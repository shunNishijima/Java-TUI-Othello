!function(){var e,t={71843:function(e,t,s){"use strict";var n=s(47019);t.Z=class{constructor(){this.info=(0,n.Z)()}get mobile(){return this.info.mobile}get name(){return this.info.name}get os(){return this.info.os}get version(){return this.info.version}get versionNumber(){return this.info.versionNumber}isChrome(){return"chrome"===this.info.name}isEdge(){return"edge"===this.info.name}isFirefox(){return"firefox"===this.info.name}isIe(){return"ie"===this.info.name}isOpera(){return"opera"===this.info.name}isSafari(){return"safari"===this.info.name}}},4444:function(e,t,s){"use strict";var n=s(16674),i=s.n(n),o=s(71207),r=s.n(o),a=s(14206),l=s.n(a),c={loading:!1,initialized:!1};c.config={locale:"nl-NL",source:"/{version}/i18n/{locale}/javascript",version:"v-"+String.uniqueID()},c.sources={};var h={get:function(e,t){if("string"!=typeof t||"_"!==t[0]||void 0!==e[t])return"symbol"==typeof t?e[t]:void 0===e[t]?t:e[t]}};"undefined"!=typeof Proxy&&(c.sources=new Proxy(c.sources,h)),i().mixin({data:function(){return{i18n:c.sources}},methods:{setLocale:function(e){e&&c.setLocale(e)}}}),c.setLocale=function(e){c.config.locale!==e&&(c.config.locale=e),c.loadSource()},c.loadSource=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!c.loading){c.loading=!0,e=e||c.config.source;var s=e.split("/").filter((function(e){return""!==e})),n=s.pop();if(t||void 0===window.$I18N||void 0===window.$I18N.resources[n]||window.$I18N.options.locale!=c.config.locale)l()(e.replace("{locale}",encodeURIComponent(c.config.locale)).replace("{version}",encodeURIComponent(c.config.version))).then((function(e){if(200!==e.status)throw Error(e);return e})).then((e=>{for(var t in e.data)e.data.hasOwnProperty(t)&&i().set(c.sources,t,e.data[t]);c.loading=!1,c.initialized=!0})).catch((function(e){c.loading=!1,console.error("Unable to load i18n",e)}));else{var o=window.$I18N.resources[n];for(var r in o)o.hasOwnProperty(r)&&i().set(c.sources,r,o[r]);c.loading=!1,c.initialized=!0}}},c.install=function(e,t){e.prototype.$f=function(e,t){try{return new(r())(e,c.config.locale).format(t||{})}catch(e){console.warn(e)}return e},t.locale&&(c.config.locale=t.locale),t.source&&(c.config.source=t.source),c.setLocale(c.config.locale),e.I18N=c,e.prototype.$i18n=c},t.Z=c},66624:function(e,t,s){"use strict";var n=s(16674),i=s.n(n),o=s(46854),r=s.n(o),a={getDomPath:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return;let s=[],n=!1,i=e;for(;null!=e.parentNode;){var o=0,r=0;for(let t=0;t<e.parentNode.childNodes.length;t++){var a=e.parentNode.childNodes[t];a.nodeName==e.nodeName&&(a===e&&(r=o),o++)}let t=e.nodeName.toLowerCase();n&&(t+="::shadow",n=!1),o>1?s.unshift(t+":nth-of-type("+(r+1)+")"):s.unshift(t),11===(e=e.parentNode).nodeType&&(n=!0,e=e.host)}if(s.splice(0,1),t&&t.contains(i)){let e=this.getDomPath(t),n=0;for(let t=0,i=e.length;t<i&&e[t]===s[t];t++)n++;s.splice(0,n)}return s},markTextNode:function(e){let t=document.createElement("mark");return e.parentNode.replaceChild(t,e),t.appendChild(e),t}},l=s(85610),c=s.n(l),h={name:"ColorPicker",computed:{current_color(){return this.$store.getters.color},colors(){return Object.entries({yellow:this.i18n.Yellow,green:this.i18n.Green,blue:this.i18n.Blue,red:this.i18n.Red}).filter((e=>e[0]!==this.current_color))},current_class(){let e=[];return e.push("mark-"+this.$store.getters.color),e.push("color"),e}},methods:{setColor(e){this.$store.dispatch("setColor",e)}}},u=s(40810),d=(0,u.Z)(h,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"selection-menu-option color-picker"},[t("span",{staticClass:"current-color"},[e._v("\n        "+e._s(e.i18n["Color:"])+" "),t("span",{class:e.current_class})]),e._v(" "),t("div",{staticClass:"color-dropdown"},[t("ul",{staticClass:"color-list"},e._l(e.colors,(function(s){let[n,i]=s;return t("li",{key:n,on:{click:function(t){return e.setColor(n)}}},[t("span",{class:["mark-"+n,{color:!0,active:e.current_color===n}]}),e._v("\n                "+e._s(i)+"\n            ")])})),0)])])}),[],!1,null,"f838b574",null).exports,m={name:"Delete",methods:{deleteSelection(){this.$store.dispatch("destroy")}}},f=(0,u.Z)(m,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"selection-menu-option css-tooltip",attrs:{"data-title":e.i18n["Delete selection"]}},[t("a",{staticClass:"fa fas fa-trash-alt",attrs:{href:"#"},on:{click:function(t){return e.deleteSelection()}}})])}),[],!1,null,"c2b3ccbc",null).exports,p={name:"NoteMenu",data:function(){return{visible:!1}},computed:{comment:{get(){return this.$store.getters.comment},set(e){this.$store.dispatch("setComment",e)}},noteInstructionsTitle(){return this.$store.getters.options.noteInstructionsTitle},noteInstructionsBody(){return this.$store.getters.options.noteInstructionsBody}}},v=(0,u.Z)(p,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"selection-menu-option note-option css-tooltip",attrs:{"data-title":e.i18n["Create a note"]}},[t("span",{class:["fa",""===e.comment?"far fa-sticky-note":"fas fa-sticky-note"]}),e._v(" "),t("div",{staticClass:"edit-field-dropdown"},[t("div",{staticClass:"edit-field-box"},[t("h4",[e._v(e._s(e.noteInstructionsTitle))]),e._v(" "),t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.comment,expression:"comment"}],staticClass:"textarea",attrs:{placeholder:e.noteInstructionsBody},domProps:{value:e.comment},on:{input:function(t){t.target.composing||(e.comment=t.target.value)}}})])])])}),[],!1,null,"1bbeaa42",null).exports,g={name:"CurrentNote",computed:{note(){return this.$store.getters.comment},editable(){return!this.$store.getters.readOnly},author(){return this.$store.getters.author},authorText(){return this.$f(this.i18n["{author} wrote:"],{author:this.author})},showNote(){return this.note&&this.note.length>0},showAuthor(){return this.$store.getters.options.showAuthor&&this.author.length>0&&this.note.length>0},options(){return this.$store.getters.options}},watch:{editable:function(){this.$forceRefresh()}}},b=(0,u.Z)(g,(function(){var e=this,t=e._self._c;return e.editable||e.showNote?t("div",{staticClass:"selection-current-note"},[e.editable?t("span",{staticClass:"fas fa-fw fa-pencil-alt"}):e._e(),e._v(" "),e.showAuthor?t("span",{staticClass:"author"},[e._v("\n        "+e._s(e.authorText)+"\n    ")]):e._e(),e._v(" "),e.showNote?t("p",[e._v("\n        "+e._s(e.note)+"\n    ")]):e._e()]):e._e()}),[],!1,null,"330f028e",null).exports,O=s(66726),E=s.n(O),k=s(82616),w=s.n(k),y={name:"Menu",components:{ColorPicker:d,Delete:f,NoteMenu:v,CurrentNote:b},data:function(){return{position:{top:0,left:0,parentWidth:0,display:"block"},padding:2,edit:!1,hover:!1,timer:null,isInSelection:!1,localStatus:!1,debouncedSetLocalStatus:null}},computed:{styles(){return{top:"".concat(this.position.top,"px"),left:"".concat(this.position.left,"px"),display:"".concat(this.position.display)}},classes(){return{"selection-menu":!0,"selection-menu-active":"active"===this.status||this.hover,rs_skip:!0,rs_preserve:!0,"align-menu-right":this.position.left>this.position.parentWidth-200,"slow-animation":this.localStatus}},status(){return this.$store.getters.status},editable(){return!this.$store.getters.readOnly},anchorElement(){return this.$store.state.anchor},scrollParentElement(){return this.getScrollParentElement(this.anchorElement)}},watch:{status:function(e){this.updatePosition(),this.checkStatus(),"active"===e?(this.debouncedSetLocalStatus.cancel(),this.setLocalStatus(!0)):this.debouncedSetLocalStatus()}},mounted:function(){this.updatePosition(),document.addEventListener("selectionchange",this.updateIsInSelection),this.scrollParentElement.addEventListener("resize",this.updatePosition),this.scrollParentElement.addEventListener("scroll",this.updatePosition),this.debouncedSetLocalStatus=E()(w()(this.setLocalStatus,!1),1500,{leading:!1})},destroyed(){this.scrollParentElement.removeEventListener("resize",this.updatePosition),this.scrollParentElement.removeEventListener("scroll",this.updatePosition),document.removeEventListener("selectionchange",this.updateIsInSelection),this.debouncedSetLocalStatus.cancel()},methods:{updatePosition(){if(!this.anchorElement||!this.anchorElement.offsetParent||!this.isElementVisible(this.anchorElement.offsetParent))return void(this.position.display="none");const e=this.anchorElement.offsetParent.getBoundingClientRect(),t=document.body.getBoundingClientRect();this.position.top=e.top-t.top+e.height+this.padding,this.position.left=Math.max(e.left,0),this.position.parentWidth=e.width,this.position.display="block"},isElementVisible(e){var t=e.getBoundingClientRect(),s=window.innerWidth||document.documentElement.clientWidth,n=window.innerHeight||document.documentElement.clientHeight,i=function(e,t){return document.elementFromPoint(e,t)};return!(t.right<0||t.bottom<0||t.left>s||t.top>n)&&(e.contains(i(t.left+1,t.top+1))||e.contains(i(t.right-1,t.top+1))||e.contains(i(t.right-1,t.bottom-1))||e.contains(i(t.left+1,t.bottom-1)))},updateIsInSelection(){this.isInSelection=""!==document.getSelection().toString()},toggleEdit(){this.edit=!0,this.$nextTick((()=>{this.updatePosition()}))},mouseEnter(){this.hover=this.localStatus},mouseLeave(){this.hover=!1,this.checkStatus()},checkStatus(){null!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{this.hover||"inactive"!==this.$store.getters.status||(this.edit=!1)}),1e3)},getScrollParentElement(e){return null!==e&&e instanceof Element&&"BODY"!==e.tagName?["scroll","auto"].indexOf(getComputedStyle(e).overflowY)>-1?e:this.getScrollParentElement(e.parentNode):window},setLocalStatus(e){this.localStatus=e}}},S=y,N=(0,u.Z)(S,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isInSelection,expression:"!isInSelection"}],class:e.classes,style:e.styles,on:{mouseenter:e.mouseEnter,mouseleave:e.mouseLeave}},[e.editable?e.editable&&!e.edit?t("div",{staticClass:"selection-edit-toggle",on:{click:e.toggleEdit}},[t("CurrentNote")],1):e.editable&&e.edit?t("div",{staticClass:"selection-menu-options"},[t("ColorPicker"),e._v(" "),t("NoteMenu"),e._v(" "),t("Delete")],1):e._e():t("div",{staticClass:"selection-menu-uneditable"},[t("CurrentNote")],1)])}),[],!1,null,null,null).exports;class C extends Error{constructor(e){super(e),this.name="InvalidRangeException"}}var _=s(4444),L=s(77382);i().use(L.ZP);class x{constructor(e,t,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouseLeave";this.element=e,this.mouseEnterCallback=t||(()=>{}),this.mouseLeaveCallback=s||(()=>{}),this.lastEvent=n,document.addEventListener("mousemove",this.mouseMoveCallback.bind(this))}mouseMoveCallback(e){if(0===document.querySelectorAll("mark[rel='".concat(this.element.getAttribute("rel"),"']")).length)return this.destroy();let t=this.element.getBoundingClientRect(),s=e.x>=t.left&&e.y>=t.top&&e.x<=t.right&&e.y<=t.bottom;return s&&"mouseenter"!==this.lastEvent.toLowerCase()?(this.lastEvent="mouseEnter",this.mouseEnterCallback(this.element)):s||"mouseleave"===this.lastEvent.toLowerCase()?void 0:(this.lastEvent="mouseLeave",this.mouseLeaveCallback(this.element))}destroy(){document.removeEventListener("mousemove",this.mouseMoveCallback.bind(this))}}const T=new(s(71843).Z);var M=s(50343);const I=".selection-menu, .rs_skip, .ignore, textarea, select, .handsontable, .CodeMirror, input, *[contenteditable], a, select, .drawing-interaction, .PinturaContentEditable";class P{constructor(e){this.events=new M,this.parent=e,this.anchor=null,this.ignoreOffsetsFrom=I,this.root=null,this.rootOffset=null,this.startOffset=0,this.endOffset=0,this.status="inactive",this.saving=!1,this.text="",this.comment="",this.author="",this.color=this.parent.Marker.options.defaultColor,this.markElements=[],this.onDelete=null,this.mouseOverElementEvents=[],this.setReferer(),this.observer=null}loadFromRange(e){let t=e.cloneRange();if((t.startContainer instanceof Text?t.startContainer.parentNode:t.startContainer).closest(this.ignoreOffsetsFrom))throw new C;let s=this.parent.compareDocumentPosition(t.startContainer),n=this.parent.compareDocumentPosition(t.endContainer);s&Node.DOCUMENT_POSITION_PRECEDING&&!(s&Node.DOCUMENT_POSITION_CONTAINED_BY)&&t.setStartBefore(this.parent.firstChild);let i=n&Node.DOCUMENT_POSITION_FOLLOWING&&!(n&Node.DOCUMENT_POSITION_CONTAINED_BY);if(""===t.toString().trim())throw t.collapse(!1),new C("Empty range");if(this.root=i?this.parent:this.getRoot(t.commonAncestorContainer),!1===this.root)throw new C;this.rootOffset=this.getOffset(this.parent,this.root),this.startOffset=this.getOffset(this.root,t.startContainer,this.rootOffset)+t.startOffset,n&Node.DOCUMENT_POSITION_FOLLOWING&&!(n&Node.DOCUMENT_POSITION_CONTAINED_BY)?this.endOffset=this.parent.textContent.length:this.endOffset=this.getOffset(this.root,t.endContainer,this.rootOffset)+t.endOffset,this.id="sel-"+c().generate(),this.status="active",t.collapse(!1)}loadFromString(e){const t=JSON.decode(e);return this.loadFromObject(t)}loadFromObject(e){if(e.root){let t=e.root;if(t.includes("&gt;")){t=(new DOMParser).parseFromString(t,"text/html").documentElement.textContent}this.root=[...this.parent.querySelectorAll(t)].find((t=>a.getDomPath(t,this.parent).join(" > ")===e.root))}else this.root=this.parent;if(!this.root)throw new C("Root object not found");try{this.rootOffset=this.getOffset(this.parent,this.root),this.startOffset=e.start,this.endOffset=e.end,this.color=e.color,this.id=e.id,this.comment=e.comment,this.author=e.user,this.setReferer(e.referer)}catch(e){throw new C(e.toString())}}setReferer(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.referer=e||this.parent.Marker.getRefererForNewSelection(),this.readOnly=this.parent.Marker.options.readOnly||!1===this.parent.Marker.options.referer[this.referer]}mark(){let e,t=this.rootOffset,s=document.createNodeIterator(this.root,NodeFilter.SHOW_TEXT,(e=>!(e.parentNode.closest(this.ignoreOffsetsFrom)||"mark"===e.parentNode.tagName.toLowerCase()&&this.markElements.contains(e.parentNode))),!0);for(;null!=(e=s.nextNode());){let s=e.textContent.length;if(this.startOffset>t+s)t+=s;else if(this.startOffset>=t){let n=this.startOffset-t;if(this.endOffset<=t+s){let t=this.endOffset-this.startOffset;this.markElements.push(a.markTextNode(e.splitText(n).splitText(t).previousSibling,this.color));break}this.markElements.push(a.markTextNode(e.splitText(n),this.color)),t+=s}else{if(this.endOffset<=t+s){let s=this.endOffset-t;this.markElements.push(a.markTextNode(e.splitText(s).previousSibling,this.color));break}this.markElements.push(a.markTextNode(e,this.color)),t+=s}}this.markElements[this.markElements.length-1].classList.add("last-mark"),this.anchor=document.createElement("a"),this.anchor.setAttribute("name",this.id),this.anchor.classList.add("selection-anchor"),this.markElements[this.markElements.length-1].insertBefore(this.anchor,this.markElements[this.markElements.length-1].firstChild),this.text="";for(let e of this.markElements)e.setAttribute("rel",this.id),e.classList.add("selection-mark"),e.classList.add("rs_preserve"),this.comment&&this.comment.length>0&&e.classList.add("comment"),e.setAttribute("data-color",this.color),this.text+=e.textContent,T.isIe()?(e.addEventListener("mouseenter",(e=>this.onMouseEnter(e.target))),e.addEventListener("mouseleave",(e=>this.onMouseLeave(e.target)))):this.mouseOverElementEvents.push(new x(e,this.onMouseEnter.bind(this),this.onMouseLeave.bind(this)));this.observer=new MutationObserver(this.elementObserver.bind(this)),this.observer.observe(this.parent.ownerDocument.documentElement,{attributes:!1,childList:!0,subtree:!0}),this.clickHandler=this.onMouseClick.bind(this),window.addEventListener("click",this.clickHandler)}unmark(){this.anchor&&(this.anchor.parentNode.removeChild(this.anchor),this.anchor=null);for(let e of this.markElements){let t,s=document.createDocumentFragment();for(;null!==(t=e.firstChild);)s.appendChild(t);e.parentNode.replaceChild(s,e)}this.markElements=[],this.menu&&(this.menu.$el.parentNode.removeChild(this.menu.$el),this.menu.$destroy(),this.menu=null)}destroy(){this.events.emit("destroy",this.id),this.reset(),this.events.removeAllListeners()}destruct(){this.reset(),this.events.emit("destruct",this.id),this.events.removeAllListeners(),this.observer.disconnect(),this.observer=null}reset(){if(this.unmark(),this.parent=null,this.root=null,T.isIe())for(let e of this.markElements)e.removeEventListener("mouseenter",(t=>this.onMouseEnter(t,e))),e.removeEventListener("mouseleave",(t=>this.onMouseLeave(t,e)));else{for(;this.mouseOverElementEvents.length>0;)this.mouseOverElementEvents[0].destroy(),delete this.mouseOverElementEvents[0],this.mouseOverElementEvents.splice(0,1);this.mouseOverElementEvents=[]}window.removeEventListener("click",this.clickHandler)}createMenu(){if(0===this.markElements.length)return;let e=document.createElement("span");document.body.appendChild(e);let t={locale:document.documentElement.getAttribute("lang"),version:"v-"+String.uniqueID(),source:"/{version}/i18n/{locale}/javascript"};var s;window.$i18n_javascript&&(t.source=window.$i18n_javascript+"{locale}/javascript"),i().use(_.Z,t),this.menu=new(i())({el:e,store:(s=this,new L.ZP.Store({state:s,mutations:{setStatus(e,t){e.status=t},setColor(e,t){e.color=t},setComment(e,t){e.comment=t}},getters:{status:function(e){return e.status},color:function(e){return e.color},options:function(e){return e.parent.Marker.options},comment:function(e){return e.comment},author:function(e){return e.author},readOnly:function(e){return e.readOnly},state:function(e){return e}},actions:{setComment:function(e,t){e.commit("setComment",t),e.state.updateMarkedElements(),e.state.events.emit("update",e.state)},setColor:function(e,t){e.commit("setColor",t),e.state.updateMarkedElements(),e.state.parent.Marker.setDefaultColor(t),e.state.events.emit("update",e.state)},destroy:function(e){e.state.destroy()}}})),render(e){return e(N)}})}updateMarkedElements(){function e(){let e="inactive";for(let t of this.markElements)t.setAttribute("data-color",this.color),t.classList.toggle("comment",(this.comment||"").length>0),void 0!==t.status&&"inactive"!==t.status&&(e="active");this.status=e}arguments.length>0&&void 0!==arguments[0]&&arguments[0]?(this._updateMarkedElements||(this._updateMarkedElements=E()(e.bind(this),200)),this._updateMarkedElements()):e.bind(this)()}serialize(){return JSON.stringify(this.getData())}getData(){return{start:this.startOffset,end:this.endOffset,root:(a.getDomPath(this.root,this.parent)||[]).join(" > "),text:this.text,color:this.color,comment:this.comment,id:this.id}}getRangeKey(){return[this.startOffset,this.endOffset].join(":")}select(){let e=document.createRange();e.setStartBefore(this.markElements[0]),e.setStartAfter(this.markElements[this.markElements.length-1]);let t=document.getSelection();t.removeAllRanges(),t.addRange(e)}getText(){return this.text}getOffset(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e===t)return s;for(let n of e.childNodes){if(t===n)break;if(n instanceof Text)s+=n.textContent.length;else if(n instanceof Element){if(t instanceof Text&&(n.contains(t.parentNode)||n===t.parentNode)||n.contains(t)){s=this.getOffset(n,t,s);break}if(!n.matches(this.ignoreOffsetsFrom)){s+=n.textContent.length;for(let e of n.querySelectorAll(this.ignoreOffsetsFrom))s-=e.textContent.length}}}return s}getRoot(e){return(e===this.parent||e instanceof Text||!e.contains(this.parent))&&(e instanceof Text||e instanceof Element&&"mark"===e.tagName.toLowerCase()?this.getRoot(e.parentNode):!(e instanceof Element&&e.matches(this.ignoreOffsetsFrom))&&e)}onMouseEnter(e){e.status="active",this.updateMarkedElements(!0)}onMouseLeave(e){e.status="inactive",this.updateMarkedElements(!0)}onMouseClick(){this.updateMarkedElements(!1)}elementObserver(e){let t=!1;for(let s of e){if(s.removedNodes)for(let e of s.removedNodes)if(e===this.parent||e.contains(this.parent)){t=!0;break}if(t)break}t&&this.destruct()}}class D extends Error{constructor(e){super(e),this.name="SelectionException"}}var j=window.selectionWindowRegistry=window.selectionWindowRegistry||new class{constructor(){this.selectionListeners=new Map,this.selected=!1,this.enabled=!1,this.enabledTimer=null,document.addEventListener("mousedown",(()=>{this.enabledTimer&&(clearTimeout(this.enabledTimer),this.enabledTimer=null,this.enabled=!1),this.enabledTimer=setTimeout((()=>{this.enabled=!0}),50)})),document.addEventListener("mouseup",(e=>{this.enabled&&window.$enable_marker&&(this.onGlobalSelection(e),this.enabled=!1)})),document.addEventListener("click",(e=>{this.selected&&e.preventDefault(),this.selected=!1}))}onGlobalSelection(e){this.selected=!1;for(let[s,n]of this.selectionListeners)if(n.isSelected()){var t;null!==(t=window.onSelectMediator)&&void 0!==t&&t.active?window.onSelectMediator.stackActions({id:"SelectionListenerRegistry-onGlobalSelection",title:$I18N.t("Mark Selection"),cssClasses:"osm-marker-icon",function:()=>{n.onSelection(e)},instant:!0}):n.onSelection(e),this.selected=!0;break}let s=document.getSelection();if(s.rangeCount>0){var n;let t=s.getRangeAt(0),i=t.commonAncestorContainer;i instanceof Text&&(i=i.parentNode),i.closest(I)||e.target.closest(I)||t.collapsed||null!==(n=window.onSelectMediator)&&void 0!==n&&n.active||t.collapse(!1)}}};class R{constructor(e){if(this.element=e,void 0!==this.element.SelectionListener)throw new D("This element already has an selection listener");this.id=r()("selectionlistener-"),this.listeners=[],j.selectionListeners.set(this.id,this),this.element.SelectionListener=this}destructor(){j.selectionListeners.delete(this.id),this.listeners=[],delete this.element.SelectionListener,delete this.element}onSelection(e){e.preventDefault();let t=document.getSelection();if(t.rangeCount>0){let e=t.getRangeAt(0);if(e&&!e.collapsed)try{let t=new P(this.element);t.loadFromRange(e);for(let e of this.listeners)e(t)}catch(e){e instanceof C||void 0!==window.Sentry&&window.Sentry.captureException(e)}}}addSelectionListener(e){this.listeners.push(e)}removeSelectionListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}isSelected(){let e=document.getSelection();if(0==e.rangeCount||"Caret"==e.type)return!1;let t=e.getRangeAt(0),s=t.startContainer,n=t.endContainer,i=this.element.compareDocumentPosition(s),o=this.element.compareDocumentPosition(n);if(i&Node.DOCUMENT_POSITION_FOLLOWING&&!(i&Node.DOCUMENT_POSITION_CONTAINED_BY))return!1;if(o&Node.DOCUMENT_POSITION_PRECEDING&&!(o&Node.DOCUMENT_POSITION_CONTAINED_BY))return!1;if(Node.DOCUMENT_POSITION_PRECEDING,this.element.contains(e.anchorNode),this.element.contains(e.focusNode),t.collapsed){try{t.collapse()}catch(e){}return!1}return!0}}var $=s(14206),A=s.n($),q=s(23954),F=s.n(q),U=s(73915),B=s.n(U);var Z=A().create({baseURL:"/marker/restapi/resource",headers:{"X-Request":"REST"}});Z.interceptors.request.use((function(e){if("post"===e.method.toLocaleLowerCase()){let t=function(e){if(void 0!==document["$"+e])return document["$"+e];try{return document.cookie.split(";").find((t=>t.trim().split("=")[0].toLowerCase()===e.toLowerCase())).split("=")[1]}catch(e){return null}}("csrf");t&&(e.headers.common["X-CSRF-TOKEN"]=t)}return e}),(function(e){return Promise.reject(e)})),Z.interceptors.response.use((function(e){return e}),(async function(e){return async function(e){e=JSON.parse(JSON.stringify(e)),B()(e,"response")&&!F()(e.response)&&console.error(e)}(e),Promise.reject(e)}));var W=Z,G={async find(e){let t=await W.get("marker",{params:e});return 200===t.status&&t.data.markers},async get(e){let t=await W.get("marker/".concat(e));return 200===t.status&&t.data.marker},async put(e,t){let s={};Object.assign(s,e,JSON.decode(t.serialize())),"number"!=typeof s.id&&delete s.id;let n=await W.put("marker",s);return 200===n.status&&n.data.id},async delete(e){return 200===(await W.delete("marker/".concat(e))).status}},z=s(61280);let Y,J=[];s(67155);class H{constructor(e,t){this.element=e,this.element.Marker=this,this.options=this.parseOptions(t),this.selections={},this.scope={referer:this.options.referer,link_name:this.options.name,link_model:this.options.model,link_id:this.options.modelId},this.queue=new z.Z,this.queue.start();let s={"-webkit-user-select":"text","-khtml-user-select":"text","-moz-user-select":"text","-ms-user-select":"text","user-select":"text",position:"static"===getComputedStyle(e)?"relative":null};for(let e in s)this.element.style.setProperty(e,s[e]);this.options.readOnly||(this.selectionListener=new R(e),this._onSelect=this.onSelect.bind(this),this.selectionListener.addSelectionListener(this._onSelect)),J.push(this),this.loadSelections()}parseOptions(e){var t={name:null,model:null,modelId:null,readOnly:!1,defaultColor:"yellow",showAuthor:!1,noteInstructionsTitle:window.$I18N.t("Write your notes here:"),noteInstructionsBody:window.$I18N.t("Add a note to this marking")};let s=JSON.parse(this.element.getAttribute("data-marker"));if("object"==typeof s&&null!==s&&(t=Object.merge(t,Object.filter(s,(function(e){return null!=e})))),this.element.setAttribute("data-marker","true"),"string"==typeof(t=Object.merge(t,e)).referer){let e=t.referer;t.referer={},t.referer[e]=!0}return("object"!=typeof t.referer||Object.keys(t.referer).length<1)&&(t.referer={},t.referer[document.location.pathname+document.location.search]=!0),t}destructor(){this.flushQueue();for(let e in this.selections){this.selections[e].destruct()}this.selections={},J.splice(J.indexOf(this),1),this.selectionListener.removeSelectionListener(this._onSelect),this.selectionListener.destructor(),delete this.selectionListener,delete this.element.Marker,this.element.removeAttribute("data-marker")}async onSelect(e){for(let t in this.selections){if(this.selections[t].getRangeKey()===e.getRangeKey())return}e.events.on("destroy",this.onDestroy.bind(this)),e.events.on("update",this.onUpdate.bind(this)),e.events.on("destruct",this.onDestruct.bind(this)),e.mark(),e.createMenu(),this.selections[e.id]=e;try{e.saving=!0;let t=await G.put(this.scope,e);t!==e.id&&(delete this.selections[e.id],e.id=t,this.selections[t]=e),this.syncMarkers((t=>{t.addSelectionObject(e.getData())})),e.saving=!1}catch(e){}}async loadSelections(){try{let e=await G.find(this.scope);for(let t of e)this.addSelectionObject(t)}catch(e){}}async deleteSelection(e){try{await G.delete(e)&&(delete this.selections[e],this.syncMarkers((t=>{t.selections[e]&&(t.selections[e].destructor(),delete t.selections[e])})))}catch(e){}}async saveSelection(e){try{const t=e.id,s=await G.put(this.scope,e);s&&(delete this.selections[t],this.selections[s]=e,this.selections[s].id=s,this.syncMarkers((n=>{let i;n.selections[t]?(i=n.selections[t],n.selections[s]=i,n.selections[s].id=s):n.selections[s]&&(i=n.selections[s]),i?(i.color=e.color,i.comment=e.comment):n.addSelectionObject(e.getData())})))}catch(t){this.queue.add("save-"+e.id,this.saveSelection,[e],this)}}addSelectionObject(e){let t=new P(this.element);t.events.on("destroy",this.onDestroy.bind(this)),t.events.on("update",this.onUpdate.bind(this)),t.events.on("destruct",this.onDestruct.bind(this));try{t.loadFromObject(e),this.selections[t.id]=t,t.mark(),t.createMenu()}catch{}}onDestruct(e){delete this.selections[e]}onDestroy(e){this.queue.add(e,this.deleteSelection,[e],this)}onUpdate(e){this.queue.add(e.id,this.saveSelection,[e],this)}syncMarkers(e){for(let t of J)t!==this&&t.scope.link_name===this.scope.link_name&&t.scope.link_model===this.scope.link_model&&t.scope.link_id===this.scope.link_id&&t.scope.referer===this.scope.referer&&e(t)}setDefaultColor(e){this.options.defaultColor=e}async flushQueue(){await this.queue.flush()}getRefererForNewSelection(){return Object.keys(this.options.referer).find((e=>this.options.referer[e]))}}function K(e){let t=JSON.parse(e.getAttribute("data-marker"));new H(t.node||e)}let X={childList:!0,subtree:!0};if("undefined"!=typeof MutationObserver&&(Y=new MutationObserver((function(e){Object.each(e,(function(e){if("childList"===e.type){for(let t of e.removedNodes)t.nodeType===Node.ELEMENT_NODE&&t.Marker&&t.Marker.destructor(),t.nodeType===Node.ELEMENT_NODE&&t.SelectionListener&&t.SelectionListener.destructor();for(let t of e.addedNodes)t.nodeType===Node.ELEMENT_NODE&&t.hasAttribute("data-marker")&&K(t)}}))}))),s(29325),i().config.devtools=!1,i().config.debug=!1,i().config.performance=!1,i().config.silent=!0,"complete"===document.readyState)for(let e of document.querySelectorAll("*[data-marker]"))K(e);else document.onreadystatechange=()=>{if("complete"===document.readyState)for(let e of document.querySelectorAll("*[data-marker]"))K(e)};var Q;Q=document.documentElement,Y.observe(Q,X)},61280:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});class n{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.queue=t,this.timeout=e,this.started=!1,this.running=!1,this.timer=null}add(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i={id:e,func:async()=>{null!==n?await t.apply(n,s):await t(...s)}},o=this.queue.find((t=>t.id===e));if(void 0!==o){let e=this.queue.indexOf(o);this.queue[e]=i}else this.queue.push(i);return this}async dequeue(){this.running=this.queue.shift(),this.running&&await this.running.func(),this.running=!1}next(){this.started&&(!1===this.running&&this.dequeue(),this.timer=setTimeout(function(){this.next()}.bind(this),this.timeout))}async flush(){for(this.stop();this.queue.length>0;)await this.dequeue();return this.start(),this}start(){return this.started||(this.started=!0,this.next()),this}stop(){return this.started=!1,clearTimeout(this.timer),this}}},67155:function(e,t,s){"use strict";s.r(t)},31843:function(){}},s={};function n(e){var i=s[e];if(void 0!==i)return i.exports;var o=s[e]={id:e,loaded:!1,exports:{}};return t[e].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.m=t,e=[],n.O=function(t,s,i,o){if(!s){var r=1/0;for(h=0;h<e.length;h++){s=e[h][0],i=e[h][1],o=e[h][2];for(var a=!0,l=0;l<s.length;l++)(!1&o||r>=o)&&Object.keys(n.O).every((function(e){return n.O[e](s[l])}))?s.splice(l--,1):(a=!1,o<r&&(r=o));if(a){e.splice(h--,1);var c=i();void 0!==c&&(t=c)}}return t}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[s,i,o]},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.hmd=function(e){return(e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:function(){throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},n.j=39,n.p="/v-940e8967/resources/minified-javascript/36035-27ef920f5b44ba56feef9fe25de7db05293536a1/application/webpacks/",function(){var e={39:0};n.O.j=function(t){return 0===e[t]};var t=function(t,s){var i,o,r=s[0],a=s[1],l=s[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(l)var h=l(n)}for(t&&t(s);c<r.length;c++)o=r[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(h)},s=self.webpackChunk=self.webpackChunk||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}(),n.O(void 0,[705],(function(){return n(1569)}));var i=n.O(void 0,[705],(function(){return n(66624)}));i=n.O(i)}();
//# sourceMappingURL=sourcemaps/marker.js.map