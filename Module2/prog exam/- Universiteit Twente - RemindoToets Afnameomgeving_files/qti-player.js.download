!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Raphael=e():t.Raphael=e()}(window,function(){return n={},r.m=i=[function(t,e,i){var i=[i(2)];void 0===(i=function(A){function P(t){if(P.is(t,"function"))return n?t():A.on("raphael.DOMload",t);if(P.is(t,y))return P._engine.create[b](P,t.splice(0,3+P.is(t[0],B))).add(t);var e=Array.prototype.slice.call(arguments,0);if(P.is(e[e.length-1],"function")){var i=e.pop();return n?i.call(P._engine.create[b](P,e)):A.on("raphael.DOMload",function(){i.call(P._engine.create[b](P,e))})}return P._engine.create[b](P,arguments)}P.version="2.3.0",P.eve=A;function t(){this.ca=this.customAttributes={}}function e(t,e,i,n){return[["M",t,e],["m",0,-(n=null==n?i:n)],["a",i,n,0,1,1,0,2*n],["a",i,n,0,1,1,0,-2*n],["z"]]}var n,i,r,D=/[, ]+/,a={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},s=/\{(\d+)\}/g,O="hasOwnProperty",f={doc:document,win:window},o={was:Object.prototype[O].call(f.win,"Raphael"),is:f.win.Raphael},b="apply",L="concat",m="ontouchstart"in window||window.TouchEvent||window.DocumentTouch&&document instanceof DocumentTouch,w="",T=" ",M=String,R="split",l="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[R](T),u={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},v=M.prototype.toLowerCase,E=Math,x=E.max,S=E.min,N=E.abs,g=E.pow,k=E.PI,B="number",y="array",h=Object.prototype.toString,c=(P._ISURL=/^url\(['"]?(.+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),d={NaN:1,Infinity:1,"-Infinity":1},F=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,C=E.round,U=parseFloat,p=parseInt,_=M.prototype.toUpperCase,j=P._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0,class:""},q=P._availableAnimAttrs={blur:B,"clip-rect":"csv",cx:B,cy:B,fill:"colour","fill-opacity":B,"font-size":B,height:B,opacity:B,path:"path",r:B,rx:B,ry:B,stroke:"colour","stroke-opacity":B,"stroke-width":B,transform:"transform",width:B,x:B,y:B},I=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,z={hs:1,rg:1},H=/,?([achlmqrstvxz]),?/gi,V=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,W=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,G=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,X=(P._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),$=function(t,e){return U(t)-U(e)},Y=function(t){return t},K=P._rectPath=function(t,e,i,n,r){return r?[["M",t+r,e],["l",i-2*r,0],["a",r,r,0,0,1,r,r],["l",0,n-2*r],["a",r,r,0,0,1,-r,r],["l",2*r-i,0],["a",r,r,0,0,1,-r,-r],["l",0,2*r-n],["a",r,r,0,0,1,r,-r],["z"]]:[["M",t,e],["l",i,0],["l",0,n],["l",-i,0],["z"]]},Q=P._getPath={path:function(t){return t.attr("path")},circle:function(t){t=t.attrs;return e(t.cx,t.cy,t.r)},ellipse:function(t){t=t.attrs;return e(t.cx,t.cy,t.rx,t.ry)},rect:function(t){t=t.attrs;return K(t.x,t.y,t.width,t.height,t.r)},image:function(t){t=t.attrs;return K(t.x,t.y,t.width,t.height)},text:function(t){t=t._getBBox();return K(t.x,t.y,t.width,t.height)},set:function(t){t=t._getBBox();return K(t.x,t.y,t.width,t.height)}},J=P.mapPath=function(t,e){if(!e)return t;for(var i,n,r,a,s,o=0,l=(t=Et(t)).length;o<l;o++)for(r=1,a=(s=t[o]).length;r<a;r+=2)i=e.x(s[r],s[r+1]),n=e.y(s[r],s[r+1]),s[r]=i,s[r+1]=n;return t};if(P._g=f,P.type=f.win.SVGAngle||f.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==P.type){var Z,tt=f.doc.createElement("div");if(tt.innerHTML='<v:shape adj="1"/>',(Z=tt.firstChild).style.behavior="url(#default#VML)",!Z||"object"!=typeof Z.adj)return P.type=w;tt=null}function et(t){if("function"==typeof t||Object(t)!==t)return t;var e,i=new t.constructor;for(e in t)t[O](e)&&(i[e]=et(t[e]));return i}P.svg=!(P.vml="VML"==P.type),P._Paper=t,P.fn=Z=t.prototype=P.prototype,P._id=0,P.is=function(t,e){return"finite"==(e=v.call(e))?!d[O](+t):"array"==e?t instanceof Array:"null"==e&&null===t||e==typeof t&&null!==t||"object"==e&&t===Object(t)||"array"==e&&Array.isArray&&Array.isArray(t)||h.call(t).slice(8,-1).toLowerCase()==e},P.angle=function(t,e,i,n,r,a){if(null!=r)return P.angle(t,e,r,a)-P.angle(i,n,r,a);i=t-i,n=e-n;return i||n?(180+180*E.atan2(-n,-i)/k+360)%360:0},P.rad=function(t){return t%360*k/180},P.deg=function(t){return Math.round(180*t/k%360*1e3)/1e3},P.snapTo=function(t,e,i){if(i=P.is(i,"finite")?i:10,P.is(t,y)){for(var n=t.length;n--;)if(N(t[n]-e)<=i)return t[n]}else{var r=e%(t=+t);if(r<i)return e-r;if(t-i<r)return e-r+t}return e},P.createUUID=(i=/[xy]/g,r=function(t){var e=16*E.random()|0;return("x"==t?e:3&e|8).toString(16)},function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(i,r).toUpperCase()}),P.setWindow=function(t){A("raphael.setWindow",P,f.win,t),f.win=t,f.doc=f.win.document,P._engine.initWin&&P._engine.initWin(f.win)};function it(){return"hsb("+[this.h,this.s,this.b]+")"}function nt(){return"hsl("+[this.h,this.s,this.l]+")"}function rt(t,e,i){var n;return null==e&&P.is(t,"object")&&"r"in t&&"g"in t&&"b"in t&&(i=t.b,e=t.g,t=t.r),null==e&&P.is(t,"string")&&(t=(n=P.getRGB(t)).r,e=n.g,i=n.b),(1<t||1<e||1<i)&&(t/=255,e/=255,i/=255),[t,e,i]}function at(t,e,i,n){return i={r:t*=255,g:e*=255,b:i*=255,hex:P.rgb(t,e,i),toString:ot},P.is(n,"finite")&&(i.opacity=n),i}var st=function(t){if(P.vml){var i,n=/^\s+|\s+$/g;try{var e=new ActiveXObject("htmlfile");e.write("<body>"),e.close(),i=e.body}catch(t){i=createPopup().document.body}var r=i.createTextRange();st=lt(function(t){try{i.style.color=M(t).replace(n,w);var e=r.queryCommandValue("ForeColor");return"#"+("000000"+(e=(255&e)<<16|65280&e|(16711680&e)>>>16).toString(16)).slice(-6)}catch(t){return"none"}})}else{var a=f.doc.createElement("i");a.title="Raphaël Colour Picker",a.style.display="none",f.doc.body.appendChild(a),st=lt(function(t){return a.style.color=t,f.doc.defaultView.getComputedStyle(a,w).getPropertyValue("color")})}return st(t)},ot=function(){return this.hex};function lt(a,s,o){return function t(){var e=Array.prototype.slice.call(arguments,0),i=e.join("␀"),n=t.cache=t.cache||{},r=t.count=t.count||[];return n[O](i)?function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return t.push(t.splice(i,1)[0])}(r,i):(1e3<=r.length&&delete n[r.shift()],r.push(i),n[i]=a[b](s,e)),o?o(n[i]):n[i]}}function ut(){return this.hex}function ht(t,e){for(var i=[],n=0,r=t.length;n<r-2*!e;n+=2){var a=[{x:+t[n-2],y:+t[n-1]},{x:+t[n],y:+t[n+1]},{x:+t[n+2],y:+t[n+3]},{x:+t[n+4],y:+t[n+5]}];e?n?r-4==n?a[3]={x:+t[0],y:+t[1]}:r-2==n&&(a[2]={x:+t[0],y:+t[1]},a[3]={x:+t[2],y:+t[3]}):a[0]={x:+t[r-2],y:+t[r-1]}:r-4==n?a[3]=a[2]:n||(a[0]={x:+t[n],y:+t[n+1]}),i.push(["C",(-a[0].x+6*a[1].x+a[2].x)/6,(-a[0].y+6*a[1].y+a[2].y)/6,(a[1].x+6*a[2].x-a[3].x)/6,(a[1].y+6*a[2].y-a[3].y)/6,a[2].x,a[2].y])}return i}P.color=function(t){var e;return P.is(t,"object")&&"h"in t&&"s"in t&&"b"in t?(e=P.hsb2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.hex=e.hex):P.is(t,"object")&&"h"in t&&"s"in t&&"l"in t?(e=P.hsl2rgb(t),t.r=e.r,t.g=e.g,t.b=e.b,t.hex=e.hex):(P.is(t,"string")&&(t=P.getRGB(t)),P.is(t,"object")&&"r"in t&&"g"in t&&"b"in t?(e=P.rgb2hsl(t),t.h=e.h,t.s=e.s,t.l=e.l,e=P.rgb2hsb(t),t.v=e.b):(t={hex:"none"}).r=t.g=t.b=t.h=t.s=t.v=t.l=-1),t.toString=ot,t},P.hsb2rgb=function(t,e,i,n){var r,a,s;return this.is(t,"object")&&"h"in t&&"s"in t&&"b"in t&&(i=t.b,e=t.s,n=t.o,t=t.h),a=(s=i*e)*(1-N((t=360*t%360/60)%2-1)),i=e=r=i-s,at(i+=[s,a,0,0,a,s][t=~~t],e+=[a,s,s,a,0,0][t],r+=[0,0,a,s,s,a][t],n)},P.hsl2rgb=function(t,e,i,n){var r,a,s;return this.is(t,"object")&&"h"in t&&"s"in t&&"l"in t&&(i=t.l,e=t.s,t=t.h),(1<t||1<e||1<i)&&(t/=360,e/=100,i/=100),a=(s=2*e*(i<.5?i:1-i))*(1-N((t=360*t%360/60)%2-1)),i=e=r=i-s/2,at(i+=[s,a,0,0,a,s][t=~~t],e+=[a,s,s,a,0,0][t],r+=[0,0,a,s,s,a][t],n)},P.rgb2hsb=function(t,e,i){var n,r;return t=(i=rt(t,e,i))[0],e=i[1],i=i[2],{h:((0==(r=(n=x(t,e,i))-S(t,e,i))?null:n==t?(e-i)/r:n==e?(i-t)/r+2:(t-e)/r+4)+360)%6*60/360,s:0==r?0:r/n,b:n,toString:it}},P.rgb2hsl=function(t,e,i){var n,r,a;return t=(i=rt(t,e,i))[0],e=i[1],i=i[2],n=((r=x(t,e,i))+(a=S(t,e,i)))/2,{h:((0==(a=r-a)?null:r==t?(e-i)/a:r==e?(i-t)/a+2:(t-e)/a+4)+360)%6*60/360,s:0==a?0:n<.5?a/(2*n):a/(2-2*n),l:n,toString:nt}},P._path2string=function(){return this.join(",").replace(H,"$1")},P._preload=function(t,e){var i=f.doc.createElement("img");i.style.cssText="position:absolute;left:-9999em;top:-9999em",i.onload=function(){e.call(this),this.onload=null,f.doc.body.removeChild(this)},i.onerror=function(){f.doc.body.removeChild(this)},f.doc.body.appendChild(i),i.src=t},P.getRGB=lt(function(t){if(!t||(t=M(t)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:ut};if("none"==t)return{r:-1,g:-1,b:-1,hex:"none",toString:ut};var e,i,n,r,a,s=(t=!z[O](t.toLowerCase().substring(0,2))&&"#"!=t.charAt()?st(t):t).match(c);return s?(s[2]&&(n=p(s[2].substring(5),16),i=p(s[2].substring(3,5),16),e=p(s[2].substring(1,3),16)),s[3]&&(n=p((t=s[3].charAt(3))+t,16),i=p((t=s[3].charAt(2))+t,16),e=p((t=s[3].charAt(1))+t,16)),s[4]&&(a=s[4][R](I),e=U(a[0]),"%"==a[0].slice(-1)&&(e*=2.55),i=U(a[1]),"%"==a[1].slice(-1)&&(i*=2.55),n=U(a[2]),"%"==a[2].slice(-1)&&(n*=2.55),"rgba"==s[1].toLowerCase().slice(0,4)&&(r=U(a[3])),a[3]&&"%"==a[3].slice(-1)&&(r/=100)),s[5]?(a=s[5][R](I),e=U(a[0]),"%"==a[0].slice(-1)&&(e*=2.55),i=U(a[1]),"%"==a[1].slice(-1)&&(i*=2.55),n=U(a[2]),"%"==a[2].slice(-1)&&(n*=2.55),"deg"!=a[0].slice(-3)&&"°"!=a[0].slice(-1)||(e/=360),"hsba"==s[1].toLowerCase().slice(0,4)&&(r=U(a[3])),a[3]&&"%"==a[3].slice(-1)&&(r/=100),P.hsb2rgb(e,i,n,r)):s[6]?(a=s[6][R](I),e=U(a[0]),"%"==a[0].slice(-1)&&(e*=2.55),i=U(a[1]),"%"==a[1].slice(-1)&&(i*=2.55),n=U(a[2]),"%"==a[2].slice(-1)&&(n*=2.55),"deg"!=a[0].slice(-3)&&"°"!=a[0].slice(-1)||(e/=360),"hsla"==s[1].toLowerCase().slice(0,4)&&(r=U(a[3])),a[3]&&"%"==a[3].slice(-1)&&(r/=100),P.hsl2rgb(e,i,n,r)):((s={r:e,g:i,b:n,toString:ut}).hex="#"+(16777216|n|i<<8|e<<16).toString(16).slice(1),P.is(r,"finite")&&(s.opacity=r),s)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:ut}},P),P.hsb=lt(function(t,e,i){return P.hsb2rgb(t,e,i).hex}),P.hsl=lt(function(t,e,i){return P.hsl2rgb(t,e,i).hex}),P.rgb=lt(function(t,e,i){function n(t){return t+.5|0}return"#"+(16777216|n(i)|n(e)<<8|n(t)<<16).toString(16).slice(1)}),P.getColor=function(t){var e=this.getColor.start=this.getColor.start||{h:0,s:1,b:t||.75},t=this.hsb2rgb(e.h,e.s,e.b);return e.h+=.075,1<e.h&&(e.h=0,e.s-=.2,e.s<=0&&(this.getColor.start={h:0,s:1,b:e.b})),t.hex},P.getColor.reset=function(){delete this.start},P.parsePathString=function(t){if(!t)return null;var e=ct(t);if(e.arr)return wt(e.arr);var a={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},s=[];return(s=P.is(t,y)&&P.is(t[0],y)?wt(t):s).length||M(t).replace(V,function(t,e,i){var n=[],r=e.toLowerCase();if(i.replace(G,function(t,e){e&&n.push(+e)}),"m"==r&&2<n.length&&(s.push([e][L](n.splice(0,2))),r="l",e="m"==e?"l":"L"),"r"==r)s.push([e][L](n));else for(;n.length>=a[r]&&(s.push([e][L](n.splice(0,a[r]))),a[r]););}),s.toString=P._path2string,e.arr=wt(s),s},P.parseTransformString=lt(function(t){if(!t)return null;var r=[];return(r=P.is(t,y)&&P.is(t[0],y)?wt(t):r).length||M(t).replace(W,function(t,e,i){var n=[];v.call(e),i.replace(G,function(t,e){e&&n.push(+e)}),r.push([e][L](n))}),r.toString=P._path2string,r},this,function(t){if(!t)return t;for(var e=[],i=0;i<t.length;i++){for(var n=[],r=0;r<t[i].length;r++)n.push(t[i][r]);e.push(n)}return e});var ct=function(e){var i=ct.ps=ct.ps||{};return i[e]?i[e].sleep=100:i[e]={sleep:100},setTimeout(function(){for(var t in i)i[O](t)&&t!=e&&(i[t].sleep--,i[t].sleep||delete i[t])}),i[e]};function dt(t,e,i,n,r){return t*(t*(-3*e+9*i-9*n+3*r)+6*e-12*i+6*n)-3*e+3*i}function pt(t,e,i,n,r,a,s,o,l){for(var u=(l=1<(l=null==l?1:l)?1:l<0?0:l)/2,h=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],c=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],d=0,p=0;p<12;p++){var f=u*h[p]+u,m=dt(f,t,i,r,s),f=dt(f,e,n,a,o);d+=c[p]*E.sqrt(m*m+f*f)}return u*d}function ft(t,e,i){var n=P.bezierBBox(t),r=P.bezierBBox(e);if(!P.isBBoxIntersect(n,r))return i?0:[];for(var n=pt.apply(0,t),r=pt.apply(0,e),a=x(~~(n/5),1),s=x(~~(r/5),1),o=[],l=[],u={},h=i?0:[],c=0;c<a+1;c++){var d=P.findDotsAtSegment.apply(P,t.concat(c/a));o.push({x:d.x,y:d.y,t:c/a})}for(c=0;c<s+1;c++)d=P.findDotsAtSegment.apply(P,e.concat(c/s)),l.push({x:d.x,y:d.y,t:c/s});for(c=0;c<a;c++)for(var p=0;p<s;p++){var f=o[c],m=o[c+1],g=l[p],v=l[p+1],y=N(m.x-f.x)<.001?"y":"x",_=N(v.x-g.x)<.001?"y":"x",b=function(t,e,i,n,r,a,s,o){if(!(x(t,i)<S(r,s)||S(t,i)>x(r,s)||x(e,n)<S(a,o)||S(e,n)>x(a,o))){var l=(t-i)*(a-o)-(e-n)*(r-s);if(l){var u=((t*n-e*i)*(r-s)-(t-i)*(r*o-a*s))/l,h=((t*n-e*i)*(a-o)-(e-n)*(r*o-a*s))/l,c=+u.toFixed(2),l=+h.toFixed(2);if(!(c<+S(t,i).toFixed(2)||c>+x(t,i).toFixed(2)||c<+S(r,s).toFixed(2)||c>+x(r,s).toFixed(2)||l<+S(e,n).toFixed(2)||l>+x(e,n).toFixed(2)||l<+S(a,o).toFixed(2)||l>+x(a,o).toFixed(2)))return{x:u,y:h}}}}(f.x,f.y,m.x,m.y,g.x,g.y,v.x,v.y);b&&u[b.x.toFixed(4)]!=b.y.toFixed(4)&&(u[b.x.toFixed(4)]=b.y.toFixed(4),f=f.t+N((b[y]-f[y])/(m[y]-f[y]))*(m.t-f.t),g=g.t+N((b[_]-g[_])/(v[_]-g[_]))*(v.t-g.t),0<=f&&f<=1.001&&0<=g&&g<=1.001&&(i?h++:h.push({x:b.x,y:b.y,t1:S(f,1),t2:S(g,1)})))}return h}function mt(t,e,i){t=P._path2curve(t),e=P._path2curve(e);for(var n,r,a,s,o,l,u,h,c=i?0:[],d=0,p=t.length;d<p;d++){var f=t[d];if("M"==f[0])n=a=f[1],m=s=f[2];else for(var m="C"==f[0]?(n=(u=[n,m].concat(f.slice(1)))[6],u[7]):(u=[n,m,n,m,a,s,a,s],n=a,s),g=0,v=e.length;g<v;g++){var y=e[g];if("M"==y[0])r=o=y[1],_=l=y[2];else{var _="C"==y[0]?(r=(h=[r,_].concat(y.slice(1)))[6],h[7]):(h=[r,_,r,_,o,l,o,l],r=o,l),b=ft(u,h,i);if(i)c+=b;else{for(var w=0,T=b.length;w<T;w++)b[w].segment1=d,b[w].segment2=g,b[w].bez1=u,b[w].bez2=h;c=c.concat(b)}}}}return c}P.findDotsAtSegment=function(t,e,i,n,r,a,s,o,l){var u=1-l,h=g(u,3),c=g(u,2),d=l*l,p=d*l,f=h*t+3*c*l*i+3*u*l*l*r+p*s,m=h*e+3*c*l*n+3*u*l*l*a+p*o,h=t+2*l*(i-t)+d*(r-2*i+t),c=e+2*l*(n-e)+d*(a-2*n+e),p=i+2*l*(r-i)+d*(s-2*r+i),d=n+2*l*(a-n)+d*(o-2*a+n),i=u*t+l*i,n=u*e+l*n,s=u*r+l*s,l=u*a+l*o,o=90-180*E.atan2(h-p,c-d)/k;return(p<h||c<d)&&(o+=180),{x:f,y:m,m:{x:h,y:c},n:{x:p,y:d},start:{x:i,y:n},end:{x:s,y:l},alpha:o}},P.bezierBBox=function(t,e,i,n,r,a,s,o){P.is(t,"array")||(t=[t,e,i,n,r,a,s,o]);t=St.apply(null,t);return{x:t.min.x,y:t.min.y,x2:t.max.x,y2:t.max.y,width:t.max.x-t.min.x,height:t.max.y-t.min.y}},P.isPointInsideBBox=function(t,e,i){return e>=t.x&&e<=t.x2&&i>=t.y&&i<=t.y2},P.isBBoxIntersect=function(t,e){var i=P.isPointInsideBBox;return i(e,t.x,t.y)||i(e,t.x2,t.y)||i(e,t.x,t.y2)||i(e,t.x2,t.y2)||i(t,e.x,e.y)||i(t,e.x2,e.y)||i(t,e.x,e.y2)||i(t,e.x2,e.y2)||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y)},P.pathIntersection=function(t,e){return mt(t,e)},P.pathIntersectionNumber=function(t,e){return mt(t,e,1)},P.isPointInsidePath=function(t,e,i){var n=P.pathBBox(t);return P.isPointInsideBBox(n,e,i)&&mt(t,[["M",e,i],["H",n.x2+10]],1)%2==1},P._removedFactory=function(t){return function(){A("raphael.log",null,"Raphaël: you are calling to method “"+t+"” of removed object",t)}};function gt(t,e,i,n){return[t,e,i,n,i,n]}function vt(t,e,i,n,r,a){return[1/3*t+2/3*i,1/3*e+2/3*n,1/3*r+2/3*i,1/3*a+2/3*n,r,a]}function yt(t,e,i,n,r,a,s,o,l){var u=1-l;return{x:g(u,3)*t+3*g(u,2)*l*i+3*u*l*l*r+g(l,3)*s,y:g(u,3)*e+3*g(u,2)*l*n+3*u*l*l*a+g(l,3)*o}}function _t(t){var e=t[0];switch(e.toLowerCase()){case"t":return[e,0,0];case"m":return[e,1,0,0,1,0,0];case"r":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"s":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}}var bt=P.pathBBox=function(t){var e=ct(t);if(e.bbox)return et(e.bbox);if(!t)return{x:0,y:0,width:0,height:0,x2:0,y2:0};for(var i,n,r=0,a=0,s=[],o=[],l=0,u=(t=Et(t)).length;l<u;l++)"M"==(i=t[l])[0]?(r=i[1],a=i[2],s.push(r),o.push(a)):(n=St(r,a,i[1],i[2],i[3],i[4],i[5],i[6]),s=s[L](n.min.x,n.max.x),o=o[L](n.min.y,n.max.y),r=i[5],a=i[6]);var h=S[b](0,s),c=S[b](0,o),d=x[b](0,s),p=x[b](0,o),f=d-h,m=p-c,m={x:h,y:c,x2:d,y2:p,width:f,height:m,cx:h+f/2,cy:c+m/2};return e.bbox=et(m),m},wt=function(t){t=et(t);return t.toString=P._path2string,t},tt=P._pathToRelative=function(t){var e=ct(t);if(e.rel)return wt(e.rel);var i=[],n=0,r=0,a=0,s=0,o=0;"M"==(t=!P.is(t,y)||!P.is(t&&t[0],y)?P.parsePathString(t):t)[0][0]&&(a=n=t[0][1],s=r=t[0][2],o++,i.push(["M",n,r]));for(var l=o,u=t.length;l<u;l++){var h=i[l]=[],c=t[l];if(c[0]!=v.call(c[0]))switch(h[0]=v.call(c[0]),h[0]){case"a":h[1]=c[1],h[2]=c[2],h[3]=c[3],h[4]=c[4],h[5]=c[5],h[6]=+(c[6]-n).toFixed(3),h[7]=+(c[7]-r).toFixed(3);break;case"v":h[1]=+(c[1]-r).toFixed(3);break;case"m":a=c[1],s=c[2];default:for(var d=1,p=c.length;d<p;d++)h[d]=+(c[d]-(d%2?n:r)).toFixed(3)}else{h=i[l]=[],"m"==c[0]&&(a=c[1]+n,s=c[2]+r);for(var f=0,m=c.length;f<m;f++)i[l][f]=c[f]}var g=i[l].length;switch(i[l][0]){case"z":n=a,r=s;break;case"h":n+=+i[l][g-1];break;case"v":r+=+i[l][g-1];break;default:n+=+i[l][g-2],r+=+i[l][g-1]}}return i.toString=P._path2string,e.rel=wt(i),i},Tt=P._pathToAbsolute=function(t){var e=ct(t);if(e.abs)return wt(e.abs);if(!(t=!P.is(t,y)||!P.is(t&&t[0],y)?P.parsePathString(t):t)||!t.length)return[["M",0,0]];var i=[],n=0,r=0,a=0,s=0,o=0;"M"==t[0][0]&&(a=n=+t[0][1],s=r=+t[0][2],o++,i[0]=["M",n,r]);for(var l,u,h=3==t.length&&"M"==t[0][0]&&"R"==t[1][0].toUpperCase()&&"Z"==t[2][0].toUpperCase(),c=o,d=t.length;c<d;c++){if(i.push(l=[]),(u=t[c])[0]!=_.call(u[0]))switch(l[0]=_.call(u[0]),l[0]){case"A":l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=+(u[6]+n),l[7]=+(u[7]+r);break;case"V":l[1]=+u[1]+r;break;case"H":l[1]=+u[1]+n;break;case"R":for(var p=[n,r][L](u.slice(1)),f=2,m=p.length;f<m;f++)p[f]=+p[f]+n,p[++f]=+p[f]+r;i.pop(),i=i[L](ht(p,h));break;case"M":a=+u[1]+n,s=+u[2]+r;default:for(f=1,m=u.length;f<m;f++)l[f]=+u[f]+(f%2?n:r)}else if("R"==u[0])p=[n,r][L](u.slice(1)),i.pop(),i=i[L](ht(p,h)),l=["R"][L](u.slice(-2));else for(var g=0,v=u.length;g<v;g++)l[g]=u[g];switch(l[0]){case"Z":n=a,r=s;break;case"H":n=l[1];break;case"V":r=l[1];break;case"M":a=l[l.length-2],s=l[l.length-1];default:n=l[l.length-2],r=l[l.length-1]}}return i.toString=P._path2string,e.abs=wt(i),i},xt=function(t,e,i,n,r,a,s,o,l,u){var h,c,d,p=120*k/180,f=k/180*(+r||0),m=[],g=lt(function(t,e,i){return{x:t*E.cos(i)-e*E.sin(i),y:t*E.sin(i)+e*E.cos(i)}});u?(b=u[0],w=u[1],y=u[2],_=u[3]):(t=(c=g(t,e,-f)).x,e=c.y,o=(c=g(o,l,-f)).x,l=c.y,E.cos(k/180*r),E.sin(k/180*r),1<(v=(d=(t-o)/2)*d/(i*i)+(h=(e-l)/2)*h/(n*n))&&(i*=v=E.sqrt(v),n*=v),y=(c=(a==s?-1:1)*E.sqrt(N(((c=i*i)*(v=n*n)-c*h*h-v*d*d)/(c*h*h+v*d*d))))*i*h/n+(t+o)/2,b=E.asin(((e-(_=c*-n*d/i+(e+l)/2))/n).toFixed(9)),w=E.asin(((l-_)/n).toFixed(9)),(b=t<y?k-b:b)<0&&(b=2*k+b),(w=o<y?k-w:w)<0&&(w=2*k+w),s&&w<b&&(b-=2*k),!s&&b<w&&(w-=2*k)),N(v=w-b)>p&&(h=w,c=o,d=l,o=y+i*E.cos(w=b+p*(s&&b<w?1:-1)),l=_+n*E.sin(w),m=xt(o,l,i,n,r,0,s,c,d,[w,h,y,_]));var v=w-b,y=E.cos(b),_=E.sin(b),b=E.cos(w),w=E.sin(w),v=E.tan(v/4),i=4/3*i*v,n=4/3*n*v,v=[t,e],y=[t+i*_,e-n*y],b=[o+i*w,l-n*b],l=[o,l];if(y[0]=2*v[0]-y[0],y[1]=2*v[1]-y[1],u)return[y,b,l][L](m);for(var T=[],x=0,S=(m=[y,b,l][L](m).join()[R](",")).length;x<S;x++)T[x]=x%2?g(m[x-1],m[x],f).y:g(m[x],m[x+1],f).x;return T},St=lt(function(t,e,i,n,r,a,s,o){var l,u=r-2*i+t-(s-2*r+i),h=2*(i-t)-2*(r-i),c=t-i,d=(-h+E.sqrt(h*h-4*u*c))/2/u,p=(-h-E.sqrt(h*h-4*u*c))/2/u,f=[e,o],m=[t,s];return"1e12"<N(d)&&(d=.5),"1e12"<N(p)&&(p=.5),0<d&&d<1&&(l=yt(t,e,i,n,r,a,s,o,d),m.push(l.x),f.push(l.y)),0<p&&p<1&&(l=yt(t,e,i,n,r,a,s,o,p),m.push(l.x),f.push(l.y)),d=(-(h=2*(n-e)-2*(a-n))+E.sqrt(h*h-4*(u=a-2*n+e-(o-2*a+n))*(c=e-n)))/2/u,p=(-h-E.sqrt(h*h-4*u*c))/2/u,"1e12"<N(d)&&(d=.5),"1e12"<N(p)&&(p=.5),0<d&&d<1&&(l=yt(t,e,i,n,r,a,s,o,d),m.push(l.x),f.push(l.y)),0<p&&p<1&&(l=yt(t,e,i,n,r,a,s,o,p),m.push(l.x),f.push(l.y)),{min:{x:S[b](0,m),y:S[b](0,f)},max:{x:x[b](0,m),y:x[b](0,f)}}}),Et=P._path2curve=lt(function(t,e){var i=!e&&ct(t);if(!e&&i.curve)return wt(i.curve);function n(t,e,i){var n,r;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(t[0]in{T:1,Q:1}||(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"][L](xt[b](0,[e.x,e.y][L](t.slice(1))));break;case"S":r="C"==i||"S"==i?(n=2*e.x-e.bx,2*e.y-e.by):(n=e.x,e.y),t=["C",n,r][L](t.slice(1));break;case"T":"Q"==i||"T"==i?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"][L](vt(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"][L](vt(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"][L](gt(e.x,e.y,t[1],t[2]));break;case"H":t=["C"][L](gt(e.x,e.y,t[1],e.y));break;case"V":t=["C"][L](gt(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"][L](gt(e.x,e.y,e.X,e.Y))}return t}function r(t,e){if(7<t[e].length){t[e].shift();for(var i=t[e];i.length;)h[e]="A",o&&(c[e]="A"),t.splice(e++,0,["C"][L](i.splice(0,6)));t.splice(e,1),m=x(s.length,o&&o.length||0)}}function a(t,e,i,n,r){t&&e&&"M"==t[r][0]&&"M"!=e[r][0]&&(e.splice(r,0,["M",n.x,n.y]),i.bx=0,i.by=0,i.x=t[r][1],i.y=t[r][2],m=x(s.length,o&&o.length||0))}for(var s=Tt(t),o=e&&Tt(e),l={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},u={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},h=[],c=[],d="",p="",f=0,m=x(s.length,o&&o.length||0);f<m;f++){"C"!=(d=s[f]?s[f][0]:d)&&(h[f]=d,f&&(p=h[f-1])),s[f]=n(s[f],l,p),"A"!=h[f]&&"C"==d&&(h[f]="C"),r(s,f),o&&("C"!=(d=o[f]?o[f][0]:d)&&(c[f]=d,f&&(p=c[f-1])),o[f]=n(o[f],u,p),"A"!=c[f]&&"C"==d&&(c[f]="C"),r(o,f)),a(s,o,l,u,f),a(o,s,u,l,f);var g=s[f],v=o&&o[f],y=g.length,_=o&&v.length;l.x=g[y-2],l.y=g[y-1],l.bx=U(g[y-4])||l.x,l.by=U(g[y-3])||l.y,u.bx=o&&(U(v[_-4])||u.x),u.by=o&&(U(v[_-3])||u.y),u.x=o&&v[_-2],u.y=o&&v[_-1]}return o||(i.curve=wt(s)),o?[s,o]:s},null,wt),kt=(P._parseDots=lt(function(t){for(var e=[],i=0,n=t.length;i<n;i++){var r={},a=t[i].match(/^([^:]*):?([\d\.]*)/);if(r.color=P.getRGB(a[1]),r.color.error)return null;r.opacity=r.color.opacity,r.color=r.color.hex,a[2]&&(r.offset=a[2]+"%"),e.push(r)}for(n=e.length-(i=1);i<n;i++)if(!e[i].offset){for(var s=U(e[i-1].offset||0),o=0,l=i+1;l<n;l++)if(e[l].offset){o=e[l].offset;break}o||(o=100,l=n);for(var u=((o=U(o))-s)/(l-i+1);i<l;i++)s+=u,e[i].offset=s+"%"}return e}),P._tear=function(t,e){t==e.top&&(e.top=t.prev),t==e.bottom&&(e.bottom=t.next),t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next)}),Ct=(P._tofront=function(t,e){e.top!==t&&(kt(t,e),t.next=null,t.prev=e.top,e.top.next=t,e.top=t)},P._toback=function(t,e){e.bottom!==t&&(kt(t,e),t.next=e.bottom,t.prev=null,e.bottom.prev=t,e.bottom=t)},P._insertafter=function(t,e,i){kt(t,i),e==i.top&&(i.top=t),e.next&&(e.next.prev=t),t.next=e.next,(t.prev=e).next=t},P._insertbefore=function(t,e,i){kt(t,i),e==i.bottom&&(i.bottom=t),e.prev&&(e.prev.next=t),t.prev=e.prev,(e.prev=t).next=e},P.toMatrix=function(t,e){var i=bt(t),t={_:{transform:w},getBBox:function(){return i}};return It(t,e),t.matrix}),It=(P.transformPath=function(t,e){return J(t,Ct(t,e))},P._extractTransform=function(t,e){if(null==e)return t._.transform;e=M(e).replace(/\.{3}|\u2026/g,t._.transform||w);var i,n=P.parseTransformString(e),r=0,a=1,s=1,o=t._,l=new Pt;if(o.transform=n||[],n)for(var u=0,h=n.length;u<h;u++){var c,d,p,f,m,g=n[u],v=g.length,y=M(g[0]).toLowerCase(),_=g[0]!=y,b=_?l.invert():0;"t"==y&&3==v?_?(c=b.x(0,0),d=b.y(0,0),p=b.x(g[1],g[2]),f=b.y(g[1],g[2]),l.translate(p-c,f-d)):l.translate(g[1],g[2]):"r"==y?2==v?(m=m||t.getBBox(1),l.rotate(g[1],m.x+m.width/2,m.y+m.height/2),r+=g[1]):4==v&&(_?(p=b.x(g[2],g[3]),f=b.y(g[2],g[3]),l.rotate(g[1],p,f)):l.rotate(g[1],g[2],g[3]),r+=g[1]):"s"==y?2==v||3==v?(m=m||t.getBBox(1),l.scale(g[1],g[v-1],m.x+m.width/2,m.y+m.height/2),a*=g[1],s*=g[v-1]):5==v&&(_?(p=b.x(g[3],g[4]),f=b.y(g[3],g[4]),l.scale(g[1],g[2],p,f)):l.scale(g[1],g[2],g[3],g[4]),a*=g[1],s*=g[2]):"m"==y&&7==v&&l.add(g[1],g[2],g[3],g[4],g[5],g[6]),o.dirtyT=1,t.matrix=l}t.matrix=l,o.sx=a,o.sy=s,o.deg=r,o.dx=i=l.e,o.dy=e=l.f,1==a&&1==s&&!r&&o.bbox?(o.bbox.x+=+i,o.bbox.y+=+e):o.dirtyT=1}),At=P._equaliseTransform=function(t,e){e=M(e).replace(/\.{3}|\u2026/g,t),t=P.parseTransformString(t)||[],e=P.parseTransformString(e)||[];for(var i,n,r,a,s=x(t.length,e.length),o=[],l=[],u=0;u<s;u++){if(r=t[u]||_t(e[u]),a=e[u]||_t(r),r[0]!=a[0]||"r"==r[0].toLowerCase()&&(r[2]!=a[2]||r[3]!=a[3])||"s"==r[0].toLowerCase()&&(r[3]!=a[3]||r[4]!=a[4]))return;for(o[u]=[],l[u]=[],i=0,n=x(r.length,a.length);i<n;i++)i in r&&(o[u][i]=r[i]),i in a&&(l[u][i]=a[i])}return{from:o,to:l}};function Pt(t,e,i,n,r,a){null!=t?(this.a=+t,this.b=+e,this.c=+i,this.d=+n,this.e=+r,this.f=+a):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function Dt(t){return t[0]*t[0]+t[1]*t[1]}function Ot(t){var e=E.sqrt(Dt(t));t[0]&&(t[0]/=e),t[1]&&(t[1]/=e)}P._getContainer=function(t,e,i,n){var r;if(null!=(r=null!=n||P.is(t,"object")?t:f.doc.getElementById(t)))return r.tagName?null==e?{container:r,width:r.style.pixelWidth||r.offsetWidth,height:r.style.pixelHeight||r.offsetHeight}:{container:r,width:e,height:i}:{container:1,x:t,y:e,width:i,height:n}},P.pathToRelative=tt,P._engine={},P.path2curve=Et,P.matrix=function(t,e,i,n,r,a){return new Pt(t,e,i,n,r,a)},(tt=Pt.prototype).add=function(t,e,i,n,r,a){var s,o,l,u,h=[[],[],[]],c=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],d=[[t,i,r],[e,n,a],[0,0,1]];for(t&&t instanceof Pt&&(d=[[t.a,t.c,t.e],[t.b,t.d,t.f],[0,0,1]]),s=0;s<3;s++)for(o=0;o<3;o++){for(l=u=0;l<3;l++)u+=c[s][l]*d[l][o];h[s][o]=u}this.a=h[0][0],this.b=h[1][0],this.c=h[0][1],this.d=h[1][1],this.e=h[0][2],this.f=h[1][2]},tt.invert=function(){var t=this,e=t.a*t.d-t.b*t.c;return new Pt(t.d/e,-t.b/e,-t.c/e,t.a/e,(t.c*t.f-t.d*t.e)/e,(t.b*t.e-t.a*t.f)/e)},tt.clone=function(){return new Pt(this.a,this.b,this.c,this.d,this.e,this.f)},tt.translate=function(t,e){this.add(1,0,0,1,t,e)},tt.scale=function(t,e,i,n){null==e&&(e=t),(i||n)&&this.add(1,0,0,1,i,n),this.add(t,0,0,e,0,0),(i||n)&&this.add(1,0,0,1,-i,-n)},tt.rotate=function(t,e,i){t=P.rad(t),e=e||0,i=i||0;var n=+E.cos(t).toFixed(9),t=+E.sin(t).toFixed(9);this.add(n,t,-t,n,e,i),this.add(1,0,0,1,-e,-i)},tt.x=function(t,e){return t*this.a+e*this.c+this.e},tt.y=function(t,e){return t*this.b+e*this.d+this.f},tt.get=function(t){return+this[M.fromCharCode(97+t)].toFixed(4)},tt.toString=function(){return P.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},tt.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},tt.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},tt.split=function(){var t={};t.dx=this.e,t.dy=this.f;var e=[[this.a,this.c],[this.b,this.d]];t.scalex=E.sqrt(Dt(e[0])),Ot(e[0]),t.shear=e[0][0]*e[1][0]+e[0][1]*e[1][1],e[1]=[e[1][0]-e[0][0]*t.shear,e[1][1]-e[0][1]*t.shear],t.scaley=E.sqrt(Dt(e[1])),Ot(e[1]),t.shear/=t.scaley;var i=-e[0][1],e=e[1][1];return e<0?(t.rotate=P.deg(E.acos(e)),i<0&&(t.rotate=360-t.rotate)):t.rotate=P.deg(E.asin(i)),t.isSimple=!(+t.shear.toFixed(9)||t.scalex.toFixed(9)!=t.scaley.toFixed(9)&&t.rotate),t.isSuperSimple=!+t.shear.toFixed(9)&&t.scalex.toFixed(9)==t.scaley.toFixed(9)&&!t.rotate,t.noRotation=!+t.shear.toFixed(9)&&!t.rotate,t},tt.toTransformString=function(t){t=t||this[R]();return t.isSimple?(t.scalex=+t.scalex.toFixed(4),t.scaley=+t.scaley.toFixed(4),t.rotate=+t.rotate.toFixed(4),(t.dx||t.dy?"t"+[t.dx,t.dy]:w)+(1!=t.scalex||1!=t.scaley?"s"+[t.scalex,t.scaley,0,0]:w)+(t.rotate?"r"+[t.rotate,0,0]:w)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]};function Lt(){this.returnValue=!1}function Mt(){return this.originalEvent.preventDefault()}function Rt(){this.cancelBubble=!0}function Nt(){return this.originalEvent.stopPropagation()}function Bt(t){var e=f.doc.documentElement.scrollTop||f.doc.body.scrollTop,i=f.doc.documentElement.scrollLeft||f.doc.body.scrollLeft;return{x:t.clientX+i,y:t.clientY+e}}for(var Ft=f.doc.addEventListener?function(a,t,s,o){function e(t){var e=Bt(t);return s.call(o,t,e.x,e.y)}var i;return a.addEventListener(t,e,!1),m&&u[t]&&a.addEventListener(u[t],i=function(t){for(var e=Bt(t),i=t,n=0,r=t.targetTouches&&t.targetTouches.length;n<r;n++)if(t.targetTouches[n].target==a){(t=t.targetTouches[n]).originalEvent=i,t.preventDefault=Mt,t.stopPropagation=Nt;break}return s.call(o,t,e.x,e.y)},!1),function(){return a.removeEventListener(t,e,!1),m&&u[t]&&a.removeEventListener(u[t],i,!1),!0}}:f.doc.attachEvent?function(t,e,n,r){function i(t){t=t||f.win.event;var e=f.doc.documentElement.scrollTop||f.doc.body.scrollTop,i=f.doc.documentElement.scrollLeft||f.doc.body.scrollLeft,i=t.clientX+i,e=t.clientY+e;return t.preventDefault=t.preventDefault||Lt,t.stopPropagation=t.stopPropagation||Rt,n.call(r,t,i,e)}return t.attachEvent("on"+e,i),function(){return t.detachEvent("on"+e,i),!0}}:void 0,Ut=[],jt=function(t){for(var e,i=t.clientX,n=t.clientY,r=f.doc.documentElement.scrollTop||f.doc.body.scrollTop,a=f.doc.documentElement.scrollLeft||f.doc.body.scrollLeft,s=Ut.length;s--;){if(e=Ut[s],m&&t.touches){for(var o,l=t.touches.length;l--;)if((o=t.touches[l]).identifier==e.el._drag.id){i=o.clientX,n=o.clientY,(t.originalEvent||t).preventDefault();break}}else t.preventDefault();var u,h=e.el.node,c=h.nextSibling,d=h.parentNode,p=h.style.display;f.win.opera&&d.removeChild(h),h.style.display="none",u=e.el.paper.getElementByPoint(i,n),h.style.display=p,f.win.opera&&(c?d.insertBefore(h,c):d.appendChild(h)),u&&A("raphael.drag.over."+e.el.id,e.el,u),i+=a,n+=r,A("raphael.drag.move."+e.el.id,e.move_scope||e.el,i-e.el._drag.x,n-e.el._drag.y,i,n,t)}},qt=function(t){P.unmousemove(jt).unmouseup(qt);for(var e,i=Ut.length;i--;)(e=Ut[i]).el._drag={},A("raphael.drag.end."+e.el.id,e.end_scope||e.start_scope||e.move_scope||e.el,t);Ut=[]},zt=P.el={},Ht=l.length;Ht--;)!function(n){P[n]=zt[n]=function(t,e){return P.is(t,"function")&&(this.events=this.events||[],this.events.push({name:n,f:t,unbind:Ft(this.shape||this.node||f.doc,n,t,e||this)})),this},P["un"+n]=zt["un"+n]=function(t){for(var e=this.events||[],i=e.length;i--;)e[i].name!=n||!P.is(t,"undefined")&&e[i].f!=t||(e[i].unbind(),e.splice(i,1),e.length||delete this.events);return this}}(l[Ht]);zt.data=function(t,e){var i=X[this.id]=X[this.id]||{};if(0==arguments.length)return i;if(1!=arguments.length)return i[t]=e,A("raphael.data.set."+this.id,this,e,t),this;if(P.is(t,"object")){for(var n in t)t[O](n)&&this.data(n,t[n]);return this}return A("raphael.data.get."+this.id,this,i[t],t),i[t]},zt.removeData=function(t){return null==t?delete X[this.id]:X[this.id]&&delete X[this.id][t],this},zt.getData=function(){return et(X[this.id]||{})},zt.hover=function(t,e,i,n){return this.mouseover(t,i).mouseout(e,n||i)},zt.unhover=function(t,e){return this.unmouseover(t).unmouseout(e)};var Vt=[];function Wt(){return this.x+T+this.y+T+this.width+" × "+this.height}zt.drag=function(o,l,u,h,c,d){function t(t){(t.originalEvent||t).preventDefault();var e=t.clientX,i=t.clientY,n=f.doc.documentElement.scrollTop||f.doc.body.scrollTop,r=f.doc.documentElement.scrollLeft||f.doc.body.scrollLeft;if(this._drag.id=t.identifier,m&&t.touches)for(var a,s=t.touches.length;s--;)if(a=t.touches[s],this._drag.id=a.identifier,a.identifier==this._drag.id){e=a.clientX,i=a.clientY;break}this._drag.x=e+r,this._drag.y=i+n,Ut.length||P.mousemove(jt).mouseup(qt),Ut.push({el:this,move_scope:h,start_scope:c,end_scope:d}),l&&A.on("raphael.drag.start."+this.id,l),o&&A.on("raphael.drag.move."+this.id,o),u&&A.on("raphael.drag.end."+this.id,u),A("raphael.drag.start."+this.id,c||h||this,this._drag.x,this._drag.y,t)}return this._drag={},Vt.push({el:this,start:t}),this.mousedown(t),this},zt.onDragOver=function(t){t?A.on("raphael.drag.over."+this.id,t):A.unbind("raphael.drag.over."+this.id)},zt.undrag=function(){for(var t=Vt.length;t--;)Vt[t].el==this&&(this.unmousedown(Vt[t].start),Vt.splice(t,1),A.unbind("raphael.drag.*."+this.id));Vt.length||P.unmousemove(jt).unmouseup(qt),Ut=[]},Z.circle=function(t,e,i){i=P._engine.circle(this,t||0,e||0,i||0);return this.__set__&&this.__set__.push(i),i},Z.rect=function(t,e,i,n,r){r=P._engine.rect(this,t||0,e||0,i||0,n||0,r||0);return this.__set__&&this.__set__.push(r),r},Z.ellipse=function(t,e,i,n){n=P._engine.ellipse(this,t||0,e||0,i||0,n||0);return this.__set__&&this.__set__.push(n),n},Z.path=function(t){!t||P.is(t,"string")||P.is(t[0],y)||(t+=w);var e=P._engine.path(P.format[b](P,arguments),this);return this.__set__&&this.__set__.push(e),e},Z.image=function(t,e,i,n,r){r=P._engine.image(this,t||"about:blank",e||0,i||0,n||0,r||0);return this.__set__&&this.__set__.push(r),r},Z.text=function(t,e,i){i=P._engine.text(this,t||0,e||0,M(i));return this.__set__&&this.__set__.push(i),i},Z.set=function(t){P.is(t,"array")||(t=Array.prototype.splice.call(arguments,0,arguments.length));var e=new ue(t);return this.__set__&&this.__set__.push(e),e.paper=this,e.type="set",e},Z.setStart=function(t){this.__set__=t||this.set()},Z.setFinish=function(t){var e=this.__set__;return delete this.__set__,e},Z.getSize=function(){var t=this.canvas.parentNode;return{width:t.offsetWidth,height:t.offsetHeight}},Z.setSize=function(t,e){return P._engine.setSize.call(this,t,e)},Z.setViewBox=function(t,e,i,n,r){return P._engine.setViewBox.call(this,t,e,i,n,r)},Z.top=Z.bottom=null,Z.raphael=P,Z.getElementByPoint=function(t,e){var i,n,r,a,s,o=this.canvas,l=f.doc.elementFromPoint(t,e);if(f.win.opera&&"svg"==l.tagName&&(i=(r=o).getBoundingClientRect(),a=(s=r.ownerDocument).body,r=(n=s.documentElement).clientTop||a.clientTop||0,s=n.clientLeft||a.clientLeft||0,a={y:i.top+(f.win.pageYOffset||n.scrollTop||a.scrollTop)-r,x:i.left+(f.win.pageXOffset||n.scrollLeft||a.scrollLeft)-s},(s=o.createSVGRect()).x=t-a.x,s.y=e-a.y,s.width=s.height=1,(s=o.getIntersectionList(s,null)).length&&(l=s[s.length-1])),!l)return null;for(;l.parentNode&&l!=o.parentNode&&!l.raphael;)l=l.parentNode;return(l=l==this.canvas.parentNode?o:l)&&l.raphael?this.getById(l.raphaelid):null},Z.getElementsByBBox=function(e){var i=this.set();return this.forEach(function(t){P.isBBoxIntersect(t.getBBox(),e)&&i.push(t)}),i},Z.getById=function(t){for(var e=this.bottom;e;){if(e.id==t)return e;e=e.next}return null},Z.forEach=function(t,e){for(var i=this.bottom;i;){if(!1===t.call(e,i))return this;i=i.next}return this},Z.getElementsByPoint=function(e,i){var n=this.set();return this.forEach(function(t){t.isPointInside(e,i)&&n.push(t)}),n},zt.isPointInside=function(t,e){var i=this.realPath=Q[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(i=P.transformPath(i,this.attr("transform"))),P.isPointInsidePath(i,t,e)},zt.getBBox=function(t){if(this.removed)return{};var e=this._;return t?(!e.dirty&&e.bboxwt||(this.realPath=Q[this.type](this),e.bboxwt=bt(this.realPath),e.bboxwt.toString=Wt,e.dirty=0),e.bboxwt):(!e.dirty&&!e.dirtyT&&e.bbox||(!e.dirty&&this.realPath||(e.bboxwt=0,this.realPath=Q[this.type](this)),e.bbox=bt(J(this.realPath,this.matrix)),e.bbox.toString=Wt,e.dirty=e.dirtyT=0),e.bbox)},zt.clone=function(){if(this.removed)return null;var t=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(t),t},zt.glow=function(t){if("text"==this.type)return null;for(var e={width:((t=t||{}).width||10)+(+this.attr("stroke-width")||1),fill:t.fill||!1,opacity:null==t.opacity?.5:t.opacity,offsetx:t.offsetx||0,offsety:t.offsety||0,color:t.color||"#000"},i=e.width/2,n=this.paper,r=n.set(),a=this.realPath||Q[this.type](this),a=this.matrix?J(a,this.matrix):a,s=1;s<1+i;s++)r.push(n.path(a).attr({stroke:e.color,fill:e.fill?e.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(e.width/i*s).toFixed(3),opacity:+(e.opacity/i).toFixed(3)}));return r.insertBefore(this).translate(e.offsetx,e.offsety)};function Gt(p,f){return function(t,e,i){for(var n,r,a,s,o,l="",u={},h=0,c=0,d=(t=Et(t)).length;c<d;c++){if("M"==(a=t[c])[0])n=+a[1],r=+a[2];else{if(h+(s=Xt(n,r,a[1],a[2],a[3],a[4],a[5],a[6]))>e){if(f&&!u.start){if(l+=["C"+(o=Xt(n,r,a[1],a[2],a[3],a[4],a[5],a[6],e-h)).start.x,o.start.y,o.m.x,o.m.y,o.x,o.y],i)return l;u.start=l,l=["M"+o.x,o.y+"C"+o.n.x,o.n.y,o.end.x,o.end.y,a[5],a[6]].join(),h+=s,n=+a[5],r=+a[6];continue}if(!p&&!f)return{x:(o=Xt(n,r,a[1],a[2],a[3],a[4],a[5],a[6],e-h)).x,y:o.y,alpha:o.alpha}}h+=s,n=+a[5],r=+a[6]}l+=a.shift()+a}return u.end=l,o=(o=p?h:f?u:P.findDotsAtSegment(n,r,a[0],a[1],a[2],a[3],a[4],a[5],1)).alpha?{x:o.x,y:o.y,alpha:o.alpha}:o}}var Xt=function(t,e,i,n,r,a,s,o,l){return null==l?pt(t,e,i,n,r,a,s,o):P.findDotsAtSegment(t,e,i,n,r,a,s,o,function(t,e,i,n,r,a,s,o,l){if(!(l<0||pt(t,e,i,n,r,a,s,o)<l)){for(var u=.5,h=1-u,c=pt(t,e,i,n,r,a,s,o,h);.01<N(c-l);)c=pt(t,e,i,n,r,a,s,o,h+=(c<l?1:-1)*(u/=2));return h}}(t,e,i,n,r,a,s,o,l))},$t=Gt(1),Yt=Gt(),Kt=Gt(0,1);P.getTotalLength=$t,P.getPointAtLength=Yt,P.getSubpath=function(t,e,i){if(this.getTotalLength(t)-i<1e-6)return Kt(t,e).end;i=Kt(t,i,1);return e?Kt(i,e).end:i},zt.getTotalLength=function(){var t=this.getPath();if(t)return this.node.getTotalLength?this.node.getTotalLength():$t(t)},zt.getPointAtLength=function(t){var e=this.getPath();if(e)return Yt(e,t)},zt.getPath=function(){var t,e=P._getPath[this.type];if("text"!=this.type&&"set"!=this.type)return t=e?e(this):t},zt.getSubpath=function(t,e){var i=this.getPath();if(i)return P.getSubpath(i,t,e)};tt=P.easing_formulas={linear:function(t){return t},"<":function(t){return g(t,1.7)},">":function(t){return g(t,.48)},"<>":function(t){var e=.48-t/1.04,i=E.sqrt(.1734+e*e),t=i-e,e=-i-e,e=g(N(t),1/3)*(t<0?-1:1)+g(N(e),1/3)*(e<0?-1:1)+.5;return 3*(1-e)*e*e+e*e*e},backIn:function(t){return t*t*(2.70158*t-1.70158)},backOut:function(t){return--t*t*(2.70158*t+1.70158)+1},elastic:function(t){return t==!!t?t:g(2,-10*t)*E.sin(2*k*(t-.075)/.3)+1},bounce:function(t){var e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375}};tt.easeIn=tt["ease-in"]=tt["<"],tt.easeOut=tt["ease-out"]=tt[">"],tt.easeInOut=tt["ease-in-out"]=tt["<>"],tt["back-in"]=tt.backIn,tt["back-out"]=tt.backOut;var Qt=[],Jt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,16)},Zt=function(){for(var t=+new Date,e=0;e<Qt.length;e++){var i=Qt[e];if(!i.el.removed&&!i.paused){var n,r=t-i.start,a=i.ms,s=i.easing,o=i.from,l=i.diff,u=i.to,h=(i.t,i.el),c={},d={};if(i.initstatus?(r=(i.initstatus*i.anim.top-i.prev)/(i.percent-i.prev)*a,i.status=i.initstatus,delete i.initstatus,i.stop&&Qt.splice(e--,1)):i.status=(i.prev+(i.percent-i.prev)*(r/a))/i.anim.top,!(r<0))if(r<a){var p,f=s(r/a);for(p in o)if(o[O](p)){switch(q[p]){case B:m=+o[p]+f*a*l[p];break;case"colour":m="rgb("+[te(C(o[p].r+f*a*l[p].r)),te(C(o[p].g+f*a*l[p].g)),te(C(o[p].b+f*a*l[p].b))].join(",")+")";break;case"path":for(var m=[],g=0,v=o[p].length;g<v;g++){m[g]=[o[p][g][0]];for(var y=1,_=o[p][g].length;y<_;y++)m[g][y]=+o[p][g][y]+f*a*l[p][g][y];m[g]=m[g].join(T)}m=m.join(T);break;case"transform":if(l[p].real)for(m=[],g=0,v=o[p].length;g<v;g++)for(m[g]=[o[p][g][0]],y=1,_=o[p][g].length;y<_;y++)m[g][y]=o[p][g][y]+f*a*l[p][g][y];else{function b(t){return+o[p][t]+f*a*l[p][t]}m=[["m",b(0),b(1),b(2),b(3),b(4),b(5)]]}break;case"csv":if("clip-rect"==p)for(m=[],g=4;g--;)m[g]=+o[p][g]+f*a*l[p][g];break;default:var w=[][L](o[p]);for(m=[],g=h.paper.customAttributes[p].length;g--;)m[g]=+w[g]+f*a*l[p][g]}c[p]=m}h.attr(c),function(t,e,i){setTimeout(function(){A("raphael.anim.frame."+t,e,i)})}(h.id,h,i.anim)}else{if(function(t,e,i){setTimeout(function(){A("raphael.anim.frame."+e.id,e,i),A("raphael.anim.finish."+e.id,e,i),P.is(t,"function")&&t.call(e)})}(i.callback,h,i.anim),h.attr(u),Qt.splice(e--,1),1<i.repeat&&!i.next){for(n in u)u[O](n)&&(d[n]=i.totalOrigin[n]);i.el.attr(d),ie(i.anim,i.el,i.anim.percents[0],null,i.totalOrigin,i.repeat-1)}i.next&&!i.stop&&ie(i.anim,i.el,i.next,null,i.totalOrigin,i.repeat)}}}Qt.length&&Jt(Zt)},te=function(t){return 255<t?255:t<0?0:t};function ee(t,e){var i=[],n={};if(this.ms=e,this.times=1,t){for(var r in t)t[O](r)&&(n[U(r)]=t[r],i.push(U(r)));i.sort($)}this.anim=n,this.top=i[i.length-1],this.percents=i}function ie(t,e,i,n,r,a){i=U(i);var s,o,l,u,h,d=t.ms,c={},p={},f={};if(n)for(g=0,v=Qt.length;g<v;g++){var m=Qt[g];if(m.el.id==e.id&&m.anim==t){m.percent!=i?(Qt.splice(g,1),l=1):o=m,e.attr(m.totalOrigin);break}}else n=+p;for(var g=0,v=t.percents.length;g<v;g++){if(t.percents[g]==i||t.percents[g]>n*t.top){i=t.percents[g],h=t.percents[g-1]||0,d=d/t.top*(i-h),u=t.percents[g+1],s=t.anim[i];break}n&&e.attr(t.anim[t.percents[g]])}if(s){if(o)o.initstatus=n,o.start=new Date-o.ms*n;else{for(var y in s)if(s[O](y)&&(q[O](y)||e.paper.customAttributes[O](y)))switch(c[y]=e.attr(y),null==c[y]&&(c[y]=j[y]),p[y]=s[y],q[y]){case B:f[y]=(p[y]-c[y])/d;break;case"colour":c[y]=P.getRGB(c[y]);var _=P.getRGB(p[y]);f[y]={r:(_.r-c[y].r)/d,g:(_.g-c[y].g)/d,b:(_.b-c[y].b)/d};break;case"path":var b=Et(c[y],p[y]),w=b[1];for(c[y]=b[0],f[y]=[],g=0,v=c[y].length;g<v;g++){f[y][g]=[0];for(var T=1,x=c[y][g].length;T<x;T++)f[y][g][T]=(w[g][T]-c[y][g][T])/d}break;case"transform":_=e._,b=At(_[y],p[y]);if(b)for(c[y]=b.from,p[y]=b.to,f[y]=[],f[y].real=!0,g=0,v=c[y].length;g<v;g++)for(f[y][g]=[c[y][g][0]],T=1,x=c[y][g].length;T<x;T++)f[y][g][T]=(p[y][g][T]-c[y][g][T])/d;else{b=e.matrix||new Pt,_={_:{transform:_.transform},getBBox:function(){return e.getBBox(1)}};c[y]=[b.a,b.b,b.c,b.d,b.e,b.f],It(_,p[y]),p[y]=_._.transform,f[y]=[(_.matrix.a-b.a)/d,(_.matrix.b-b.b)/d,(_.matrix.c-b.c)/d,(_.matrix.d-b.d)/d,(_.matrix.e-b.e)/d,(_.matrix.f-b.f)/d]}break;case"csv":var S=M(s[y])[R](D),E=M(c[y])[R](D);if("clip-rect"==y)for(c[y]=E,f[y]=[],g=E.length;g--;)f[y][g]=(S[g]-c[y][g])/d;p[y]=S;break;default:for(S=[][L](s[y]),E=[][L](c[y]),f[y]=[],g=e.paper.customAttributes[y].length;g--;)f[y][g]=((S[g]||0)-(E[g]||0))/d}var k,C=s.easing,I=P.easing_formulas[C];if(I=I||((I=M(C).match(F))&&5==I.length?(k=I,function(t){return r=t,e=+k[1],i=+k[2],n=+k[3],t=+k[4],c=1-(u=3*e)-(h=3*(n-e)-u),i=1-(e=3*i)-(t=3*(t-i)-e),r=function(t,e){for(var i,n,r,a,s=t,o=0;o<8;o++){if(r=l(s)-t,N(r)<e)return s;if(N(a=(3*c*s+2*h)*s+u)<1e-6)break;s-=r/a}if((s=t)<(i=0))return i;if((n=1)<s)return n;for(;i<n;){if(r=l(s),N(r-t)<e)return s;r<t?i=s:n=s,s=(n-i)/2+i}return s}(r,1/(200*(r=d))),((i*r+t)*r+e)*r;function l(t){return((c*t+h)*t+u)*t}var e,i,n,r,u,h,c}):Y),m={anim:t,percent:i,timestamp:C=s.start||t.start||+new Date,start:C+(t.del||0),status:0,initstatus:n||0,stop:!1,ms:d,easing:I,from:c,diff:f,to:p,el:e,callback:s.callback,prev:h,next:u,repeat:a||t.times,origin:e.attr(),totalOrigin:r},Qt.push(m),n&&!o&&!l&&(m.stop=!0,m.start=new Date-d*n,1==Qt.length))return Zt();l&&(m.start=new Date-m.ms*n),1==Qt.length&&Jt(Zt)}A("raphael.anim.start."+e.id,e,t)}}function ne(t){for(var e=0;e<Qt.length;e++)Qt[e].el.paper==t&&Qt.splice(e--,1)}zt.animateWith=function(t,e,i,n,r,a){if(this.removed)return a&&a.call(this),this;a=i instanceof ee?i:P.animation(i,n,r,a);ie(a,this,a.percents[0],null,this.attr());for(var s=0,o=Qt.length;s<o;s++)if(Qt[s].anim==e&&Qt[s].el==t){Qt[o-1].start=Qt[s].start;break}return this},zt.onAnimation=function(t){return t?A.on("raphael.anim.frame."+this.id,t):A.unbind("raphael.anim.frame."+this.id),this},ee.prototype.delay=function(t){var e=new ee(this.anim,this.ms);return e.times=this.times,e.del=+t||0,e},ee.prototype.repeat=function(t){var e=new ee(this.anim,this.ms);return e.del=this.del,e.times=E.floor(x(t,0))||1,e},P.animation=function(t,e,i,n){if(t instanceof ee)return t;!P.is(i,"function")&&i||(n=n||i||null,i=null),e=+e||0;var r,a,s={};for(a in t=Object(t))t[O](a)&&U(a)!=a&&U(a)+"%"!=a&&(r=!0,s[a]=t[a]);if(r)return i&&(s.easing=i),n&&(s.callback=n),new ee({100:s},e);if(n){var o,l=0;for(o in t){var u=p(o);t[O](o)&&l<u&&(l=u)}t[l+="%"].callback||(t[l].callback=n)}return new ee(t,e)},zt.animate=function(t,e,i,n){if(this.removed)return n&&n.call(this),this;n=t instanceof ee?t:P.animation(t,e,i,n);return ie(n,this,n.percents[0],null,this.attr()),this},zt.setTime=function(t,e){return t&&null!=e&&this.status(t,S(e,t.ms)/t.ms),this},zt.status=function(t,e){var i,n,r=[],a=0;if(null!=e)return ie(t,this,-1,S(e,1)),this;for(i=Qt.length;a<i;a++)if((n=Qt[a]).el.id==this.id&&(!t||n.anim==t)){if(t)return n.status;r.push({anim:n.anim,status:n.status})}return t?0:r},zt.pause=function(t){for(var e=0;e<Qt.length;e++)Qt[e].el.id!=this.id||t&&Qt[e].anim!=t||!1!==A("raphael.anim.pause."+this.id,this,Qt[e].anim)&&(Qt[e].paused=!0);return this},zt.resume=function(t){for(var e,i=0;i<Qt.length;i++)Qt[i].el.id!=this.id||t&&Qt[i].anim!=t||(e=Qt[i],!1!==A("raphael.anim.resume."+this.id,this,e.anim)&&(delete e.paused,this.status(e.anim,e.status)));return this},zt.stop=function(t){for(var e=0;e<Qt.length;e++)Qt[e].el.id!=this.id||t&&Qt[e].anim!=t||!1!==A("raphael.anim.stop."+this.id,this,Qt[e].anim)&&Qt.splice(e--,1);return this},A.on("raphael.remove",ne),A.on("raphael.clear",ne),zt.toString=function(){return"Raphaël’s object"};var re,ae,se,oe,le,ue=function(t){if(this.items=[],this.length=0,this.type="set",t)for(var e=0,i=t.length;e<i;e++)!t[e]||t[e].constructor!=zt.constructor&&t[e].constructor!=ue||(this[this.items.length]=this.items[this.items.length]=t[e],this.length++)},he=ue.prototype;for(le in he.push=function(){for(var t,e,i=0,n=arguments.length;i<n;i++)!(t=arguments[i])||t.constructor!=zt.constructor&&t.constructor!=ue||(this[e=this.items.length]=this.items[e]=t,this.length++);return this},he.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},he.forEach=function(t,e){for(var i=0,n=this.items.length;i<n;i++)if(!1===t.call(e,this.items[i],i))return this;return this},zt)zt[O](le)&&(he[le]=function(i){return function(){var e=arguments;return this.forEach(function(t){t[i][b](t,e)})}}(le));return he.attr=function(t,e){if(t&&P.is(t,y)&&P.is(t[0],"object"))for(var i=0,n=t.length;i<n;i++)this.items[i].attr(t[i]);else for(var r=0,a=this.items.length;r<a;r++)this.items[r].attr(t,e);return this},he.clear=function(){for(;this.length;)this.pop()},he.splice=function(t,e,i){t=t<0?x(this.length+t,0):t,e=x(0,S(this.length-t,e));for(var n=[],r=[],a=[],s=2;s<arguments.length;s++)a.push(arguments[s]);for(s=0;s<e;s++)r.push(this[t+s]);for(;s<this.length-t;s++)n.push(this[t+s]);var o=a.length;for(s=0;s<o+n.length;s++)this.items[t+s]=this[t+s]=s<o?a[s]:n[s-o];for(s=this.items.length=this.length-=e-o;this[s];)delete this[s++];return new ue(r)},he.exclude=function(t){for(var e=0,i=this.length;e<i;e++)if(this[e]==t)return this.splice(e,1),!0},he.animate=function(t,e,i,n){!P.is(i,"function")&&i||(n=i||null);var r,a=this.items.length,s=a,o=this;if(!a)return this;n&&(r=function(){--a||n.call(o)}),i=P.is(i,"string")?i:r;for(var l=P.animation(t,e,i,r),u=this.items[--s].animate(l);s--;)this.items[s]&&!this.items[s].removed&&this.items[s].animateWith(u,l,l),this.items[s]&&!this.items[s].removed||a--;return this},he.insertAfter=function(t){for(var e=this.items.length;e--;)this.items[e].insertAfter(t);return this},he.getBBox=function(){for(var t,e=[],i=[],n=[],r=[],a=this.items.length;a--;)this.items[a].removed||(t=this.items[a].getBBox(),e.push(t.x),i.push(t.y),n.push(t.x+t.width),r.push(t.y+t.height));return{x:e=S[b](0,e),y:i=S[b](0,i),x2:n=x[b](0,n),y2:r=x[b](0,r),width:n-e,height:r-i}},he.clone=function(t){t=this.paper.set();for(var e=0,i=this.items.length;e<i;e++)t.push(this.items[e].clone());return t},he.toString=function(){return"Raphaël‘s set"},he.glow=function(i){var n=this.paper.set();return this.forEach(function(t,e){t=t.glow(i);null!=t&&t.forEach(function(t,e){n.push(t)})}),n},he.isPointInside=function(e,i){var n=!1;return this.forEach(function(t){if(t.isPointInside(e,i))return!(n=!0)}),n},P.registerFont=function(t){if(!t.face)return t;this.fonts=this.fonts||{};var e,i={w:t.w,face:{},glyphs:{}},n=t.face["font-family"];for(e in t.face)t.face[O](e)&&(i.face[e]=t.face[e]);if(this.fonts[n]?this.fonts[n].push(i):this.fonts[n]=[i],!t.svg)for(var r in i.face["units-per-em"]=p(t.face["units-per-em"],10),t.glyphs)if(t.glyphs[O](r)){var a=t.glyphs[r];if(i.glyphs[r]={w:a.w,k:{},d:a.d&&"M"+a.d.replace(/[mlcxtrv]/g,function(t){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[t]||"M"})+"z"},a.k)for(var s in a.k)a[O](s)&&(i.glyphs[r].k[s]=a.k[s])}return t},Z.getFont=function(t,e,i,n){if(n=n||"normal",i=i||"normal",e=+e||{normal:400,bold:700,lighter:300,bolder:800}[e]||400,P.fonts){var r,a=P.fonts[t];if(!a){var s,o=new RegExp("(^|\\s)"+t.replace(/[^\w\d\s+!~.:_-]/g,w)+"(\\s|$)","i");for(s in P.fonts)if(P.fonts[O](s)&&o.test(s)){a=P.fonts[s];break}}if(a)for(var l=0,u=a.length;l<u&&((r=a[l]).face["font-weight"]!=e||r.face["font-style"]!=i&&r.face["font-style"]||r.face["font-stretch"]!=n);l++);return r}},Z.print=function(t,e,i,n,r,a,s,o){a=a||"middle",s=x(S(s||0,1),-1),o=x(S(o||1,3),1);var l=M(i)[R](w),u=0,h=0,c=w;if(n=P.is(n,"string")?this.getFont(n):n)for(var d,p,f=(r||16)/n.face["units-per-em"],r=n.face.bbox[R](D),m=+r[0],g=r[3]-r[1],v=0,y=+r[1]+("baseline"==a?g+ +n.face.descent:g/2),_=0,b=l.length;_<b;_++)"\n"==l[_]?(h=p=u=0,v+=g*o):(d=h&&n.glyphs[l[_-1]]||{},p=n.glyphs[l[_]],u+=h?(d.w||n.w)+(d.k&&d.k[l[_]]||0)+n.w*s:0,h=1),p&&p.d&&(c+=P.transformPath(p.d,["t",u*f,v*f,"s",f,f,m,y,"t",(t-m)/f,(e-y)/f]));return this.path(c).attr({fill:"#000",stroke:"none"})},Z.add=function(t){if(P.is(t,"array"))for(var e,i=this.set(),n=0,r=t.length;n<r;n++)e=t[n]||{},a[O](e.type)&&i.push(this[e.type]().attr(e));return i},P.format=function(t,e){var i=P.is(e,y)?[0][L](e):arguments;return(t=t&&P.is(t,"string")&&i.length-1?t.replace(s,function(t,e){return null==i[++e]?w:i[e]}):t)||w},P.fullfill=(re=/\{([^\}]+)\}/g,ae=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,function(t,n){return String(t).replace(re,function(t,e){return i=t,a=t=n,e.replace(ae,function(t,e,i,n,r){e=e||n,a&&("function"==typeof(a=e in a?a[e]:a)&&r&&(a=a()))}),a=(null==a||a==t?i:a)+"";var i,a})}),P.ninja=function(){if(o.was)f.win.Raphael=o.is;else{window.Raphael=void 0;try{delete window.Raphael}catch(t){}}return P},P.st=he,A.on("raphael.DOMload",function(){n=!0}),null==(se=document).readyState&&se.addEventListener&&(se.addEventListener("DOMContentLoaded",oe=function(){se.removeEventListener("DOMContentLoaded",oe,!1),se.readyState="complete"},!1),se.readyState="loading"),function t(){/in/.test(se.readyState)?setTimeout(t,9):P.eve("raphael.DOMload")}(),P}.apply(e,i))||(t.exports=i)},function(t,e,i){var i=[i(0),i(3),i(4)];void 0===(i=function(t){return t}.apply(e,i))||(t.exports=i)},function(t,e,i){var p,f,m,d="hasOwnProperty",g=/[\.\/]/,v=/\s*,\s*/,y=function(t,e){return t-e},_={n:{}},b=function(){for(var t=0,e=this.length;t<e;t++)if(void 0!==this[t])return this[t]},w=function(){for(var t=this.length;--t;)if(void 0!==this[t])return this[t]},n=Object.prototype.toString,T=String,x=Array.isArray||function(t){return t instanceof Array||"[object Array]"==n.call(t)};(m=function(t,e){var i,n=f,r=Array.prototype.slice.call(arguments,2),a=m.listeners(t),s=0,o=[],l={},u=[],h=p;u.firstDefined=b,u.lastDefined=w,p=t;for(var c=f=0,d=a.length;c<d;c++)"zIndex"in a[c]&&(o.push(a[c].zIndex),a[c].zIndex<0&&(l[a[c].zIndex]=a[c]));for(o.sort(y);o[s]<0;)if(i=l[o[s++]],u.push(i.apply(e,r)),f)return f=n,u;for(c=0;c<d;c++)if("zIndex"in(i=a[c]))if(i.zIndex==o[s]){if(u.push(i.apply(e,r)),f)break;do{if((i=l[o[++s]])&&u.push(i.apply(e,r)),f)break}while(i)}else l[i.zIndex]=i;else if(u.push(i.apply(e,r)),f)break;return f=n,p=h,u})._events=_,m.listeners=function(t){for(var e,i,n,r,a,s,o,l=x(t)?t:t.split(g),u=[_],h=[],c=0,d=l.length;c<d;c++){for(s=[],r=0,a=u.length;r<a;r++)for(i=[(o=u[r].n)[l[c]],o["*"]],n=2;n--;)(e=i[n])&&(s.push(e),h=h.concat(e.f||[]));u=s}return h},m.separator=function(t){g=t?(t="["+T(t).replace(/(?=[\.\^\]\[\-])/g,"\\")+"]",new RegExp(t)):/[\.\/]/},m.on=function(t,s){if("function"!=typeof s)return function(){};for(var e=x(t)?x(t[0])?t:[t]:T(t).split(v),i=0,n=e.length;i<n;i++)!function(t){for(var e,i=x(t)?t:T(t).split(g),n=_,r=0,a=i.length;r<a;r++)n=(n=n.n).hasOwnProperty(i[r])&&n[i[r]]||(n[i[r]]={n:{}});for(n.f=n.f||[],r=0,a=n.f.length;r<a;r++)if(n.f[r]==s){e=!0;break}e||n.f.push(s)}(e[i]);return function(t){+t==+t&&(s.zIndex=+t)}},m.f=function(t){var e=[].slice.call(arguments,1);return function(){m.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},m.stop=function(){f=1},m.nt=function(t){var e=x(p)?p.join("."):p;return t?new RegExp("(?:\\.|\\/|^)"+t+"(?:\\.|\\/|$)").test(e):e},m.nts=function(){return x(p)?p:p.split(g)},m.off=m.unbind=function(t,e){if(t)if(1<(o=x(t)?x(t[0])?t:[t]:T(t).split(v)).length)for(var i=0,n=o.length;i<n;i++)m.off(o[i],e);else{for(var r,a,s,o=x(t)?t:T(t).split(g),l=[_],i=0,n=o.length;i<n;i++)for(h=0;h<l.length;h+=s.length-2){if(s=[h,1],r=l[h].n,"*"!=o[i])r[o[i]]&&s.push(r[o[i]]);else for(a in r)r[d](a)&&s.push(r[a]);l.splice.apply(l,s)}for(i=0,n=l.length;i<n;i++)for(r=l[i];r.n;){if(e){if(r.f){for(h=0,c=r.f.length;h<c;h++)if(r.f[h]==e){r.f.splice(h,1);break}r.f.length||delete r.f}for(a in r.n)if(r.n[d](a)&&r.n[a].f){for(var u=r.n[a].f,h=0,c=u.length;h<c;h++)if(u[h]==e){u.splice(h,1);break}u.length||delete r.n[a].f}}else for(a in delete r.f,r.n)r.n[d](a)&&r.n[a].f&&delete r.n[a].f;r=r.n}}else m._events=_={n:{}}},m.once=function(t,e){function i(){return m.off(t,i),e.apply(this,arguments)}return m.on(t,i)},m.version="0.5.0",m.toString=function(){return"You are running Eve 0.5.0"},t.exports?t.exports=m:void 0===(e=function(){return m}.apply(e,[]))||(t.exports=e)},function(t,e,i){var i=[i(0)];void 0===(i=function(x){if(!x||x.svg){var S="hasOwnProperty",E=String,m=parseFloat,y=parseInt,g=Math,_=g.max,b=g.abs,v=g.pow,w=/[, ]+/,d=x.eve,k="",T="http://www.w3.org/1999/xlink",C={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},I={};x.toString=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};function A(t,e){var n="linear",i=t.id+e,r=.5,a=.5,s=t.node,o=t.paper,l=s.style,u=x._g.doc.getElementById(i);if(!u){if(e=(e=E(e).replace(x._radial_gradient,function(t,e,i){return n="radial",e&&i&&(r=m(e),i=2*(.5<(a=m(i)))-1,.25<v(r-.5,2)+v(a-.5,2)&&(a=g.sqrt(.25-v(r-.5,2))*i+.5)&&.5!=a&&(a=a.toFixed(5)-1e-5*i)),k})).split(/\s*\-\s*/),"linear"==n){var h=e.shift(),h=-m(h);if(isNaN(h))return null;var c=[0,0,g.cos(x.rad(h)),g.sin(x.rad(h))],h=1/(_(b(c[2]),b(c[3]))||1);c[2]*=h,c[3]*=h,c[2]<0&&(c[0]=-c[2],c[2]=0),c[3]<0&&(c[1]=-c[3],c[3]=0)}var d=x._parseDots(e);if(!d)return null;if(i=i.replace(/[\(\)\s,\xb0#]/g,"_"),t.gradient&&i!=t.gradient.id&&(o.defs.removeChild(t.gradient),delete t.gradient),!t.gradient){u=L(n+"Gradient",{id:i}),t.gradient=u,L(u,"radial"==n?{fx:r,fy:a}:{x1:c[0],y1:c[1],x2:c[2],y2:c[3],gradientTransform:t.matrix.invert()}),o.defs.appendChild(u);for(var p=0,f=d.length;p<f;p++)u.appendChild(L("stop",{offset:d[p].offset||(p?"100%":"0%"),"stop-color":d[p].color||"#fff","stop-opacity":isFinite(d[p].opacity)?d[p].opacity:1}))}}return L(s,{fill:M(i),opacity:1,"fill-opacity":1}),l.fill=k,l.opacity=1,l.fillOpacity=1}function P(t){var e=t.getBBox(1);L(t.pattern,{patternTransform:t.matrix.invert()+" translate("+e.x+","+e.y+")"})}function D(t,e,i){if("path"==t.type){for(var n,r,a,s,o,l,u,h,c,d=E(e).toLowerCase().split("-"),p=t.paper,f=i?"end":"start",m=t.node,g=t.attrs,v=g["stroke-width"],y=d.length,_="classic",b=3,w=3,T=5;y--;)switch(d[y]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":_=d[y];break;case"wide":w=5;break;case"narrow":w=2;break;case"long":b=5;break;case"short":b=2}for(a in a="open"==_?(b+=2,w+=2,T+=2,u=1,r=i?4:1,{fill:"none",stroke:g.stroke}):(r=u=b/2,{fill:g.stroke,stroke:"none"}),t._.arrows?i?(t._.arrows.endPath&&I[t._.arrows.endPath]--,t._.arrows.endMarker&&I[t._.arrows.endMarker]--):(t._.arrows.startPath&&I[t._.arrows.startPath]--,t._.arrows.startMarker&&I[t._.arrows.startMarker]--):t._.arrows={},"none"!=_?(o="raphael-marker-"+f+_+b+w+"-obj"+t.id,x._g.doc.getElementById(s="raphael-marker-"+_)?I[s]++:(p.defs.appendChild(L(L("path"),{"stroke-linecap":"round",d:C[_],id:s})),I[s]=1),(l=x._g.doc.getElementById(o))?(I[o]++,h=l.getElementsByTagName("use")[0]):(l=L(L("marker"),{id:o,markerHeight:w,markerWidth:b,orient:"auto",refX:r,refY:w/2}),h=L(L("use"),{"xlink:href":"#"+s,transform:(i?"rotate(180 "+b/2+" "+w/2+") ":k)+"scale("+b/T+","+w/T+")","stroke-width":(1/((b/T+w/T)/2)).toFixed(4)}),l.appendChild(h),p.defs.appendChild(l),I[o]=1),L(h,a),u=u*("diamond"!=_&&"oval"!=_),h=i?(n=t._.arrows.startdx*v||0,x.getTotalLength(g.path)-u*v):(n=u*v,x.getTotalLength(g.path)-(t._.arrows.enddx*v||0)),(a={})["marker-"+f]="url(#"+o+")",(h||n)&&(a.d=x.getSubpath(g.path,n,h)),L(m,a),t._.arrows[f+"Path"]=s,t._.arrows[f+"Marker"]=o,t._.arrows[f+"dx"]=u,t._.arrows[f+"Type"]=_,t._.arrows[f+"String"]=e):(h=i?(n=t._.arrows.startdx*v||0,x.getTotalLength(g.path)-n):(n=0,x.getTotalLength(g.path)-(t._.arrows.enddx*v||0)),t._.arrows[f+"Path"]&&L(m,{d:x.getSubpath(g.path,n,h)}),delete t._.arrows[f+"Path"],delete t._.arrows[f+"Marker"],delete t._.arrows[f+"dx"],delete t._.arrows[f+"Type"],delete t._.arrows[f+"String"]),I)!I[S](a)||I[a]||(c=x._g.doc.getElementById(a))&&c.parentNode.removeChild(c)}}function O(t,e,i){if(e=l[E(e).toLowerCase()]){for(var n=t.attrs["stroke-width"]||"1",r={round:n,square:n,butt:0}[t.attrs["stroke-linecap"]||i["stroke-linecap"]]||0,a=[],s=e.length;s--;)a[s]=e[s]*n+(s%2?1:-1)*r;L(t.node,{"stroke-dasharray":a.join(",")})}else L(t.node,{"stroke-dasharray":"none"})}function p(t,e){var i,n=t.node,r=t.attrs,a=n.style.visibility;for(i in n.style.visibility="hidden",e)if(e[S](i)){if(!x._availableAttrs[S](i))continue;var s=e[i];switch(r[i]=s,i){case"blur":t.blur(s);break;case"title":var o,l=n.getElementsByTagName("title");l.length&&(l=l[0])?l.firstChild.nodeValue=s:(l=L("title"),o=x._g.doc.createTextNode(s),l.appendChild(o),n.appendChild(l));break;case"href":case"target":var u=n.parentNode;"a"!=u.tagName.toLowerCase()&&(l=L("a"),u.insertBefore(l,n),l.appendChild(n),u=l),"target"==i?u.setAttributeNS(T,"show","blank"==s?"new":s):u.setAttributeNS(T,i,s);break;case"cursor":n.style.cursor=s;break;case"transform":t.transform(s);break;case"arrow-start":D(t,s);break;case"arrow-end":D(t,s,1);break;case"clip-rect":var h,u=E(s).split(w);4==u.length&&(t.clip&&t.clip.parentNode.parentNode.removeChild(t.clip.parentNode),d=L("clipPath"),h=L("rect"),d.id=x.createUUID(),L(h,{x:u[0],y:u[1],width:u[2],height:u[3]}),d.appendChild(h),t.paper.defs.appendChild(d),L(n,{"clip-path":"url(#"+d.id+")"}),t.clip=h),s||(h=n.getAttribute("clip-path"))&&((v=x._g.doc.getElementById(h.replace(/(^url\(#|\)$)/g,k)))&&v.parentNode.removeChild(v),L(n,{"clip-path":k}),delete t.clip);break;case"path":"path"==t.type&&(L(n,{d:s?r.path=x._pathToAbsolute(s):"M0,0"}),t._.dirty=1,t._.arrows&&("startString"in t._.arrows&&D(t,t._.arrows.startString),"endString"in t._.arrows&&D(t,t._.arrows.endString,1)));break;case"width":if(n.setAttribute(i,s),t._.dirty=1,!r.fx)break;i="x",s=r.x;case"x":r.fx&&(s=-r.x-(r.width||0));case"rx":if("rx"==i&&"rect"==t.type)break;case"cx":n.setAttribute(i,s),t.pattern&&P(t),t._.dirty=1;break;case"height":if(n.setAttribute(i,s),t._.dirty=1,!r.fy)break;i="y",s=r.y;case"y":r.fy&&(s=-r.y-(r.height||0));case"ry":if("ry"==i&&"rect"==t.type)break;case"cy":n.setAttribute(i,s),t.pattern&&P(t),t._.dirty=1;break;case"r":"rect"==t.type?L(n,{rx:s,ry:s}):n.setAttribute(i,s),t._.dirty=1;break;case"src":"image"==t.type&&n.setAttributeNS(T,"href",s);break;case"stroke-width":1==t._.sx&&1==t._.sy||(s/=_(b(t._.sx),b(t._.sy))||1),n.setAttribute(i,s),r["stroke-dasharray"]&&O(t,r["stroke-dasharray"],e),t._.arrows&&("startString"in t._.arrows&&D(t,t._.arrows.startString),"endString"in t._.arrows&&D(t,t._.arrows.endString,1));break;case"stroke-dasharray":O(t,s,e);break;case"fill":var c=E(s).match(x._ISURL);if(c){var d=L("pattern"),p=L("image");d.id=x.createUUID(),L(d,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),L(p,{x:0,y:0,"xlink:href":c[1]}),d.appendChild(p),function(i){x._preload(c[1],function(){var t=this.offsetWidth,e=this.offsetHeight;L(i,{width:t,height:e}),L(p,{width:t,height:e})})}(d),t.paper.defs.appendChild(d),L(n,{fill:"url(#"+d.id+")"}),t.pattern=d,t.pattern&&P(t);break}var f,m,g=x.getRGB(s);if(g.error){if(("circle"==t.type||"ellipse"==t.type||"r"!=E(s).charAt())&&A(t,s)){!("opacity"in r||"fill-opacity"in r)||(f=x._g.doc.getElementById(n.getAttribute("fill").replace(/^url\(#|\)$/g,k)))&&(m=f.getElementsByTagName("stop"),L(m[m.length-1],{"stop-opacity":("opacity"in r?r.opacity:1)*("fill-opacity"in r?r["fill-opacity"]:1)})),r.gradient=s,r.fill="none";break}}else delete e.gradient,delete r.gradient,!x.is(r.opacity,"undefined")&&x.is(e.opacity,"undefined")&&L(n,{opacity:r.opacity}),!x.is(r["fill-opacity"],"undefined")&&x.is(e["fill-opacity"],"undefined")&&L(n,{"fill-opacity":r["fill-opacity"]});g[S]("opacity")&&L(n,{"fill-opacity":1<g.opacity?g.opacity/100:g.opacity});case"stroke":g=x.getRGB(s),n.setAttribute(i,g.hex),"stroke"==i&&g[S]("opacity")&&L(n,{"stroke-opacity":1<g.opacity?g.opacity/100:g.opacity}),"stroke"==i&&t._.arrows&&("startString"in t._.arrows&&D(t,t._.arrows.startString),"endString"in t._.arrows&&D(t,t._.arrows.endString,1));break;case"gradient":"circle"!=t.type&&"ellipse"!=t.type&&"r"==E(s).charAt()||A(t,s);break;case"opacity":r.gradient&&!r[S]("stroke-opacity")&&L(n,{"stroke-opacity":1<s?s/100:s});case"fill-opacity":if(r.gradient){(f=x._g.doc.getElementById(n.getAttribute("fill").replace(/^url\(#|\)$/g,k)))&&(m=f.getElementsByTagName("stop"),L(m[m.length-1],{"stop-opacity":s}));break}default:"font-size"==i&&(s=y(s,10)+"px");var v=i.replace(/(\-.)/g,function(t){return t.substring(1).toUpperCase()});n.style[v]=s,t._.dirty=1,n.setAttribute(i,s)}}(function(t,e){if("text"==t.type&&(e[S]("text")||e[S]("font")||e[S]("font-size")||e[S]("x")||e[S]("y"))){var i=t.attrs,n=t.node,r=n.firstChild?y(x._g.doc.defaultView.getComputedStyle(n.firstChild,k).getPropertyValue("font-size"),10):10;if(e[S]("text")){for(i.text=e.text;n.firstChild;)n.removeChild(n.firstChild);for(var a,s=E(e.text).split("\n"),o=[],l=0,u=s.length;l<u;l++)a=L("tspan"),l&&L(a,{dy:1.2*r,x:i.x}),a.appendChild(x._g.doc.createTextNode(s[l])),n.appendChild(a),o[l]=a}else for(l=0,u=(o=n.getElementsByTagName("tspan")).length;l<u;l++)l?L(o[l],{dy:1.2*r,x:i.x}):L(o[0],{dy:0});L(n,{x:i.x,y:i.y}),t._.dirty=1;var h=t._getBBox(),c=i.y-(h.y+h.height/2);c&&x.is(c,"finite")&&L(o[0],{dy:c})}})(t,e),n.style.visibility=a}function n(t){return t.parentNode&&"a"===t.parentNode.tagName.toLowerCase()?t.parentNode:t}function o(t,e){(this[0]=this.node=t).raphael=!0,this.id=("0000"+(Math.random()*Math.pow(36,5)<<0).toString(36)).slice(-5),t.raphaelid=this.id,this.matrix=x.matrix(),this.realPath=null,this.paper=e,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},e.bottom||(e.bottom=this),this.prev=e.top,e.top&&(e.top.next=this),(e.top=this).next=null}var L=function(t,e){if(e)for(var i in"string"==typeof t&&(t=L(t)),e)e[S](i)&&("xlink:"==i.substring(0,6)?t.setAttributeNS(T,i.substring(6),E(e[i])):t.setAttribute(i,E(e[i])));else(t=x._g.doc.createElementNS("http://www.w3.org/2000/svg",t)).style&&(t.style.webkitTapHighlightColor="rgba(0,0,0,0)");return t},M=function(t){if((e=document.documentMode)&&(9===e||10===e))return"url('#"+t+"')";var e=document.location;return"url('"+e.protocol+"//"+e.host+e.pathname+e.search+"#"+t+"')"},l={"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},t=x.el;(o.prototype=t).constructor=o,x._engine.path=function(t,e){var i=L("path");e.canvas&&e.canvas.appendChild(i);e=new o(i,e);return e.type="path",p(e,{fill:"none",stroke:"#000",path:t}),e},t.rotate=function(t,e,i){return this.removed||((t=E(t).split(w)).length-1&&(e=m(t[1]),i=m(t[2])),t=m(t[0]),null!=(e=null==i?i:e)&&null!=i||(e=(n=this.getBBox(1)).x+n.width/2,i=n.y+n.height/2),this.transform(this._.transform.concat([["r",t,e,i]]))),this;var n},t.scale=function(t,e,i,n){return this.removed||((t=E(t).split(w)).length-1&&(e=m(t[1]),i=m(t[2]),n=m(t[3])),t=m(t[0]),null==e&&(e=t),null!=(i=null==n?n:i)&&null!=n||(r=this.getBBox(1)),i=null==i?r.x+r.width/2:i,n=null==n?r.y+r.height/2:n,this.transform(this._.transform.concat([["s",t,e,i,n]]))),this;var r},t.translate=function(t,e){return this.removed||((t=E(t).split(w)).length-1&&(e=m(t[1])),t=m(t[0])||0,this.transform(this._.transform.concat([["t",t,e=+e||0]]))),this},t.transform=function(t){var e=this._;return null==t?e.transform:(x._extractTransform(this,t),this.clip&&L(this.clip,{transform:this.matrix.invert()}),this.pattern&&P(this),this.node&&L(this.node,{transform:this.matrix}),1==e.sx&&1==e.sy||(e=this.attrs[S]("stroke-width")?this.attrs["stroke-width"]:1,this.attr({"stroke-width":e})),this)},t.hide=function(){return this.removed||(this.node.style.display="none"),this},t.show=function(){return this.removed||(this.node.style.display=""),this},t.remove=function(){var t=n(this.node);if(!this.removed&&t.parentNode){var e,i=this.paper;for(e in i.__set__&&i.__set__.exclude(this),d.unbind("raphael.*.*."+this.id),this.gradient&&i.defs.removeChild(this.gradient),x._tear(this,i),t.parentNode.removeChild(t),this.removeData(),this)this[e]="function"==typeof this[e]?x._removedFactory(e):null;this.removed=!0}},t._getBBox=function(){var t;"none"==this.node.style.display&&(this.show(),t=!0);var e,i=!1;this.paper.canvas.parentElement?e=this.paper.canvas.parentElement.style:this.paper.canvas.parentNode&&(e=this.paper.canvas.parentNode.style),e&&"none"==e.display&&(i=!0,e.display="");var n={};try{n=this.node.getBBox()}catch(t){n={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}finally{n=n||{},i&&(e.display="none")}return t&&this.hide(),n},t.attr=function(t,e){if(this.removed)return this;if(null==t){var i,n={};for(i in this.attrs)this.attrs[S](i)&&(n[i]=this.attrs[i]);return n.gradient&&"none"==n.fill&&(n.fill=n.gradient)&&delete n.gradient,n.transform=this._.transform,n}if(null==e&&x.is(t,"string")){if("fill"==t&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==t)return this._.transform;for(var r=t.split(w),a={},s=0,o=r.length;s<o;s++)(t=r[s])in this.attrs?a[t]=this.attrs[t]:x.is(this.paper.customAttributes[t],"function")?a[t]=this.paper.customAttributes[t].def:a[t]=x._availableAttrs[t];return o-1?a:a[r[0]]}if(null==e&&x.is(t,"array")){for(a={},s=0,o=t.length;s<o;s++)a[t[s]]=this.attr(t[s]);return a}var l,u;for(u in null!=e?(l={})[t]=e:null!=t&&x.is(t,"object")&&(l=t),l)d("raphael.attr."+u+"."+this.id,this,l[u]);for(u in this.paper.customAttributes)if(this.paper.customAttributes[S](u)&&l[S](u)&&x.is(this.paper.customAttributes[u],"function")){var h,c=this.paper.customAttributes[u].apply(this,[].concat(l[u]));for(h in this.attrs[u]=l[u],c)c[S](h)&&(l[h]=c[h])}return p(this,l),this},t.toFront=function(){if(this.removed)return this;var t=n(this.node);t.parentNode.appendChild(t);t=this.paper;return t.top!=this&&x._tofront(this,t),this},t.toBack=function(){if(this.removed)return this;var t=n(this.node),e=t.parentNode;return e.insertBefore(t,e.firstChild),x._toback(this,this.paper),this.paper,this},t.insertAfter=function(t){if(this.removed||!t)return this;var e=n(this.node),i=n(t.node||t[t.length-1].node);return i.nextSibling?i.parentNode.insertBefore(e,i.nextSibling):i.parentNode.appendChild(e),x._insertafter(this,t,this.paper),this},t.insertBefore=function(t){if(this.removed||!t)return this;var e=n(this.node),i=n(t.node||t[0].node);return i.parentNode.insertBefore(e,i),x._insertbefore(this,t,this.paper),this},t.blur=function(t){var e,i,n=this;return 0!=+t?(e=L("filter"),i=L("feGaussianBlur"),n.attrs.blur=t,e.id=x.createUUID(),L(i,{stdDeviation:+t||1.5}),e.appendChild(i),n.paper.defs.appendChild(e),n._blur=e,L(n.node,{filter:"url(#"+e.id+")"})):(n._blur&&(n._blur.parentNode.removeChild(n._blur),delete n._blur,delete n.attrs.blur),n.node.removeAttribute("filter")),n},x._engine.circle=function(t,e,i,n){var r=L("circle");t.canvas&&t.canvas.appendChild(r);t=new o(r,t);return t.attrs={cx:e,cy:i,r:n,fill:"none",stroke:"#000"},t.type="circle",L(r,t.attrs),t},x._engine.rect=function(t,e,i,n,r,a){var s=L("rect");t.canvas&&t.canvas.appendChild(s);t=new o(s,t);return t.attrs={x:e,y:i,width:n,height:r,rx:a||0,ry:a||0,fill:"none",stroke:"#000"},t.type="rect",L(s,t.attrs),t},x._engine.ellipse=function(t,e,i,n,r){var a=L("ellipse");t.canvas&&t.canvas.appendChild(a);t=new o(a,t);return t.attrs={cx:e,cy:i,rx:n,ry:r,fill:"none",stroke:"#000"},t.type="ellipse",L(a,t.attrs),t},x._engine.image=function(t,e,i,n,r,a){var s=L("image");L(s,{x:i,y:n,width:r,height:a,preserveAspectRatio:"none"}),s.setAttributeNS(T,"href",e),t.canvas&&t.canvas.appendChild(s);t=new o(s,t);return t.attrs={x:i,y:n,width:r,height:a,src:e},t.type="image",t},x._engine.text=function(t,e,i,n){var r=L("text");t.canvas&&t.canvas.appendChild(r);t=new o(r,t);return t.attrs={x:e,y:i,"text-anchor":"middle",text:n,"font-family":x._availableAttrs["font-family"],"font-size":x._availableAttrs["font-size"],stroke:"none",fill:"#000"},t.type="text",p(t,t.attrs),t},x._engine.setSize=function(t,e){return this.width=t||this.width,this.height=e||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},x._engine.create=function(){var t=x._getContainer.apply(0,arguments),e=t&&t.container;if(!e)throw new Error("SVG container not found.");var i,n=t.x,r=t.y,a=t.width,s=t.height,o=L("svg"),t="overflow:hidden;",n=n||0,r=r||0;return L(o,{height:s=s||342,version:1.1,width:a=a||512,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),1==e?(o.style.cssText=t+"position:absolute;left:"+n+"px;top:"+r+"px",x._g.doc.body.appendChild(o),i=1):(o.style.cssText=t+"position:relative",e.firstChild?e.insertBefore(o,e.firstChild):e.appendChild(o)),(e=new x._Paper).width=a,e.height=s,e.canvas=o,e.clear(),e._left=e._top=0,i&&(e.renderfix=function(){}),e.renderfix(),e},x._engine.setViewBox=function(t,e,i,n,r){d("raphael.setViewBox",this,this._viewBox,[t,e,i,n,r]);var a,s=this.getSize(),o=_(i/s.width,n/s.height),l=this.top,u=r?"xMidYMid meet":"xMinYMin",s=null==t?(this._vbSize&&(o=1),delete this._vbSize,"0 0 "+this.width+" "+this.height):(this._vbSize=o,t+" "+e+" "+i+" "+n);for(L(this.canvas,{viewBox:s,preserveAspectRatio:u});o&&l;)a="stroke-width"in l.attrs?l.attrs["stroke-width"]:1,l.attr({"stroke-width":a}),l._.dirty=1,l._.dirtyT=1,l=l.prev;return this._viewBox=[t,e,i,n,!!r],this},x.prototype.renderfix=function(){var t=this.canvas,e=t.style;try{i=t.getScreenCTM()||t.createSVGMatrix()}catch(e){i=t.createSVGMatrix()}var t=-i.e%1,i=-i.f%1;(t||i)&&(t&&(this._left=(this._left+t)%1,e.left=this._left+"px"),i&&(this._top=(this._top+i)%1,e.top=this._top+"px"))},x.prototype.clear=function(){x.eve("raphael.clear",this);for(var t=this.canvas;t.firstChild;)t.removeChild(t.firstChild);this.bottom=this.top=null,(this.desc=L("desc")).appendChild(x._g.doc.createTextNode("Created with Raphaël "+x.version)),t.appendChild(this.desc),t.appendChild(this.defs=L("defs"))},x.prototype.remove=function(){for(var t in d("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this)this[t]="function"==typeof this[t]?x._removedFactory(t):null};var e,i=x.st;for(e in t)t[S](e)&&!i[S](e)&&(i[e]=function(i){return function(){var e=arguments;return this.forEach(function(t){t[i].apply(t,e)})}}(e))}}.apply(e,i))||(t.exports=i)},function(t,e,i){var i=[i(0)];void 0===(i=function(_){if(!_||_.vml){function m(t,e,i){var n=_.matrix();return n.rotate(-t,.5,.5),{dx:n.x(e,i),dy:n.y(e,i)}}function b(t,e,i,n,r,a){var s,o=t._,l=t.matrix,u=o.fillpos,h=t.node,c=h.style,d=1,p="",f=M/e,t=M/i;c.visibility="hidden",e&&i&&(h.coordsize=g(f)+A+g(t),c.rotation=a*(e*i<0?-1:1),a&&(n=(s=m(a,n,r)).dx,r=s.dy),e<0&&(p+="x"),i<0&&(p+=" y")&&(d=-1),c.flip=p,h.coordorigin=n*-f+A+r*-t,(u||o.fillsize)&&(t=(t=h.getElementsByTagName("fill"))&&t[0],h.removeChild(t),u&&(s=m(a,l.x(u[0],u[1]),l.y(u[0],u[1])),t.position=s.dx*d+A+s.dy*d),o.fillsize&&(t.size=o.fillsize[0]*g(e)+A+o.fillsize[1]*g(i)),h.appendChild(t)),c.visibility="visible")}var w="hasOwnProperty",T=String,x=parseFloat,S=Math,E=S.round,k=S.max,C=S.min,g=S.abs,I=/[, ]+/,d=_.eve,A=" ",P="",D={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},O=/([clmz]),?([^clmz]*)/gi,n=/ progid:\S+Blur\([^\)]+\)/g,L=/-?[^,\s-]+/g,u="position:absolute;left:0;top:0;width:1px;height:1px;behavior:url(#default#VML)",M=21600,R={path:1,rect:1,image:1},N={circle:1,ellipse:1};_.toString=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version};function B(t,e,i){for(var n=T(e).toLowerCase().split("-"),i=i?"end":"start",r=n.length,a="classic",s="medium",o="medium";r--;)switch(n[r]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":a=n[r];break;case"wide":case"narrow":o=n[r];break;case"long":case"short":s=n[r]}t=t.node.getElementsByTagName("stroke")[0];t[i+"arrow"]=a,t[i+"arrowlength"]=s,t[i+"arrowwidth"]=o}function p(t,e){t.attrs=t.attrs||{};var i,n,r,a,s,o,l,u=t.node,h=t.attrs,c=u.style,d=R[t.type]&&(e.x!=h.x||e.y!=h.y||e.width!=h.width||e.height!=h.height||e.cx!=h.cx||e.cy!=h.cy||e.rx!=h.rx||e.ry!=h.ry||e.r!=h.r),p=N[t.type]&&(h.cx!=e.cx||h.cy!=e.cy||h.r!=e.r||h.rx!=e.rx||h.ry!=e.ry),f=t;for(i in e)e[w](i)&&(h[i]=e[i]);if(d&&(h.path=_._getPath[t.type](t),t._.dirty=1),e.href&&(u.href=e.href),e.title&&(u.title=e.title),e.target&&(u.target=e.target),e.cursor&&(c.cursor=e.cursor),"blur"in e&&t.blur(e.blur),(e.path&&"path"==t.type||d)&&(u.path=function(t){var e=/[ahqstv]/gi,i=_._pathToAbsolute;if(T(t).match(e)&&(i=_._path2curve),e=/[clmz]/g,i==_._pathToAbsolute&&!T(t).match(e)){var n=T(t).replace(O,function(t,e,i){var n=[],r="m"==e.toLowerCase(),a=D[e];return i.replace(L,function(t){r&&2==n.length&&(a+=n+D["m"==e?"l":"L"],n=[]),n.push(E(t*M))}),a+n});return n}for(var r,a,s=i(t),n=[],o=0,l=s.length;o<l;o++){r=s[o],"z"==(a=s[o][0].toLowerCase())&&(a="x");for(var u=1,h=r.length;u<h;u++)a+=E(r[u]*M)+(u!=h-1?",":P);n.push(a)}return n.join(A)}(~T(h.path).toLowerCase().indexOf("r")?_._pathToAbsolute(h.path):h.path),t._.dirty=1,"image"==t.type&&(t._.fillpos=[h.x,h.y],t._.fillsize=[h.width,h.height],b(t,1,1,0,0,0))),"transform"in e&&t.transform(e.transform),p&&(a=+h.cx,n=+h.cy,p=+h.rx||+h.r||0,r=+h.ry||+h.r||0,u.path=_.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",E((a-p)*M),E((n-r)*M),E((a+p)*M),E((n+r)*M),E(a*M)),t._.dirty=1),"clip-rect"in e&&(4==(n=T(e["clip-rect"]).split(I)).length&&(n[2]=+n[2]+ +n[0],n[3]=+n[3]+ +n[1],(a=(r=u.clipRect||_._g.doc.createElement("div")).style).clip=_.format("rect({1}px {2}px {3}px {0}px)",n),u.clipRect||(a.position="absolute",a.top=0,a.left=0,a.width=t.paper.width+"px",a.height=t.paper.height+"px",u.parentNode.insertBefore(r,u),r.appendChild(u),u.clipRect=r)),e["clip-rect"]||u.clipRect&&(u.clipRect.style.clip="auto")),t.textpath&&(o=t.textpath.style,e.font&&(o.font=e.font),e["font-family"]&&(o.fontFamily='"'+e["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,P)+'"'),e["font-size"]&&(o.fontSize=e["font-size"]),e["font-weight"]&&(o.fontWeight=e["font-weight"]),e["font-style"]&&(o.fontStyle=e["font-style"])),"arrow-start"in e&&B(f,e["arrow-start"]),"arrow-end"in e&&B(f,e["arrow-end"],1),null==e.opacity&&null==e.fill&&null==e.src&&null==e.stroke&&null==e["stroke-width"]&&null==e["stroke-opacity"]&&null==e["fill-opacity"]&&null==e["stroke-dasharray"]&&null==e["stroke-miterlimit"]&&null==e["stroke-linejoin"]&&null==e["stroke-linecap"]||((o=(o=u.getElementsByTagName("fill"))&&o[0])||(o=F("fill")),"image"==t.type&&e.src&&(o.src=e.src),e.fill&&(o.on=!0),null!=o.on&&"none"!=e.fill&&null!==e.fill||(o.on=!1),o.on&&e.fill&&((m=T(e.fill).match(_._ISURL))?(o.parentNode==u&&u.removeChild(o),o.rotate=!0,o.src=m[1],o.type="tile",s=t.getBBox(1),o.position=s.x+A+s.y,t._.fillpos=[s.x,s.y],_._preload(m[1],function(){t._.fillsize=[this.offsetWidth,this.offsetHeight]})):(o.color=_.getRGB(e.fill).hex,o.src=P,o.type="solid",_.getRGB(e.fill).error&&(f.type in{circle:1,ellipse:1}||"r"!=T(e.fill).charAt())&&function(t,e,i){t.attrs=t.attrs||{},t.attrs;var n=Math.pow,r="linear",a=".5 .5";if(t.attrs.gradient=e,e=(e=T(e).replace(_._radial_gradient,function(t,e,i){return r="radial",e&&i&&(e=x(e),i=x(i),n(e-.5,2)+n(i-.5,2)>.25&&(i=S.sqrt(.25-n(e-.5,2))*(2*(i>.5)-1)+.5),a=e+A+i),P})).split(/\s*\-\s*/),"linear"==r){var s=e.shift();if(s=-x(s),isNaN(s))return null}var o=_._parseDots(e);if(!o)return null;if(t=t.shape||t.node,o.length){t.removeChild(i),i.on=!0,i.method="none",i.color=o[0].color,i.color2=o[o.length-1].color;for(var l=[],u=0,h=o.length;u<h;u++)o[u].offset&&l.push(o[u].offset+A+o[u].color);i.colors=l.length?l.join():"0% "+i.color,"radial"==r?(i.type="gradientTitle",i.focus="100%",i.focussize="0 0",i.focusposition=a,i.angle=0):(i.type="gradient",i.angle=(270-s)%360),t.appendChild(i)}return 1}(f,e.fill,o)&&(h.fill="none",h.gradient=e.fill,o.rotate=!1))),("fill-opacity"in e||"opacity"in e)&&(l=((+h["fill-opacity"]+1||2)-1)*((+h.opacity+1||2)-1)*((+_.getRGB(e.fill).o+1||2)-1),l=C(k(l,0),1),o.opacity=l,o.src&&(o.color="none")),u.appendChild(o),s=!1,(m=u.getElementsByTagName("stroke")&&u.getElementsByTagName("stroke")[0])||(s=m=F("stroke")),(e.stroke&&"none"!=e.stroke||e["stroke-width"]||null!=e["stroke-opacity"]||e["stroke-dasharray"]||e["stroke-miterlimit"]||e["stroke-linejoin"]||e["stroke-linecap"])&&(m.on=!0),"none"!=e.stroke&&null!==e.stroke&&null!=m.on&&0!=e.stroke&&0!=e["stroke-width"]||(m.on=!1),o=_.getRGB(e.stroke),m.on&&e.stroke&&(m.color=o.hex),l=((+h["stroke-opacity"]+1||2)-1)*((+h.opacity+1||2)-1)*((+o.o+1||2)-1),o=.75*(x(e["stroke-width"])||1),l=C(k(l,0),1),null==e["stroke-width"]&&(o=h["stroke-width"]),e["stroke-width"]&&(m.weight=o),o&&o<1&&(l*=o)&&(m.weight=1),m.opacity=l,e["stroke-linejoin"]&&(m.joinstyle=e["stroke-linejoin"]||"miter"),m.miterlimit=e["stroke-miterlimit"]||8,e["stroke-linecap"]&&(m.endcap="butt"==e["stroke-linecap"]?"flat":"square"==e["stroke-linecap"]?"square":"round"),"stroke-dasharray"in e&&(m.dashstyle=(l={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"})[w](e["stroke-dasharray"])?l[e["stroke-dasharray"]]:P),s&&u.appendChild(m)),"text"==f.type){f.paper.canvas.style.display=P;var u=f.paper.span,m=h.font&&h.font.match(/\d+(?:\.\d*)?(?=px)/),c=u.style;h.font&&(c.font=h.font),h["font-family"]&&(c.fontFamily=h["font-family"]),h["font-weight"]&&(c.fontWeight=h["font-weight"]),h["font-style"]&&(c.fontStyle=h["font-style"]),m=x(h["font-size"]||m&&m[0])||10,c.fontSize=100*m+"px",f.textpath.string&&(u.innerHTML=T(f.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));u=u.getBoundingClientRect();f.W=h.w=(u.right-u.left)/100,f.H=h.h=(u.bottom-u.top)/100,f.X=h.x,f.Y=h.y+f.H/2,("x"in e||"y"in e)&&(f.path.v=_.format("m{0},{1}l{2},{1}",E(h.x*M),E(h.y*M),E(h.x*M)+1));for(var g=["x","y","text","font","font-family","font-weight","font-style","font-size"],v=0,y=g.length;v<y;v++)if(g[v]in e){f._.dirty=1;break}switch(h["text-anchor"]){case"start":f.textpath.style["v-text-align"]="left",f.bbx=f.W/2;break;case"end":f.textpath.style["v-text-align"]="right",f.bbx=-f.W/2;break;default:f.textpath.style["v-text-align"]="center",f.bbx=0}f.textpath.style["v-text-kern"]=!0}}function h(t,e){(this[0]=this.node=t).raphael=!0,this.id=_._oid++,t.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=e,this.matrix=_.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},e.bottom||(e.bottom=this),this.prev=e.top,e.top&&(e.top.next=this),(e.top=this).next=null}var F,t=_.el;(h.prototype=t).constructor=h,t.transform=function(t){if(null==t)return this._.transform;var e,i=this.paper._viewBoxShift,n=i?"s"+[i.scale,i.scale]+"-1-1t"+[i.dx,i.dy]:P;i&&(e=t=T(t).replace(/\.{3}|\u2026/g,this._.transform||P)),_._extractTransform(this,n+t);var r=this.matrix.clone(),a=this.skew,s=this.node,o=~T(this.attrs.fill).indexOf("-"),i=!T(this.attrs.fill).indexOf("url(");return r.translate(1,1),i||o||"image"==this.type?(a.matrix="1 0 0 1",a.offset="0 0",n=r.split(),o&&n.noRotation||!n.isSimple?(s.style.filter=r.toFilter(),t=this.getBBox(),i=this.getBBox(1),o=t.x-i.x,i=t.y-i.y,s.coordorigin=o*-M+A+i*-M,b(this,1,1,o,i,0)):(s.style.filter=P,b(this,n.scalex,n.scaley,n.dx,n.dy,n.rotate))):(s.style.filter=P,a.matrix=T(r),a.offset=r.offset()),null!==e&&(this._.transform=e,_._extractTransform(this,e)),this},t.rotate=function(t,e,i){return this.removed?this:null!=t?((t=T(t).split(I)).length-1&&(e=x(t[1]),i=x(t[2])),t=x(t[0]),null!=(e=null==i?i:e)&&null!=i||(e=(n=this.getBBox(1)).x+n.width/2,i=n.y+n.height/2),this._.dirtyT=1,this.transform(this._.transform.concat([["r",t,e,i]])),this):void 0;var n},t.translate=function(t,e){return this.removed||((t=T(t).split(I)).length-1&&(e=x(t[1])),t=x(t[0])||0,e=+e||0,this._.bbox&&(this._.bbox.x+=t,this._.bbox.y+=e),this.transform(this._.transform.concat([["t",t,e]]))),this},t.scale=function(t,e,i,n){return this.removed||((t=T(t).split(I)).length-1&&(e=x(t[1]),i=x(t[2]),n=x(t[3]),isNaN(i)&&(i=null),isNaN(n)&&(n=null)),t=x(t[0]),null==e&&(e=t),null!=(i=null==n?n:i)&&null!=n||(r=this.getBBox(1)),i=null==i?r.x+r.width/2:i,n=null==n?r.y+r.height/2:n,this.transform(this._.transform.concat([["s",t,e,i,n]])),this._.dirtyT=1),this;var r},t.hide=function(){return this.removed||(this.node.style.display="none"),this},t.show=function(){return this.removed||(this.node.style.display=P),this},t.auxGetBBox=_.el.getBBox,t.getBBox=function(){var t=this.auxGetBBox();if(this.paper&&this.paper._viewBoxShift){var e={},i=1/this.paper._viewBoxShift.scale;return e.x=t.x-this.paper._viewBoxShift.dx,e.x*=i,e.y=t.y-this.paper._viewBoxShift.dy,e.y*=i,e.width=t.width*i,e.height=t.height*i,e.x2=e.x+e.width,e.y2=e.y+e.height,e}return t},t._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},t.remove=function(){if(!this.removed&&this.node.parentNode){for(var t in this.paper.__set__&&this.paper.__set__.exclude(this),_.eve.unbind("raphael.*.*."+this.id),_._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape),this)this[t]="function"==typeof this[t]?_._removedFactory(t):null;this.removed=!0}},t.attr=function(t,e){if(this.removed)return this;if(null==t){var i,n={};for(i in this.attrs)this.attrs[w](i)&&(n[i]=this.attrs[i]);return n.gradient&&"none"==n.fill&&(n.fill=n.gradient)&&delete n.gradient,n.transform=this._.transform,n}if(null==e&&_.is(t,"string")){if("fill"==t&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var r=t.split(I),a={},s=0,o=r.length;s<o;s++)(t=r[s])in this.attrs?a[t]=this.attrs[t]:_.is(this.paper.customAttributes[t],"function")?a[t]=this.paper.customAttributes[t].def:a[t]=_._availableAttrs[t];return o-1?a:a[r[0]]}if(this.attrs&&null==e&&_.is(t,"array")){for(a={},s=0,o=t.length;s<o;s++)a[t[s]]=this.attr(t[s]);return a}var l,u;for(u in null!=e&&((l={})[t]=e),l=null==e&&_.is(t,"object")?t:l)d("raphael.attr."+u+"."+this.id,this,l[u]);if(l){for(u in this.paper.customAttributes)if(this.paper.customAttributes[w](u)&&l[w](u)&&_.is(this.paper.customAttributes[u],"function")){var h,c=this.paper.customAttributes[u].apply(this,[].concat(l[u]));for(h in this.attrs[u]=l[u],c)c[w](h)&&(l[h]=c[h])}l.text&&"text"==this.type&&(this.textpath.string=l.text),p(this,l)}return this},t.toFront=function(){return this.removed||this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&_._tofront(this,this.paper),this},t.toBack=function(){return this.removed||this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),_._toback(this,this.paper)),this},t.insertAfter=function(t){return this.removed||((t=t.constructor==_.st.constructor?t[t.length-1]:t).node.nextSibling?t.node.parentNode.insertBefore(this.node,t.node.nextSibling):t.node.parentNode.appendChild(this.node),_._insertafter(this,t,this.paper)),this},t.insertBefore=function(t){return this.removed||((t=t.constructor==_.st.constructor?t[0]:t).node.parentNode.insertBefore(this.node,t.node),_._insertbefore(this,t,this.paper)),this},t.blur=function(t){var e=this.node.runtimeStyle,i=(i=e.filter).replace(n,P);return 0!=+t?(this.attrs.blur=t,e.filter=i+A+" progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+t||1.5)+")",e.margin=_.format("-{0}px 0 0 -{0}px",E(+t||1.5))):(e.filter=i,e.margin=0,delete this.attrs.blur),this},_._engine.path=function(t,e){var i=F("shape");i.style.cssText=u,i.coordsize=M+A+M,i.coordorigin=e.coordorigin;var n=new h(i,e),r={fill:"none",stroke:"#000"};t&&(r.path=t),n.type="path",n.path=[],n.Path=P,p(n,r),e.canvas&&e.canvas.appendChild(i);e=F("skew");return e.on=!0,i.appendChild(e),n.skew=e,n.transform(P),n},_._engine.rect=function(t,e,i,n,r,a){var s=_._rectPath(e,i,n,r,a),o=t.path(s),t=o.attrs;return o.X=t.x=e,o.Y=t.y=i,o.W=t.width=n,o.H=t.height=r,t.r=a,t.path=s,o.type="rect",o},_._engine.ellipse=function(t,e,i,n,r){t=t.path();return t.attrs,t.X=e-n,t.Y=i-r,t.W=2*n,t.H=2*r,t.type="ellipse",p(t,{cx:e,cy:i,rx:n,ry:r}),t},_._engine.circle=function(t,e,i,n){t=t.path();return t.attrs,t.X=e-n,t.Y=i-n,t.W=t.H=2*n,t.type="circle",p(t,{cx:e,cy:i,r:n}),t},_._engine.image=function(t,e,i,n,r,a){var s=_._rectPath(i,n,r,a),o=t.path(s).attr({stroke:"none"}),l=o.attrs,u=o.node,t=u.getElementsByTagName("fill")[0];return l.src=e,o.X=l.x=i,o.Y=l.y=n,o.W=l.width=r,o.H=l.height=a,l.path=s,o.type="image",t.parentNode==u&&u.removeChild(t),t.rotate=!0,t.src=e,t.type="tile",o._.fillpos=[i,n],o._.fillsize=[r,a],u.appendChild(t),b(o,1,1,0,0,0),o},_._engine.text=function(t,e,i,n){var r=F("shape"),a=F("path"),s=F("textpath");i=i||0,n=n||"",a.v=_.format("m{0},{1}l{2},{1}",E((e=e||0)*M),E(i*M),E(e*M)+1),a.textpathok=!0,s.string=T(n),s.on=!0,r.style.cssText=u,r.coordsize=M+A+M,r.coordorigin="0 0";var o=new h(r,t),l={fill:"#000",stroke:"none",font:_._availableAttrs.font,text:n};o.shape=r,o.path=a,o.textpath=s,o.type="text",o.attrs.text=T(n),o.attrs.x=e,o.attrs.y=i,o.attrs.w=1,o.attrs.h=1,p(o,l),r.appendChild(s),r.appendChild(a),t.canvas.appendChild(r);t=F("skew");return t.on=!0,r.appendChild(t),o.skew=t,o.transform(P),o},_._engine.setSize=function(t,e){var i=this.canvas.style;return(this.width=t)==+t&&(t+="px"),(this.height=e)==+e&&(e+="px"),i.width=t,i.height=e,i.clip="rect(0 "+t+" "+e+" 0)",this._viewBox&&_._engine.setViewBox.apply(this,this._viewBox),this},_._engine.setViewBox=function(t,e,i,n,r){_.eve("raphael.setViewBox",this,this._viewBox,[t,e,i,n,r]);var a,s=this.getSize(),o=s.width,l=s.height;return r&&(i*(a=l/n)<o&&(t-=(o-i*a)/2/a),n*(o=o/i)<l&&(e-=(l-n*o)/2/o)),this._viewBox=[t,e,i,n,!!r],this._viewBoxShift={dx:-t,dy:-e,scale:s},this.forEach(function(t){t.transform("...")}),this},_._engine.initWin=function(t){var e=t.document;(e.styleSheets.length<31?e.createStyleSheet():e.styleSheets[0]).addRule(".rvml","behavior:url(#default#VML)");try{e.namespaces.rvml||e.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),F=function(t){return e.createElement("<rvml:"+t+' class="rvml">')}}catch(t){F=function(t){return e.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},_._engine.initWin(_._g.win),_._engine.create=function(){var t=_._getContainer.apply(0,arguments),e=t.container,i=t.height,n=t.width,r=t.x,a=t.y;if(!e)throw new Error("VML container not found.");var s=new _._Paper,o=s.canvas=_._g.doc.createElement("div"),t=o.style,r=r||0,a=a||0,n=n||512,i=i||342;return(s.width=n)==+n&&(n+="px"),(s.height=i)==+i&&(i+="px"),s.coordsize=216e5+A+216e5,s.coordorigin="0 0",s.span=_._g.doc.createElement("span"),s.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",o.appendChild(s.span),t.cssText=_.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",n,i),1==e?(_._g.doc.body.appendChild(o),t.left=r+"px",t.top=a+"px",t.position="absolute"):e.firstChild?e.insertBefore(o,e.firstChild):e.appendChild(o),s.renderfix=function(){},s},_.prototype.clear=function(){_.eve("raphael.clear",this),this.canvas.innerHTML=P,this.span=_._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},_.prototype.remove=function(){for(var t in _.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas),this)this[t]="function"==typeof this[t]?_._removedFactory(t):null;return!0};var e,i=_.st;for(e in t)t[w](e)&&!i[w](e)&&(i[e]=function(i){return function(){var e=arguments;return this.forEach(function(t){t[i].apply(t,e)})}}(e))}}.apply(e,i))||(t.exports=i)}],r.c=n,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1);function r(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}var i,n}),Raphael.el.popup=function(t,e,i,n){var r,a,s=this.paper||this[0].paper;if(s){switch(this.type){case"text":case"circle":case"ellipse":r=!0;break;default:r=!1}t=null==t?"up":t,e=e||5,l=this.getBBox(),i="number"==typeof i?i:r?l.x+l.width/2:l.x,n="number"==typeof n?n:r?l.y+l.height/2:l.y,a=Math.max(l.width/2-e,0),o=Math.max(l.height/2-e,0),this.translate(i-l.x-(r?l.width/2:0),n-l.y-(r?l.height/2:0));var o={up:["M",i,n,"l",-e,-e,-a,0,"a",e,e,0,0,1,-e,-e,"l",0,-(l=this.getBBox()).height,"a",e,e,0,0,1,e,-e,"l",2*e+2*a,0,"a",e,e,0,0,1,e,e,"l",0,l.height,"a",e,e,0,0,1,-e,e,"l",-a,0,"z"].join(","),down:["M",i,n,"l",e,e,a,0,"a",e,e,0,0,1,e,e,"l",0,l.height,"a",e,e,0,0,1,-e,e,"l",-(2*e+2*a),0,"a",e,e,0,0,1,-e,-e,"l",0,-l.height,"a",e,e,0,0,1,e,-e,"l",a,0,"z"].join(","),left:["M",i,n,"l",-e,e,0,o,"a",e,e,0,0,1,-e,e,"l",-l.width,0,"a",e,e,0,0,1,-e,-e,"l",0,-(2*e+2*o),"a",e,e,0,0,1,e,-e,"l",l.width,0,"a",e,e,0,0,1,e,e,"l",0,o,"z"].join(","),right:["M",i,n,"l",e,-e,0,-o,"a",e,e,0,0,1,e,-e,"l",l.width,0,"a",e,e,0,0,1,e,e,"l",0,2*e+2*o,"a",e,e,0,0,1,-e,e,"l",-l.width,0,"a",e,e,0,0,1,-e,-e,"l",0,-o,"z"].join(",")},l={up:{x:-!r*(l.width/2),y:2*-e-(r?l.height/2:l.height)},down:{x:-!r*(l.width/2),y:2*e+(r?l.height/2:l.height)},left:{x:2*-e-(r?l.width/2:l.width),y:-!r*(l.height/2)},right:{x:2*e+(r?l.width/2:l.width),y:-!r*(l.height/2)}}[t];return this.translate(l.x,l.y),s.path(o[t]).attr({fill:"#000",stroke:"none"}).insertBefore(this.node?this:this[0])}},Raphael.el.tag=function(t,e,i,n){var r=this.paper||this[0].paper;if(r){var a,s,o=r.path().attr({fill:"#000",stroke:"#000"}),l=this.getBBox();switch(this.type){case"text":case"circle":case"ellipse":s=!0;break;default:s=!1}return t=t||0,i="number"==typeof i?i:s?l.x+l.width/2:l.x,n="number"==typeof n?n:s?l.y+l.height/2:l.y,a=.5522*(e=null==e?5:e),l.height>=2*e?o.attr({path:["M",i,n+e,"a",e,e,0,1,1,0,2*-e,e,e,0,1,1,0,2*e,"m",0,2*-e-3,"a",e+3,e+3,0,1,0,0,2*(e+3),"L",i+e+3,n+l.height/2+3,"l",l.width+6,0,0,-l.height-6,-l.width-6,0,"L",i,n-e-3].join(",")}):(r=Math.sqrt(Math.pow(e+3,2)-Math.pow(l.height/2+3,2)),o.attr({path:["M",i,n+e,"c",-a,0,-e,a-e,-e,-e,0,-a,e-a,-e,e,-e,a,0,e,e-a,e,e,0,a,a-e,e,-e,e,"M",i+r,n-l.height/2-3,"a",e+3,e+3,0,1,0,0,l.height+6,"l",e+3-r+l.width+6,0,0,-l.height-6,"L",i+r,n-l.height/2-3].join(",")})),o.rotate(t=360-t,i,n),this.attrs?(this.attr(this.attrs.x?"x":"cx",i+e+3+(s?l.width/2:"text"==this.type?l.width:0)).attr("y",s?n:n-l.height/2),this.rotate(t,i,n),90<t&&t<270&&this.attr(this.attrs.x?"x":"cx",i-e-3-(s?l.width/2:l.width)).rotate(180,i,n)):90<t&&t<270?(this.translate(i-l.x-l.width-e-3,n-l.y-l.height/2),this.rotate(t-180,l.x+l.width+e+3,l.y+l.height/2)):(this.translate(i-l.x+e+3,n-l.y-l.height/2),this.rotate(t,l.x-e-3,l.y+l.height/2)),o.insertBefore(this.node?this:this[0])}},Raphael.el.drop=function(t,e,i){var n,r,a=this.getBBox(),s=this.paper||this[0].paper;if(s){switch(this.type){case"text":case"circle":case"ellipse":n=!0;break;default:n=!1}return t=t||0,e="number"==typeof e?e:n?a.x+a.width/2:a.x,i="number"==typeof i?i:n?a.y+a.height/2:a.y,r=Math.max(a.width,a.height)+Math.min(a.width,a.height),s=s.path(["M",e,i,"l",r,0,"A",.4*r,.4*r,0,1,0,e+.7*r,i-.7*r,"z"]).attr({fill:"#000",stroke:"none"}).rotate(22.5-t,e,i),t=(t+90)*Math.PI/180,e=e+r*Math.sin(t)-(n?0:a.width/2),t=i+r*Math.cos(t)-(n?0:a.height/2),this.attrs?this.attr(this.attrs.x?"x":"cx",e).attr(this.attrs.y?"y":"cy",t):this.translate(e-a.x,t-a.y),s.insertBefore(this.node?this:this[0])}},Raphael.el.flag=function(t,e,i){var n=this.paper||this[0].paper;if(n){var r,a=n.path().attr({fill:"#000",stroke:"#000"}),s=this.getBBox(),n=s.height/2;switch(this.type){case"text":case"circle":case"ellipse":r=!0;break;default:r=!1}return t=t||0,e="number"==typeof e?e:r?s.x+s.width/2:s.x,i="number"==typeof i?i:r?s.y+s.height/2:s.y,a.attr({path:["M",e,i,"l",3+n,-n-3,s.width+6,0,0,s.height+6,-s.width-6,0,"z"].join(",")}),a.rotate(t=360-t,e,i),this.attrs?(this.attr(this.attrs.x?"x":"cx",e+n+3+(r?s.width/2:"text"==this.type?s.width:0)).attr("y",r?i:i-s.height/2),this.rotate(t,e,i),90<t&&t<270&&this.attr(this.attrs.x?"x":"cx",e-n-3-(r?s.width/2:s.width)).rotate(180,e,i)):90<t&&t<270?(this.translate(e-s.x-s.width-n-3,i-s.y-s.height/2),this.rotate(t-180,s.x+s.width+n+3,s.y+s.height/2)):(this.translate(e-s.x+n+3,i-s.y-s.height/2),this.rotate(t,s.x-n-3,s.y+s.height/2)),a.insertBefore(this.node?this:this[0])}},Raphael.el.label=function(){var t=this.getBBox(),e=this.paper||this[0].paper,i=Math.min(20,t.width+10,t.height+10)/2;if(e)return e.rect(t.x-i/2,t.y-i/2,t.width+i,t.height+i,i).attr({stroke:"none",fill:"#000"}).insertBefore(this.node?this:this[0])},Raphael.el.blob=function(t,e,i){var n,r,a=this.getBBox(),s=Math.PI/180,o=this.paper||this[0].paper;if(o){switch(this.type){case"text":case"circle":case"ellipse":r=!0;break;default:r=!1}n=o.path().attr({fill:"#000",stroke:"none"}),t=(+t+1?t:45)+90,p=Math.min(a.height,a.width),e="number"==typeof e?e:r?a.x+a.width/2:a.x,i="number"==typeof i?i:r?a.y+a.height/2:a.y;var l=Math.max(a.width+p,25*p/12),u=Math.max(a.height+p,25*p/12),h=e+p*Math.sin((t-22.5)*s),c=i+p*Math.cos((t-22.5)*s),d=e+p*Math.sin((t+22.5)*s),o=i+p*Math.cos((t+22.5)*s),p=(d-h)/2,t=(o-c)/2,s=l/2,l=u/2,u=-Math.sqrt(Math.abs(s*s*l*l-s*s*t*t-l*l*p*p)/(s*s*t*t+l*l*p*p)),t=u*s*t/l+(d+h)/2,p=u*-l*p/s+(o+c)/2;return n.attr({x:t,y:p,path:["M",e,i,"L",d,o,"A",s,l,0,1,1,h,c,"z"].join(",")}),this.translate(t-a.x-a.width/2,p-a.y-a.height/2),n.insertBefore(this.node?this:this[0])}},Raphael.fn.label=function(t,e,i){var n=this.set();return i=this.text(t,e,i).attr(Raphael.g.txtattr),n.push(i.label(),i)},Raphael.fn.popup=function(t,e,i,n,r){var a=this.set();return i=this.text(t,e,i).attr(Raphael.g.txtattr),a.push(i.popup(n,r),i)},Raphael.fn.tag=function(t,e,i,n,r){var a=this.set();return i=this.text(t,e,i).attr(Raphael.g.txtattr),a.push(i.tag(n,r),i)},Raphael.fn.flag=function(t,e,i,n){var r=this.set();return i=this.text(t,e,i).attr(Raphael.g.txtattr),r.push(i.flag(n),i)},Raphael.fn.drop=function(t,e,i,n){var r=this.set();return i=this.text(t,e,i).attr(Raphael.g.txtattr),r.push(i.drop(n),i)},Raphael.fn.blob=function(t,e,i,n){var r=this.set();return i=this.text(t,e,i).attr(Raphael.g.txtattr),r.push(i.blob(n),i)},Raphael.el.lighter=function(t){t=t||2;var e=[this.attrs.fill,this.attrs.stroke];return this.fs=this.fs||[e[0],e[1]],e[0]=Raphael.rgb2hsb(Raphael.getRGB(e[0]).hex),e[1]=Raphael.rgb2hsb(Raphael.getRGB(e[1]).hex),e[0].b=Math.min(e[0].b*t,1),e[0].s=e[0].s/t,e[1].b=Math.min(e[1].b*t,1),e[1].s=e[1].s/t,this.attr({fill:"hsb("+[e[0].h,e[0].s,e[0].b]+")",stroke:"hsb("+[e[1].h,e[1].s,e[1].b]+")"}),this},Raphael.el.darker=function(t){t=t||2;var e=[this.attrs.fill,this.attrs.stroke];return this.fs=this.fs||[e[0],e[1]],e[0]=Raphael.rgb2hsb(Raphael.getRGB(e[0]).hex),e[1]=Raphael.rgb2hsb(Raphael.getRGB(e[1]).hex),e[0].s=Math.min(e[0].s*t,1),e[0].b=e[0].b/t,e[1].s=Math.min(e[1].s*t,1),e[1].b=e[1].b/t,this.attr({fill:"hsb("+[e[0].h,e[0].s,e[0].b]+")",stroke:"hsb("+[e[1].h,e[1].s,e[1].b]+")"}),this},Raphael.el.resetBrightness=function(){return this.fs&&(this.attr({fill:this.fs[0],stroke:this.fs[1]}),delete this.fs),this},function(){var t,e=["lighter","darker","resetBrightness"],i=["popup","tag","flag","label","drop","blob"];for(t in i)!function(t){Raphael.st[t]=function(){return Raphael.el[t].apply(this,arguments)}}(i[t]);for(t in e)!function(e){Raphael.st[e]=function(){for(var t=0;t<this.length;t++)this[t][e].apply(this[t],arguments);return this}}(e[t])}(),Raphael.g={shim:{stroke:"none",fill:"#000","fill-opacity":0},txtattr:{font:"12px Arial, sans-serif",fill:"#fff"},colors:function(){for(var t=[.6,.2,.05,.1333,.75,0],e=[],i=0;i<10;i++)i<t.length?e.push("hsb("+t[i]+",.75, .75)"):e.push("hsb("+t[i-t.length]+", 1, .5)");return e}(),snapEnds:function(t,e,i){var n=t,r=e;if(n==r)return{from:n,to:r,power:0};function a(t){return Math.abs(t-.5)<.25?.5+~~t:Math.round(t)}var s=(r-n)/i,o=~~s,l=o,u=0;if(o){for(;l;)u--,l=~~(s*Math.pow(10,u))/Math.pow(10,u);u++}else{if(0!=s&&isFinite(s))for(;!o;)u=u||1,o=~~(s*Math.pow(10,u))/Math.pow(10,u),u++;else u=1;u&&u--}return(r=a(e*Math.pow(10,u))/Math.pow(10,u))<e&&(r=a((e+.5)*Math.pow(10,u))/Math.pow(10,u)),{from:n=a((t-(0<u?0:.5))*Math.pow(10,u))/Math.pow(10,u),to:r,power:u}},axis:function(t,e,i,n,r,a,s,o,l,u,h){u=null==u?2:u,l=l||"t",a=a||10,h=arguments[arguments.length-1];var c="|"==l||" "==l?["M",t+.5,e,"l",0,.001]:1==s||3==s?["M",t+.5,e,"l",0,-i]:["M",t,e+.5,"l",i,0],d=this.snapEnds(n,r,a),p=d.from,f=d.to,d=d.power,m=0,g={font:"11px 'Fontin Sans', Fontin-Sans, sans-serif"},v=h.set(),y=(f-p)/a,_=p,b=0<d?d:0,w=i/a;if(1==+s||3==+s){for(var T=e,x=(s-1?1:-1)*(u+3+!!(s-1));e-i<=T;)"-"!=l&&" "!=l&&(c=c.concat(["M",t-("+"==l||"|"==l?u:!(s-1)*u*2),T+.5,"l",2*u+1,0])),v.push(h.text(t+x,T,o&&o[m++]||(Math.round(_)==_?_:+_.toFixed(b))).attr(g).attr({"text-anchor":s-1?"start":"end"})),_+=y,T-=w;Math.round(T+w-(e-i))&&("-"!=l&&" "!=l&&(c=c.concat(["M",t-("+"==l||"|"==l?u:!(s-1)*u*2),e-i+.5,"l",2*u+1,0])),v.push(h.text(t+x,e-i,o&&o[m]||(Math.round(_)==_?_:+_.toFixed(b))).attr(g).attr({"text-anchor":s-1?"start":"end"})))}else{for(var _=p,b=(0<d)*d,x=(s?-1:1)*(u+9+!s),S=t,w=i/a,E=0,k=0;S<=t+i;){"-"!=l&&" "!=l&&(c=c.concat(["M",S+.5,e-("+"==l?u:!!s*u*2),"l",0,2*u+1])),v.push(E=h.text(S,e+x,o&&o[m++]||(Math.round(_)==_?_:+_.toFixed(b))).attr(g));var C=E.getBBox();k>=C.x-5?v.pop(v.length-1).remove():k=C.x+C.width,_+=y,S+=w}Math.round(S-w-t-i)&&("-"!=l&&" "!=l&&(c=c.concat(["M",t+i+.5,e-("+"==l?u:!!s*u*2),"l",0,2*u+1])),v.push(h.text(t+i,e+x,o&&o[m]||(Math.round(_)==_?_:+_.toFixed(b))).attr(g)))}d=h.path(c);return d.text=v,d.all=h.set([d,v]),d.remove=function(){this.text.remove(),this.constructor.prototype.remove.call(this)},d},labelise:function(t,n,r){return t?(t+"").replace(/(##+(?:\.#+)?)|(%%+(?:\.%+)?)/g,function(t,e,i){return e?(+n).toFixed(e.replace(/^#+\.?/g,"").length):i?(100*n/r).toFixed(i.replace(/^%+\.?/g,"").length)+"%":void 0}):(+n).toFixed(0)}},function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).videojs=e()}(this,function(){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function i(t,e){return t(e={exports:{}},e.exports),e.exports}for(var n,d="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},r={},a=void 0!==t?t:"undefined"!=typeof window?window:{},c="undefined"!=typeof document?document:a["__GLOBAL_DOCUMENT_CACHE@4"]||(a["__GLOBAL_DOCUMENT_CACHE@4"]=r),l={prefixed:!0},s=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror","fullscreen"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"]],o=s[0],u=0;u<s.length;u++)if(s[u][1]in c){n=s[u];break}if(n){for(var h=0;h<n.length;h++)l[o[h]]=n[h];l.prefixed=n[0]!==o[0]}function p(t){return w(t)?Object.keys(t):[]}var f=[],m=function e(i){function n(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];r("log",o,e)}var r,a,s,o="info";return a=i,r=function(t,e,i){var n,r=s.levels[e],e=new RegExp("^("+r+")$");"log"!==t&&i.unshift(t.toUpperCase()+":"),i.unshift(a+":"),f&&(f.push([].concat(i)),n=f.length-1e3,f.splice(0,0<n?n:0)),!d.console||(n=!(n=d.console[t])&&"debug"===t?d.console.info||d.console.log:n)&&r&&e.test(t)&&n[Array.isArray(i)?"apply":"call"](d.console,i)},(s=n).createLogger=function(t){return e(i+": "+t)},n.levels={all:"debug|log|warn|error",off:"",debug:"debug|log|warn|error",info:"log|warn|error",warn:"warn|error",error:"error",DEFAULT:o},n.level=function(t){if("string"==typeof t){if(!n.levels.hasOwnProperty(t))throw new Error('"'+t+'" in not a valid log level');o=t}return o},(n.history=function(){return f?[].concat(f):[]}).filter=function(e){return(f||[]).filter(function(t){return new RegExp(".*"+e+".*").test(t[0])})},n.history.clear=function(){f&&(f.length=0)},n.history.disable=function(){null!==f&&(f.length=0,f=null)},n.history.enable=function(){null===f&&(f=[])},n.error=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return r("error",o,e)},n.warn=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return r("warn",o,e)},n.debug=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return r("debug",o,e)},n}("VIDEOJS"),g=m.createLogger,v=i(function(t){function e(){return t.exports=e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i,n=arguments[e];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},e.apply(this,arguments)}t.exports=e}),y=Object.prototype.toString;function _(e,i){p(e).forEach(function(t){return i(e[t],t)})}function b(i){for(var t=arguments.length,e=new Array(1<t?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return Object.assign?v.apply(void 0,[i].concat(e)):(e.forEach(function(t){t&&_(t,function(t,e){i[e]=t})}),i)}function w(t){return!!t&&"object"==typeof t}function T(t){return w(t)&&"[object Object]"===y.call(t)&&t.constructor===Object}function x(t,e){if(!t||!e)return"";if("function"!=typeof d.getComputedStyle)return"";t=d.getComputedStyle(t);return t?t.getPropertyValue(e)||t[e]:""}var S=d.navigator&&d.navigator.userAgent||"",E=/AppleWebKit\/([\d.]+)/i.exec(S),k=E?parseFloat(E.pop()):null,C=/iPod/i.test(S),I=(he=S.match(/OS (\d+)_/i))&&he[1]?he[1]:null,A=/Android/i.test(S),P=function(){var t=S.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!t)return null;var e=t[1]&&parseFloat(t[1]),i=t[2]&&parseFloat(t[2]);return e&&i?parseFloat(t[1]+"."+t[2]):e||null}(),D=A&&P<5&&k<537,O=/Firefox/i.test(S),L=/Edg/i.test(S),M=!L&&(/Chrome/i.test(S)||/CriOS/i.test(S)),R=(Ue=S.match(/(Chrome|CriOS)\/(\d+)/))&&Ue[2]?parseFloat(Ue[2]):null,N=qe=!(qe=(je=/MSIE\s(\d+)\.\d/.exec(S))&&parseFloat(je[1]))&&/Trident\/7.0/i.test(S)&&/rv:11.0/.test(S)?11:qe,B=/Safari/i.test(S)&&!M&&!A&&!L,F=/Windows/i.test(S),U=Boolean(X()&&("ontouchstart"in d||d.navigator.maxTouchPoints||d.DocumentTouch&&d.document instanceof d.DocumentTouch)),j=/iPad/i.test(S)||B&&U&&!/iPhone/i.test(S),q=/iPhone/i.test(S)&&!j,z=q||j||C,H=(B||z)&&!M,V=Object.freeze({__proto__:null,IS_IPOD:C,IOS_VERSION:I,IS_ANDROID:A,ANDROID_VERSION:P,IS_NATIVE_ANDROID:D,IS_FIREFOX:O,IS_EDGE:L,IS_CHROME:M,CHROME_VERSION:R,IE_VERSION:N,IS_SAFARI:B,IS_WINDOWS:F,TOUCH_ENABLED:U,IS_IPAD:j,IS_IPHONE:q,IS_IOS:z,IS_ANY_SAFARI:H});function W(t){return"string"==typeof t&&Boolean(t.trim())}function G(t){if(0<=t.indexOf(" "))throw new Error("class has illegal whitespace characters")}function X(){return c===d.document}function $(t){return w(t)&&1===t.nodeType}function Y(){try{return d.parent!==d.self}catch(t){return!0}}function K(i){return function(t,e){if(!W(t))return c[i](null);e=$(e=W(e)?c.querySelector(e):e)?e:c;return e[i]&&e[i](t)}}function Q(t,i,e,n){void 0===i&&(i={}),void 0===e&&(e={});var r=c.createElement(t=void 0===t?"div":t);return Object.getOwnPropertyNames(i).forEach(function(t){var e=i[t];-1!==t.indexOf("aria-")||"role"===t||"type"===t?(m.warn("Setting attributes in the second argument of createEl()\nhas been deprecated. Use the third argument instead.\ncreateEl(type, properties, attributes). Attempting to set "+t+" to "+e+"."),r.setAttribute(t,e)):"textContent"===t?J(r,e):r[t]===e&&"tabIndex"!==t||(r[t]=e)}),Object.getOwnPropertyNames(e).forEach(function(t){r.setAttribute(t,e[t])}),n&&vt(r,n),r}function J(t,e){return void 0===t.textContent?t.innerText=e:t.textContent=e,t}function Z(t,e){e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)}function tt(t,e){return G(e),t.classList?t.classList.contains(e):new RegExp("(^|\\s)"+e+"($|\\s)").test(t.className)}function et(t,e){return t.classList?t.classList.add(e):tt(t,e)||(t.className=(t.className+" "+e).trim()),t}function it(t,e){return t.classList?t.classList.remove(e):(G(e),t.className=t.className.split(/\s+/).filter(function(t){return t!==e}).join(" ")),t}function nt(t,e,i){var n=tt(t,e);if((i="boolean"!=typeof(i="function"==typeof i?i(t,e):i)?!n:i)!==n)return(i?et:it)(t,e),t}function rt(i,n){Object.getOwnPropertyNames(n).forEach(function(t){var e=n[t];null==e||!1===e?i.removeAttribute(t):i.setAttribute(t,!0===e?"":e)})}function at(t){var e={};if(t&&t.attributes&&0<t.attributes.length)for(var i=t.attributes,n=i.length-1;0<=n;n--){var r=i[n].name,a=i[n].value;"boolean"!=typeof t[r]&&-1===",autoplay,controls,playsinline,loop,muted,default,defaultMuted,".indexOf(","+r+",")||(a=null!==a),e[r]=a}return e}function st(t,e){return t.getAttribute(e)}function ot(t,e,i){t.setAttribute(e,i)}function lt(t,e){t.removeAttribute(e)}function ut(){c.body.focus(),c.onselectstart=function(){return!1}}function ht(){c.onselectstart=function(){return!0}}function ct(t){if(t&&t.getBoundingClientRect&&t.parentNode){var e=t.getBoundingClientRect(),i={};return["bottom","height","left","right","top","width"].forEach(function(t){void 0!==e[t]&&(i[t]=e[t])}),i.height||(i.height=parseFloat(x(t,"height"))),i.width||(i.width=parseFloat(x(t,"width"))),i}}function dt(t){if(!t||!t.offsetParent)return{left:0,top:0,width:0,height:0};for(var e=t.offsetWidth,i=t.offsetHeight,n=0,r=0;t.offsetParent&&t!==c[l.fullscreenElement];)n+=t.offsetLeft,r+=t.offsetTop,t=t.offsetParent;return{left:n,top:r,width:e,height:i}}function pt(t,e){var i={x:0,y:0};if(z)for(var n=t;n&&"html"!==n.nodeName.toLowerCase();){var r,a=x(n,"transform");/^matrix/.test(a)?(r=a.slice(7,-1).split(/,\s/).map(Number),i.x+=r[4],i.y+=r[5]):/^matrix3d/.test(a)&&(a=a.slice(9,-1).split(/,\s/).map(Number),i.x+=a[12],i.y+=a[13]),n=n.parentNode}var s={},o=dt(e.target),l=dt(t),u=l.width,h=l.height,t=e.offsetY-(l.top-o.top),o=e.offsetX-(l.left-o.left);return e.changedTouches&&(o=e.changedTouches[0].pageX-l.left,t=e.changedTouches[0].pageY+l.top,z&&(o-=i.x,t-=i.y)),s.y=1-Math.max(0,Math.min(1,t/h)),s.x=Math.max(0,Math.min(1,o/u)),s}function ft(t){return w(t)&&3===t.nodeType}function mt(t){for(;t.firstChild;)t.removeChild(t.firstChild);return t}function gt(t){return"function"==typeof t&&(t=t()),(Array.isArray(t)?t:[t]).map(function(t){return $(t="function"==typeof t?t():t)||ft(t)?t:"string"==typeof t&&/\S/.test(t)?c.createTextNode(t):void 0}).filter(function(t){return t})}function vt(e,t){return gt(t).forEach(function(t){return e.appendChild(t)}),e}function yt(t,e){return vt(mt(t),e)}function _t(t){return void 0===t.button&&void 0===t.buttons||0===t.button&&void 0===t.buttons||"mouseup"===t.type&&0===t.button&&0===t.buttons||0===t.button&&1===t.buttons}function bt(){if(X()&&!1!==wt.options.autoSetup){var t=Array.prototype.slice.call(c.getElementsByTagName("video")),e=Array.prototype.slice.call(c.getElementsByTagName("audio")),i=Array.prototype.slice.call(c.getElementsByTagName("video-js")),n=t.concat(e,i);if(n&&0<n.length)for(var r=0,a=n.length;r<a;r++){var s=n[r];if(!s||!s.getAttribute){kt(1);break}void 0===s.player&&null!==s.getAttribute("data-setup")&&wt(s)}else Et||kt(1)}}var wt,Tt=K("querySelector"),xt=K("querySelectorAll"),St=Object.freeze({__proto__:null,isReal:X,isEl:$,isInFrame:Y,createEl:Q,textContent:J,prependTo:Z,hasClass:tt,addClass:et,removeClass:it,toggleClass:nt,setAttributes:rt,getAttributes:at,getAttribute:st,setAttribute:ot,removeAttribute:lt,blockTextSelection:ut,unblockTextSelection:ht,getBoundingClientRect:ct,findPosition:dt,getPointerPosition:pt,isTextNode:ft,emptyEl:mt,normalizeContent:gt,appendContent:vt,insertContent:yt,isSingleLeftClick:_t,$:Tt,$$:xt}),Et=!1;function kt(t,e){e&&(wt=e),d.setTimeout(bt,t)}function Ct(){Et=!0,d.removeEventListener("load",Ct)}function It(t){var e=c.createElement("style");return e.className=t,e}function At(t,e){t.styleSheet?t.styleSheet.cssText=e:t.textContent=e}X()&&("complete"===c.readyState?Ct():d.addEventListener("load",Ct));var Pt=3;function Dt(){this.vdata="vdata"+Math.floor(d.performance&&d.performance.now()||Date.now()),this.data={}}d.WeakMap||((Xe=Dt.prototype).set=function(t,e){var i=t[this.vdata]||Pt++;return t[this.vdata]||(t[this.vdata]=i),this.data[i]=e,this},Xe.get=function(t){var e=t[this.vdata];if(e)return this.data[e];m("We have no data for this element",t)},Xe.has=function(t){return t[this.vdata]in this.data},Xe.delete=function(t){var e=t[this.vdata];e&&(delete this.data[e],delete t[this.vdata])},$e=Dt);var Ot,Lt=new(d.WeakMap?WeakMap:$e);function Mt(t,e){var i;Lt.has(t)&&(0===(i=Lt.get(t)).handlers[e].length&&(delete i.handlers[e],t.removeEventListener?t.removeEventListener(e,i.dispatcher,!1):t.detachEvent&&t.detachEvent("on"+e,i.dispatcher)),Object.getOwnPropertyNames(i.handlers).length<=0&&(delete i.handlers,delete i.dispatcher,delete i.disabled),0===Object.getOwnPropertyNames(i).length&&Lt.delete(t))}function Rt(e,i,t,n){t.forEach(function(t){e(i,t,n)})}function Nt(t){if(t.fixed_)return t;function e(){return!0}function i(){return!1}if(!t||!t.isPropagationStopped){var n,r,a,s=t||d.event;for(n in t={},s)"layerX"!==n&&"layerY"!==n&&"keyLocation"!==n&&"webkitMovementX"!==n&&"webkitMovementY"!==n&&("returnValue"===n&&s.preventDefault||(t[n]=s[n]));t.target||(t.target=t.srcElement||c),t.relatedTarget||(t.relatedTarget=t.fromElement===t.target?t.toElement:t.fromElement),t.preventDefault=function(){s.preventDefault&&s.preventDefault(),t.returnValue=!1,s.returnValue=!1,t.defaultPrevented=!0},t.defaultPrevented=!1,t.stopPropagation=function(){s.stopPropagation&&s.stopPropagation(),t.cancelBubble=!0,s.cancelBubble=!0,t.isPropagationStopped=e},t.isPropagationStopped=i,t.stopImmediatePropagation=function(){s.stopImmediatePropagation&&s.stopImmediatePropagation(),t.isImmediatePropagationStopped=e,t.stopPropagation()},t.isImmediatePropagationStopped=i,null!==t.clientX&&void 0!==t.clientX&&(r=c.documentElement,a=c.body,t.pageX=t.clientX+(r&&r.scrollLeft||a&&a.scrollLeft||0)-(r&&r.clientLeft||a&&a.clientLeft||0),t.pageY=t.clientY+(r&&r.scrollTop||a&&a.scrollTop||0)-(r&&r.clientTop||a&&a.clientTop||0)),t.which=t.charCode||t.keyCode,null!==t.button&&void 0!==t.button&&(t.button=1&t.button?0:4&t.button?1:2&t.button?2:0)}return t.fixed_=!0,t}var Bt=["touchstart","touchmove"];function Ft(s,t,e){if(Array.isArray(t))return Rt(Ft,s,t,e);Lt.has(s)||Lt.set(s,{});var o=Lt.get(s);o.handlers||(o.handlers={}),o.handlers[t]||(o.handlers[t]=[]),e.guid||(e.guid=Pt++),o.handlers[t].push(e),o.dispatcher||(o.disabled=!1,o.dispatcher=function(t,e){if(!o.disabled){t=Nt(t);var i=o.handlers[t.type];if(i)for(var n=i.slice(0),r=0,a=n.length;r<a&&!t.isImmediatePropagationStopped();r++)try{n[r].call(s,t,e)}catch(t){m.error(t)}}}),1===o.handlers[t].length&&(s.addEventListener?(e=!1,function(){if("boolean"!=typeof Ot){Ot=!1;try{var t=Object.defineProperty({},"passive",{get:function(){Ot=!0}});d.addEventListener("test",null,t),d.removeEventListener("test",null,t)}catch(t){}}return Ot}()&&-1<Bt.indexOf(t)&&(e={passive:!0}),s.addEventListener(t,o.dispatcher,e)):s.attachEvent&&s.attachEvent("on"+t,o.dispatcher))}function Ut(t,e,i){if(Lt.has(t)){var n=Lt.get(t);if(n.handlers){if(Array.isArray(e))return Rt(Ut,t,e,i);var r=function(t,e){n.handlers[e]=[],Mt(t,e)};if(void 0!==e){var a=n.handlers[e];if(a)if(i){if(i.guid)for(var s=0;s<a.length;s++)a[s].guid===i.guid&&a.splice(s--,1);Mt(t,e)}else r(t,e)}else for(var o in n.handlers)Object.prototype.hasOwnProperty.call(n.handlers||{},o)&&r(t,o)}}}function jt(t,e,i){var n=Lt.has(t)?Lt.get(t):{},r=t.parentNode||t.ownerDocument;return"string"==typeof e?e={type:e,target:t}:e.target||(e.target=t),e=Nt(e),n.dispatcher&&n.dispatcher.call(t,e,i),r&&!e.isPropagationStopped()&&!0===e.bubbles?jt.call(null,r,e,i):!r&&!e.defaultPrevented&&e.target&&e.target[e.type]&&(Lt.has(e.target)||Lt.set(e.target,{}),r=Lt.get(e.target),e.target[e.type]&&(r.disabled=!0,"function"==typeof e.target[e.type]&&e.target[e.type](),r.disabled=!1)),!e.defaultPrevented}function qt(t,e,i){if(Array.isArray(e))return Rt(qt,t,e,i);function n(){Ut(t,e,n),i.apply(this,arguments)}n.guid=i.guid=i.guid||Pt++,Ft(t,e,n)}function zt(t,e,i){function n(){Ut(t,e,n),i.apply(this,arguments)}n.guid=i.guid=i.guid||Pt++,Ft(t,e,n)}function Ht(t,e,i){e.guid||(e.guid=Pt++);t=e.bind(t);return t.guid=i?i+"_"+e.guid:e.guid,t}function Vt(e,i){var n=d.performance.now();return function(){var t=d.performance.now();i<=t-n&&(e.apply(void 0,arguments),n=t)}}function Wt(){}var Gt,Xt=Object.freeze({__proto__:null,fixEvent:Nt,on:Ft,off:Ut,trigger:jt,one:qt,any:zt});function $t(t){return"function"==typeof t.name?t.name():"string"==typeof t.name?t.name:t.name_||(t.constructor&&t.constructor.name?t.constructor.name:typeof t)}function Yt(t){return"string"==typeof t&&/\S/.test(t)||Array.isArray(t)&&t.length}function Kt(t,e,i){if(!t||!t.nodeName&&!ee(t))throw new Error("Invalid target for "+$t(e)+"#"+i+"; must be a DOM node or evented object.")}function Qt(t,e,i){if(!Yt(t))throw new Error("Invalid event type for "+$t(e)+"#"+i+"; must be a non-empty string or array.")}function Jt(t,e,i){if("function"!=typeof t)throw new Error("Invalid listener for "+$t(e)+"#"+i+"; must be a function.")}function Zt(t,e,i){var n,r,a=e.length<3||e[0]===t||e[0]===t.eventBusEl_,e=a?(n=t.eventBusEl_,3<=e.length&&e.shift(),r=e[0],e[1]):(n=e[0],r=e[1],e[2]);return Kt(n,t,i),Qt(r,t,i),Jt(e,t,i),{isTargetingSelf:a,target:n,type:r,listener:Ht(t,e)}}function te(t,e,i,n){Kt(t,t,e),t.nodeName?Xt[e](t,i,n):t[e](i,n)}Wt.prototype.allowedEvents_={},Wt.prototype.addEventListener=Wt.prototype.on=function(t,e){var i=this.addEventListener;this.addEventListener=function(){},Ft(this,t,e),this.addEventListener=i},Wt.prototype.removeEventListener=Wt.prototype.off=function(t,e){Ut(this,t,e)},Wt.prototype.one=function(t,e){var i=this.addEventListener;this.addEventListener=function(){},qt(this,t,e),this.addEventListener=i},Wt.prototype.any=function(t,e){var i=this.addEventListener;this.addEventListener=function(){},zt(this,t,e),this.addEventListener=i},Wt.prototype.dispatchEvent=Wt.prototype.trigger=function(t){var e=t.type||t;t=Nt(t="string"==typeof t?{type:e}:t),this.allowedEvents_[e]&&this["on"+e]&&this["on"+e](t),jt(this,t)},Wt.prototype.queueTrigger=function(t){var e=this;Gt=Gt||new Map;var i=t.type||t,n=Gt.get(this);n||(n=new Map,Gt.set(this,n));var r=n.get(i);n.delete(i),d.clearTimeout(r);r=d.setTimeout(function(){0===n.size&&(n=null,Gt.delete(e)),e.trigger(t)},0);n.set(i,r)};var ee=function(e){return e instanceof Wt||!!e.eventBusEl_&&["on","one","off","trigger"].every(function(t){return"function"==typeof e[t]})},ie={on:function(){for(var t=this,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];var r,a=Zt(this,i,"on"),s=a.isTargetingSelf,o=a.target,l=a.type,u=a.listener;te(o,"on",l,u),s||((r=function(){return t.off(o,l,u)}).guid=u.guid,(s=function(){return t.off("dispose",r)}).guid=u.guid,te(this,"on","dispose",r),te(o,"on","dispose",s))},one:function(){for(var r=this,t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=Zt(this,e,"one"),a=n.isTargetingSelf,s=n.target,o=n.type,l=n.listener;a?te(s,"one",o,l):((a=function t(){r.off(s,o,t);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];l.apply(null,i)}).guid=l.guid,te(s,"one",o,a))},any:function(){for(var r=this,t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=Zt(this,e,"any"),a=n.isTargetingSelf,s=n.target,o=n.type,l=n.listener;a?te(s,"any",o,l):((a=function t(){r.off(s,o,t);for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];l.apply(null,i)}).guid=l.guid,te(s,"any",o,a))},off:function(t,e,i){!t||Yt(t)?Ut(this.eventBusEl_,t,e):(e=e,Kt(t=t,this,"off"),Qt(e,this,"off"),Jt(i,this,"off"),i=Ht(this,i),this.off("dispose",i),t.nodeName?(Ut(t,e,i),Ut(t,"dispose",i)):ee(t)&&(t.off(e,i),t.off("dispose",i)))},trigger:function(t,e){if(Kt(this.eventBusEl_,this,"trigger"),!Yt(t&&"string"!=typeof t?t.type:t)){var i="Invalid event type for "+$t(this)+"#trigger; must be a non-empty string or object with a type key that has a non-empty value.";if(!t)throw new Error(i);(this.log||m).error(i)}return jt(this.eventBusEl_,t,e)}};function ne(t,e){e=(e=void 0===e?{}:e).eventBusKey;if(e){if(!t[e].nodeName)throw new Error('The eventBusKey "'+e+'" does not refer to an element.');t.eventBusEl_=t[e]}else t.eventBusEl_=Q("span",{className:"vjs-event-bus"});return b(t,ie),t.eventedCallbacks&&t.eventedCallbacks.forEach(function(t){t()}),t.on("dispose",function(){t.off(),d.setTimeout(function(){t.eventBusEl_=null},0)}),t}var re={state:{},setState:function(t){var i,n=this;return _(t="function"==typeof t?t():t,function(t,e){n.state[e]!==t&&((i=i||{})[e]={from:n.state[e],to:t}),n.state[e]=t}),i&&ee(this)&&this.trigger({changes:i,type:"statechanged"}),i}};function ae(t,e){return b(t,re),t.state=b({},t.state,e),"function"==typeof t.handleStateChanged&&ee(t)&&t.on("statechanged",t.handleStateChanged),t}function se(t){return"string"!=typeof t?t:t.replace(/./,function(t){return t.toLowerCase()})}function oe(t){return"string"!=typeof t?t:t.replace(/./,function(t){return t.toUpperCase()})}function le(){for(var i={},t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.forEach(function(t){t&&_(t,function(t,e){T(t)?(T(i[e])||(i[e]={}),i[e]=le(i[e],t)):i[e]=t})}),i}var a=((ii=me.prototype).has=function(t){return t in this.map_},ii.delete=function(t){var e=this.has(t);return delete this.map_[t],e},ii.set=function(t,e){return this.map_[t]=e,this},ii.forEach=function(t,e){for(var i in this.map_)t.call(e,this.map_[i],i,this)},me),ue=d.Map||a,he=((E=fe.prototype).has=function(t){return t in this.set_},E.delete=function(t){var e=this.has(t);return delete this.set_[t],e},E.add=function(t){return this.set_[t]=1,this},E.forEach=function(t,e){for(var i in this.set_)t.call(e,i,i,this)},fe),ce=d.Set||he,de=((k=pe.prototype).dispose=function(){if(!this.isDisposed_){if(this.readyQueue_&&(this.readyQueue_.length=0),this.trigger({type:"dispose",bubbles:!1}),this.isDisposed_=!0,this.children_)for(var t=this.children_.length-1;0<=t;t--)this.children_[t].dispose&&this.children_[t].dispose();this.children_=null,this.childIndex_=null,this.childNameIndex_=null,this.parentComponent_=null,this.el_&&(this.el_.parentNode&&this.el_.parentNode.removeChild(this.el_),Lt.has(this.el_)&&Lt.delete(this.el_),this.el_=null),this.player_=null}},k.isDisposed=function(){return Boolean(this.isDisposed_)},k.player=function(){return this.player_},k.options=function(t){return t&&(this.options_=le(this.options_,t)),this.options_},k.el=function(){return this.el_},k.createEl=function(t,e,i){return Q(t,e,i)},k.localize=function(t,i,e){void 0===e&&(e=t);var n=this.player_.language&&this.player_.language(),r=this.player_.languages&&this.player_.languages(),a=r&&r[n],n=n&&n.split("-")[0],n=r&&r[n],e=e;return a&&a[t]?e=a[t]:n&&n[t]&&(e=n[t]),e=i?e.replace(/\{(\d+)\}/g,function(t,e){e=i[e-1];return void 0===e?t:e}):e},k.handleLanguagechange=function(){},k.contentEl=function(){return this.contentEl_||this.el_},k.id=function(){return this.id_},k.name=function(){return this.name_},k.children=function(){return this.children_},k.getChildById=function(t){return this.childIndex_[t]},k.getChild=function(t){if(t)return this.childNameIndex_[t]},k.getDescendant=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];for(var e=e.reduce(function(t,e){return t.concat(e)},[]),n=this,r=0;r<e.length;r++)if(!(n=n.getChild(e[r]))||!n.getChild)return;return n},k.addChild=function(t,e,i){if(void 0===e&&(e={}),void 0===i&&(i=this.children_.length),"string"==typeof t){var n=oe(t),r=e.componentClass||n;e.name=n;var a=pe.getComponent(r);if(!a)throw new Error("Component "+r+" does not exist");if("function"!=typeof a)return null;a=new a(this.player_||this,e)}else a=t;return a.parentComponent_&&a.parentComponent_.removeChild(a),this.children_.splice(i,0,a),a.parentComponent_=this,"function"==typeof a.id&&(this.childIndex_[a.id()]=a),(n=n||a.name&&oe(a.name()))&&(this.childNameIndex_[n]=a,this.childNameIndex_[se(n)]=a),"function"==typeof a.el&&a.el()&&(n=null,this.children_[i+1]&&(this.children_[i+1].el_?n=this.children_[i+1].el_:$(this.children_[i+1])&&(n=this.children_[i+1])),this.contentEl().insertBefore(a.el(),n)),a},k.removeChild=function(t){if((t="string"==typeof t?this.getChild(t):t)&&this.children_){for(var e,i=!1,n=this.children_.length-1;0<=n;n--)if(this.children_[n]===t){i=!0,this.children_.splice(n,1);break}i&&(t.parentComponent_=null,this.childIndex_[t.id()]=null,this.childNameIndex_[oe(t.name())]=null,this.childNameIndex_[se(t.name())]=null,(e=t.el())&&e.parentNode===this.contentEl()&&this.contentEl().removeChild(t.el()))}},k.initChildren=function(){var t,i,e,n=this,r=this.options_.children;r&&(i=this.options_,e=pe.getComponent("Tech"),(t=Array.isArray(r)?r:Object.keys(r)).concat(Object.keys(this.options_).filter(function(e){return!t.some(function(t){return"string"==typeof t?e===t:e===t.name})})).map(function(t){var e,t="string"==typeof t?r[e=t]||n.options_[e]||{}:(e=t.name,t);return{name:e,opts:t}}).filter(function(t){t=pe.getComponent(t.opts.componentClass||oe(t.name));return t&&!e.isTech(t)}).forEach(function(t){var e=t.name,t=t.opts;!1!==(t=void 0!==i[e]?i[e]:t)&&((t=!0===t?{}:t).playerOptions=n.options_.playerOptions,(t=n.addChild(e,t))&&(n[e]=t))}))},k.buildCSSClass=function(){return""},k.ready=function(t,e){if(void 0===e&&(e=!1),t)return this.isReady_?void(e?t.call(this):this.setTimeout(t,1)):(this.readyQueue_=this.readyQueue_||[],void this.readyQueue_.push(t))},k.triggerReady=function(){this.isReady_=!0,this.setTimeout(function(){var t=this.readyQueue_;this.readyQueue_=[],t&&0<t.length&&t.forEach(function(t){t.call(this)},this),this.trigger("ready")},1)},k.$=function(t,e){return Tt(t,e||this.contentEl())},k.$$=function(t,e){return xt(t,e||this.contentEl())},k.hasClass=function(t){return tt(this.el_,t)},k.addClass=function(t){et(this.el_,t)},k.removeClass=function(t){it(this.el_,t)},k.toggleClass=function(t,e){nt(this.el_,t,e)},k.show=function(){this.removeClass("vjs-hidden")},k.hide=function(){this.addClass("vjs-hidden")},k.lockShowing=function(){this.addClass("vjs-lock-showing")},k.unlockShowing=function(){this.removeClass("vjs-lock-showing")},k.getAttribute=function(t){return st(this.el_,t)},k.setAttribute=function(t,e){ot(this.el_,t,e)},k.removeAttribute=function(t){lt(this.el_,t)},k.width=function(t,e){return this.dimension("width",t,e)},k.height=function(t,e){return this.dimension("height",t,e)},k.dimensions=function(t,e){this.width(t,!0),this.height(e)},k.dimension=function(t,e,i){if(void 0!==e)return-1!==(""+(e=null===e||e!=e?0:e)).indexOf("%")||-1!==(""+e).indexOf("px")?this.el_.style[t]=e:this.el_.style[t]="auto"===e?"":e+"px",void(i||this.trigger("componentresize"));if(!this.el_)return 0;e=this.el_.style[t],i=e.indexOf("px");return-1!==i?parseInt(e.slice(0,i),10):parseInt(this.el_["offset"+oe(t)],10)},k.currentDimension=function(t){var e=0;if("width"!==t&&"height"!==t)throw new Error("currentDimension only accepts width or height value");return e=x(this.el_,t),0!==(e=parseFloat(e))&&!isNaN(e)||(t="offset"+oe(t),e=this.el_[t]),e},k.currentDimensions=function(){return{width:this.currentDimension("width"),height:this.currentDimension("height")}},k.currentWidth=function(){return this.currentDimension("width")},k.currentHeight=function(){return this.currentDimension("height")},k.focus=function(){this.el_.focus()},k.blur=function(){this.el_.blur()},k.handleKeyDown=function(t){this.player_&&(t.stopPropagation(),this.player_.handleKeyDown(t))},k.handleKeyPress=function(t){this.handleKeyDown(t)},k.emitTapEvents=function(){var i,e=0,n=null;function t(){i=!1}this.on("touchstart",function(t){1===t.touches.length&&(n={pageX:t.touches[0].pageX,pageY:t.touches[0].pageY},e=d.performance.now(),i=!0)}),this.on("touchmove",function(t){var e;1<t.touches.length?i=!1:n&&(e=t.touches[0].pageX-n.pageX,t=t.touches[0].pageY-n.pageY,10<Math.sqrt(e*e+t*t)&&(i=!1))}),this.on("touchleave",t),this.on("touchcancel",t),this.on("touchend",function(t){!(n=null)===i&&d.performance.now()-e<200&&(t.preventDefault(),this.trigger("tap"))})},k.enableTouchActivity=function(){var e,i,t;this.player()&&this.player().reportUserActivity&&(i=Ht(this.player(),this.player().reportUserActivity),this.on("touchstart",function(){i(),this.clearInterval(e),e=this.setInterval(i,250)}),t=function(t){i(),this.clearInterval(e)},this.on("touchmove",i),this.on("touchend",t),this.on("touchcancel",t))},k.setTimeout=function(t,e){var i,n=this;return t=Ht(this,t),this.clearTimersOnDispose_(),i=d.setTimeout(function(){n.setTimeoutIds_.has(i)&&n.setTimeoutIds_.delete(i),t()},e),this.setTimeoutIds_.add(i),i},k.clearTimeout=function(t){return this.setTimeoutIds_.has(t)&&(this.setTimeoutIds_.delete(t),d.clearTimeout(t)),t},k.setInterval=function(t,e){t=Ht(this,t),this.clearTimersOnDispose_();e=d.setInterval(t,e);return this.setIntervalIds_.add(e),e},k.clearInterval=function(t){return this.setIntervalIds_.has(t)&&(this.setIntervalIds_.delete(t),d.clearInterval(t)),t},k.requestAnimationFrame=function(t){var e,i=this;return this.supportsRaf_?(this.clearTimersOnDispose_(),t=Ht(this,t),e=d.requestAnimationFrame(function(){i.rafIds_.has(e)&&i.rafIds_.delete(e),t()}),this.rafIds_.add(e),e):this.setTimeout(t,1e3/60)},k.requestNamedAnimationFrame=function(t,e){var i=this;if(!this.namedRafs_.has(t)){this.clearTimersOnDispose_(),e=Ht(this,e);var n=this.requestAnimationFrame(function(){e(),i.namedRafs_.has(t)&&i.namedRafs_.delete(t)});return this.namedRafs_.set(t,n),t}},k.cancelNamedAnimationFrame=function(t){this.namedRafs_.has(t)&&(this.cancelAnimationFrame(this.namedRafs_.get(t)),this.namedRafs_.delete(t))},k.cancelAnimationFrame=function(t){return this.supportsRaf_?(this.rafIds_.has(t)&&(this.rafIds_.delete(t),d.cancelAnimationFrame(t)),t):this.clearTimeout(t)},k.clearTimersOnDispose_=function(){var n=this;this.clearingTimersOnDispose_||(this.clearingTimersOnDispose_=!0,this.one("dispose",function(){[["namedRafs_","cancelNamedAnimationFrame"],["rafIds_","cancelAnimationFrame"],["setTimeoutIds_","clearTimeout"],["setIntervalIds_","clearInterval"]].forEach(function(t){var e=t[0],i=t[1];n[e].forEach(function(t,e){return n[i](e)})}),n.clearingTimersOnDispose_=!1}))},pe.registerComponent=function(t,e){if("string"!=typeof t||!t)throw new Error('Illegal component name, "'+t+'"; must be a non-empty string.');var i=pe.getComponent("Tech"),n=i&&i.isTech(e),i=pe===e||pe.prototype.isPrototypeOf(e.prototype);if(n||!i)throw new Error('Illegal component, "'+t+'"; '+(n?"techs must be registered using Tech.registerTech()":"must be a Component subclass")+".");t=oe(t),pe.components_||(pe.components_={});n=pe.getComponent("Player");if("Player"===t&&n&&n.players){var r=n.players,n=Object.keys(r);if(r&&0<n.length&&n.map(function(t){return r[t]}).every(Boolean))throw new Error("Can not register Player component after player has been created.")}return pe.components_[t]=e,pe.components_[se(t)]=e},pe.getComponent=function(t){if(t&&pe.components_)return pe.components_[t]},pe);function pe(t,e,i){!t&&this.play?this.player_=t=this:this.player_=t,this.isDisposed_=!1,this.parentComponent_=null,this.options_=le({},this.options_),e=this.options_=le(this.options_,e),this.id_=e.id||e.el&&e.el.id,this.id_||(t=t&&t.id&&t.id()||"no_player",this.id_=t+"_component_"+Pt++),this.name_=e.name||null,e.el?this.el_=e.el:!1!==e.createEl&&(this.el_=this.createEl()),!1!==e.evented&&(ne(this,{eventBusKey:this.el_?"el_":null}),this.handleLanguagechange=this.handleLanguagechange.bind(this),this.on(this.player_,"languagechange",this.handleLanguagechange)),ae(this,this.constructor.defaultState),this.children_=[],this.childIndex_={},this.childNameIndex_={},this.setTimeoutIds_=new ce,this.setIntervalIds_=new ce,this.rafIds_=new ce,this.namedRafs_=new ue,(this.clearingTimersOnDispose_=!1)!==e.initChildren&&this.initChildren(),this.ready(i),!1!==e.reportTouchActivity&&this.enableTouchActivity()}function fe(){this.set_={}}function me(){this.map_={}}de.prototype.supportsRaf_="function"==typeof d.requestAnimationFrame&&"function"==typeof d.cancelAnimationFrame,de.registerComponent("Component",de);function ge(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}i(function(e){function i(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?e.exports=i=function(t){return typeof t}:e.exports=i=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}e.exports=i}),i(function(e){function i(t){return e.exports=i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},i(t)}e.exports=i});function ve(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}function ye(e,t,i,n){return function(t){if("number"!=typeof n||n<0||t<n)throw new Error("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+n+") is non-numeric or out of bounds (0-"+t+").")}(i.length-1),i[n][t]}function _e(t){return void 0===t||0===t.length?{length:0,start:function(){throw new Error("This TimeRanges object is empty")},end:function(){throw new Error("This TimeRanges object is empty")}}:{length:t.length,start:ye.bind(null,"start",0,t),end:ye.bind(null,"end",1,t)}}function be(t,e){return Array.isArray(t)?_e(t):void 0===t||void 0===e?_e():_e([[t,e]])}function we(t,e){var i,n,r=0;if(!e)return 0;t&&t.length||(t=be(0,0));for(var a=0;a<t.length;a++)i=t.start(a),r+=(n=e<(n=t.end(a))?e:n)-i;return r/e}function Te(t){if(t instanceof Te)return t;"number"==typeof t?this.code=t:"string"==typeof t?this.message=t:w(t)&&("number"==typeof t.code&&(this.code=t.code),b(this,t)),this.message||(this.message=Te.defaultMessages[this.code]||"")}Te.prototype.code=0,Te.prototype.message="",Te.prototype.status=null,Te.errorTypes=["MEDIA_ERR_CUSTOM","MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED","MEDIA_ERR_ENCRYPTED"],Te.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail part-way.",3:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",4:"The media could not be loaded, either because the server or network failed or because the format is not supported.",5:"The media is encrypted and we do not have the keys to decrypt it."};for(var xe=0;xe<Te.errorTypes.length;xe++)Te[Te.errorTypes[xe]]=xe,Te.prototype[Te.errorTypes[xe]]=xe;function Se(t){return null!=t&&"function"==typeof t.then}function Ee(t){Se(t)&&t.then(null,function(t){})}function ke(n){return["kind","label","language","id","inBandMetadataTrackDispatchType","mode","src"].reduce(function(t,e,i){return n[e]&&(t[e]=n[e]),t},{cues:n.cues&&Array.prototype.map.call(n.cues,function(t){return{startTime:t.startTime,endTime:t.endTime,text:t.text,id:t.id}})})}var Ce=i(function(t,e){function i(t){if(!t||"object"!=typeof t||(e=t.which||t.keyCode||t.charCode)&&(t=e),"number"==typeof t)return o[t];var e=String(t);return(t=n[e.toLowerCase()])?t:(t=r[e.toLowerCase()])||(1===e.length?e.charCodeAt(0):void 0)}i.isEventKey=function(t,e){if(t&&"object"==typeof t){var i=t.which||t.keyCode||t.charCode;if(null==i)return!1;if("string"==typeof e){if(t=n[e.toLowerCase()])return t===i;if(t=r[e.toLowerCase()])return t===i}else if("number"==typeof e)return e===i;return!1}};for(var n=(e=t.exports=i).code=e.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},r=e.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91},a=97;a<123;a++)n[String.fromCharCode(a)]=a-32;for(var a=48;a<58;a++)n[a-48]=a;for(a=1;a<13;a++)n["f"+a]=a+111;for(a=0;a<10;a++)n["numpad "+a]=a+96;var s,o=e.names=e.title={};for(a in n)o[n[a]]=a;for(s in r)n[s]=r[s]}),Ie=(Ce.code,Ce.codes,Ce.aliases,Ce.names,Ce.title,"vjs-modal-dialog"),Ae=function(i){function t(t,e){return(e=i.call(this,t,e)||this).opened_=e.hasBeenOpened_=e.hasBeenFilled_=!1,e.closeable(!e.options_.uncloseable),e.content(e.options_.content),e.contentEl_=Q("div",{className:Ie+"-content"},{role:"document"}),e.descEl_=Q("p",{className:Ie+"-description vjs-control-text",id:e.el().getAttribute("aria-describedby")}),J(e.descEl_,e.description()),e.el_.appendChild(e.descEl_),e.el_.appendChild(e.contentEl_),e}ve(t,i);var e=t.prototype;return e.createEl=function(){return i.prototype.createEl.call(this,"div",{className:this.buildCSSClass(),tabIndex:-1},{"aria-describedby":this.id()+"_description","aria-hidden":"true","aria-label":this.label(),role:"dialog"})},e.dispose=function(){this.contentEl_=null,this.descEl_=null,this.previouslyActiveEl_=null,i.prototype.dispose.call(this)},e.buildCSSClass=function(){return Ie+" vjs-hidden "+i.prototype.buildCSSClass.call(this)},e.label=function(){return this.localize(this.options_.label||"Modal Window")},e.description=function(){var t=this.options_.description||this.localize("This is a modal window.");return this.closeable()&&(t+=" "+this.localize("This modal can be closed by pressing the Escape key or activating the close button.")),t},e.open=function(){var t;this.opened_||(t=this.player(),this.trigger("beforemodalopen"),this.opened_=!0,!this.options_.fillAlways&&(this.hasBeenOpened_||this.hasBeenFilled_)||this.fill(),this.wasPlaying_=!t.paused(),this.options_.pauseOnOpen&&this.wasPlaying_&&t.pause(),this.on("keydown",this.handleKeyDown),this.hadControls_=t.controls(),t.controls(!1),this.show(),this.conditionalFocus_(),this.el().setAttribute("aria-hidden","false"),this.trigger("modalopen"),this.hasBeenOpened_=!0)},e.opened=function(t){return"boolean"==typeof t&&this[t?"open":"close"](),this.opened_},e.close=function(){var t;this.opened_&&(t=this.player(),this.trigger("beforemodalclose"),this.opened_=!1,this.wasPlaying_&&this.options_.pauseOnOpen&&t.play(),this.off("keydown",this.handleKeyDown),this.hadControls_&&t.controls(!0),this.hide(),this.el().setAttribute("aria-hidden","true"),this.trigger("modalclose"),this.conditionalBlur_(),this.options_.temporary&&this.dispose())},e.closeable=function(t){var e,i;return"boolean"==typeof t&&(e=this.closeable_=!!t,i=this.getChild("closeButton"),e&&!i&&(t=this.contentEl_,this.contentEl_=this.el_,i=this.addChild("closeButton",{controlText:"Close Modal Dialog"}),this.contentEl_=t,this.on(i,"close",this.close)),!e&&i&&(this.off(i,"close",this.close),this.removeChild(i),i.dispose())),this.closeable_},e.fill=function(){this.fillWith(this.content())},e.fillWith=function(t){var e=this.contentEl(),i=e.parentNode,n=e.nextSibling;this.trigger("beforemodalfill"),this.hasBeenFilled_=!0,i.removeChild(e),this.empty(),yt(e,t),this.trigger("modalfill"),n?i.insertBefore(e,n):i.appendChild(e);e=this.getChild("closeButton");e&&i.appendChild(e.el_)},e.empty=function(){this.trigger("beforemodalempty"),mt(this.contentEl()),this.trigger("modalempty")},e.content=function(t){return void 0!==t&&(this.content_=t),this.content_},e.conditionalFocus_=function(){var t=c.activeElement,e=this.player_.el_;this.previouslyActiveEl_=null,!e.contains(t)&&e!==t||(this.previouslyActiveEl_=t,this.focus())},e.conditionalBlur_=function(){this.previouslyActiveEl_&&(this.previouslyActiveEl_.focus(),this.previouslyActiveEl_=null)},e.handleKeyDown=function(t){if(t.stopPropagation(),Ce.isEventKey(t,"Escape")&&this.closeable())return t.preventDefault(),void this.close();if(Ce.isEventKey(t,"Tab")){for(var e,i=this.focusableEls_(),n=this.el_.querySelector(":focus"),r=0;r<i.length;r++)if(n===i[r]){e=r;break}c.activeElement===this.el_&&(e=0),t.shiftKey&&0===e?(i[i.length-1].focus(),t.preventDefault()):t.shiftKey||e!==i.length-1||(i[0].focus(),t.preventDefault())}},e.focusableEls_=function(){var t=this.el_.querySelectorAll("*");return Array.prototype.filter.call(t,function(t){return(t instanceof d.HTMLAnchorElement||t instanceof d.HTMLAreaElement)&&t.hasAttribute("href")||(t instanceof d.HTMLInputElement||t instanceof d.HTMLSelectElement||t instanceof d.HTMLTextAreaElement||t instanceof d.HTMLButtonElement)&&!t.hasAttribute("disabled")||t instanceof d.HTMLIFrameElement||t instanceof d.HTMLObjectElement||t instanceof d.HTMLEmbedElement||t.hasAttribute("tabindex")&&-1!==t.getAttribute("tabindex")||t.hasAttribute("contenteditable")})},t}(de);Ae.prototype.options_={pauseOnOpen:!0,temporary:!0},de.registerComponent("ModalDialog",Ae);var Pe,De=function(n){function t(t){var e;void 0===t&&(t=[]),(e=n.call(this)||this).tracks_=[],Object.defineProperty(ge(e),"length",{get:function(){return this.tracks_.length}});for(var i=0;i<t.length;i++)e.addTrack(t[i]);return e}ve(t,n);var e=t.prototype;return e.addTrack=function(t){var e=this,i=this.tracks_.length;""+i in this||Object.defineProperty(this,i,{get:function(){return this.tracks_[i]}}),-1===this.tracks_.indexOf(t)&&(this.tracks_.push(t),this.trigger({track:t,type:"addtrack",target:this})),t.labelchange_=function(){e.trigger({track:t,type:"labelchange",target:e})},ee(t)&&t.addEventListener("labelchange",t.labelchange_)},e.removeTrack=function(t){for(var e,i=0,n=this.length;i<n;i++)if(this[i]===t){(e=this[i]).off&&e.off(),this.tracks_.splice(i,1);break}e&&this.trigger({track:e,type:"removetrack",target:this})},e.getTrackById=function(t){for(var e=null,i=0,n=this.length;i<n;i++){var r=this[i];if(r.id===t){e=r;break}}return e},t}(Wt);for(Pe in De.prototype.allowedEvents_={change:"change",addtrack:"addtrack",removetrack:"removetrack",labelchange:"labelchange"},De.prototype.allowedEvents_)De.prototype["on"+Pe]=null;function Oe(t,e){for(var i=0;i<t.length;i++)Object.keys(t[i]).length&&e.id!==t[i].id&&(t[i].enabled=!1)}function Le(t,e){for(var i=0;i<t.length;i++)Object.keys(t[i]).length&&e.id!==t[i].id&&(t[i].selected=!1)}function Me(t){var e=["protocol","hostname","port","pathname","search","hash","host"],i=c.createElement("a");i.href=t;var n,r=""===i.host&&"file:"!==i.protocol;r&&((n=c.createElement("div")).innerHTML='<a href="'+t+'"></a>',i=n.firstChild,n.setAttribute("style","display:none; position:absolute;"),c.body.appendChild(n));for(var a={},s=0;s<e.length;s++)a[e[s]]=i[e[s]];return"http:"===a.protocol&&(a.host=a.host.replace(/:80$/,"")),"https:"===a.protocol&&(a.host=a.host.replace(/:443$/,"")),a.protocol||(a.protocol=d.location.protocol),r&&c.body.removeChild(n),a}function Re(t){var e;return t.match(/^https?:\/\//)||((e=c.createElement("div")).innerHTML='<a href="'+t+'">x</a>',t=e.firstChild.href),t}function Ne(t){if("string"==typeof t){t=/^(\/?)([\s\S]*?)((?:\.{1,2}|[^\/]+?)(\.([^\.\/\?]+)))(?:[\/]*|[\?].*)$/.exec(t);if(t)return t.pop().toLowerCase()}return""}function Be(t,e){void 0===e&&(e=d.location);t=Me(t);return(":"===t.protocol?e:t).protocol+t.host!==e.protocol+e.host}var Fe,Ue=function(n){function t(t){for(var e,i=(t=void 0===t?[]:t).length-1;0<=i;i--)if(t[i].enabled){Oe(t,t[i]);break}return(e=n.call(this,t)||this).changing_=!1,e}ve(t,n);var e=t.prototype;return e.addTrack=function(t){var e=this;t.enabled&&Oe(this,t),n.prototype.addTrack.call(this,t),t.addEventListener&&(t.enabledChange_=function(){e.changing_||(e.changing_=!0,Oe(e,t),e.changing_=!1,e.trigger("change"))},t.addEventListener("enabledchange",t.enabledChange_))},e.removeTrack=function(t){n.prototype.removeTrack.call(this,t),t.removeEventListener&&t.enabledChange_&&(t.removeEventListener("enabledchange",t.enabledChange_),t.enabledChange_=null)},t}(De),je=function(n){function t(t){for(var e,i=(t=void 0===t?[]:t).length-1;0<=i;i--)if(t[i].selected){Le(t,t[i]);break}return(e=n.call(this,t)||this).changing_=!1,Object.defineProperty(ge(e),"selectedIndex",{get:function(){for(var t=0;t<this.length;t++)if(this[t].selected)return t;return-1},set:function(){}}),e}ve(t,n);var e=t.prototype;return e.addTrack=function(t){var e=this;t.selected&&Le(this,t),n.prototype.addTrack.call(this,t),t.addEventListener&&(t.selectedChange_=function(){e.changing_||(e.changing_=!0,Le(e,t),e.changing_=!1,e.trigger("change"))},t.addEventListener("selectedchange",t.selectedChange_))},e.removeTrack=function(t){n.prototype.removeTrack.call(this,t),t.removeEventListener&&t.selectedChange_&&(t.removeEventListener("selectedchange",t.selectedChange_),t.selectedChange_=null)},t}(De),qe=function(i){function t(){return i.apply(this,arguments)||this}ve(t,i);var e=t.prototype;return e.addTrack=function(t){var e=this;i.prototype.addTrack.call(this,t),this.queueChange_||(this.queueChange_=function(){return e.queueTrigger("change")}),this.triggerSelectedlanguagechange||(this.triggerSelectedlanguagechange_=function(){return e.trigger("selectedlanguagechange")}),t.addEventListener("modechange",this.queueChange_),-1===["metadata","chapters"].indexOf(t.kind)&&t.addEventListener("modechange",this.triggerSelectedlanguagechange_)},e.removeTrack=function(t){i.prototype.removeTrack.call(this,t),t.removeEventListener&&(this.queueChange_&&t.removeEventListener("modechange",this.queueChange_),this.selectedlanguagechange_&&t.removeEventListener("modechange",this.triggerSelectedlanguagechange_))},t}(De),I=((C=Ze.prototype).addTrackElement_=function(t){var e=this.trackElements_.length;""+e in this||Object.defineProperty(this,e,{get:function(){return this.trackElements_[e]}}),-1===this.trackElements_.indexOf(t)&&this.trackElements_.push(t)},C.getTrackElementByTrack_=function(t){for(var e,i=0,n=this.trackElements_.length;i<n;i++)if(t===this.trackElements_[i].track){e=this.trackElements_[i];break}return e},C.removeTrackElement_=function(t){for(var e=0,i=this.trackElements_.length;e<i;e++)if(t===this.trackElements_[e]){this.trackElements_[e].track&&"function"==typeof this.trackElements_[e].track.off&&this.trackElements_[e].track.off(),"function"==typeof this.trackElements_[e].off&&this.trackElements_[e].off(),this.trackElements_.splice(e,1);break}},Ze),ze=((B=Je.prototype).setCues_=function(t){var e=this.length||0,i=0,n=t.length;function r(t){""+t in this||Object.defineProperty(this,""+t,{get:function(){return this.cues_[t]}})}if(this.cues_=t,this.length_=t.length,e<n)for(i=e;i<n;i++)r.call(this,i)},B.getCueById=function(t){for(var e=null,i=0,n=this.length;i<n;i++){var r=this[i];if(r.id===t){e=r;break}}return e},Je),He={alternative:"alternative",captions:"captions",main:"main",sign:"sign",subtitles:"subtitles",commentary:"commentary"},Ve={alternative:"alternative",descriptions:"descriptions",main:"main","main-desc":"main-desc",translation:"translation",commentary:"commentary"},We={subtitles:"subtitles",captions:"captions",descriptions:"descriptions",chapters:"chapters",metadata:"metadata"},Ge={disabled:"disabled",hidden:"hidden",showing:"showing"},j=(ve(Qe,Fe=Wt),Qe),Xe=Object.freeze({__proto__:null,parseUrl:Me,getAbsoluteURL:Re,getFileExtension:Ne,isCrossOrigin:Be}),$e="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},Ye=function(t){var e=Ke.call(t);return"[object Function]"===e||"function"==typeof t&&"[object RegExp]"!==e||"undefined"!=typeof window&&(t===window.setTimeout||t===window.alert||t===window.confirm||t===window.prompt)},Ke=Object.prototype.toString;function Qe(t){void 0===t&&(t={});var e,i=Fe.call(this)||this,n={id:t.id||"vjs_track_"+Pt++,kind:t.kind||"",language:t.language||""},r=t.label||"";for(e in n)!function(t){Object.defineProperty(ge(i),t,{get:function(){return n[t]},set:function(){}})}(e);return Object.defineProperty(ge(i),"label",{get:function(){return r},set:function(t){t!==r&&(r=t,this.trigger("labelchange"))}}),i}function Je(t){Je.prototype.setCues_.call(this,t),Object.defineProperty(this,"length",{get:function(){return this.length_}})}function Ze(t){void 0===t&&(t=[]),this.trackElements_=[],Object.defineProperty(this,"length",{get:function(){return this.trackElements_.length}});for(var e=0,i=t.length;e<i;e++)this.addTrackElement_(t[e])}var ti=function(t){var n={};return t&&t.trim().split("\n").forEach(function(t){var e=t.indexOf(":"),i=t.slice(0,e).trim().toLowerCase(),e=t.slice(e+1).trim();void 0===n[i]?n[i]=e:Array.isArray(n[i])?n[i].push(e):n[i]=[n[i],e]}),n},ei=ri,ii=ri;function ni(t,e,i){var n=t;return Ye(e)?(i=e,"string"==typeof t&&(n={uri:t})):n=v({},e,{uri:t}),n.callback=i,n}function ri(t,e,i){return ai(e=ni(t,e,i))}function ai(n){if(void 0===n.callback)throw new Error("callback argument missing");function r(t,e,i){a||(a=!0,n.callback(t,e,i))}var a=!1;function e(t){return clearTimeout(o),(t=!(t instanceof Error)?new Error(""+(t||"Unknown XMLHttpRequest Error")):t).statusCode=0,r(t,m)}function t(){if(!s){clearTimeout(o);var t=n.useXDR&&void 0===l.status?200:1223===l.status?204:l.status,e=m,i=null;return 0!==t?(e={body:function(){var t=void 0,t=l.response||l.responseText||function(t){try{if("document"===t.responseType)return t.responseXML;var e=t.responseXML&&"parsererror"===t.responseXML.documentElement.nodeName;if(""===t.responseType&&!e)return t.responseXML}catch(t){}return null}(l);if(f)try{t=JSON.parse(t)}catch(t){}return t}(),statusCode:t,method:h,headers:{},url:u,rawRequest:l},l.getAllResponseHeaders&&(e.headers=ti(l.getAllResponseHeaders()))):i=new Error("Internal XMLHttpRequest Error"),r(i,e,e.body)}}var i,s,o,l=n.xhr||null,u=(l=l||new(n.cors||n.useXDR?ri.XDomainRequest:ri.XMLHttpRequest)).url=n.uri||n.url,h=l.method=n.method||"GET",c=n.body||n.data,d=l.headers=n.headers||{},p=!!n.sync,f=!1,m={body:void 0,headers:{},statusCode:0,method:h,url:u,rawRequest:l};if("json"in n&&!1!==n.json&&(f=!0,d.accept||d.Accept||(d.Accept="application/json"),"GET"!==h&&"HEAD"!==h&&(d["content-type"]||d["Content-Type"]||(d["Content-Type"]="application/json"),c=JSON.stringify(!0===n.json?c:n.json))),l.onreadystatechange=function(){4===l.readyState&&setTimeout(t,0)},l.onload=t,l.onerror=e,l.onprogress=function(){},l.onabort=function(){s=!0},l.ontimeout=e,l.open(h,u,!p,n.username,n.password),p||(l.withCredentials=!!n.withCredentials),!p&&0<n.timeout&&(o=setTimeout(function(){var t;s||(s=!0,l.abort("timeout"),(t=new Error("XMLHttpRequest timeout")).code="ETIMEDOUT",e(t))},n.timeout)),l.setRequestHeader)for(i in d)d.hasOwnProperty(i)&&l.setRequestHeader(i,d[i]);else if(n.headers&&!function(t){for(var e in t)if(t.hasOwnProperty(e))return;return 1}(n.headers))throw new Error("Headers cannot be set on an XDomainRequest object");return"responseType"in n&&(l.responseType=n.responseType),"beforeSend"in n&&"function"==typeof n.beforeSend&&n.beforeSend(l),l.send(c||null),l}function si(t,e){var i=new d.WebVTT.Parser(d,d.vttjs,d.WebVTT.StringDecoder()),n=[];i.oncue=function(t){e.addCue(t)},i.onparsingerror=function(t){n.push(t)},i.onflush=function(){e.trigger({type:"loadeddata",target:e})},i.parse(t),0<n.length&&(d.console&&d.console.groupCollapsed&&d.console.groupCollapsed("Text Track parsing errors for "+e.src),n.forEach(function(t){return m.error(t)}),d.console&&d.console.groupEnd&&d.console.groupEnd()),i.flush()}function oi(t,n){var e={uri:t},t=Be(t);t&&(e.cors=t);t="use-credentials"===n.tech_.crossOrigin();t&&(e.withCredentials=t),ei(e,Ht(this,function(t,e,i){return t?m.error(t,e):(n.loaded_=!0,void("function"!=typeof d.WebVTT?n.tech_&&n.tech_.any(["vttjsloaded","vttjserror"],function(t){return"vttjserror"!==t.type?si(i,n):void m.error("vttjs failed to load, stopping trying to process "+n.src)}):si(i,n)))}))}ri.XMLHttpRequest=$e.XMLHttpRequest||function(){},ri.XDomainRequest="withCredentials"in new ri.XMLHttpRequest?ri.XMLHttpRequest:$e.XDomainRequest,function(t){for(var e=0;e<t.length;e++)!function(n){ri["delete"===n?"del":n]=function(t,e,i){return(e=ni(t,e,i)).method=n.toUpperCase(),ai(e)}}(t[e])}(["get","put","post","patch","head","delete"]),ei.default=ii;var li=function(l){function t(t){var e;if(!(t=void 0===t?{}:t).tech)throw new Error("A tech was not provided.");var t=le(t,{kind:We[t.kind]||"subtitles",language:t.language||t.srclang||""}),i=Ge[t.mode]||"disabled",n=t.default;"metadata"!==t.kind&&"chapters"!==t.kind||(i="hidden"),(e=l.call(this,t)||this).tech_=t.tech,e.cues_=[],e.activeCues_=[],e.preload_=!1!==e.tech_.preloadTextTracks;var r=new ze(e.cues_),s=new ze(e.activeCues_),o=!1,a=Ht(ge(e),function(){this.tech_.isReady_&&!this.tech_.isDisposed()&&(this.activeCues=this.activeCues,o&&(this.trigger("cuechange"),o=!1))});return e.tech_.one("dispose",function(){e.tech_.off("timeupdate",a)}),"disabled"!==i&&e.tech_.on("timeupdate",a),Object.defineProperties(ge(e),{default:{get:function(){return n},set:function(){}},mode:{get:function(){return i},set:function(t){Ge[t]&&i!==t&&(i=t,this.preload_||"disabled"===i||0!==this.cues.length||oi(this.src,this),this.tech_.off("timeupdate",a),"disabled"!==i&&this.tech_.on("timeupdate",a),this.trigger("modechange"))}},cues:{get:function(){return this.loaded_?r:null},set:function(){}},activeCues:{get:function(){if(!this.loaded_)return null;if(0===this.cues.length)return s;for(var t=this.tech_.currentTime(),e=[],i=0,n=this.cues.length;i<n;i++){var r=this.cues[i];(r.startTime<=t&&r.endTime>=t||r.startTime===r.endTime&&r.startTime<=t&&r.startTime+.5>=t)&&e.push(r)}if(o=!1,e.length!==this.activeCues_.length)o=!0;else for(var a=0;a<e.length;a++)-1===this.activeCues_.indexOf(e[a])&&(o=!0);return this.activeCues_=e,s.setCues_(this.activeCues_),s},set:function(){}}}),t.src?(e.src=t.src,e.preload_||(e.loaded_=!0),(e.preload_||"subtitles"!==t.kind&&"captions"!==t.kind)&&oi(e.src,ge(e))):e.loaded_=!0,e}ve(t,l);var e=t.prototype;return e.addCue=function(t){var e=t;if(d.vttjs&&!(t instanceof d.vttjs.VTTCue)){for(var i in e=new d.vttjs.VTTCue(t.startTime,t.endTime,t.text),t)i in e||(e[i]=t[i]);e.id=t.id,e.originalCue_=t}for(var n=this.tech_.textTracks(),r=0;r<n.length;r++)n[r]!==this&&n[r].removeCue(e);this.cues_.push(e),this.cues.setCues_(this.cues_)},e.removeCue=function(t){for(var e=this.cues_.length;e--;){var i=this.cues_[e];if(i===t||i.originalCue_&&i.originalCue_===t){this.cues_.splice(e,1),this.cues.setCues_(this.cues_);break}}},t}(j);li.prototype.allowedEvents_={cuechange:"cuechange"};var ui,hi,ci,a=(ve(fi,ci=j),fi),E=(ve(pi,hi=j),pi),he=(ve(di,ui=Wt),di);function di(t){var e;void 0===t&&(t={});var i=ui.call(this)||this,n=new li(t);return i.kind=n.kind,i.src=n.src,i.srclang=n.language,i.label=n.label,i.default=n.default,Object.defineProperties(ge(i),{readyState:{get:function(){return e}},track:{get:function(){return n}}}),e=0,n.addEventListener("loadeddata",function(){e=2,i.trigger({type:"load",target:ge(i)})}),i}function pi(t){var e=le(t=void 0===t?{}:t,{kind:He[t.kind]||""}),t=hi.call(this,e)||this,i=!1;return Object.defineProperty(ge(t),"selected",{get:function(){return i},set:function(t){"boolean"==typeof t&&t!==i&&(i=t,this.trigger("selectedchange"))}}),e.selected&&(t.selected=e.selected),t}function fi(t){var e=le(t=void 0===t?{}:t,{kind:Ve[t.kind]||""}),t=ci.call(this,e)||this,i=!1;return Object.defineProperty(ge(t),"enabled",{get:function(){return i},set:function(t){"boolean"==typeof t&&t!==i&&(i=t,this.trigger("enabledchange"))}}),e.enabled&&(t.enabled=e.enabled),t.loaded_=!0,t}he.prototype.allowedEvents_={load:"load"},he.NONE=0,he.LOADING=1,he.LOADED=2,he.ERROR=3;var mi={audio:{ListClass:Ue,TrackClass:a,capitalName:"Audio"},video:{ListClass:je,TrackClass:E,capitalName:"Video"},text:{ListClass:qe,TrackClass:li,capitalName:"Text"}};Object.keys(mi).forEach(function(t){mi[t].getterName=t+"Tracks",mi[t].privateName=t+"Tracks_"});var gi={remoteText:{ListClass:qe,TrackClass:li,capitalName:"RemoteText",getterName:"remoteTextTracks",privateName:"remoteTextTracks_"},remoteTextEl:{ListClass:I,TrackClass:he,capitalName:"RemoteTextTrackEls",getterName:"remoteTextTrackEls",privateName:"remoteTextTrackEls_"}},vi=v({},mi,gi);gi.names=Object.keys(gi),mi.names=Object.keys(mi),vi.names=[].concat(gi.names).concat(mi.names);var yi=Object.create||function(t){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return _i.prototype=t,new _i};function _i(){}function bi(t,e){this.name="ParsingError",this.code=t.code,this.message=e||t.message}function wi(t){function e(t,e,i,n){return 3600*(0|t)+60*(0|e)+(0|i)+(0|n)/1e3}t=t.match(/^(\d+):(\d{1,2})(:\d{1,2})?\.(\d{3})/);return t?t[3]?e(t[1],t[2],t[3].replace(":",""),t[4]):59<t[1]?e(t[1],t[2],0,t[4]):e(0,t[1],t[2],t[4]):null}function Ti(){this.values=yi(null)}function xi(t,e,i,n){var r,a,s=n?t.split(n):[t];for(r in s)"string"!=typeof s[r]||2===(a=s[r].split(i)).length&&e(a[0],a[1])}function Si(e,t,s){var i=e;function n(){var t=wi(e);if(null===t)throw new bi(bi.Errors.BadTimeStamp,"Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function r(){e=e.replace(/^\s+/,"")}if(r(),t.startTime=n(),r(),"--\x3e"!==e.substr(0,3))throw new bi(bi.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.substr(3),r(),t.endTime=n(),r(),function(t,e){var a=new Ti;xi(t,function(t,e){switch(t){case"region":for(var i=s.length-1;0<=i;i--)if(s[i].id===e){a.set(t,s[i].region);break}break;case"vertical":a.alt(t,e,["rl","lr"]);break;case"line":var n=e.split(","),r=n[0];a.integer(t,r),a.percent(t,r)&&a.set("snapToLines",!1),a.alt(t,r,["auto"]),2===n.length&&a.alt("lineAlign",n[1],["start","center","end"]);break;case"position":n=e.split(","),a.percent(t,n[0]),2===n.length&&a.alt("positionAlign",n[1],["start","center","end"]);break;case"size":a.percent(t,e);break;case"align":a.alt(t,e,["start","center","end","left","right"])}},/:/,/\s/),e.region=a.get("region",null),e.vertical=a.get("vertical","");try{e.line=a.get("line","auto")}catch(t){}e.lineAlign=a.get("lineAlign","start"),e.snapToLines=a.get("snapToLines",!0),e.size=a.get("size",100);try{e.align=a.get("align","center")}catch(t){e.align=a.get("align","middle")}try{e.position=a.get("position","auto")}catch(t){e.position=a.get("position",{start:0,left:0,center:50,middle:50,end:100,right:100},e.align)}e.positionAlign=a.get("positionAlign",{start:"start",left:"start",center:"center",middle:"center",end:"end",right:"end"},e.align)}(e,t)}((bi.prototype=yi(Error.prototype)).constructor=bi).Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},Ti.prototype={set:function(t,e){this.get(t)||""===e||(this.values[t]=e)},get:function(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e},has:function(t){return t in this.values},alt:function(t,e,i){for(var n=0;n<i.length;++n)if(e===i[n]){this.set(t,e);break}},integer:function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},percent:function(t,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&0<=(e=parseFloat(e))&&e<=100)&&(this.set(t,e),!0)}};var Ei=c.createElement("textarea"),ki={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},Ci={white:"rgba(255,255,255,1)",lime:"rgba(0,255,0,1)",cyan:"rgba(0,255,255,1)",red:"rgba(255,0,0,1)",yellow:"rgba(255,255,0,1)",magenta:"rgba(255,0,255,1)",blue:"rgba(0,0,255,1)",black:"rgba(0,0,0,1)"},Ii={v:"title",lang:"lang"},Ai={rt:"ruby"};function Pi(t,e){for(var i,n,r=t.document.createElement("div"),a=r,s=[];null!==(n=function(){if(!e)return null;var t=(t=e.match(/^([^<]*)(<[^>]*>?)?/))[1]||t[2];return e=e.substr(t.length),t}());)if("<"!==n[0])a.appendChild(t.document.createTextNode((i=n,Ei.innerHTML=i,i=Ei.textContent,Ei.textContent="",i)));else{if("/"===n[1]){s.length&&s[s.length-1]===n.substr(2).replace(">","")&&(s.pop(),a=a.parentNode);continue}var o,l=wi(n.substr(1,n.length-2));if(l){o=t.document.createProcessingInstruction("timestamp",l),a.appendChild(o);continue}var u=n.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!u)continue;if(i=u[1],l=u[3],n=void 0,n=ki[i],!(o=n?(n=t.document.createElement(n),(i=Ii[i])&&l&&(n[i]=l.trim()),n):null))continue;if(l=a,Ai[(n=o).localName]&&Ai[n.localName]!==l.localName)continue;u[2]&&((l=u[2].split(".")).forEach(function(t){var e=/^bg_/.test(t),t=e?t.slice(3):t;Ci.hasOwnProperty(t)&&(t=Ci[t],o.style[e?"background-color":"color"]=t)}),o.className=l.join(" ")),s.push(u[1]),a.appendChild(o),a=o}return r}var Di=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function Oi(){}function Li(t,e,i){Oi.call(this),this.cue=e,this.cueDiv=Pi(t,e.text);var n={color:"rgba(255, 255, 255, 1)",backgroundColor:"rgba(0, 0, 0, 0.8)",position:"relative",left:0,right:0,top:0,bottom:0,display:"inline",writingMode:""===e.vertical?"horizontal-tb":"lr"===e.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext"};this.applyStyles(n,this.cueDiv),this.div=t.document.createElement("div"),n={direction:function(t){var e=[],i="";if(!t||!t.childNodes)return"ltr";function a(t,e){for(var i=e.childNodes.length-1;0<=i;i--)t.push(e.childNodes[i])}for(a(e,t);i=function t(e){if(!e||!e.length)return null;var i=e.pop(),n=i.textContent||i.innerText;if(n){var r=n.match(/^.*(\n|\r)/);return r?r[e.length=0]:n}return"ruby"===i.tagName?t(e):i.childNodes?(a(e,i),t(e)):void 0}(e);)for(var n=0;n<i.length;n++)if(function(t){for(var e=0;e<Di.length;e++){var i=Di[e];if(t>=i[0]&&t<=i[1])return 1}}(i.charCodeAt(n)))return"rtl";return"ltr"}(this.cueDiv),writingMode:""===e.vertical?"horizontal-tb":"lr"===e.vertical?"vertical-lr":"vertical-rl",unicodeBidi:"plaintext",textAlign:"middle"===e.align?"center":e.align,font:i.font,whiteSpace:"pre-line",position:"absolute"},this.applyStyles(n),this.div.appendChild(this.cueDiv);var r=0;switch(e.positionAlign){case"start":r=e.position;break;case"center":r=e.position-e.size/2;break;case"end":r=e.position-e.size}""===e.vertical?this.applyStyles({left:this.formatStyle(r,"%"),width:this.formatStyle(e.size,"%")}):this.applyStyles({top:this.formatStyle(r,"%"),height:this.formatStyle(e.size,"%")}),this.move=function(t){this.applyStyles({top:this.formatStyle(t.top,"px"),bottom:this.formatStyle(t.bottom,"px"),left:this.formatStyle(t.left,"px"),right:this.formatStyle(t.right,"px"),height:this.formatStyle(t.height,"px"),width:this.formatStyle(t.width,"px")})}}function Mi(t){var e,i,n,r;t.div&&(e=t.div.offsetHeight,i=t.div.offsetWidth,n=t.div.offsetTop,r=(r=t.div.childNodes)&&(r=r[0])&&r.getClientRects&&r.getClientRects(),t=t.div.getBoundingClientRect(),r=r?Math.max(r[0]&&r[0].height||0,t.height/r.length):0),this.left=t.left,this.right=t.right,this.top=t.top||n,this.height=t.height||e,this.bottom=t.bottom||n+(t.height||e),this.width=t.width||i,this.lineHeight=void 0!==r?r:t.lineHeight}function Ri(){}Oi.prototype.applyStyles=function(t,e){for(var i in e=e||this.div,t)t.hasOwnProperty(i)&&(e.style[i]=t[i])},Oi.prototype.formatStyle=function(t,e){return 0===t?0:t+e},(Li.prototype=yi(Oi.prototype)).constructor=Li,Mi.prototype.move=function(t,e){switch(e=void 0!==e?e:this.lineHeight,t){case"+x":this.left+=e,this.right+=e;break;case"-x":this.left-=e,this.right-=e;break;case"+y":this.top+=e,this.bottom+=e;break;case"-y":this.top-=e,this.bottom-=e}},Mi.prototype.overlaps=function(t){return this.left<t.right&&this.right>t.left&&this.top<t.bottom&&this.bottom>t.top},Mi.prototype.overlapsAny=function(t){for(var e=0;e<t.length;e++)if(this.overlaps(t[e]))return!0;return!1},Mi.prototype.within=function(t){return this.top>=t.top&&this.bottom<=t.bottom&&this.left>=t.left&&this.right<=t.right},Mi.prototype.overlapsOppositeAxis=function(t,e){switch(e){case"+x":return this.left<t.left;case"-x":return this.right>t.right;case"+y":return this.top<t.top;case"-y":return this.bottom>t.bottom}},Mi.prototype.intersectPercentage=function(t){return Math.max(0,Math.min(this.right,t.right)-Math.max(this.left,t.left))*Math.max(0,Math.min(this.bottom,t.bottom)-Math.max(this.top,t.top))/(this.height*this.width)},Mi.prototype.toCSSCompatValues=function(t){return{top:this.top-t.top,bottom:t.bottom-this.bottom,left:this.left-t.left,right:t.right-this.right,height:this.height,width:this.width}},Mi.getSimpleBoxPosition=function(t){var e=t.div?t.div.offsetHeight:t.tagName?t.offsetHeight:0,i=t.div?t.div.offsetWidth:t.tagName?t.offsetWidth:0,n=t.div?t.div.offsetTop:t.tagName?t.offsetTop:0;return{left:(t=t.div?t.div.getBoundingClientRect():t.tagName?t.getBoundingClientRect():t).left,right:t.right,top:t.top||n,height:t.height||e,bottom:t.bottom||n+(t.height||e),width:t.width||i}},Ri.StringDecoder=function(){return{decode:function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}},Ri.convertCueToDOMTree=function(t,e){return t&&e?Pi(t,e):null},Ri.processCues=function(n,r,t){if(!n||!r||!t)return null;for(;t.firstChild;)t.removeChild(t.firstChild);var a=n.document.createElement("div");if(a.style.position="absolute",a.style.left="0",a.style.right="0",a.style.top="0",a.style.bottom="0",a.style.margin="1.5%",t.appendChild(a),function(t){for(var e=0;e<t.length;e++)if(t[e].hasBeenReset||!t[e].displayState)return 1}(r)){var s=[],o=Mi.getSimpleBoxPosition(a),l={font:Math.round(.05*o.height*100)/100+"px sans-serif"};!function(){for(var t,e,i=0;i<r.length;i++)e=r[i],t=new Li(n,e,l),a.appendChild(t.div),function(t,o,l){var e,i=new Mi(t),r=t.cue,n=function(){if("number"==typeof r.line&&(r.snapToLines||0<=r.line&&r.line<=100))return r.line;if(!r.track||!r.track.textTrackList||!r.track.textTrackList.mediaElement)return-1;for(var t=r.track,e=t.textTrackList,i=0,n=0;n<e.length&&e[n]!==t;n++)"showing"===e[n].mode&&i++;return-1*++i}(),a=[];if(r.snapToLines){switch(r.vertical){case"":a=["+y","-y"],e="height";break;case"rl":a=["+x","-x"],e="width";break;case"lr":a=["-x","+x"],e="width"}var s=i.lineHeight,u=s*Math.round(n),h=o[e]+s,c=a[0];Math.abs(u)>h&&(u=u<0?-1:1,u*=Math.ceil(h/s)*s),n<0&&(u+=""===r.vertical?o.height:o.width,a=a.reverse()),i.move(c,u)}else{var d=i.lineHeight/o.height*100;switch(r.lineAlign){case"center":n-=d/2;break;case"end":n-=d}switch(r.vertical){case"":t.applyStyles({top:t.formatStyle(n,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(n,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(n,"%")})}a=["+y","-x","+x","-y"],i=new Mi(t)}i=function(t,e){for(var i,n=new Mi(t),r=1,a=0;a<e.length;a++){for(;t.overlapsOppositeAxis(o,e[a])||t.within(o)&&t.overlapsAny(l);)t.move(e[a]);if(t.within(o))return t;var s=t.intersectPercentage(o);s<r&&(i=new Mi(t),r=s),t=new Mi(n)}return i||n}(i,a),t.move(i.toCSSCompatValues(o))}(t,o,s),e.displayState=t.div,s.push(Mi.getSimpleBoxPosition(t))}()}else for(var e=0;e<r.length;e++)a.appendChild(r[e].displayState)},(Ri.Parser=function(t,e,i){i||(i=e,e={}),e=e||{},this.window=t,this.vttjs=e,this.state="INITIAL",this.buffer="",this.decoder=i||new TextDecoder("utf8"),this.regionList=[]}).prototype={reportOrThrowError:function(t){if(!(t instanceof bi))throw t;this.onparsingerror&&this.onparsingerror(t)},parse:function(t){var e,n=this;function i(){for(var t=n.buffer,e=0;e<t.length&&"\r"!==t[e]&&"\n"!==t[e];)++e;var i=t.substr(0,e);return"\r"===t[e]&&++e,"\n"===t[e]&&++e,n.buffer=t.substr(e),i}function r(t){t.match(/X-TIMESTAMP-MAP/)?xi(t,function(t,e){var i;"X-TIMESTAMP-MAP"===t&&(e=e,i=new Ti,xi(e,function(t,e){switch(t){case"MPEGT":i.integer(t+"S",e);break;case"LOCA":i.set(t+"L",wi(e))}},/[^\d]:/,/,/),n.ontimestampmap&&n.ontimestampmap({MPEGTS:i.get("MPEGTS"),LOCAL:i.get("LOCAL")}))},/=/):xi(t,function(t,e){var r;"Region"===t&&(e=e,r=new Ti,xi(e,function(t,e){switch(t){case"id":r.set(t,e);break;case"width":r.percent(t,e);break;case"lines":r.integer(t,e);break;case"regionanchor":case"viewportanchor":var i=e.split(",");if(2!==i.length)break;var n=new Ti;if(n.percent("x",i[0]),n.percent("y",i[1]),!n.has("x")||!n.has("y"))break;r.set(t+"X",n.get("x")),r.set(t+"Y",n.get("y"));break;case"scroll":r.alt(t,e,["up"])}},/=/,/\s/),r.has("id")&&((e=new(n.vttjs.VTTRegion||n.window.VTTRegion)).width=r.get("width",100),e.lines=r.get("lines",3),e.regionAnchorX=r.get("regionanchorX",0),e.regionAnchorY=r.get("regionanchorY",100),e.viewportAnchorX=r.get("viewportanchorX",0),e.viewportAnchorY=r.get("viewportanchorY",100),e.scroll=r.get("scroll",""),n.onregion&&n.onregion(e),n.regionList.push({id:r.get("id"),region:e})))},/:/)}t&&(n.buffer+=n.decoder.decode(t,{stream:!0}));try{if("INITIAL"===n.state){if(!/\r\n|\n/.test(n.buffer))return this;var a=(e=i()).match(/^WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new bi(bi.Errors.BadSignature);n.state="HEADER"}for(var s=!1;n.buffer;){if(!/\r\n|\n/.test(n.buffer))return this;switch(s?s=!1:e=i(),n.state){case"HEADER":/:/.test(e)?r(e):e||(n.state="ID");continue;case"NOTE":e||(n.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){n.state="NOTE";break}if(!e)continue;n.cue=new(n.vttjs.VTTCue||n.window.VTTCue)(0,0,"");try{n.cue.align="center"}catch(t){n.cue.align="middle"}if(n.state="CUE",-1===e.indexOf("--\x3e")){n.cue.id=e;continue}case"CUE":try{Si(e,n.cue,n.regionList)}catch(t){n.reportOrThrowError(t),n.cue=null,n.state="BADCUE";continue}n.state="CUETEXT";continue;case"CUETEXT":var o=-1!==e.indexOf("--\x3e");if(!e||o&&(s=!0)){n.oncue&&n.oncue(n.cue),n.cue=null,n.state="ID";continue}n.cue.text&&(n.cue.text+="\n"),n.cue.text+=e.replace(/\u2028/g,"\n").replace(/u2029/g,"\n");continue;case"BADCUE":e||(n.state="ID");continue}}}catch(t){n.reportOrThrowError(t),"CUETEXT"===n.state&&n.cue&&n.oncue&&n.oncue(n.cue),n.cue=null,n.state="INITIAL"===n.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),!e.cue&&"HEADER"!==e.state||(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new bi(bi.Errors.BadSignature)}catch(t){e.reportOrThrowError(t)}return e.onflush&&e.onflush(),this}};var Ni=Ri,Bi={"":1,lr:1,rl:1},Fi={start:1,center:1,end:1,left:1,right:1,auto:1,"line-left":1,"line-right":1};function Ui(t){return"string"==typeof t&&!!Fi[t.toLowerCase()]&&t.toLowerCase()}function ji(t,e,i){this.hasBeenReset=!1;var n="",r=!1,a=t,s=e,o=i,l=null,u="",h=!0,c="auto",d="start",p="auto",f="auto",m=100,g="center";Object.defineProperties(this,{id:{enumerable:!0,get:function(){return n},set:function(t){n=""+t}},pauseOnExit:{enumerable:!0,get:function(){return r},set:function(t){r=!!t}},startTime:{enumerable:!0,get:function(){return a},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");a=t,this.hasBeenReset=!0}},endTime:{enumerable:!0,get:function(){return s},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");s=t,this.hasBeenReset=!0}},text:{enumerable:!0,get:function(){return o},set:function(t){o=""+t,this.hasBeenReset=!0}},region:{enumerable:!0,get:function(){return l},set:function(t){l=t,this.hasBeenReset=!0}},vertical:{enumerable:!0,get:function(){return u},set:function(t){t="string"==typeof(t=t)&&!!Bi[t.toLowerCase()]&&t.toLowerCase();if(!1===t)throw new SyntaxError("Vertical: an invalid or illegal direction string was specified.");u=t,this.hasBeenReset=!0}},snapToLines:{enumerable:!0,get:function(){return h},set:function(t){h=!!t,this.hasBeenReset=!0}},line:{enumerable:!0,get:function(){return c},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("Line: an invalid number or illegal string was specified.");c=t,this.hasBeenReset=!0}},lineAlign:{enumerable:!0,get:function(){return d},set:function(t){t=Ui(t);t&&(d=t,this.hasBeenReset=!0)}},position:{enumerable:!0,get:function(){return p},set:function(t){if(t<0||100<t)throw new Error("Position must be between 0 and 100.");p=t,this.hasBeenReset=!0}},positionAlign:{enumerable:!0,get:function(){return f},set:function(t){t=Ui(t);t&&(f=t,this.hasBeenReset=!0)}},size:{enumerable:!0,get:function(){return m},set:function(t){if(t<0||100<t)throw new Error("Size must be between 0 and 100.");m=t,this.hasBeenReset=!0}},align:{enumerable:!0,get:function(){return g},set:function(t){t=Ui(t);if(!t)throw new SyntaxError("align: an invalid or illegal alignment string was specified.");g=t,this.hasBeenReset=!0}}}),this.displayState=void 0}ji.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)};var qi=ji,zi={"":!0,up:!0};function Hi(t){return"number"==typeof t&&0<=t&&t<=100}function Vi(){var e=100,i=3,n=0,r=100,a=0,s=100,o="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return e},set:function(t){if(!Hi(t))throw new Error("Width must be between 0 and 100.");e=t}},lines:{enumerable:!0,get:function(){return i},set:function(t){if("number"!=typeof t)throw new TypeError("Lines must be set to a number.");i=t}},regionAnchorY:{enumerable:!0,get:function(){return r},set:function(t){if(!Hi(t))throw new Error("RegionAnchorX must be between 0 and 100.");r=t}},regionAnchorX:{enumerable:!0,get:function(){return n},set:function(t){if(!Hi(t))throw new Error("RegionAnchorY must be between 0 and 100.");n=t}},viewportAnchorY:{enumerable:!0,get:function(){return s},set:function(t){if(!Hi(t))throw new Error("ViewportAnchorY must be between 0 and 100.");s=t}},viewportAnchorX:{enumerable:!0,get:function(){return a},set:function(t){if(!Hi(t))throw new Error("ViewportAnchorX must be between 0 and 100.");a=t}},scroll:{enumerable:!0,get:function(){return o},set:function(t){t="string"==typeof(t=t)&&!!zi[t.toLowerCase()]&&t.toLowerCase();!1===t||(o=t)}}})}var Wi=i(function(t){t=t.exports={WebVTT:Ni,VTTCue:qi,VTTRegion:Vi};d.vttjs=t,d.WebVTT=t.WebVTT;var e=t.VTTCue,i=t.VTTRegion,n=d.VTTCue,r=d.VTTRegion;t.shim=function(){d.VTTCue=e,d.VTTRegion=i},t.restore=function(){d.VTTCue=n,d.VTTRegion=r},d.VTTCue||t.shim()});Wi.WebVTT,Wi.VTTCue,Wi.VTTRegion;var Gi=function(n){function i(e,t){var i;return void 0===t&&(t=function(){}),(e=void 0===e?{}:e).reportTouchActivity=!1,(i=n.call(this,null,e,t)||this).hasStarted_=!1,i.on("playing",function(){this.hasStarted_=!0}),i.on("loadstart",function(){this.hasStarted_=!1}),vi.names.forEach(function(t){t=vi[t];e&&e[t.getterName]&&(i[t.privateName]=e[t.getterName])}),i.featuresProgressEvents||i.manualProgressOn(),i.featuresTimeupdateEvents||i.manualTimeUpdatesOn(),["Text","Audio","Video"].forEach(function(t){!1===e["native"+t+"Tracks"]&&(i["featuresNative"+t+"Tracks"]=!1)}),!1===e.nativeCaptions||!1===e.nativeTextTracks?i.featuresNativeTextTracks=!1:!0!==e.nativeCaptions&&!0!==e.nativeTextTracks||(i.featuresNativeTextTracks=!0),i.featuresNativeTextTracks||i.emulateTextTracks(),i.preloadTextTracks=!1!==e.preloadTextTracks,i.autoRemoteTextTracks_=new vi.text.ListClass,i.initTrackListeners(),e.nativeControlsForTouch||i.emitTapEvents(),i.constructor&&(i.name_=i.constructor.name||"Unknown Tech"),i}ve(i,n);var t=i.prototype;return t.triggerSourceset=function(t){var e=this;this.isReady_||this.one("ready",function(){return e.setTimeout(function(){return e.triggerSourceset(t)},1)}),this.trigger({src:t,type:"sourceset"})},t.manualProgressOn=function(){this.on("durationchange",this.onDurationChange),this.manualProgress=!0,this.one("ready",this.trackProgress)},t.manualProgressOff=function(){this.manualProgress=!1,this.stopTrackingProgress(),this.off("durationchange",this.onDurationChange)},t.trackProgress=function(t){this.stopTrackingProgress(),this.progressInterval=this.setInterval(Ht(this,function(){var t=this.bufferedPercent();this.bufferedPercent_!==t&&this.trigger("progress"),1===(this.bufferedPercent_=t)&&this.stopTrackingProgress()}),500)},t.onDurationChange=function(t){this.duration_=this.duration()},t.buffered=function(){return be(0,0)},t.bufferedPercent=function(){return we(this.buffered(),this.duration_)},t.stopTrackingProgress=function(){this.clearInterval(this.progressInterval)},t.manualTimeUpdatesOn=function(){this.manualTimeUpdates=!0,this.on("play",this.trackCurrentTime),this.on("pause",this.stopTrackingCurrentTime)},t.manualTimeUpdatesOff=function(){this.manualTimeUpdates=!1,this.stopTrackingCurrentTime(),this.off("play",this.trackCurrentTime),this.off("pause",this.stopTrackingCurrentTime)},t.trackCurrentTime=function(){this.currentTimeInterval&&this.stopTrackingCurrentTime(),this.currentTimeInterval=this.setInterval(function(){this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},250)},t.stopTrackingCurrentTime=function(){this.clearInterval(this.currentTimeInterval),this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},t.dispose=function(){this.clearTracks(mi.names),this.manualProgress&&this.manualProgressOff(),this.manualTimeUpdates&&this.manualTimeUpdatesOff(),n.prototype.dispose.call(this)},t.clearTracks=function(t){var r=this;(t=[].concat(t)).forEach(function(t){for(var e=r[t+"Tracks"]()||[],i=e.length;i--;){var n=e[i];"text"===t&&r.removeRemoteTextTrack(n),e.removeTrack(n)}})},t.cleanupAutoTextTracks=function(){for(var t=this.autoRemoteTextTracks_||[],e=t.length;e--;){var i=t[e];this.removeRemoteTextTrack(i)}},t.reset=function(){},t.crossOrigin=function(){},t.setCrossOrigin=function(){},t.error=function(t){return void 0!==t&&(this.error_=new Te(t),this.trigger("error")),this.error_},t.played=function(){return this.hasStarted_?be(0,0):be()},t.play=function(){},t.setScrubbing=function(){},t.scrubbing=function(){},t.setCurrentTime=function(){this.manualTimeUpdates&&this.trigger({type:"timeupdate",target:this,manuallyTriggered:!0})},t.initTrackListeners=function(){var r=this;mi.names.forEach(function(t){function e(){r.trigger(t+"trackchange")}var i=mi[t],n=r[i.getterName]();n.addEventListener("removetrack",e),n.addEventListener("addtrack",e),r.on("dispose",function(){n.removeEventListener("removetrack",e),n.removeEventListener("addtrack",e)})})},t.addWebVttScript_=function(){var t,e=this;d.WebVTT||(c.body.contains(this.el())?!this.options_["vtt.js"]&&T(Wi)&&0<Object.keys(Wi).length?this.trigger("vttjsloaded"):((t=c.createElement("script")).src=this.options_["vtt.js"]||"https://vjs.zencdn.net/vttjs/0.14.1/vtt.min.js",t.onload=function(){e.trigger("vttjsloaded")},t.onerror=function(){e.trigger("vttjserror")},this.on("dispose",function(){t.onload=null,t.onerror=null}),d.WebVTT=!0,this.el().parentNode.appendChild(t)):this.ready(this.addWebVttScript_))},t.emulateTextTracks=function(){function e(t){return n.addTrack(t.track)}function i(t){return n.removeTrack(t.track)}var t=this,n=this.textTracks(),r=this.remoteTextTracks();function a(){return t.trigger("texttrackchange")}function s(){a();for(var t=0;t<n.length;t++){var e=n[t];e.removeEventListener("cuechange",a),"showing"===e.mode&&e.addEventListener("cuechange",a)}}r.on("addtrack",e),r.on("removetrack",i),this.addWebVttScript_(),s(),n.addEventListener("change",s),n.addEventListener("addtrack",s),n.addEventListener("removetrack",s),this.on("dispose",function(){r.off("addtrack",e),r.off("removetrack",i),n.removeEventListener("change",s),n.removeEventListener("addtrack",s),n.removeEventListener("removetrack",s);for(var t=0;t<n.length;t++)n[t].removeEventListener("cuechange",a)})},t.addTextTrack=function(t,e,i){if(!t)throw new Error("TextTrack kind is required but was not provided");return function(t,e,i,n,r){void 0===r&&(r={});var a=t.textTracks();r.kind=e,i&&(r.label=i),n&&(r.language=n),r.tech=t;r=new vi.text.TrackClass(r);return a.addTrack(r),r}(this,t,e,i)},t.createRemoteTextTrack=function(t){t=le(t,{tech:this});return new gi.remoteTextEl.TrackClass(t)},t.addRemoteTextTrack=function(t,e){var i=this,n=this.createRemoteTextTrack(t=void 0===t?{}:t);return!0!==e&&!1!==e&&(m.warn('Calling addRemoteTextTrack without explicitly setting the "manualCleanup" parameter to `true` is deprecated and default to `false` in future version of video.js'),e=!0),this.remoteTextTrackEls().addTrackElement_(n),this.remoteTextTracks().addTrack(n.track),!0!==e&&this.ready(function(){return i.autoRemoteTextTracks_.addTrack(n.track)}),n},t.removeRemoteTextTrack=function(t){var e=this.remoteTextTrackEls().getTrackElementByTrack_(t);this.remoteTextTrackEls().removeTrackElement_(e),this.remoteTextTracks().removeTrack(t),this.autoRemoteTextTracks_.removeTrack(t)},t.getVideoPlaybackQuality=function(){return{}},t.requestPictureInPicture=function(){var t=this.options_.Promise||d.Promise;if(t)return t.reject()},t.disablePictureInPicture=function(){return!0},t.setDisablePictureInPicture=function(){},t.setPoster=function(){},t.playsinline=function(){},t.setPlaysinline=function(){},t.overrideNativeAudioTracks=function(){},t.overrideNativeVideoTracks=function(){},t.canPlayType=function(){return""},i.canPlayType=function(){return""},i.canPlaySource=function(t,e){return i.canPlayType(t.type)},i.isTech=function(t){return t.prototype instanceof i||t instanceof i||t===i},i.registerTech=function(t,e){if(i.techs_||(i.techs_={}),!i.isTech(e))throw new Error("Tech "+t+" must be a Tech");if(!i.canPlayType)throw new Error("Techs must have a static canPlayType method on them");if(!i.canPlaySource)throw new Error("Techs must have a static canPlaySource method on them");return t=oe(t),i.techs_[t]=e,i.techs_[se(t)]=e,"Tech"!==t&&i.defaultTechOrder_.push(t),e},i.getTech=function(t){if(t)return i.techs_&&i.techs_[t]?i.techs_[t]:(t=oe(t),d&&d.videojs&&d.videojs[t]?(m.warn("The "+t+" tech was added to the videojs object when it should be registered using videojs.registerTech(name, tech)"),d.videojs[t]):void 0)},i}(de);vi.names.forEach(function(t){var e=vi[t];Gi.prototype[e.getterName]=function(){return this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName]}}),Gi.prototype.featuresVolumeControl=!0,Gi.prototype.featuresMuteControl=!0,Gi.prototype.featuresFullscreenResize=!1,Gi.prototype.featuresPlaybackRate=!1,Gi.prototype.featuresProgressEvents=!1,Gi.prototype.featuresSourceset=!1,Gi.prototype.featuresTimeupdateEvents=!1,Gi.prototype.featuresNativeTextTracks=!1,Gi.withSourceHandlers=function(r){r.registerSourceHandler=function(t,e){var i=(i=r.sourceHandlers)||(r.sourceHandlers=[]);void 0===e&&(e=i.length),i.splice(e,0,t)},r.canPlayType=function(t){for(var e,i=r.sourceHandlers||[],n=0;n<i.length;n++)if(e=i[n].canPlayType(t))return e;return""},r.selectSourceHandler=function(t,e){for(var i=r.sourceHandlers||[],n=0;n<i.length;n++)if(i[n].canHandleSource(t,e))return i[n];return null},r.canPlaySource=function(t,e){var i=r.selectSourceHandler(t,e);return i?i.canHandleSource(t,e):""},["seekable","seeking","duration"].forEach(function(t){var e=this[t];"function"==typeof e&&(this[t]=function(){return this.sourceHandler_&&this.sourceHandler_[t]?this.sourceHandler_[t].apply(this.sourceHandler_,arguments):e.apply(this,arguments)})},r.prototype),r.prototype.setSource=function(t){var e=r.selectSourceHandler(t,this.options_);e||(r.nativeSourceHandler?e=r.nativeSourceHandler:m.error("No source handler found for the current source.")),this.disposeSourceHandler(),this.off("dispose",this.disposeSourceHandler),e!==r.nativeSourceHandler&&(this.currentSource_=t),this.sourceHandler_=e.handleSource(t,this,this.options_),this.one("dispose",this.disposeSourceHandler)},r.prototype.disposeSourceHandler=function(){this.currentSource_&&(this.clearTracks(["audio","video"]),this.currentSource_=null),this.cleanupAutoTextTracks(),this.sourceHandler_&&(this.sourceHandler_.dispose&&this.sourceHandler_.dispose(),this.sourceHandler_=null)}},de.registerComponent("Tech",Gi),Gi.registerTech("Tech",Gi),Gi.defaultTechOrder_=[];var Xi={},$i={},Yi={};function Ki(t,e,i){t.setTimeout(function(){return function i(n,t,r,a,s,o){void 0===n&&(n={}),void 0===s&&(s=[]),void 0===o&&(o=!1);var e=t=void 0===t?[]:t,t=e[0],l=e.slice(1);if("string"==typeof t)i(n,Xi[t],r,a,s,o);else if(t){var u=function(t,e){var i=$i[t.id()],n=null;if(null==i)return n=e(t),$i[t.id()]=[[e,n]],n;for(var r=0;r<i.length;r++){var a=i[r],s=a[0],a=a[1];s===e&&(n=a)}return null===n&&(n=e(t),i.push([e,n])),n}(a,t);if(!u.setSource)return s.push(u),i(n,l,r,a,s,o);u.setSource(b({},n),function(t,e){return t?i(n,l,r,a,s,o):(s.push(u),void i(e,n.type===e.type?l:Xi[e.type],r,a,s,o))})}else l.length?i(n,l,r,a,s,o):o?r(n,s):i(n,Xi["*"],r,a,s,!0)}(e,Xi[e.type],i,t)},1)}function Qi(t,e,i,n){void 0===n&&(n=null);var r="call"+oe(i),r=t.reduce(en(r),n),n=r===Yi,r=n?null:e[i](r);return function(t,e,i,n){for(var r=t.length-1;0<=r;r--){var a=t[r];a[e]&&a[e](n,i)}}(t,i,r,n),r}var Ji={buffered:1,currentTime:1,duration:1,muted:1,played:1,paused:1,seekable:1,volume:1},Zi={setCurrentTime:1,setMuted:1,setVolume:1},tn={play:1,pause:1};function en(i){return function(t,e){return t===Yi?Yi:e[i]?e[i](t):t}}function nn(t){t=Ne(t=void 0===t?"":t);return rn[t.toLowerCase()]||""}var rn={opus:"video/ogg",ogv:"video/ogg",mp4:"video/mp4",mov:"video/mp4",m4v:"video/mp4",mkv:"video/x-matroska",m4a:"audio/mp4",mp3:"audio/mpeg",aac:"audio/aac",caf:"audio/x-caf",flac:"audio/flac",oga:"audio/ogg",wav:"audio/wav",m3u8:"application/x-mpegURL",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",svg:"image/svg+xml",webp:"image/webp"};function an(t){var e;return t.type||(e=nn(t.src))&&(t.type=e),t}var sn,k=(ve(on,sn=de),on);function on(t,e,i){var n=le({createEl:!1},e),i=sn.call(this,t,n,i)||this;if(e.playerOptions.sources&&0!==e.playerOptions.sources.length)t.src(e.playerOptions.sources);else for(var r=0,a=e.playerOptions.techOrder;r<a.length;r++){var s=oe(a[r]),o=Gi.getTech(s);if((o=!s?de.getComponent(s):o)&&o.isSupported()){t.loadTech_(s);break}}return i}de.registerComponent("MediaLoader",k);C=function(n){function t(t,e){return(e=n.call(this,t,e)||this).emitTapEvents(),e.enable(),e}ve(t,n);var e=t.prototype;return e.createEl=function(t,e,i){void 0===t&&(t="div"),void 0===e&&(e={}),void 0===i&&(i={}),e=b({innerHTML:'<span aria-hidden="true" class="vjs-icon-placeholder"></span>',className:this.buildCSSClass(),tabIndex:0},e),"button"===t&&m.error("Creating a ClickableComponent with an HTML element of "+t+" is not supported; use a Button instead."),i=b({role:"button"},i),this.tabIndex_=e.tabIndex;i=n.prototype.createEl.call(this,t,e,i);return this.createControlTextEl(i),i},e.dispose=function(){this.controlTextEl_=null,n.prototype.dispose.call(this)},e.createControlTextEl=function(t){return this.controlTextEl_=Q("span",{className:"vjs-control-text"},{"aria-live":"polite"}),t&&t.appendChild(this.controlTextEl_),this.controlText(this.controlText_,t),this.controlTextEl_},e.controlText=function(t,e){if(void 0===e&&(e=this.el()),void 0===t)return this.controlText_||"Need Text";var i=this.localize(t);this.controlText_=t,J(this.controlTextEl_,i),this.nonIconControl||e.setAttribute("title",i)},e.buildCSSClass=function(){return"vjs-control vjs-button "+n.prototype.buildCSSClass.call(this)},e.enable=function(){this.enabled_||(this.enabled_=!0,this.removeClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","false"),void 0!==this.tabIndex_&&this.el_.setAttribute("tabIndex",this.tabIndex_),this.on(["tap","click"],this.handleClick),this.on("keydown",this.handleKeyDown))},e.disable=function(){this.enabled_=!1,this.addClass("vjs-disabled"),this.el_.setAttribute("aria-disabled","true"),void 0!==this.tabIndex_&&this.el_.removeAttribute("tabIndex"),this.off("mouseover",this.handleMouseOver),this.off("mouseout",this.handleMouseOut),this.off(["tap","click"],this.handleClick),this.off("keydown",this.handleKeyDown)},e.handleLanguagechange=function(){this.controlText(this.controlText_)},e.handleClick=function(t){this.options_.clickHandler&&this.options_.clickHandler.call(this,arguments)},e.handleKeyDown=function(t){Ce.isEventKey(t,"Space")||Ce.isEventKey(t,"Enter")?(t.preventDefault(),t.stopPropagation(),this.trigger("click")):n.prototype.handleKeyDown.call(this,t)},t}(de);de.registerComponent("ClickableComponent",C);B=function(i){function t(t,e){return(e=i.call(this,t,e)||this).update(),t.on("posterchange",Ht(ge(e),e.update)),e}ve(t,i);var e=t.prototype;return e.dispose=function(){this.player().off("posterchange",this.update),i.prototype.dispose.call(this)},e.createEl=function(){return Q("div",{className:"vjs-poster",tabIndex:-1})},e.update=function(t){var e=this.player().poster();this.setSrc(e),e?this.show():this.hide()},e.setSrc=function(t){t=t?'url("'+t+'")':"";this.el_.style.backgroundImage=t},e.handleClick=function(t){var e;this.player_.controls()&&(e=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&0<this.player_.eme.sessions.length,!this.player_.tech(!0)||(N||L)&&e||this.player_.tech(!0).focus(),this.player_.paused()?Ee(this.player_.play()):this.player_.pause())},t}(C);de.registerComponent("PosterImage",B);var ln="#222",un={monospace:"monospace",sansSerif:"sans-serif",serif:"serif",monospaceSansSerif:'"Andale Mono", "Lucida Console", monospace',monospaceSerif:'"Courier New", monospace',proportionalSansSerif:"sans-serif",proportionalSerif:"serif",casual:'"Comic Sans MS", Impact, fantasy',script:'"Monotype Corsiva", cursive',smallcaps:'"Andale Mono", "Lucida Console", monospace, sans-serif'};function hn(t,e){var i;if(4===t.length)i=t[1]+t[1]+t[2]+t[2]+t[3]+t[3];else{if(7!==t.length)throw new Error("Invalid color code provided, "+t+"; must be formatted as e.g. #f0e or #f604e2.");i=t.slice(1)}return"rgba("+parseInt(i.slice(0,2),16)+","+parseInt(i.slice(2,4),16)+","+parseInt(i.slice(4,6),16)+","+e+")"}function cn(t,e,i){try{t.style[e]=i}catch(t){return}}$e=function(r){function t(i,t,e){var e=r.call(this,i,t,e)||this,n=Ht(ge(e),e.updateDisplay);return i.on("loadstart",Ht(ge(e),e.toggleDisplay)),i.on("texttrackchange",n),i.on("loadedmetadata",Ht(ge(e),e.preselectTrack)),i.ready(Ht(ge(e),function(){if(i.tech_&&i.tech_.featuresNativeTextTracks)this.hide();else{i.on("fullscreenchange",n),i.on("playerresize",n),d.addEventListener("orientationchange",n),i.on("dispose",function(){return d.removeEventListener("orientationchange",n)});for(var t=this.options_.playerOptions.tracks||[],e=0;e<t.length;e++)this.player_.addRemoteTextTrack(t[e],!0);this.preselectTrack()}})),e}ve(t,r);var e=t.prototype;return e.preselectTrack=function(){for(var t,e,i,n={captions:1,subtitles:1},r=this.player_.textTracks(),a=this.player_.cache_.selectedLanguage,s=0;s<r.length;s++){var o=r[s];a&&a.enabled&&a.language&&a.language===o.language&&o.kind in n?i=o.kind!==a.kind&&i||o:a&&!a.enabled?e=t=i=null:o.default&&("descriptions"!==o.kind||t?o.kind in n&&!e&&(e=o):t=o)}i?i.mode="showing":e?e.mode="showing":t&&(t.mode="showing")},e.toggleDisplay=function(){this.player_.tech_&&this.player_.tech_.featuresNativeTextTracks?this.hide():this.show()},e.createEl=function(){return r.prototype.createEl.call(this,"div",{className:"vjs-text-track-display"},{"aria-live":"off","aria-atomic":"true"})},e.clearDisplay=function(){"function"==typeof d.WebVTT&&d.WebVTT.processCues(d,[],this.el_)},e.updateDisplay=function(){var t=this.player_.textTracks(),e=this.options_.allowMultipleShowingTracks;if(this.clearDisplay(),e){for(var i=[],n=0;n<t.length;++n){var r=t[n];"showing"===r.mode&&i.push(r)}this.updateForTrack(i)}else{for(var a=null,s=null,o=t.length;o--;){var l=t[o];"showing"===l.mode&&("descriptions"===l.kind?a=l:s=l)}s?("off"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","off"),this.updateForTrack(s)):a&&("assertive"!==this.getAttribute("aria-live")&&this.setAttribute("aria-live","assertive"),this.updateForTrack(a))}},e.updateDisplayState=function(t){for(var e=this.player_.textTrackSettings.getValues(),i=t.activeCues,n=i.length;n--;){var r,a=i[n];a&&(r=a.displayState,e.color&&(r.firstChild.style.color=e.color),e.textOpacity&&cn(r.firstChild,"color",hn(e.color||"#fff",e.textOpacity)),e.backgroundColor&&(r.firstChild.style.backgroundColor=e.backgroundColor),e.backgroundOpacity&&cn(r.firstChild,"backgroundColor",hn(e.backgroundColor||"#000",e.backgroundOpacity)),e.windowColor&&(e.windowOpacity?cn(r,"backgroundColor",hn(e.windowColor,e.windowOpacity)):r.style.backgroundColor=e.windowColor),e.edgeStyle&&("dropshadow"===e.edgeStyle?r.firstChild.style.textShadow="2px 2px 3px #222, 2px 2px 4px #222, 2px 2px 5px "+ln:"raised"===e.edgeStyle?r.firstChild.style.textShadow="1px 1px #222, 2px 2px #222, 3px 3px "+ln:"depressed"===e.edgeStyle?r.firstChild.style.textShadow="1px 1px #ccc, 0 1px #ccc, -1px -1px #222, 0 -1px "+ln:"uniform"===e.edgeStyle&&(r.firstChild.style.textShadow="0 0 4px #222, 0 0 4px #222, 0 0 4px #222, 0 0 4px "+ln)),e.fontPercent&&1!==e.fontPercent&&(a=d.parseFloat(r.style.fontSize),r.style.fontSize=a*e.fontPercent+"px",r.style.height="auto",r.style.top="auto"),e.fontFamily&&"default"!==e.fontFamily&&("small-caps"===e.fontFamily?r.firstChild.style.fontVariant="small-caps":r.firstChild.style.fontFamily=un[e.fontFamily]))}},e.updateForTrack=function(t){if(Array.isArray(t)||(t=[t]),"function"==typeof d.WebVTT&&!t.every(function(t){return!t.activeCues})){for(var e=[],i=0;i<t.length;++i)for(var n=t[i],r=0;r<n.activeCues.length;++r)e.push(n.activeCues[r]);d.WebVTT.processCues(d,e,this.el_);for(var a=0;a<t.length;++a){for(var s=t[a],o=0;o<s.activeCues.length;++o){var l=s.activeCues[o].displayState;et(l,"vjs-text-track-cue"),et(l,"vjs-text-track-cue-"+(s.language||a))}this.player_.textTrackSettings&&this.updateDisplayState(s)}}},t}(de);de.registerComponent("TextTrackDisplay",$e);var dn,ii=(ve(pn,dn=de),pn.prototype.createEl=function(){var t=this.player_.isAudio(),e=this.localize(t?"Audio Player":"Video Player"),t=Q("span",{className:"vjs-control-text",innerHTML:this.localize("{1} is loading.",[e])}),e=dn.prototype.createEl.call(this,"div",{className:"vjs-loading-spinner",dir:"ltr"});return e.appendChild(t),e},pn);function pn(){return dn.apply(this,arguments)||this}de.registerComponent("LoadingSpinner",ii);var fn=function(e){function t(){return e.apply(this,arguments)||this}ve(t,e);var i=t.prototype;return i.createEl=function(t,e,i){void 0===e&&(e={}),void 0===i&&(i={}),e=b({innerHTML:'<span aria-hidden="true" class="vjs-icon-placeholder"></span>',className:this.buildCSSClass()},e),i=b({type:"button"},i);i=de.prototype.createEl.call(this,"button",e,i);return this.createControlTextEl(i),i},i.addChild=function(t,e){void 0===e&&(e={});var i=this.constructor.name;return m.warn("Adding an actionable (user controllable) child to a Button ("+i+") is not supported; use a ClickableComponent instead."),de.prototype.addChild.call(this,t,e)},i.enable=function(){e.prototype.enable.call(this),this.el_.removeAttribute("disabled")},i.disable=function(){e.prototype.disable.call(this),this.el_.setAttribute("disabled","disabled")},i.handleKeyDown=function(t){Ce.isEventKey(t,"Space")||Ce.isEventKey(t,"Enter")?t.stopPropagation():e.prototype.handleKeyDown.call(this,t)},t}(C);de.registerComponent("Button",fn);j=function(i){function t(t,e){return(e=i.call(this,t,e)||this).mouseused_=!1,e.on("mousedown",e.handleMouseDown),e}ve(t,i);var e=t.prototype;return e.buildCSSClass=function(){return"vjs-big-play-button"},e.handleClick=function(t){var e=this.player_.play();if(this.mouseused_&&t.clientX&&t.clientY){var i=this.player_.usingPlugin("eme")&&this.player_.eme.sessions&&0<this.player_.eme.sessions.length;return Ee(e),void(!this.player_.tech(!0)||(N||L)&&i||this.player_.tech(!0).focus())}var i=this.player_.getChild("controlBar"),n=i&&i.getChild("playToggle");n?(i=function(){return n.focus()},Se(e)?e.then(i,function(){}):this.setTimeout(i,1)):this.player_.tech(!0).focus()},e.handleKeyDown=function(t){this.mouseused_=!1,i.prototype.handleKeyDown.call(this,t)},e.handleMouseDown=function(t){this.mouseused_=!0},t}(fn);j.prototype.controlText_="Play Video",de.registerComponent("BigPlayButton",j);Ue=function(i){function t(t,e){return(t=i.call(this,t,e)||this).controlText(e&&e.controlText||t.localize("Close")),t}ve(t,i);var e=t.prototype;return e.buildCSSClass=function(){return"vjs-close-button "+i.prototype.buildCSSClass.call(this)},e.handleClick=function(t){this.trigger({type:"close",bubbles:!1})},e.handleKeyDown=function(t){Ce.isEventKey(t,"Esc")?(t.preventDefault(),t.stopPropagation(),this.trigger("click")):i.prototype.handleKeyDown.call(this,t)},t}(fn);de.registerComponent("CloseButton",Ue);je=function(n){function t(t,e){var i=n.call(this,t,e=void 0===e?{}:e)||this;return e.replay=void 0===e.replay||e.replay,i.on(t,"play",i.handlePlay),i.on(t,"pause",i.handlePause),e.replay&&i.on(t,"ended",i.handleEnded),i}ve(t,n);var e=t.prototype;return e.buildCSSClass=function(){return"vjs-play-control "+n.prototype.buildCSSClass.call(this)},e.handleClick=function(t){this.player_.paused()?this.player_.play():this.player_.pause()},e.handleSeeked=function(t){this.removeClass("vjs-ended"),this.player_.paused()?this.handlePause(t):this.handlePlay(t)},e.handlePlay=function(t){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.controlText("Pause")},e.handlePause=function(t){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.controlText("Play")},e.handleEnded=function(t){this.removeClass("vjs-playing"),this.addClass("vjs-ended"),this.controlText("Replay"),this.one(this.player_,"seeked",this.handleSeeked)},t}(fn);function mn(t,e){t=t<0?0:t;var i=Math.floor(t%60),n=Math.floor(t/60%60),r=Math.floor(t/3600),a=Math.floor(e/60%60),e=Math.floor(e/3600);return(r=0<(r=isNaN(t)||t===1/0?n=i="-":r)||0<e?r+":":"")+(n=((r||10<=a)&&n<10?"0"+n:n)+":")+(i<10?"0"+i:i)}je.prototype.controlText_="Play",de.registerComponent("PlayToggle",je);var gn=mn;function vn(t,e){return gn(t,e=void 0===e?t:e)}qe=function(i){function t(t,e){return(e=i.call(this,t,e)||this).on(t,["timeupdate","ended"],e.updateContent),e.updateTextNode_(),e}ve(t,i);var e=t.prototype;return e.createEl=function(){var t=this.buildCSSClass(),e=i.prototype.createEl.call(this,"div",{className:t+" vjs-time-control vjs-control",innerHTML:'<span class="vjs-control-text" role="presentation">'+this.localize(this.labelText_)+" </span>"});return this.contentEl_=Q("span",{className:t+"-display"},{"aria-live":"off",role:"presentation"}),e.appendChild(this.contentEl_),e},e.dispose=function(){this.contentEl_=null,this.textNode_=null,i.prototype.dispose.call(this)},e.updateTextNode_=function(t){var e=this;t=vn(t=void 0===t?0:t),this.formattedTime_!==t&&(this.formattedTime_=t,this.requestNamedAnimationFrame("TimeDisplay#updateTextNode_",function(){var t;e.contentEl_&&((t=e.textNode_)&&e.contentEl_.firstChild!==t&&(t=null,m.warn("TimeDisplay#updateTextnode_: Prevented replacement of text node element since it was no longer a child of this node. Appending a new node instead.")),e.textNode_=c.createTextNode(e.formattedTime_),e.textNode_&&(t?e.contentEl_.replaceChild(e.textNode_,t):e.contentEl_.appendChild(e.textNode_)))}))},e.updateContent=function(t){},t}(de);qe.prototype.labelText_="Time",qe.prototype.controlText_="Time",de.registerComponent("TimeDisplay",qe);I=function(t){function e(){return t.apply(this,arguments)||this}ve(e,t);var i=e.prototype;return i.buildCSSClass=function(){return"vjs-current-time"},i.updateContent=function(t){var e=this.player_.ended()?this.player_.duration():this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime();this.updateTextNode_(e)},e}(qe);I.prototype.labelText_="Current Time",I.prototype.controlText_="Current Time",de.registerComponent("CurrentTimeDisplay",I);he=function(i){function t(t,e){return(e=i.call(this,t,e)||this).on(t,"durationchange",e.updateContent),e.on(t,"loadstart",e.updateContent),e.on(t,"loadedmetadata",e.updateContent),e}ve(t,i);var e=t.prototype;return e.buildCSSClass=function(){return"vjs-duration"},e.updateContent=function(t){var e=this.player_.duration();this.updateTextNode_(e)},t}(qe);he.prototype.labelText_="Duration",he.prototype.controlText_="Duration",de.registerComponent("DurationDisplay",he);var yn,k=(ve(_n,yn=de),_n.prototype.createEl=function(){return yn.prototype.createEl.call(this,"div",{className:"vjs-time-control vjs-time-divider",innerHTML:"<div><span>/</span></div>"},{"aria-hidden":!0})},_n);function _n(){return yn.apply(this,arguments)||this}de.registerComponent("TimeDivider",k);B=function(i){function t(t,e){return(e=i.call(this,t,e)||this).on(t,"durationchange",e.updateContent),e}ve(t,i);var e=t.prototype;return e.buildCSSClass=function(){return"vjs-remaining-time"},e.createEl=function(){var t=i.prototype.createEl.call(this);return t.insertBefore(Q("span",{},{"aria-hidden":!0},"-"),this.contentEl_),t},e.updateContent=function(t){var e;"number"==typeof this.player_.duration()&&(e=this.player_.ended()?0:this.player_.remainingTimeDisplay?this.player_.remainingTimeDisplay():this.player_.remainingTime(),this.updateTextNode_(e))},t}(qe);B.prototype.labelText_="Remaining Time",B.prototype.controlText_="Remaining Time",de.registerComponent("RemainingTimeDisplay",B);$e=function(i){function t(t,e){return(e=i.call(this,t,e)||this).updateShowing(),e.on(e.player(),"durationchange",e.updateShowing),e}ve(t,i);var e=t.prototype;return e.createEl=function(){var t=i.prototype.createEl.call(this,"div",{className:"vjs-live-control vjs-control"});return this.contentEl_=Q("div",{className:"vjs-live-display",innerHTML:'<span class="vjs-control-text">'+this.localize("Stream Type")+" </span>"+this.localize("LIVE")},{"aria-live":"off"}),t.appendChild(this.contentEl_),t},e.dispose=function(){this.contentEl_=null,i.prototype.dispose.call(this)},e.updateShowing=function(t){this.player().duration()===1/0?this.show():this.hide()},t}(de);de.registerComponent("LiveDisplay",$e);ii=function(i){function t(t,e){return(e=i.call(this,t,e)||this).updateLiveEdgeStatus(),e.player_.liveTracker&&e.on(e.player_.liveTracker,"liveedgechange",e.updateLiveEdgeStatus),e}ve(t,i);var e=t.prototype;return e.createEl=function(){var t=i.prototype.createEl.call(this,"button",{className:"vjs-seek-to-live-control vjs-control"});return this.textEl_=Q("span",{className:"vjs-seek-to-live-text",innerHTML:this.localize("LIVE")},{"aria-hidden":"true"}),t.appendChild(this.textEl_),t},e.updateLiveEdgeStatus=function(){!this.player_.liveTracker||this.player_.liveTracker.atLiveEdge()?(this.setAttribute("aria-disabled",!0),this.addClass("vjs-at-live-edge"),this.controlText("Seek to live, currently playing live")):(this.setAttribute("aria-disabled",!1),this.removeClass("vjs-at-live-edge"),this.controlText("Seek to live, currently behind live"))},e.handleClick=function(){this.player_.liveTracker.seekToLiveEdge()},e.dispose=function(){this.player_.liveTracker&&this.off(this.player_.liveTracker,"liveedgechange",this.updateLiveEdgeStatus),this.textEl_=null,i.prototype.dispose.call(this)},t}(fn);function bn(t,e,i){return t=Number(t),Math.min(i,Math.max(e,isNaN(t)?e:t))}ii.prototype.controlText_="Seek to live, currently playing live",de.registerComponent("SeekToLive",ii);j=function(n){function t(t,e){return(e=n.call(this,t,e)||this).bar=e.getChild(e.options_.barName),e.vertical(!!e.options_.vertical),e.enable(),e}ve(t,n);var e=t.prototype;return e.enabled=function(){return this.enabled_},e.enable=function(){this.enabled()||(this.on("mousedown",this.handleMouseDown),this.on("touchstart",this.handleMouseDown),this.on("keydown",this.handleKeyDown),this.on("click",this.handleClick),this.on(this.player_,"controlsvisible",this.update),this.playerEvent&&this.on(this.player_,this.playerEvent,this.update),this.removeClass("disabled"),this.setAttribute("tabindex",0),this.enabled_=!0)},e.disable=function(){var t;this.enabled()&&(t=this.bar.el_.ownerDocument,this.off("mousedown",this.handleMouseDown),this.off("touchstart",this.handleMouseDown),this.off("keydown",this.handleKeyDown),this.off("click",this.handleClick),this.off(this.player_,"controlsvisible",this.update),this.off(t,"mousemove",this.handleMouseMove),this.off(t,"mouseup",this.handleMouseUp),this.off(t,"touchmove",this.handleMouseMove),this.off(t,"touchend",this.handleMouseUp),this.removeAttribute("tabindex"),this.addClass("disabled"),this.playerEvent&&this.off(this.player_,this.playerEvent,this.update),this.enabled_=!1)},e.createEl=function(t,e,i){return void 0===i&&(i={}),(e=void 0===e?{}:e).className=e.className+" vjs-slider",e=b({tabIndex:0},e),i=b({role:"slider","aria-valuenow":0,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0},i),n.prototype.createEl.call(this,t,e,i)},e.handleMouseDown=function(t){var e=this.bar.el_.ownerDocument;"mousedown"===t.type&&t.preventDefault(),"touchstart"!==t.type||M||t.preventDefault(),ut(),this.addClass("vjs-sliding"),this.trigger("slideractive"),this.on(e,"mousemove",this.handleMouseMove),this.on(e,"mouseup",this.handleMouseUp),this.on(e,"touchmove",this.handleMouseMove),this.on(e,"touchend",this.handleMouseUp),this.handleMouseMove(t)},e.handleMouseMove=function(t){},e.handleMouseUp=function(){var t=this.bar.el_.ownerDocument;ht(),this.removeClass("vjs-sliding"),this.trigger("sliderinactive"),this.off(t,"mousemove",this.handleMouseMove),this.off(t,"mouseup",this.handleMouseUp),this.off(t,"touchmove",this.handleMouseMove),this.off(t,"touchend",this.handleMouseUp),this.update()},e.update=function(){var e=this;if(this.el_&&this.bar){var i=this.getProgress();return i===this.progress_||(this.progress_=i,this.requestNamedAnimationFrame("Slider#update",function(){var t=e.vertical()?"height":"width";e.bar.el().style[t]=(100*i).toFixed(2)+"%"})),i}},e.getProgress=function(){return Number(bn(this.getPercent(),0,1).toFixed(4))},e.calculateDistance=function(t){t=pt(this.el_,t);return this.vertical()?t.y:t.x},e.handleKeyDown=function(t){Ce.isEventKey(t,"Left")||Ce.isEventKey(t,"Down")?(t.preventDefault(),t.stopPropagation(),this.stepBack()):Ce.isEventKey(t,"Right")||Ce.isEventKey(t,"Up")?(t.preventDefault(),t.stopPropagation(),this.stepForward()):n.prototype.handleKeyDown.call(this,t)},e.handleClick=function(t){t.stopPropagation(),t.preventDefault()},e.vertical=function(t){if(void 0===t)return this.vertical_||!1;this.vertical_=!!t,this.vertical_?this.addClass("vjs-slider-vertical"):this.addClass("vjs-slider-horizontal")},t}(de);function wn(t,e){return bn(t/e*100,0,100).toFixed(2)+"%"}de.registerComponent("Slider",j);Ue=function(r){function t(t,e){return(e=r.call(this,t,e)||this).partEls_=[],e.on(t,"progress",e.update),e}ve(t,r);var e=t.prototype;return e.createEl=function(){var t=r.prototype.createEl.call(this,"div",{className:"vjs-load-progress"}),e=Q("span",{className:"vjs-control-text"}),i=Q("span",{textContent:this.localize("Loaded")}),n=c.createTextNode(": ");return this.percentageEl_=Q("span",{className:"vjs-control-text-loaded-percentage",textContent:"0%"}),t.appendChild(e),e.appendChild(i),e.appendChild(n),e.appendChild(this.percentageEl_),t},e.dispose=function(){this.partEls_=null,this.percentageEl_=null,r.prototype.dispose.call(this)},e.update=function(t){var u=this;this.requestNamedAnimationFrame("LoadProgressBar#update",function(){var t=u.player_.liveTracker,e=u.player_.buffered(),t=t&&t.isLive()?t.seekableEnd():u.player_.duration(),i=u.player_.bufferedEnd(),n=u.partEls_,t=wn(i,t);u.percent_!==t&&(u.el_.style.width=t,J(u.percentageEl_,t),u.percent_=t);for(var r=0;r<e.length;r++){var a=e.start(r),s=e.end(r),o=n[r];o||(o=u.el_.appendChild(Q()),n[r]=o),o.dataset.start===a&&o.dataset.end===s||(o.dataset.start=a,o.dataset.end=s,o.style.left=wn(a,i),o.style.width=wn(s-a,i))}for(var l=n.length;l>e.length;l--)u.el_.removeChild(n[l-1]);n.length=e.length})},t}(de);de.registerComponent("LoadProgressBar",Ue);je=function(i){function t(t,e){return(e=i.call(this,t,e)||this).update=Vt(Ht(ge(e),e.update),30),e}ve(t,i);var e=t.prototype;return e.createEl=function(){return i.prototype.createEl.call(this,"div",{className:"vjs-time-tooltip"},{"aria-hidden":"true"})},e.update=function(t,e,i){var n=dt(this.el_),r=ct(this.player_.el()),a=t.width*e;r&&n&&(e=t.left-r.left+a,r=t.width-a+(r.right-t.right),e<(t=n.width/2)?t+=t-e:r<t&&(t=r),t<0?t=0:t>n.width&&(t=n.width),t=Math.round(t),this.el_.style.right="-"+t+"px",this.write(i))},e.write=function(t){J(this.el_,t)},e.updateTime=function(n,r,a,s){var o=this;this.requestNamedAnimationFrame("TimeTooltip#updateTime",function(){var t,e,i=o.player_.duration();i=o.player_.liveTracker&&o.player_.liveTracker.isLive()?((e=(t=o.player_.liveTracker.liveWindow())-r*t)<1?"":"-")+vn(e,t):vn(a,i),o.update(n,r,i),s&&s()})},t}(de);de.registerComponent("TimeTooltip",je);I=function(i){function t(t,e){return(e=i.call(this,t,e)||this).update=Vt(Ht(ge(e),e.update),30),e}ve(t,i);var e=t.prototype;return e.createEl=function(){return i.prototype.createEl.call(this,"div",{className:"vjs-play-progress vjs-slider-bar"},{"aria-hidden":"true"})},e.update=function(t,e){var i,n=this.getChild("timeTooltip");n&&(i=this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime(),n.updateTime(t,e,i))},t}(de);I.prototype.options_={children:[]},z||A||I.prototype.options_.children.push("timeTooltip"),de.registerComponent("PlayProgressBar",I);he=function(i){function t(t,e){return(e=i.call(this,t,e)||this).update=Vt(Ht(ge(e),e.update),30),e}ve(t,i);var e=t.prototype;return e.createEl=function(){return i.prototype.createEl.call(this,"div",{className:"vjs-mouse-display"})},e.update=function(t,e){var i=this,n=e*this.player_.duration();this.getChild("timeTooltip").updateTime(t,e,n,function(){i.el_.style.left=t.width*e+"px"})},t}(de);he.prototype.options_={children:["timeTooltip"]},de.registerComponent("MouseTimeDisplay",he);k=function(i){function t(t,e){return(e=i.call(this,t,e)||this).setEventHandlers_(),e}ve(t,i);var e=t.prototype;return e.setEventHandlers_=function(){this.update_=Ht(this,this.update),this.update=Vt(this.update_,30),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.on(this.player_,["playing"],this.enableInterval_),this.on(this.player_,["ended","pause","waiting"],this.disableInterval_),"hidden"in c&&"visibilityState"in c&&this.on(c,"visibilitychange",this.toggleVisibility_)},e.toggleVisibility_=function(t){"hidden"===c.visibilityState?(this.cancelNamedAnimationFrame("SeekBar#update"),this.cancelNamedAnimationFrame("Slider#update"),this.disableInterval_(t)):(this.player_.ended()||this.player_.paused()||this.enableInterval_(),this.update())},e.enableInterval_=function(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,30))},e.disableInterval_=function(t){this.player_.liveTracker&&this.player_.liveTracker.isLive()&&t&&"ended"!==t.type||this.updateInterval&&(this.clearInterval(this.updateInterval),this.updateInterval=null)},e.createEl=function(){return i.prototype.createEl.call(this,"div",{className:"vjs-progress-holder"},{"aria-label":this.localize("Progress Bar")})},e.update=function(t){var n=this;if("hidden"!==c.visibilityState){var r=i.prototype.update.call(this);return this.requestNamedAnimationFrame("SeekBar#update",function(){var t=n.player_.ended()?n.player_.duration():n.getCurrentTime_(),e=n.player_.liveTracker,i=n.player_.duration();e&&e.isLive()&&(i=n.player_.liveTracker.liveCurrentTime()),n.percent_!==r&&(n.el_.setAttribute("aria-valuenow",(100*r).toFixed(2)),n.percent_=r),n.currentTime_===t&&n.duration_===i||(n.el_.setAttribute("aria-valuetext",n.localize("progress bar timing: currentTime={1} duration={2}",[vn(t,i),vn(i,i)],"{1} of {2}")),n.currentTime_=t,n.duration_=i),n.bar&&n.bar.update(ct(n.el()),n.getProgress())}),r}},e.getCurrentTime_=function(){return this.player_.scrubbing()?this.player_.getCache().currentTime:this.player_.currentTime()},e.getPercent=function(){var t,e=this.getCurrentTime_(),i=this.player_.liveTracker;return i&&i.isLive()?(t=(e-i.seekableStart())/i.liveWindow(),i.atLiveEdge()&&(t=1)):t=e/this.player_.duration(),t},e.handleMouseDown=function(t){_t(t)&&(t.stopPropagation(),this.player_.scrubbing(!0),this.videoWasPlaying=!this.player_.paused(),this.player_.pause(),i.prototype.handleMouseDown.call(this,t))},e.handleMouseMove=function(t){if(_t(t)){var e,i=this.calculateDistance(t),n=this.player_.liveTracker;if(n&&n.isLive()){if(.99<=i)return void n.seekToLiveEdge();var r=n.seekableStart(),t=n.liveCurrentTime();if((e=(e=t<=(e=r+i*n.liveWindow())?t:e)<=r?r+.1:e)===1/0)return}else(e=i*this.player_.duration())===this.player_.duration()&&(e-=.1);this.player_.currentTime(e)}},e.enable=function(){i.prototype.enable.call(this);var t=this.getChild("mouseTimeDisplay");t&&t.show()},e.disable=function(){i.prototype.disable.call(this);var t=this.getChild("mouseTimeDisplay");t&&t.hide()},e.handleMouseUp=function(t){i.prototype.handleMouseUp.call(this,t),t&&t.stopPropagation(),this.player_.scrubbing(!1),this.player_.trigger({type:"timeupdate",target:this,manuallyTriggered:!0}),this.videoWasPlaying?Ee(this.player_.play()):this.update_()},e.stepForward=function(){this.player_.currentTime(this.player_.currentTime()+5)},e.stepBack=function(){this.player_.currentTime(this.player_.currentTime()-5)},e.handleAction=function(t){this.player_.paused()?this.player_.play():this.player_.pause()},e.handleKeyDown=function(t){var e;Ce.isEventKey(t,"Space")||Ce.isEventKey(t,"Enter")?(t.preventDefault(),t.stopPropagation(),this.handleAction(t)):Ce.isEventKey(t,"Home")?(t.preventDefault(),t.stopPropagation(),this.player_.currentTime(0)):Ce.isEventKey(t,"End")?(t.preventDefault(),t.stopPropagation(),this.player_.currentTime(this.player_.duration())):/^[0-9]$/.test(Ce(t))?(t.preventDefault(),t.stopPropagation(),e=10*(Ce.codes[Ce(t)]-Ce.codes[0])/100,this.player_.currentTime(this.player_.duration()*e)):Ce.isEventKey(t,"PgDn")?(t.preventDefault(),t.stopPropagation(),this.player_.currentTime(this.player_.currentTime()-60)):Ce.isEventKey(t,"PgUp")?(t.preventDefault(),t.stopPropagation(),this.player_.currentTime(this.player_.currentTime()+60)):i.prototype.handleKeyDown.call(this,t)},e.dispose=function(){this.disableInterval_(),this.off(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.off(this.player_,["playing"],this.enableInterval_),this.off(this.player_,["ended","pause","waiting"],this.disableInterval_),"hidden"in c&&"visibilityState"in c&&this.off(c,"visibilitychange",this.toggleVisibility_),i.prototype.dispose.call(this)},t}(j);k.prototype.options_={children:["loadProgressBar","playProgressBar"],barName:"playProgressBar"},z||A||k.prototype.options_.children.splice(1,0,"mouseTimeDisplay"),de.registerComponent("SeekBar",k);qe=function(i){function t(t,e){return(e=i.call(this,t,e)||this).handleMouseMove=Vt(Ht(ge(e),e.handleMouseMove),30),e.throttledHandleMouseSeek=Vt(Ht(ge(e),e.handleMouseSeek),30),e.enable(),e}ve(t,i);var e=t.prototype;return e.createEl=function(){return i.prototype.createEl.call(this,"div",{className:"vjs-progress-control vjs-control"})},e.handleMouseMove=function(t){var e,i,n,r,a=this.getChild("seekBar");a&&(e=a.getChild("playProgressBar"),i=a.getChild("mouseTimeDisplay"),(e||i)&&(r=dt(n=a.el()),t=bn(t=pt(n,t).x,0,1),i&&i.update(r,t),e&&e.update(r,a.getProgress())))},e.handleMouseSeek=function(t){var e=this.getChild("seekBar");e&&e.handleMouseMove(t)},e.enabled=function(){return this.enabled_},e.disable=function(){var t;this.children().forEach(function(t){return t.disable&&t.disable()}),this.enabled()&&(this.off(["mousedown","touchstart"],this.handleMouseDown),this.off(this.el_,"mousemove",this.handleMouseMove),this.removeListenersAddedOnMousedownAndTouchstart(),this.addClass("disabled"),this.enabled_=!1,this.player_.scrubbing())&&(t=this.getChild("seekBar"),this.player_.scrubbing(!1),t.videoWasPlaying&&Ee(this.player_.play()))},e.enable=function(){this.children().forEach(function(t){return t.enable&&t.enable()}),this.enabled()||(this.on(["mousedown","touchstart"],this.handleMouseDown),this.on(this.el_,"mousemove",this.handleMouseMove),this.removeClass("disabled"),this.enabled_=!0)},e.removeListenersAddedOnMousedownAndTouchstart=function(){var t=this.el_.ownerDocument;this.off(t,"mousemove",this.throttledHandleMouseSeek),this.off(t,"touchmove",this.throttledHandleMouseSeek),this.off(t,"mouseup",this.handleMouseUp),this.off(t,"touchend",this.handleMouseUp)},e.handleMouseDown=function(t){var e=this.el_.ownerDocument,i=this.getChild("seekBar");i&&i.handleMouseDown(t),this.on(e,"mousemove",this.throttledHandleMouseSeek),this.on(e,"touchmove",this.throttledHandleMouseSeek),this.on(e,"mouseup",this.handleMouseUp),this.on(e,"touchend",this.handleMouseUp)},e.handleMouseUp=function(t){var e=this.getChild("seekBar");e&&e.handleMouseUp(t),this.removeListenersAddedOnMousedownAndTouchstart()},t}(de);qe.prototype.options_={children:["seekBar"]},de.registerComponent("ProgressControl",qe);B=function(i){function t(t,e){return(e=i.call(this,t,e)||this).on(t,["enterpictureinpicture","leavepictureinpicture"],e.handlePictureInPictureChange),e.on(t,["disablepictureinpicturechanged","loadedmetadata"],e.handlePictureInPictureEnabledChange),e.disable(),e}ve(t,i);var e=t.prototype;return e.buildCSSClass=function(){return"vjs-picture-in-picture-control "+i.prototype.buildCSSClass.call(this)},e.handlePictureInPictureEnabledChange=function(){c.pictureInPictureEnabled&&!1===this.player_.disablePictureInPicture()?this.enable():this.disable()},e.handlePictureInPictureChange=function(t){this.player_.isInPictureInPicture()?this.controlText("Exit Picture-in-Picture"):this.controlText("Picture-in-Picture"),this.handlePictureInPictureEnabledChange()},e.handleClick=function(t){this.player_.isInPictureInPicture()?this.player_.exitPictureInPicture():this.player_.requestPictureInPicture()},t}(fn);B.prototype.controlText_="Picture-in-Picture",de.registerComponent("PictureInPictureToggle",B);$e=function(i){function t(t,e){return(e=i.call(this,t,e)||this).on(t,"fullscreenchange",e.handleFullscreenChange),!1===c[t.fsApi_.fullscreenEnabled]&&e.disable(),e}ve(t,i);var e=t.prototype;return e.buildCSSClass=function(){return"vjs-fullscreen-control "+i.prototype.buildCSSClass.call(this)},e.handleFullscreenChange=function(t){this.player_.isFullscreen()?this.controlText("Non-Fullscreen"):this.controlText("Fullscreen")},e.handleClick=function(t){this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()},t}(fn);$e.prototype.controlText_="Fullscreen",de.registerComponent("FullscreenToggle",$e);var Tn,ii=(ve(xn,Tn=de),xn.prototype.createEl=function(){return Tn.prototype.createEl.call(this,"div",{className:"vjs-volume-level",innerHTML:'<span class="vjs-control-text"></span>'})},xn);function xn(){return Tn.apply(this,arguments)||this}de.registerComponent("VolumeLevel",ii);Ue=function(n){function t(t,e){var i;return(i=n.call(this,t,e)||this).on("slideractive",i.updateLastVolume_),i.on(t,"volumechange",i.updateARIAAttributes),t.ready(function(){return i.updateARIAAttributes()}),i}ve(t,n);var e=t.prototype;return e.createEl=function(){return n.prototype.createEl.call(this,"div",{className:"vjs-volume-bar vjs-slider-bar"},{"aria-label":this.localize("Volume Level"),"aria-live":"polite"})},e.handleMouseDown=function(t){_t(t)&&n.prototype.handleMouseDown.call(this,t)},e.handleMouseMove=function(t){_t(t)&&(this.checkMuted(),this.player_.volume(this.calculateDistance(t)))},e.checkMuted=function(){this.player_.muted()&&this.player_.muted(!1)},e.getPercent=function(){return this.player_.muted()?0:this.player_.volume()},e.stepForward=function(){this.checkMuted(),this.player_.volume(this.player_.volume()+.1)},e.stepBack=function(){this.checkMuted(),this.player_.volume(this.player_.volume()-.1)},e.updateARIAAttributes=function(t){var e=this.player_.muted()?0:this.volumeAsPercentage_();this.el_.setAttribute("aria-valuenow",e),this.el_.setAttribute("aria-valuetext",e+"%")},e.volumeAsPercentage_=function(){return Math.round(100*this.player_.volume())},e.updateLastVolume_=function(){var t=this,e=this.player_.volume();this.one("sliderinactive",function(){0===t.player_.volume()&&t.player_.lastVolume_(e)})},t}(j);Ue.prototype.options_={children:["volumeLevel"],barName:"volumeLevel"},Ue.prototype.playerEvent="volumechange",de.registerComponent("VolumeBar",Ue);je=function(a){function t(t,e){var i,n,r;return(e=void 0===e?{}:e).vertical=e.vertical||!1,void 0!==e.volumeBar&&!T(e.volumeBar)||(e.volumeBar=e.volumeBar||{},e.volumeBar.vertical=e.vertical),i=a.call(this,t,e)||this,n=ge(i),(r=t).tech_&&!r.tech_.featuresVolumeControl&&n.addClass("vjs-hidden"),n.on(r,"loadstart",function(){r.tech_.featuresVolumeControl?n.removeClass("vjs-hidden"):n.addClass("vjs-hidden")}),i.throttledHandleMouseMove=Vt(Ht(ge(i),i.handleMouseMove),30),i.on("mousedown",i.handleMouseDown),i.on("touchstart",i.handleMouseDown),i.on(i.volumeBar,["focus","slideractive"],function(){i.volumeBar.addClass("vjs-slider-active"),i.addClass("vjs-slider-active"),i.trigger("slideractive")}),i.on(i.volumeBar,["blur","sliderinactive"],function(){i.volumeBar.removeClass("vjs-slider-active"),i.removeClass("vjs-slider-active"),i.trigger("sliderinactive")}),i}ve(t,a);var e=t.prototype;return e.createEl=function(){var t="vjs-volume-horizontal";return this.options_.vertical&&(t="vjs-volume-vertical"),a.prototype.createEl.call(this,"div",{className:"vjs-volume-control vjs-control "+t})},e.handleMouseDown=function(t){var e=this.el_.ownerDocument;this.on(e,"mousemove",this.throttledHandleMouseMove),this.on(e,"touchmove",this.throttledHandleMouseMove),this.on(e,"mouseup",this.handleMouseUp),this.on(e,"touchend",this.handleMouseUp)},e.handleMouseUp=function(t){var e=this.el_.ownerDocument;this.off(e,"mousemove",this.throttledHandleMouseMove),this.off(e,"touchmove",this.throttledHandleMouseMove),this.off(e,"mouseup",this.handleMouseUp),this.off(e,"touchend",this.handleMouseUp)},e.handleMouseMove=function(t){this.volumeBar.handleMouseMove(t)},t}(de);je.prototype.options_={children:["volumeBar"]},de.registerComponent("VolumeControl",je);I=function(r){function t(t,e){var i,n,e=r.call(this,t,e)||this;return i=ge(e),(n=t).tech_&&!n.tech_.featuresMuteControl&&i.addClass("vjs-hidden"),i.on(n,"loadstart",function(){n.tech_.featuresMuteControl?i.removeClass("vjs-hidden"):i.addClass("vjs-hidden")}),e.on(t,["loadstart","volumechange"],e.update),e}ve(t,r);var e=t.prototype;return e.buildCSSClass=function(){return"vjs-mute-control "+r.prototype.buildCSSClass.call(this)},e.handleClick=function(t){var e=this.player_.volume(),i=this.player_.lastVolume_();0===e?(this.player_.volume(i<.1?.1:i),this.player_.muted(!1)):this.player_.muted(!this.player_.muted())},e.update=function(t){this.updateIcon_(),this.updateControlText_()},e.updateIcon_=function(){var t=this.player_.volume(),e=3;z&&this.player_.tech_&&this.player_.tech_.el_&&this.player_.muted(this.player_.tech_.el_.muted),0===t||this.player_.muted()?e=0:t<.33?e=1:t<.67&&(e=2);for(var i=0;i<4;i++)it(this.el_,"vjs-vol-"+i);et(this.el_,"vjs-vol-"+e)},e.updateControlText_=function(){var t=this.player_.muted()||0===this.player_.volume()?"Unmute":"Mute";this.controlText()!==t&&this.controlText(t)},t}(fn);I.prototype.controlText_="Mute",de.registerComponent("MuteToggle",I);he=function(i){function t(t,e){return void 0!==(e=void 0===e?{}:e).inline?e.inline=e.inline:e.inline=!0,void 0!==e.volumeControl&&!T(e.volumeControl)||(e.volumeControl=e.volumeControl||{},e.volumeControl.vertical=!e.inline),(e=i.call(this,t,e)||this).on(t,["loadstart"],e.volumePanelState_),e.on(e.muteToggle,"keyup",e.handleKeyPress),e.on(e.volumeControl,"keyup",e.handleVolumeControlKeyUp),e.on("keydown",e.handleKeyPress),e.on("mouseover",e.handleMouseOver),e.on("mouseout",e.handleMouseOut),e.on(e.volumeControl,["slideractive"],e.sliderActive_),e.on(e.volumeControl,["sliderinactive"],e.sliderInactive_),e}ve(t,i);var e=t.prototype;return e.sliderActive_=function(){this.addClass("vjs-slider-active")},e.sliderInactive_=function(){this.removeClass("vjs-slider-active")},e.volumePanelState_=function(){this.volumeControl.hasClass("vjs-hidden")&&this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-hidden"),this.volumeControl.hasClass("vjs-hidden")&&!this.muteToggle.hasClass("vjs-hidden")&&this.addClass("vjs-mute-toggle-only")},e.createEl=function(){var t="vjs-volume-panel-horizontal";return this.options_.inline||(t="vjs-volume-panel-vertical"),i.prototype.createEl.call(this,"div",{className:"vjs-volume-panel vjs-control "+t})},e.dispose=function(){this.handleMouseOut(),i.prototype.dispose.call(this)},e.handleVolumeControlKeyUp=function(t){Ce.isEventKey(t,"Esc")&&this.muteToggle.focus()},e.handleMouseOver=function(t){this.addClass("vjs-hover"),Ft(c,"keyup",Ht(this,this.handleKeyPress))},e.handleMouseOut=function(t){this.removeClass("vjs-hover"),Ut(c,"keyup",Ht(this,this.handleKeyPress))},e.handleKeyPress=function(t){Ce.isEventKey(t,"Esc")&&this.handleMouseOut()},t}(de);he.prototype.options_={children:["muteToggle","volumeControl"]},de.registerComponent("VolumePanel",he);var Sn=function(i){function t(t,e){t=i.call(this,t,e)||this;return e&&(t.menuButton_=e.menuButton),t.focusedChild_=-1,t.on("keydown",t.handleKeyDown),t.boundHandleBlur_=Ht(ge(t),t.handleBlur),t.boundHandleTapClick_=Ht(ge(t),t.handleTapClick),t}ve(t,i);var e=t.prototype;return e.addEventListenerForItem=function(t){t instanceof de&&(this.on(t,"blur",this.boundHandleBlur_),this.on(t,["tap","click"],this.boundHandleTapClick_))},e.removeEventListenerForItem=function(t){t instanceof de&&(this.off(t,"blur",this.boundHandleBlur_),this.off(t,["tap","click"],this.boundHandleTapClick_))},e.removeChild=function(t){"string"==typeof t&&(t=this.getChild(t)),this.removeEventListenerForItem(t),i.prototype.removeChild.call(this,t)},e.addItem=function(t){t=this.addChild(t);t&&this.addEventListenerForItem(t)},e.createEl=function(){var t=this.options_.contentElType||"ul";this.contentEl_=Q(t,{className:"vjs-menu-content"}),this.contentEl_.setAttribute("role","menu");t=i.prototype.createEl.call(this,"div",{append:this.contentEl_,className:"vjs-menu"});return t.appendChild(this.contentEl_),Ft(t,"click",function(t){t.preventDefault(),t.stopImmediatePropagation()}),t},e.dispose=function(){this.contentEl_=null,this.boundHandleBlur_=null,this.boundHandleTapClick_=null,i.prototype.dispose.call(this)},e.handleBlur=function(t){var e=t.relatedTarget||c.activeElement;this.children().some(function(t){return t.el()===e})||(t=this.menuButton_)&&t.buttonPressed_&&e!==t.el().firstChild&&t.unpressButton()},e.handleTapClick=function(e){var t;this.menuButton_&&(this.menuButton_.unpressButton(),t=this.children(),!Array.isArray(t)||(t=t.filter(function(t){return t.el()===e.target})[0])&&"CaptionSettingsMenuItem"!==t.name()&&this.menuButton_.focus())},e.handleKeyDown=function(t){Ce.isEventKey(t,"Left")||Ce.isEventKey(t,"Down")?(t.preventDefault(),t.stopPropagation(),this.stepForward()):(Ce.isEventKey(t,"Right")||Ce.isEventKey(t,"Up"))&&(t.preventDefault(),t.stopPropagation(),this.stepBack())},e.stepForward=function(){var t=0;void 0!==this.focusedChild_&&(t=this.focusedChild_+1),this.focus(t)},e.stepBack=function(){var t=0;void 0!==this.focusedChild_&&(t=this.focusedChild_-1),this.focus(t)},e.focus=function(t){void 0===t&&(t=0);var e=this.children().slice();e.length&&e[0].hasClass("vjs-menu-title")&&e.shift(),0<e.length&&(t<0?t=0:t>=e.length&&(t=e.length-1),e[this.focusedChild_=t].el_.focus())},t}(de);de.registerComponent("Menu",Sn);k=function(n){function t(t,e){var i;(i=n.call(this,t,e=void 0===e?{}:e)||this).menuButton_=new fn(t,e),i.menuButton_.controlText(i.controlText_),i.menuButton_.el_.setAttribute("aria-haspopup","true");e=fn.prototype.buildCSSClass();return i.menuButton_.el_.className=i.buildCSSClass()+" "+e,i.menuButton_.removeClass("vjs-control"),i.addChild(i.menuButton_),i.update(),i.enabled_=!0,i.on(i.menuButton_,"tap",i.handleClick),i.on(i.menuButton_,"click",i.handleClick),i.on(i.menuButton_,"keydown",i.handleKeyDown),i.on(i.menuButton_,"mouseenter",function(){i.addClass("vjs-hover"),i.menu.show(),Ft(c,"keyup",Ht(ge(i),i.handleMenuKeyUp))}),i.on("mouseleave",i.handleMouseLeave),i.on("keydown",i.handleSubmenuKeyDown),i}ve(t,n);var e=t.prototype;return e.update=function(){var t=this.createMenu();this.menu&&(this.menu.dispose(),this.removeChild(this.menu)),this.menu=t,this.addChild(t),this.buttonPressed_=!1,this.menuButton_.el_.setAttribute("aria-expanded","false"),this.items&&this.items.length<=this.hideThreshold_?this.hide():this.show()},e.createMenu=function(){var t,e=new Sn(this.player_,{menuButton:this});if(this.hideThreshold_=0,this.options_.title&&(t=Q("li",{className:"vjs-menu-title",innerHTML:oe(this.options_.title),tabIndex:-1}),this.hideThreshold_+=1,t=new de(this.player_,{el:t}),e.addItem(t)),this.items=this.createItems(),this.items)for(var i=0;i<this.items.length;i++)e.addItem(this.items[i]);return e},e.createItems=function(){},e.createEl=function(){return n.prototype.createEl.call(this,"div",{className:this.buildWrapperCSSClass()},{})},e.buildWrapperCSSClass=function(){var t="vjs-menu-button";return!0===this.options_.inline?t+="-inline":t+="-popup","vjs-menu-button "+t+" "+fn.prototype.buildCSSClass()+" "+n.prototype.buildCSSClass.call(this)},e.buildCSSClass=function(){var t="vjs-menu-button";return!0===this.options_.inline?t+="-inline":t+="-popup","vjs-menu-button "+t+" "+n.prototype.buildCSSClass.call(this)},e.controlText=function(t,e){return void 0===e&&(e=this.menuButton_.el()),this.menuButton_.controlText(t,e)},e.dispose=function(){this.handleMouseLeave(),n.prototype.dispose.call(this)},e.handleClick=function(t){this.buttonPressed_?this.unpressButton():this.pressButton()},e.handleMouseLeave=function(t){this.removeClass("vjs-hover"),Ut(c,"keyup",Ht(this,this.handleMenuKeyUp))},e.focus=function(){this.menuButton_.focus()},e.blur=function(){this.menuButton_.blur()},e.handleKeyDown=function(t){Ce.isEventKey(t,"Esc")||Ce.isEventKey(t,"Tab")?(this.buttonPressed_&&this.unpressButton(),Ce.isEventKey(t,"Tab")||(t.preventDefault(),this.menuButton_.focus())):(Ce.isEventKey(t,"Up")||Ce.isEventKey(t,"Down"))&&(this.buttonPressed_||(t.preventDefault(),this.pressButton()))},e.handleMenuKeyUp=function(t){(Ce.isEventKey(t,"Esc")||Ce.isEventKey(t,"Tab"))&&this.removeClass("vjs-hover")},e.handleSubmenuKeyPress=function(t){this.handleSubmenuKeyDown(t)},e.handleSubmenuKeyDown=function(t){(Ce.isEventKey(t,"Esc")||Ce.isEventKey(t,"Tab"))&&(this.buttonPressed_&&this.unpressButton(),Ce.isEventKey(t,"Tab")||(t.preventDefault(),this.menuButton_.focus()))},e.pressButton=function(){this.enabled_&&(this.buttonPressed_=!0,this.menu.show(),this.menu.lockShowing(),this.menuButton_.el_.setAttribute("aria-expanded","true"),z&&Y()||this.menu.focus())},e.unpressButton=function(){this.enabled_&&(this.buttonPressed_=!1,this.menu.unlockShowing(),this.menu.hide(),this.menuButton_.el_.setAttribute("aria-expanded","false"))},e.disable=function(){this.unpressButton(),this.enabled_=!1,this.addClass("vjs-disabled"),this.menuButton_.disable()},e.enable=function(){this.enabled_=!0,this.removeClass("vjs-disabled"),this.menuButton_.enable()},t}(de);de.registerComponent("MenuButton",k);var En,qe=(ve(kn,En=k),kn);function kn(t,e){var i=e.tracks;if((e=En.call(this,t,e)||this).items.length<=1&&e.hide(),!i)return ge(e);var n=Ht(ge(e),e.update);return i.addEventListener("removetrack",n),i.addEventListener("addtrack",n),i.addEventListener("labelchange",n),e.player_.on("ready",n),e.player_.on("dispose",function(){i.removeEventListener("removetrack",n),i.removeEventListener("addtrack",n),i.removeEventListener("labelchange",n)}),e}de.registerComponent("TrackButton",qe);var Cn=["Tab","Esc","Up","Down","Right","Left"],B=function(n){function t(t,e){return(t=n.call(this,t,e)||this).selectable=e.selectable,t.isSelected_=e.selected||!1,t.multiSelectable=e.multiSelectable,t.selected(t.isSelected_),t.selectable?t.multiSelectable?t.el_.setAttribute("role","menuitemcheckbox"):t.el_.setAttribute("role","menuitemradio"):t.el_.setAttribute("role","menuitem"),t}ve(t,n);var e=t.prototype;return e.createEl=function(t,e,i){return this.nonIconControl=!0,n.prototype.createEl.call(this,"li",b({className:"vjs-menu-item",innerHTML:'<span class="vjs-menu-item-text">'+this.localize(this.options_.label)+"</span>",tabIndex:-1},e),i)},e.handleKeyDown=function(e){Cn.some(function(t){return Ce.isEventKey(e,t)})||n.prototype.handleKeyDown.call(this,e)},e.handleClick=function(t){this.selected(!0)},e.selected=function(t){this.selectable&&(t?(this.addClass("vjs-selected"),this.el_.setAttribute("aria-checked","true"),this.controlText(", selected"),this.isSelected_=!0):(this.removeClass("vjs-selected"),this.el_.setAttribute("aria-checked","false"),this.controlText(""),this.isSelected_=!1))},t}(C);de.registerComponent("MenuItem",B);var In=function(l){function t(t,e){var n,i,r=e.track,a=t.textTracks();function s(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];n.handleTracksChange.apply(ge(n),e)}function o(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];n.handleSelectedLanguageChange.apply(ge(n),e)}return e.label=r.label||r.language||"Unknown",e.selected="showing"===r.mode,(n=l.call(this,t,e)||this).track=r,n.kinds=(e.kinds||[e.kind||n.track.kind]).filter(Boolean),t.on(["loadstart","texttrackchange"],s),a.addEventListener("change",s),a.addEventListener("selectedlanguagechange",o),n.on("dispose",function(){t.off(["loadstart","texttrackchange"],s),a.removeEventListener("change",s),a.removeEventListener("selectedlanguagechange",o)}),void 0===a.onchange&&n.on(["tap","click"],function(){if("object"!=typeof d.Event)try{i=new d.Event("change")}catch(t){}i||(i=c.createEvent("Event")).initEvent("change",!0,!0),a.dispatchEvent(i)}),n.handleTracksChange(),n}ve(t,l);var e=t.prototype;return e.handleClick=function(t){var e=this.track,i=this.player_.textTracks();if(l.prototype.handleClick.call(this,t),i)for(var n=0;n<i.length;n++){var r=i[n];-1!==this.kinds.indexOf(r.kind)&&(r===e?"showing"!==r.mode&&(r.mode="showing"):"disabled"!==r.mode&&(r.mode="disabled"))}},e.handleTracksChange=function(t){var e="showing"===this.track.mode;e!==this.isSelected_&&this.selected(e)},e.handleSelectedLanguageChange=function(t){var e;"showing"===this.track.mode&&((e=this.player_.cache_.selectedLanguage)&&e.enabled&&e.language===this.track.language&&e.kind!==this.track.kind||(this.player_.cache_.selectedLanguage={enabled:!0,language:this.track.language,kind:this.track.kind}))},e.dispose=function(){this.track=null,l.prototype.dispose.call(this)},t}(B);de.registerComponent("TextTrackMenuItem",In);var An=function(i){function t(t,e){return e.track={player:t,kind:e.kind,kinds:e.kinds,default:!1,mode:"disabled"},e.kinds||(e.kinds=[e.kind]),e.label?e.track.label=e.label:e.track.label=e.kinds.join(" and ")+" off",e.selectable=!0,e.multiSelectable=!1,i.call(this,t,e)||this}ve(t,i);var e=t.prototype;return e.handleTracksChange=function(t){for(var e=this.player().textTracks(),i=!0,n=0,r=e.length;n<r;n++){var a=e[n];if(-1<this.options_.kinds.indexOf(a.kind)&&"showing"===a.mode){i=!1;break}}i!==this.isSelected_&&this.selected(i)},e.handleSelectedLanguageChange=function(t){for(var e=this.player().textTracks(),i=!0,n=0,r=e.length;n<r;n++){var a=e[n];if(-1<["captions","descriptions","subtitles"].indexOf(a.kind)&&"showing"===a.mode){i=!1;break}}i&&(this.player_.cache_.selectedLanguage={enabled:!1})},t}(In);de.registerComponent("OffTextTrackMenuItem",An);var Pn,$e=(ve(Dn,Pn=qe),Dn.prototype.createItems=function(t,e){var i;void 0===e&&(e=In),this.label_&&(i=this.label_+" off"),(t=void 0===t?[]:t).push(new An(this.player_,{kinds:this.kinds_,kind:this.kind_,label:i})),this.hideThreshold_+=1;var n=this.player_.textTracks();Array.isArray(this.kinds_)||(this.kinds_=[this.kind_]);for(var r=0;r<n.length;r++){var a,s=n[r];-1<this.kinds_.indexOf(s.kind)&&((a=new e(this.player_,{track:s,kinds:this.kinds_,kind:this.kind_,selectable:!0,multiSelectable:!1})).addClass("vjs-"+s.kind+"-menu-item"),t.push(a))}return t},Dn);function Dn(t,e){return(e=void 0===e?{}:e).tracks=t.textTracks(),Pn.call(this,t,e)||this}de.registerComponent("TextTrackButton",$e);var On=function(a){function t(t,e){var i=e.track,n=e.cue,r=t.currentTime();return e.selectable=!0,e.multiSelectable=!1,e.label=n.text,e.selected=n.startTime<=r&&r<n.endTime,(e=a.call(this,t,e)||this).track=i,e.cue=n,i.addEventListener("cuechange",Ht(ge(e),e.update)),e}ve(t,a);var e=t.prototype;return e.handleClick=function(t){a.prototype.handleClick.call(this),this.player_.currentTime(this.cue.startTime),this.update(this.cue.startTime)},e.update=function(t){var e=this.cue,i=this.player_.currentTime();this.selected(e.startTime<=i&&i<e.endTime)},t}(B);de.registerComponent("ChaptersTrackMenuItem",On);ii=function(n){function t(t,e,i){return n.call(this,t,e,i)||this}ve(t,n);var e=t.prototype;return e.buildCSSClass=function(){return"vjs-chapters-button "+n.prototype.buildCSSClass.call(this)},e.buildWrapperCSSClass=function(){return"vjs-chapters-button "+n.prototype.buildWrapperCSSClass.call(this)},e.update=function(t){this.track_&&(!t||"addtrack"!==t.type&&"removetrack"!==t.type)||this.setTrack(this.findChaptersTrack()),n.prototype.update.call(this)},e.setTrack=function(t){var e;this.track_!==t&&(this.updateHandler_||(this.updateHandler_=this.update.bind(this)),this.track_&&((e=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_))&&e.removeEventListener("load",this.updateHandler_),this.track_=null),this.track_=t,this.track_&&(this.track_.mode="hidden",(t=this.player_.remoteTextTrackEls().getTrackElementByTrack_(this.track_))&&t.addEventListener("load",this.updateHandler_)))},e.findChaptersTrack=function(){for(var t=this.player_.textTracks()||[],e=t.length-1;0<=e;e--){var i=t[e];if(i.kind===this.kind_)return i}},e.getMenuCaption=function(){return this.track_&&this.track_.label?this.track_.label:this.localize(oe(this.kind_))},e.createMenu=function(){return this.options_.title=this.getMenuCaption(),n.prototype.createMenu.call(this)},e.createItems=function(){var t=[];if(!this.track_)return t;var e=this.track_.cues;if(!e)return t;for(var i=0,n=e.length;i<n;i++){var r=e[i],r=new On(this.player_,{track:this.track_,cue:r});t.push(r)}return t},t}($e);ii.prototype.kind_="chapters",ii.prototype.controlText_="Chapters",de.registerComponent("ChaptersButton",ii);j=function(a){function t(t,e,i){var i=a.call(this,t,e,i)||this,n=t.textTracks(),r=Ht(ge(i),i.handleTracksChange);return n.addEventListener("change",r),i.on("dispose",function(){n.removeEventListener("change",r)}),i}ve(t,a);var e=t.prototype;return e.handleTracksChange=function(t){for(var e=this.player().textTracks(),i=!1,n=0,r=e.length;n<r;n++){var a=e[n];if(a.kind!==this.kind_&&"showing"===a.mode){i=!0;break}}i?this.disable():this.enable()},e.buildCSSClass=function(){return"vjs-descriptions-button "+a.prototype.buildCSSClass.call(this)},e.buildWrapperCSSClass=function(){return"vjs-descriptions-button "+a.prototype.buildWrapperCSSClass.call(this)},t}($e);j.prototype.kind_="descriptions",j.prototype.controlText_="Descriptions",de.registerComponent("DescriptionsButton",j);Ue=function(n){function t(t,e,i){return n.call(this,t,e,i)||this}ve(t,n);var e=t.prototype;return e.buildCSSClass=function(){return"vjs-subtitles-button "+n.prototype.buildCSSClass.call(this)},e.buildWrapperCSSClass=function(){return"vjs-subtitles-button "+n.prototype.buildWrapperCSSClass.call(this)},t}($e);Ue.prototype.kind_="subtitles",Ue.prototype.controlText_="Subtitles",de.registerComponent("SubtitlesButton",Ue);var Ln,Mn=(ve(Rn,Ln=In),Rn.prototype.handleClick=function(t){this.player().getChild("textTrackSettings").open()},Rn);function Rn(t,e){return e.track={player:t,kind:e.kind,label:e.kind+" settings",selectable:!1,default:!1,mode:"disabled"},e.selectable=!1,e.name="CaptionSettingsMenuItem",(t=Ln.call(this,t,e)||this).addClass("vjs-texttrack-settings"),t.controlText(", opens "+e.kind+" settings dialog"),t}de.registerComponent("CaptionSettingsMenuItem",Mn);je=function(n){function t(t,e,i){return n.call(this,t,e,i)||this}ve(t,n);var e=t.prototype;return e.buildCSSClass=function(){return"vjs-captions-button "+n.prototype.buildCSSClass.call(this)},e.buildWrapperCSSClass=function(){return"vjs-captions-button "+n.prototype.buildWrapperCSSClass.call(this)},e.createItems=function(){var t=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(t.push(new Mn(this.player_,{kind:this.kind_})),this.hideThreshold_+=1),n.prototype.createItems.call(this,t)},t}($e);je.prototype.kind_="captions",je.prototype.controlText_="Captions",de.registerComponent("CaptionsButton",je);var Nn,Bn=(ve(Fn,Nn=In),Fn.prototype.createEl=function(t,e,i){var n='<span class="vjs-menu-item-text">'+this.localize(this.options_.label);return"captions"===this.options_.track.kind&&(n+='\n        <span aria-hidden="true" class="vjs-icon-placeholder"></span>\n        <span class="vjs-control-text"> '+this.localize("Captions")+"</span>\n      "),Nn.prototype.createEl.call(this,t,b({innerHTML:n+="</span>"},e),i)},Fn);function Fn(){return Nn.apply(this,arguments)||this}de.registerComponent("SubsCapsMenuItem",Bn);I=function(i){function t(t,e){return(e=i.call(this,t,e=void 0===e?{}:e)||this).label_="subtitles",-1<["en","en-us","en-ca","fr-ca"].indexOf(e.player_.language_)&&(e.label_="captions"),e.menuButton_.controlText(oe(e.label_)),e}ve(t,i);var e=t.prototype;return e.buildCSSClass=function(){return"vjs-subs-caps-button "+i.prototype.buildCSSClass.call(this)},e.buildWrapperCSSClass=function(){return"vjs-subs-caps-button "+i.prototype.buildWrapperCSSClass.call(this)},e.createItems=function(){var t=[];return this.player().tech_&&this.player().tech_.featuresNativeTextTracks||!this.player().getChild("textTrackSettings")||(t.push(new Mn(this.player_,{kind:this.label_})),this.hideThreshold_+=1),i.prototype.createItems.call(this,t,Bn)},t}($e);I.prototype.kinds_=["captions","subtitles"],I.prototype.controlText_="Subtitles",de.registerComponent("SubsCapsButton",I);var Un=function(s){function t(t,e){var n,i=e.track,r=t.audioTracks();function a(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];n.handleTracksChange.apply(ge(n),e)}return e.label=i.label||i.language||"Unknown",e.selected=i.enabled,(n=s.call(this,t,e)||this).track=i,n.addClass("vjs-"+i.kind+"-menu-item"),r.addEventListener("change",a),n.on("dispose",function(){r.removeEventListener("change",a)}),n}ve(t,s);var e=t.prototype;return e.createEl=function(t,e,i){var n='<span class="vjs-menu-item-text">'+this.localize(this.options_.label);return"main-desc"===this.options_.track.kind&&(n+='\n        <span aria-hidden="true" class="vjs-icon-placeholder"></span>\n        <span class="vjs-control-text"> '+this.localize("Descriptions")+"</span>\n      "),s.prototype.createEl.call(this,t,b({innerHTML:n+="</span>"},e),i)},e.handleClick=function(t){var e=this.player_.audioTracks();s.prototype.handleClick.call(this,t);for(var i=0;i<e.length;i++){var n=e[i];n.enabled=n===this.track}},e.handleTracksChange=function(t){this.selected(this.track.enabled)},t}(B);de.registerComponent("AudioTrackMenuItem",Un);he=function(i){function t(t,e){return(e=void 0===e?{}:e).tracks=t.audioTracks(),i.call(this,t,e)||this}ve(t,i);var e=t.prototype;return e.buildCSSClass=function(){return"vjs-audio-button "+i.prototype.buildCSSClass.call(this)},e.buildWrapperCSSClass=function(){return"vjs-audio-button "+i.prototype.buildWrapperCSSClass.call(this)},e.createItems=function(t){void 0===t&&(t=[]),this.hideThreshold_=1;for(var e=this.player_.audioTracks(),i=0;i<e.length;i++){var n=e[i];t.push(new Un(this.player_,{track:n,selectable:!0,multiSelectable:!1}))}return t},t}(qe);he.prototype.controlText_="Audio Track",de.registerComponent("AudioTrackButton",he);var jn=function(r){function t(t,e){var i=e.rate,n=parseFloat(i,10);return e.label=i,e.selected=1===n,e.selectable=!0,e.multiSelectable=!1,(e=r.call(this,t,e)||this).label=i,e.rate=n,e.on(t,"ratechange",e.update),e}ve(t,r);var e=t.prototype;return e.handleClick=function(t){r.prototype.handleClick.call(this),this.player().playbackRate(this.rate)},e.update=function(t){this.selected(this.player().playbackRate()===this.rate)},t}(B);jn.prototype.contentElType="button",de.registerComponent("PlaybackRateMenuItem",jn);C=function(i){function t(t,e){return(e=i.call(this,t,e)||this).updateVisibility(),e.updateLabel(),e.on(t,"loadstart",e.updateVisibility),e.on(t,"ratechange",e.updateLabel),e}ve(t,i);var e=t.prototype;return e.createEl=function(){var t=i.prototype.createEl.call(this);return this.labelEl_=Q("div",{className:"vjs-playback-rate-value",innerHTML:"1x"}),t.appendChild(this.labelEl_),t},e.dispose=function(){this.labelEl_=null,i.prototype.dispose.call(this)},e.buildCSSClass=function(){return"vjs-playback-rate "+i.prototype.buildCSSClass.call(this)},e.buildWrapperCSSClass=function(){return"vjs-playback-rate "+i.prototype.buildWrapperCSSClass.call(this)},e.createMenu=function(){var t=new Sn(this.player()),e=this.playbackRates();if(e)for(var i=e.length-1;0<=i;i--)t.addChild(new jn(this.player(),{rate:e[i]+"x"}));return t},e.updateARIAAttributes=function(){this.el().setAttribute("aria-valuenow",this.player().playbackRate())},e.handleClick=function(t){for(var e=this.player().playbackRate(),i=this.playbackRates(),n=i[0],r=0;r<i.length;r++)if(i[r]>e){n=i[r];break}this.player().playbackRate(n)},e.playbackRates=function(){return this.options_.playbackRates||this.options_.playerOptions&&this.options_.playerOptions.playbackRates},e.playbackRateSupported=function(){return this.player().tech_&&this.player().tech_.featuresPlaybackRate&&this.playbackRates()&&0<this.playbackRates().length},e.updateVisibility=function(t){this.playbackRateSupported()?this.removeClass("vjs-hidden"):this.addClass("vjs-hidden")},e.updateLabel=function(t){this.playbackRateSupported()&&(this.labelEl_.innerHTML=this.player().playbackRate()+"x")},t}(k);C.prototype.controlText_="Playback Rate",de.registerComponent("PlaybackRateMenuButton",C);ii=function(t){function e(){return t.apply(this,arguments)||this}ve(e,t);var i=e.prototype;return i.buildCSSClass=function(){return"vjs-spacer "+t.prototype.buildCSSClass.call(this)},i.createEl=function(){return t.prototype.createEl.call(this,"div",{className:this.buildCSSClass()})},e}(de);de.registerComponent("Spacer",ii);j=function(e){function t(){return e.apply(this,arguments)||this}ve(t,e);var i=t.prototype;return i.buildCSSClass=function(){return"vjs-custom-control-spacer "+e.prototype.buildCSSClass.call(this)},i.createEl=function(){var t=e.prototype.createEl.call(this,{className:this.buildCSSClass()});return t.innerHTML=" ",t},t}(ii);de.registerComponent("CustomControlSpacer",j);var qn,Ue=(ve(zn,qn=de),zn.prototype.createEl=function(){return qn.prototype.createEl.call(this,"div",{className:"vjs-control-bar",dir:"ltr"})},zn);function zn(){return qn.apply(this,arguments)||this}Ue.prototype.options_={children:["playToggle","volumePanel","currentTimeDisplay","timeDivider","durationDisplay","progressControl","liveDisplay","seekToLive","remainingTimeDisplay","customControlSpacer","playbackRateMenuButton","chaptersButton","descriptionsButton","subsCapsButton","audioTrackButton","fullscreenToggle"]},"exitPictureInPicture"in c&&Ue.prototype.options_.children.splice(Ue.prototype.options_.children.length-1,0,"pictureInPictureToggle"),de.registerComponent("ControlBar",Ue);je=function(i){function t(t,e){return(e=i.call(this,t,e)||this).on(t,"error",e.open),e}ve(t,i);var e=t.prototype;return e.buildCSSClass=function(){return"vjs-error-display "+i.prototype.buildCSSClass.call(this)},e.content=function(){var t=this.player().error();return t?this.localize(t.message):""},t}(Ae);je.prototype.options_=v({},Ae.prototype.options_,{pauseOnOpen:!1,fillAlways:!0,temporary:!1,uncloseable:!0}),de.registerComponent("ErrorDisplay",je);var Hn="vjs-text-track-settings",$e=["#000","Black"],I=["#00F","Blue"],qe=["#0FF","Cyan"],he=["#0F0","Green"],B=["#F0F","Magenta"],k=["#F00","Red"],C=["#FFF","White"],ii=["#FF0","Yellow"],j=["1","Opaque"],Ue=["0.5","Semi-Transparent"],je=["0","Transparent"],Vn={backgroundColor:{selector:".vjs-bg-color > select",id:"captions-background-color-%s",label:"Color",options:[$e,C,k,he,I,ii,B,qe]},backgroundOpacity:{selector:".vjs-bg-opacity > select",id:"captions-background-opacity-%s",label:"Transparency",options:[j,Ue,je]},color:{selector:".vjs-fg-color > select",id:"captions-foreground-color-%s",label:"Color",options:[C,$e,k,he,I,ii,B,qe]},edgeStyle:{selector:".vjs-edge-style > select",id:"%s",label:"Text Edge Style",options:[["none","None"],["raised","Raised"],["depressed","Depressed"],["uniform","Uniform"],["dropshadow","Dropshadow"]]},fontFamily:{selector:".vjs-font-family > select",id:"captions-font-family-%s",label:"Font Family",options:[["proportionalSansSerif","Proportional Sans-Serif"],["monospaceSansSerif","Monospace Sans-Serif"],["proportionalSerif","Proportional Serif"],["monospaceSerif","Monospace Serif"],["casual","Casual"],["script","Script"],["small-caps","Small Caps"]]},fontPercent:{selector:".vjs-font-percent > select",id:"captions-font-size-%s",label:"Font Size",options:[["0.50","50%"],["0.75","75%"],["1.00","100%"],["1.25","125%"],["1.50","150%"],["1.75","175%"],["2.00","200%"],["3.00","300%"],["4.00","400%"]],default:2,parser:function(t){return"1.00"===t?null:Number(t)}},textOpacity:{selector:".vjs-text-opacity > select",id:"captions-foreground-opacity-%s",label:"Transparency",options:[j,Ue]},windowColor:{selector:".vjs-window-color > select",id:"captions-window-color-%s",label:"Color"},windowOpacity:{selector:".vjs-window-opacity > select",id:"captions-window-opacity-%s",label:"Transparency",options:[je,Ue,j]}};function Wn(t,e){if((t=e?e(t):t)&&"none"!==t)return t}Vn.windowColor.options=Vn.backgroundColor.options;Ue=function(n){function t(t,e){var i;return e.temporary=!1,(i=n.call(this,t,e)||this).updateDisplay=Ht(ge(i),i.updateDisplay),i.fill(),i.hasBeenOpened_=i.hasBeenFilled_=!0,i.endDialog=Q("p",{className:"vjs-control-text",textContent:i.localize("End of dialog window.")}),i.el().appendChild(i.endDialog),i.setDefaults(),void 0===e.persistTextTrackSettings&&(i.options_.persistTextTrackSettings=i.options_.playerOptions.persistTextTrackSettings),i.on(i.$(".vjs-done-button"),"click",function(){i.saveSettings(),i.close()}),i.on(i.$(".vjs-default-button"),"click",function(){i.setDefaults(),i.updateDisplay()}),_(Vn,function(t){i.on(i.$(t.selector),"change",i.updateDisplay)}),i.options_.persistTextTrackSettings&&i.restoreSettings(),i}ve(t,n);var e=t.prototype;return e.dispose=function(){this.endDialog=null,n.prototype.dispose.call(this)},e.createElSelect_=function(t,e,i){var n=this;void 0===e&&(e=""),void 0===i&&(i="label");var t=Vn[t],r=t.id.replace("%s",this.id_),a=[e,r].join(" ").trim();return["<"+i+' id="'+r+'" class="'+("label"===i?"vjs-label":"")+'">',this.localize(t.label),"</"+i+">",'<select aria-labelledby="'+a+'">'].concat(t.options.map(function(t){var e=r+"-"+t[1].replace(/\W+/g,"");return['<option id="'+e+'" value="'+t[0]+'" ','aria-labelledby="'+a+" "+e+'">',n.localize(t[1]),"</option>"].join("")})).concat("</select>").join("")},e.createElFgColor_=function(){var t="captions-text-legend-"+this.id_;return['<fieldset class="vjs-fg-color vjs-track-setting">','<legend id="'+t+'">',this.localize("Text"),"</legend>",this.createElSelect_("color",t),'<span class="vjs-text-opacity vjs-opacity">',this.createElSelect_("textOpacity",t),"</span>","</fieldset>"].join("")},e.createElBgColor_=function(){var t="captions-background-"+this.id_;return['<fieldset class="vjs-bg-color vjs-track-setting">','<legend id="'+t+'">',this.localize("Background"),"</legend>",this.createElSelect_("backgroundColor",t),'<span class="vjs-bg-opacity vjs-opacity">',this.createElSelect_("backgroundOpacity",t),"</span>","</fieldset>"].join("")},e.createElWinColor_=function(){var t="captions-window-"+this.id_;return['<fieldset class="vjs-window-color vjs-track-setting">','<legend id="'+t+'">',this.localize("Window"),"</legend>",this.createElSelect_("windowColor",t),'<span class="vjs-window-opacity vjs-opacity">',this.createElSelect_("windowOpacity",t),"</span>","</fieldset>"].join("")},e.createElColors_=function(){return Q("div",{className:"vjs-track-settings-colors",innerHTML:[this.createElFgColor_(),this.createElBgColor_(),this.createElWinColor_()].join("")})},e.createElFont_=function(){return Q("div",{className:"vjs-track-settings-font",innerHTML:['<fieldset class="vjs-font-percent vjs-track-setting">',this.createElSelect_("fontPercent","","legend"),"</fieldset>",'<fieldset class="vjs-edge-style vjs-track-setting">',this.createElSelect_("edgeStyle","","legend"),"</fieldset>",'<fieldset class="vjs-font-family vjs-track-setting">',this.createElSelect_("fontFamily","","legend"),"</fieldset>"].join("")})},e.createElControls_=function(){var t=this.localize("restore all settings to the default values");return Q("div",{className:"vjs-track-settings-controls",innerHTML:['<button type="button" class="vjs-default-button" title="'+t+'">',this.localize("Reset"),'<span class="vjs-control-text"> '+t+"</span>","</button>",'<button type="button" class="vjs-done-button">'+this.localize("Done")+"</button>"].join("")})},e.content=function(){return[this.createElColors_(),this.createElFont_(),this.createElControls_()]},e.label=function(){return this.localize("Caption Settings Dialog")},e.description=function(){return this.localize("Beginning of dialog window. Escape will cancel and close the window.")},e.buildCSSClass=function(){return n.prototype.buildCSSClass.call(this)+" vjs-text-track-settings"},e.getValues=function(){var n,t,r=this;return void 0===(t={})&&(t=0),p(n=Vn).reduce(function(t,e){return i=t,t=n[e],e=e,void 0!==(t=function(t,e){return Wn(t.options[t.options.selectedIndex].value,e)}(r.$(t.selector),t.parser))&&(i[e]=t),i;var i},t)},e.setValues=function(i){var n=this;_(Vn,function(t,e){!function(t,e,i){if(e)for(var n=0;n<t.options.length;n++)if(Wn(t.options[n].value,i)===e){t.selectedIndex=n;break}}(n.$(t.selector),i[e],t.parser)})},e.setDefaults=function(){var i=this;_(Vn,function(t){var e=t.hasOwnProperty("default")?t.default:0;i.$(t.selector).selectedIndex=e})},e.restoreSettings=function(){var t;try{t=JSON.parse(d.localStorage.getItem(Hn))}catch(t){m.warn(t)}t&&this.setValues(t)},e.saveSettings=function(){if(this.options_.persistTextTrackSettings){var t=this.getValues();try{Object.keys(t).length?d.localStorage.setItem(Hn,JSON.stringify(t)):d.localStorage.removeItem(Hn)}catch(t){m.warn(t)}}},e.updateDisplay=function(){var t=this.player_.getChild("textTrackDisplay");t&&t.updateDisplay()},e.conditionalBlur_=function(){this.previouslyActiveEl_=null;var t=this.player_.controlBar,e=t&&t.subsCapsButton,t=t&&t.captionsButton;e?e.focus():t&&t.focus()},t}(Ae);de.registerComponent("TextTrackSettings",Ue);j=function(c){function t(t,e){var i,n,r,a,s,o,l=e.ResizeObserver||d.ResizeObserver,u=le({createEl:!(l=null===e.ResizeObserver?!1:l),reportTouchActivity:!1},e);return(i=c.call(this,t,u)||this).ResizeObserver=e.ResizeObserver||d.ResizeObserver,i.loadListener_=null,i.resizeObserver_=null,i.debouncedHandler_=(n=function(){i.resizeHandler()},a=!(r=100),void 0===(s=ge(i))&&(s=d),h.cancel=function(){s.clearTimeout(o),o=null},h),l?(i.resizeObserver_=new i.ResizeObserver(i.debouncedHandler_),i.resizeObserver_.observe(t.el())):(i.loadListener_=function(){var t,e;i.el_&&i.el_.contentWindow&&(t=i.debouncedHandler_,e=i.unloadListener_=function(){Ut(this,"resize",t),Ut(this,"unload",e),e=null},Ft(i.el_.contentWindow,"unload",e),Ft(i.el_.contentWindow,"resize",t))},i.one("load",i.loadListener_)),i;function h(){var t=this,e=arguments,i=function(){i=o=null,a||n.apply(t,e)};!o&&a&&n.apply(t,e),s.clearTimeout(o),o=s.setTimeout(i,r)}}ve(t,c);var e=t.prototype;return e.createEl=function(){return c.prototype.createEl.call(this,"iframe",{className:"vjs-resize-manager",tabIndex:-1},{"aria-hidden":"true"})},e.resizeHandler=function(){this.player_&&this.player_.trigger&&this.player_.trigger("playerresize")},e.dispose=function(){this.debouncedHandler_&&this.debouncedHandler_.cancel(),this.resizeObserver_&&(this.player_.el()&&this.resizeObserver_.unobserve(this.player_.el()),this.resizeObserver_.disconnect()),this.loadListener_&&this.off("load",this.loadListener_),this.el_&&this.el_.contentWindow&&this.unloadListener_&&this.unloadListener_.call(this.el_.contentWindow),this.ResizeObserver=null,this.resizeObserver=null,this.debouncedHandler_=null,this.loadListener_=null,c.prototype.dispose.call(this)},t}(de);de.registerComponent("ResizeManager",j);var Gn={trackingThreshold:30,liveTolerance:15},Ue=function(n){function t(t,e){var i,e=le(Gn,e,{createEl:!1});return(i=n.call(this,t,e)||this).reset_(),i.on(i.player_,"durationchange",i.handleDurationchange),i.one(i.player_,"canplay",function(){return i.toggleTracking()}),N&&"hidden"in c&&"visibilityState"in c&&i.on(c,"visibilitychange",i.handleVisibilityChange),i}ve(t,n);var e=t.prototype;return e.handleVisibilityChange=function(){this.player_.duration()===1/0&&(c.hidden?this.stopTracking():this.startTracking())},e.trackLive_=function(){var t,e=this.player_.seekable();e&&e.length&&(t=Number(d.performance.now().toFixed(4)),e=-1===this.lastTime_?0:(t-this.lastTime_)/1e3,this.lastTime_=t,this.pastSeekEnd_=this.pastSeekEnd()+e,t=this.liveCurrentTime(),e=this.player_.currentTime(),e=this.player_.paused()||this.seekedBehindLive_||Math.abs(t-e)>this.options_.liveTolerance,(e=!this.timeupdateSeen_||t===1/0?!1:e)!==this.behindLiveEdge_&&(this.behindLiveEdge_=e,this.trigger("liveedgechange")))},e.handleDurationchange=function(){this.toggleTracking()},e.toggleTracking=function(){this.player_.duration()===1/0&&this.liveWindow()>=this.options_.trackingThreshold?(this.player_.options_.liveui&&this.player_.addClass("vjs-liveui"),this.startTracking()):(this.player_.removeClass("vjs-liveui"),this.stopTracking())},e.startTracking=function(){this.isTracking()||(this.timeupdateSeen_||(this.timeupdateSeen_=this.player_.hasStarted()),this.trackingInterval_=this.setInterval(this.trackLive_,30),this.trackLive_(),this.on(this.player_,["play","pause"],this.trackLive_),this.timeupdateSeen_?this.on(this.player_,"seeked",this.handleSeeked):(this.one(this.player_,"play",this.handlePlay),this.one(this.player_,"timeupdate",this.handleFirstTimeupdate)))},e.handleFirstTimeupdate=function(){this.timeupdateSeen_=!0,this.on(this.player_,"seeked",this.handleSeeked)},e.handleSeeked=function(){var t=Math.abs(this.liveCurrentTime()-this.player_.currentTime());this.seekedBehindLive_=!this.skipNextSeeked_&&2<t,this.skipNextSeeked_=!1,this.trackLive_()},e.handlePlay=function(){this.one(this.player_,"timeupdate",this.seekToLiveEdge)},e.reset_=function(){this.lastTime_=-1,this.pastSeekEnd_=0,this.lastSeekEnd_=-1,this.behindLiveEdge_=!0,this.timeupdateSeen_=!1,this.seekedBehindLive_=!1,this.skipNextSeeked_=!1,this.clearInterval(this.trackingInterval_),this.trackingInterval_=null,this.off(this.player_,["play","pause"],this.trackLive_),this.off(this.player_,"seeked",this.handleSeeked),this.off(this.player_,"play",this.handlePlay),this.off(this.player_,"timeupdate",this.handleFirstTimeupdate),this.off(this.player_,"timeupdate",this.seekToLiveEdge)},e.stopTracking=function(){this.isTracking()&&(this.reset_(),this.trigger("liveedgechange"))},e.seekableEnd=function(){for(var t=this.player_.seekable(),e=[],i=t?t.length:0;i--;)e.push(t.end(i));return e.length?e.sort()[e.length-1]:1/0},e.seekableStart=function(){for(var t=this.player_.seekable(),e=[],i=t?t.length:0;i--;)e.push(t.start(i));return e.length?e.sort()[0]:0},e.liveWindow=function(){var t=this.liveCurrentTime();return t===1/0?0:t-this.seekableStart()},e.isLive=function(){return this.isTracking()},e.atLiveEdge=function(){return!this.behindLiveEdge()},e.liveCurrentTime=function(){return this.pastSeekEnd()+this.seekableEnd()},e.pastSeekEnd=function(){var t=this.seekableEnd();return-1!==this.lastSeekEnd_&&t!==this.lastSeekEnd_&&(this.pastSeekEnd_=0),this.lastSeekEnd_=t,this.pastSeekEnd_},e.behindLiveEdge=function(){return this.behindLiveEdge_},e.isTracking=function(){return"number"==typeof this.trackingInterval_},e.seekToLiveEdge=function(){this.seekedBehindLive_=!1,this.atLiveEdge()||(this.skipNextSeeked_=!0,this.player_.currentTime(this.liveCurrentTime()))},e.dispose=function(){this.off(c,"visibilitychange",this.handleVisibilityChange),this.stopTracking(),n.prototype.dispose.call(this)},t}(de);function Xn(t){var e=t.el();if(e.hasAttribute("src"))return t.triggerSourceset(e.src),1;var i=t.$$("source"),n=[],e="";if(i.length){for(var r=0;r<i.length;r++){var a=i[r].src;a&&-1===n.indexOf(a)&&n.push(a)}return n.length&&(1===n.length&&(e=n[0]),t.triggerSourceset(e),1)}}function $n(t,e){for(var i={},n=0;n<t.length&&!((i=Object.getOwnPropertyDescriptor(t[n],e))&&i.set&&i.get);n++);return i.enumerable=!0,i.configurable=!0,i}function Yn(a){var e,t,i,s=a.el();s.resetSourceWatch_||(e={},t=$n([a.el(),d.HTMLMediaElement.prototype,d.Element.prototype,Jn],"innerHTML"),i=function(r){return function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=r.apply(s,e);return Xn(a),n}},["append","appendChild","insertAdjacentHTML"].forEach(function(t){s[t]&&(e[t]=s[t],s[t]=i(e[t]))}),Object.defineProperty(s,"innerHTML",le(t,{set:i(t.set)})),s.resetSourceWatch_=function(){s.resetSourceWatch_=null,Object.keys(e).forEach(function(t){s[t]=e[t]}),Object.defineProperty(s,"innerHTML",t)},a.one("sourceset",s.resetSourceWatch_))}function Kn(e,i,n,t){function r(t){return Object.defineProperty(e,i,{value:t,enumerable:!0,writable:!0})}var a={configurable:!0,enumerable:!0,get:function(){var t=n();return r(t),t}};return(t=void 0===t?!0:t)&&(a.set=r),Object.defineProperty(e,i,a)}de.registerComponent("LiveTracker",Ue);var Qn,Jn=Object.defineProperty({},"innerHTML",{get:function(){return this.cloneNode(!0).innerHTML},set:function(t){var e=c.createElement(this.nodeName.toLowerCase());e.innerHTML=t;for(var i=c.createDocumentFragment();e.childNodes.length;)i.appendChild(e.childNodes[0]);return this.innerText="",d.Element.prototype.appendChild.call(this,i),this.innerHTML}}),Zn=Object.defineProperty({},"src",{get:function(){return this.hasAttribute("src")?Re(d.Element.prototype.getAttribute.call(this,"src")):""},set:function(t){return d.Element.prototype.setAttribute.call(this,"src",t),t}}),tr=function(u){function s(t,e){var i=u.call(this,t,e)||this,e=t.source,n=!1;if(e&&(i.el_.currentSrc!==e.src||t.tag&&3===t.tag.initNetworkState_)?i.setSource(e):i.handleLateInit_(i.el_),t.enableSourceset&&i.setupSourcesetHandling_(),i.isScrubbing_=!1,i.el_.hasChildNodes()){for(var r=i.el_.childNodes,a=r.length,s=[];a--;){var o=r[a];"track"===o.nodeName.toLowerCase()&&(i.featuresNativeTextTracks?(i.remoteTextTrackEls().addTrackElement_(o),i.remoteTextTracks().addTrack(o.track),i.textTracks().addTrack(o.track),n||i.el_.hasAttribute("crossorigin")||!Be(o.src)||(n=!0)):s.push(o))}for(var l=0;l<s.length;l++)i.el_.removeChild(s[l])}return i.proxyNativeTracks_(),i.featuresNativeTextTracks&&n&&m.warn("Text Tracks are being loaded from another origin but the crossorigin attribute isn't used.\nThis may prevent text tracks from loading."),i.restoreMetadataTracksInIOSNativePlayer_(),(U||q||D)&&!0===t.nativeControlsForTouch&&i.setControls(!0),i.proxyWebkitFullscreen_(),i.triggerReady(),i}ve(s,u);var t=s.prototype;return t.dispose=function(){this.el_&&this.el_.resetSourceset_&&this.el_.resetSourceset_(),s.disposeMediaElement(this.el_),this.options_=null,u.prototype.dispose.call(this)},t.setupSourcesetHandling_=function(){var i,n,e,r,a;(i=this).featuresSourceset&&((n=i.el()).resetSourceset_||(e=$n([i.el(),d.HTMLMediaElement.prototype,Zn],"src"),r=n.setAttribute,a=n.load,Object.defineProperty(n,"src",le(e,{set:function(t){t=e.set.call(n,t);return i.triggerSourceset(n.src),t}})),n.setAttribute=function(t,e){e=r.call(n,t,e);return/src/i.test(t)&&i.triggerSourceset(n.src),e},n.load=function(){var t=a.call(n);return Xn(i)||(i.triggerSourceset(""),Yn(i)),t},n.currentSrc?i.triggerSourceset(n.currentSrc):Xn(i)||Yn(i),n.resetSourceset_=function(){n.resetSourceset_=null,n.load=a,n.setAttribute=r,Object.defineProperty(n,"src",e),n.resetSourceWatch_&&n.resetSourceWatch_()}))},t.restoreMetadataTracksInIOSNativePlayer_=function(){function t(){i=[];for(var t=0;t<n.length;t++){var e=n[t];"metadata"===e.kind&&i.push({track:e,storedMode:e.mode})}}var i,n=this.textTracks();function r(){for(var t=0;t<i.length;t++){var e=i[t];"disabled"===e.track.mode&&e.track.mode!==e.storedMode&&(e.track.mode=e.storedMode)}n.removeEventListener("change",r)}t(),n.addEventListener("change",t),this.on("dispose",function(){return n.removeEventListener("change",t)}),this.on("webkitbeginfullscreen",function(){n.removeEventListener("change",t),n.removeEventListener("change",r),n.addEventListener("change",r)}),this.on("webkitendfullscreen",function(){n.removeEventListener("change",t),n.addEventListener("change",t),n.removeEventListener("change",r)})},t.overrideNative_=function(t,e){var i,n=this;e===this["featuresNative"+t+"Tracks"]&&(this[(i=t.toLowerCase())+"TracksListeners_"]&&Object.keys(this[i+"TracksListeners_"]).forEach(function(t){n.el()[i+"Tracks"].removeEventListener(t,n[i+"TracksListeners_"][t])}),this["featuresNative"+t+"Tracks"]=!e,this[i+"TracksListeners_"]=null,this.proxyNativeTracksForType_(i))},t.overrideNativeAudioTracks=function(t){this.overrideNative_("Audio",t)},t.overrideNativeVideoTracks=function(t){this.overrideNative_("Video",t)},t.proxyNativeTracksForType_=function(i){var t,e,n=this,r=mi[i],a=this.el()[r.getterName],s=this[r.getterName]();this["featuresNative"+r.capitalName+"Tracks"]&&a&&a.addEventListener&&(e=function(){for(var t=[],e=0;e<s.length;e++){for(var i=!1,n=0;n<a.length;n++)if(a[n]===s[e]){i=!0;break}i||t.push(s[e])}for(;t.length;)s.removeTrack(t.shift())},this[r.getterName+"Listeners_"]=t={change:function(t){var e={type:"change",target:s,currentTarget:s,srcElement:s};s.trigger(e),"text"===i&&n[gi.remoteText.getterName]().trigger(e)},addtrack:function(t){s.addTrack(t.track)},removetrack:function(t){s.removeTrack(t.track)}},Object.keys(t).forEach(function(e){var i=t[e];a.addEventListener(e,i),n.on("dispose",function(t){return a.removeEventListener(e,i)})}),this.on("loadstart",e),this.on("dispose",function(t){return n.off("loadstart",e)}))},t.proxyNativeTracks_=function(){var e=this;mi.names.forEach(function(t){e.proxyNativeTracksForType_(t)})},t.createEl=function(){var t,e=this.options_.tag;e&&(this.options_.playerElIngest||this.movingMediaElementInDOM)||(e?(t=e.cloneNode(!0),e.parentNode&&e.parentNode.insertBefore(t,e),s.disposeMediaElement(e),e=t):(e=c.createElement("video"),t=le({},this.options_.tag&&at(this.options_.tag)),U&&!0===this.options_.nativeControlsForTouch||delete t.controls,rt(e,b(t,{id:this.options_.techId,class:"vjs-tech"}))),e.playerId=this.options_.playerId),void 0!==this.options_.preload&&ot(e,"preload",this.options_.preload),void 0!==this.options_.disablePictureInPicture&&(e.disablePictureInPicture=this.options_.disablePictureInPicture);for(var i=["loop","muted","playsinline","autoplay"],n=0;n<i.length;n++){var r=i[n],a=this.options_[r];void 0!==a&&(a?ot(e,r,r):lt(e,r),e[r]=a)}return e},t.handleLateInit_=function(t){if(0!==t.networkState&&3!==t.networkState){if(0===t.readyState){var e=!1,i=function(){e=!0};this.on("loadstart",i);var n=function(){e||this.trigger("loadstart")};return this.on("loadedmetadata",n),void this.ready(function(){this.off("loadstart",i),this.off("loadedmetadata",n),e||this.trigger("loadstart")})}var r=["loadstart"];r.push("loadedmetadata"),2<=t.readyState&&r.push("loadeddata"),3<=t.readyState&&r.push("canplay"),4<=t.readyState&&r.push("canplaythrough"),this.ready(function(){r.forEach(function(t){this.trigger(t)},this)})}},t.setScrubbing=function(t){this.isScrubbing_=t},t.scrubbing=function(){return this.isScrubbing_},t.setCurrentTime=function(t){try{this.isScrubbing_&&this.el_.fastSeek&&H?this.el_.fastSeek(t):this.el_.currentTime=t}catch(t){m(t,"Video is not ready. (Video.js)")}},t.duration=function(){var e=this;return this.el_.duration===1/0&&A&&M&&0===this.el_.currentTime?(this.on("timeupdate",function t(){0<e.el_.currentTime&&(e.el_.duration===1/0&&e.trigger("durationchange"),e.off("timeupdate",t))}),NaN):this.el_.duration||NaN},t.width=function(){return this.el_.offsetWidth},t.height=function(){return this.el_.offsetHeight},t.proxyWebkitFullscreen_=function(){var t,e,i=this;"webkitDisplayingFullscreen"in this.el_&&(t=function(){this.trigger("fullscreenchange",{isFullscreen:!1})},this.on("webkitbeginfullscreen",e=function(){"webkitPresentationMode"in this.el_&&"picture-in-picture"!==this.el_.webkitPresentationMode&&(this.one("webkitendfullscreen",t),this.trigger("fullscreenchange",{isFullscreen:!0,nativeIOSFullscreen:!0}))}),this.on("dispose",function(){i.off("webkitbeginfullscreen",e),i.off("webkitendfullscreen",t)}))},t.supportsFullScreen=function(){if("function"==typeof this.el_.webkitEnterFullScreen){var t=d.navigator&&d.navigator.userAgent||"";if(/Android/.test(t)||!/Chrome|Mac OS X 10.5/.test(t))return!0}return!1},t.enterFullScreen=function(){var t=this.el_;if(t.paused&&t.networkState<=t.HAVE_METADATA)Ee(this.el_.play()),this.setTimeout(function(){t.pause();try{t.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},0);else try{t.webkitEnterFullScreen()}catch(t){this.trigger("fullscreenerror",t)}},t.exitFullScreen=function(){this.el_.webkitDisplayingFullscreen?this.el_.webkitExitFullScreen():this.trigger("fullscreenerror",new Error("The video is not fullscreen"))},t.requestPictureInPicture=function(){return this.el_.requestPictureInPicture()},t.src=function(t){if(void 0===t)return this.el_.src;this.setSrc(t)},t.reset=function(){s.resetMediaElement(this.el_)},t.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.el_.currentSrc},t.setControls=function(t){this.el_.controls=!!t},t.addTextTrack=function(t,e,i){return this.featuresNativeTextTracks?this.el_.addTextTrack(t,e,i):u.prototype.addTextTrack.call(this,t,e,i)},t.createRemoteTextTrack=function(t){if(!this.featuresNativeTextTracks)return u.prototype.createRemoteTextTrack.call(this,t);var e=c.createElement("track");return t.kind&&(e.kind=t.kind),t.label&&(e.label=t.label),(t.language||t.srclang)&&(e.srclang=t.language||t.srclang),t.default&&(e.default=t.default),t.id&&(e.id=t.id),t.src&&(e.src=t.src),e},t.addRemoteTextTrack=function(t,e){e=u.prototype.addRemoteTextTrack.call(this,t,e);return this.featuresNativeTextTracks&&this.el().appendChild(e),e},t.removeRemoteTextTrack=function(t){if(u.prototype.removeRemoteTextTrack.call(this,t),this.featuresNativeTextTracks)for(var e=this.$$("track"),i=e.length;i--;)t!==e[i]&&t!==e[i].track||this.el().removeChild(e[i])},t.getVideoPlaybackQuality=function(){if("function"==typeof this.el().getVideoPlaybackQuality)return this.el().getVideoPlaybackQuality();var t={};return void 0!==this.el().webkitDroppedFrameCount&&void 0!==this.el().webkitDecodedFrameCount&&(t.droppedVideoFrames=this.el().webkitDroppedFrameCount,t.totalVideoFrames=this.el().webkitDecodedFrameCount),d.performance&&"function"==typeof d.performance.now?t.creationTime=d.performance.now():d.performance&&d.performance.timing&&"number"==typeof d.performance.timing.navigationStart&&(t.creationTime=d.Date.now()-d.performance.timing.navigationStart),t},s}(Gi);Kn(tr,"TEST_VID",function(){if(X()){var t=c.createElement("video"),e=c.createElement("track");return e.kind="captions",e.srclang="en",e.label="English",t.appendChild(e),t}}),tr.isSupported=function(){try{tr.TEST_VID.volume=.5}catch(t){return!1}return!(!tr.TEST_VID||!tr.TEST_VID.canPlayType)},tr.canPlayType=function(t){return tr.TEST_VID.canPlayType(t)},tr.canPlaySource=function(t,e){return tr.canPlayType(t.type)},tr.canControlVolume=function(){try{var t=tr.TEST_VID.volume;return tr.TEST_VID.volume=t/2+.1,t!==tr.TEST_VID.volume}catch(t){return!1}},tr.canMuteVolume=function(){try{var t=tr.TEST_VID.muted;return tr.TEST_VID.muted=!t,tr.TEST_VID.muted?ot(tr.TEST_VID,"muted","muted"):lt(tr.TEST_VID,"muted"),t!==tr.TEST_VID.muted}catch(t){return!1}},tr.canControlPlaybackRate=function(){if(A&&M&&R<58)return!1;try{var t=tr.TEST_VID.playbackRate;return tr.TEST_VID.playbackRate=t/2+.1,t!==tr.TEST_VID.playbackRate}catch(t){return!1}},tr.canOverrideAttributes=function(){try{var t=function(){};Object.defineProperty(c.createElement("video"),"src",{get:t,set:t}),Object.defineProperty(c.createElement("audio"),"src",{get:t,set:t}),Object.defineProperty(c.createElement("video"),"innerHTML",{get:t,set:t}),Object.defineProperty(c.createElement("audio"),"innerHTML",{get:t,set:t})}catch(t){return!1}return!0},tr.supportsNativeTextTracks=function(){return H||z&&M},tr.supportsNativeVideoTracks=function(){return!(!tr.TEST_VID||!tr.TEST_VID.videoTracks)},tr.supportsNativeAudioTracks=function(){return!(!tr.TEST_VID||!tr.TEST_VID.audioTracks)},tr.Events=["loadstart","suspend","abort","error","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","playing","waiting","seeking","seeked","ended","durationchange","timeupdate","progress","play","pause","ratechange","resize","volumechange"],[["featuresVolumeControl","canControlVolume"],["featuresMuteControl","canMuteVolume"],["featuresPlaybackRate","canControlPlaybackRate"],["featuresSourceset","canOverrideAttributes"],["featuresNativeTextTracks","supportsNativeTextTracks"],["featuresNativeVideoTracks","supportsNativeVideoTracks"],["featuresNativeAudioTracks","supportsNativeAudioTracks"]].forEach(function(t){var e=t[0],i=t[1];Kn(tr.prototype,e,function(){return tr[i]()},!0)}),tr.prototype.movingMediaElementInDOM=!z,tr.prototype.featuresFullscreenResize=!0,tr.prototype.featuresProgressEvents=!0,tr.prototype.featuresTimeupdateEvents=!0,tr.patchCanPlayType=function(){4<=P&&!O&&!M&&(Qn=tr.TEST_VID&&tr.TEST_VID.constructor.prototype.canPlayType,tr.TEST_VID.constructor.prototype.canPlayType=function(t){return t&&/^application\/(?:x-|vnd\.apple\.)mpegurl/i.test(t)?"maybe":Qn.call(this,t)})},tr.unpatchCanPlayType=function(){var t=tr.TEST_VID.constructor.prototype.canPlayType;return Qn&&(tr.TEST_VID.constructor.prototype.canPlayType=Qn),t},tr.patchCanPlayType(),tr.disposeMediaElement=function(t){if(t){for(t.parentNode&&t.parentNode.removeChild(t);t.hasChildNodes();)t.removeChild(t.firstChild);t.removeAttribute("src"),"function"==typeof t.load&&function(){try{t.load()}catch(t){}}()}},tr.resetMediaElement=function(t){if(t){for(var e=t.querySelectorAll("source"),i=e.length;i--;)t.removeChild(e[i]);t.removeAttribute("src"),"function"==typeof t.load&&function(){try{t.load()}catch(t){}}()}},["muted","defaultMuted","autoplay","controls","loop","playsinline"].forEach(function(t){tr.prototype[t]=function(){return this.el_[t]||this.el_.hasAttribute(t)}}),["muted","defaultMuted","autoplay","loop","playsinline"].forEach(function(e){tr.prototype["set"+oe(e)]=function(t){(this.el_[e]=t)?this.el_.setAttribute(e,e):this.el_.removeAttribute(e)}}),["paused","currentTime","buffered","volume","poster","preload","error","seeking","seekable","ended","playbackRate","defaultPlaybackRate","disablePictureInPicture","played","networkState","readyState","videoWidth","videoHeight","crossOrigin"].forEach(function(t){tr.prototype[t]=function(){return this.el_[t]}}),["volume","src","poster","preload","playbackRate","defaultPlaybackRate","disablePictureInPicture","crossOrigin"].forEach(function(e){tr.prototype["set"+oe(e)]=function(t){this.el_[e]=t}}),["pause","load","play"].forEach(function(t){tr.prototype[t]=function(){return this.el_[t]()}}),Gi.withSourceHandlers(tr),tr.nativeSourceHandler={},tr.nativeSourceHandler.canPlayType=function(t){try{return tr.TEST_VID.canPlayType(t)}catch(t){return""}},tr.nativeSourceHandler.canHandleSource=function(t,e){if(t.type)return tr.nativeSourceHandler.canPlayType(t.type);if(t.src){t=Ne(t.src);return tr.nativeSourceHandler.canPlayType("video/"+t)}return""},tr.nativeSourceHandler.handleSource=function(t,e,i){e.setSrc(t.src)},tr.nativeSourceHandler.dispose=function(){},tr.registerSourceHandler(tr.nativeSourceHandler),Gi.registerTech("Html5",tr);var er=["progress","abort","suspend","emptied","stalled","loadedmetadata","loadeddata","timeupdate","resize","volumechange","texttrackchange"],ir={canplay:"CanPlay",canplaythrough:"CanPlayThrough",playing:"Playing",seeked:"Seeked"},nr=["tiny","xsmall","small","medium","large","xlarge","huge"],rr={};nr.forEach(function(t){var e="x"===t.charAt(0)?"x-"+t.substring(1):t;rr[t]="vjs-layout-"+e});var ar={tiny:210,xsmall:320,small:425,medium:768,large:1440,xlarge:2560,huge:1/0},sr=function(h){function o(t,e,i){var n,r;if(t.id=t.id||e.id||"vjs_video_"+Pt++,(e=b(o.getTagSettings(t),e)).initChildren=!1,e.createEl=!1,e.evented=!1,e.reportTouchActivity=!1,!e.language)if("function"==typeof t.closest){var a=t.closest("[lang]");a&&a.getAttribute&&(e.language=a.getAttribute("lang"))}else for(var s=t;s&&1===s.nodeType;){if(at(s).hasOwnProperty("lang")){e.language=s.getAttribute("lang");break}s=s.parentNode}if((n=h.call(this,null,e,i)||this).boundDocumentFullscreenChange_=function(t){return n.documentFullscreenChange_(t)},n.boundFullWindowOnEscKey_=function(t){return n.fullWindowOnEscKey(t)},n.isFullscreen_=!1,n.log=g(n.id_),n.fsApi_=l,n.isPosterFromTech_=!1,n.queuedCallbacks_=[],n.isReady_=!1,n.hasStarted_=!1,n.userActive_=!1,n.debugEnabled_=!1,!n.options_||!n.options_.techOrder||!n.options_.techOrder.length)throw new Error("No techOrder specified. Did you overwrite videojs.options instead of just changing the properties you want to override?");n.tag=t,n.tagAttributes=t&&at(t),n.language(n.options_.language),e.languages?(r={},Object.getOwnPropertyNames(e.languages).forEach(function(t){r[t.toLowerCase()]=e.languages[t]}),n.languages_=r):n.languages_=o.prototype.options_.languages,n.resetCache_(),n.poster_=e.poster||"",n.controls_=!!e.controls,t.controls=!1,t.removeAttribute("controls"),n.changingSrc_=!1,n.playCallbacks_=[],n.playTerminatedQueue_=[],t.hasAttribute("autoplay")?n.autoplay(!0):n.autoplay(n.options_.autoplay),e.plugins&&Object.keys(e.plugins).forEach(function(t){if("function"!=typeof n[t])throw new Error('plugin "'+t+'" does not exist')}),n.scrubbing_=!1,n.el_=n.createEl(),ne(ge(n),{eventBusKey:"el_"}),n.fsApi_.requestFullscreen&&(Ft(c,n.fsApi_.fullscreenchange,n.boundDocumentFullscreenChange_),n.on(n.fsApi_.fullscreenchange,n.boundDocumentFullscreenChange_)),n.fluid_&&n.on(["playerreset","resize"],n.updateStyleEl_);i=le(n.options_);e.plugins&&Object.keys(e.plugins).forEach(function(t){n[t](e.plugins[t])}),e.debug&&n.debug(!0),n.options_.playerOptions=i,n.middleware_=[],n.initChildren(),n.isAudio("audio"===t.nodeName.toLowerCase()),n.controls()?n.addClass("vjs-controls-enabled"):n.addClass("vjs-controls-disabled"),n.el_.setAttribute("role","region"),n.isAudio()?n.el_.setAttribute("aria-label",n.localize("Audio Player")):n.el_.setAttribute("aria-label",n.localize("Video Player")),n.isAudio()&&n.addClass("vjs-audio"),n.flexNotSupported_()&&n.addClass("vjs-no-flex"),U&&n.addClass("vjs-touch-enabled"),z||n.addClass("vjs-workinghover"),o.players[n.id_]=ge(n);t="7.11.8".split(".")[0];return n.addClass("vjs-v"+t),n.userActive(!0),n.reportUserActivity(),n.one("play",n.listenForUserActivity_),n.on("stageclick",n.handleStageClick_),n.on("keydown",n.handleKeyDown),n.on("languagechange",n.handleLanguagechange),n.breakpoints(n.options_.breakpoints),n.responsive(n.options_.responsive),n}ve(o,h);var t=o.prototype;return t.dispose=function(){var e=this;this.trigger("dispose"),this.off("dispose"),Ut(c,this.fsApi_.fullscreenchange,this.boundDocumentFullscreenChange_),Ut(c,"keydown",this.boundFullWindowOnEscKey_),this.styleEl_&&this.styleEl_.parentNode&&(this.styleEl_.parentNode.removeChild(this.styleEl_),this.styleEl_=null),o.players[this.id_]=null,this.tag&&this.tag.player&&(this.tag.player=null),this.el_&&this.el_.player&&(this.el_.player=null),this.tech_&&(this.tech_.dispose(),this.isPosterFromTech_=!1,this.poster_=""),this.playerElIngest_&&(this.playerElIngest_=null),this.tag&&(this.tag=null),$i[this.id()]=null,vi.names.forEach(function(t){t=vi[t],t=e[t.getterName]();t&&t.off&&t.off()}),h.prototype.dispose.call(this)},t.createEl=function(){var e,i=this.tag,t=this.playerElIngest_=i.parentNode&&i.parentNode.hasAttribute&&i.parentNode.hasAttribute("data-vjs-player"),n="video-js"===this.tag.tagName.toLowerCase();t?e=this.el_=i.parentNode:n||(e=this.el_=h.prototype.createEl.call(this,"div"));var r,a,s=at(i);if(n){for(e=this.el_=i,i=this.tag=c.createElement("video");e.children.length;)i.appendChild(e.firstChild);tt(e,"video-js")||et(e,"video-js"),e.appendChild(i),t=this.playerElIngest_=e,Object.keys(e).forEach(function(t){try{i[t]=e[t]}catch(t){}})}i.setAttribute("tabindex","-1"),s.tabindex="-1",(N||M&&F)&&(i.setAttribute("role","application"),s.role="application"),i.removeAttribute("width"),i.removeAttribute("height"),"width"in s&&delete s.width,"height"in s&&delete s.height,Object.getOwnPropertyNames(s).forEach(function(t){n&&"class"===t||e.setAttribute(t,s[t]),n&&i.setAttribute(t,s[t])}),i.playerId=i.id,i.id+="_html5_api",i.className="vjs-tech",(i.player=e.player=this).addClass("vjs-paused"),!0!==d.VIDEOJS_NO_DYNAMIC_STYLE&&(this.styleEl_=It("vjs-styles-dimensions"),r=Tt(".vjs-styles-defaults"),(a=Tt("head")).insertBefore(this.styleEl_,r?r.nextSibling:a.firstChild)),this.fill_=!1,this.fluid_=!1,this.width(this.options_.width),this.height(this.options_.height),this.fill(this.options_.fill),this.fluid(this.options_.fluid),this.aspectRatio(this.options_.aspectRatio),this.crossOrigin(this.options_.crossOrigin||this.options_.crossorigin);for(var o=i.getElementsByTagName("a"),l=0;l<o.length;l++){var u=o.item(l);et(u,"vjs-hidden"),u.setAttribute("hidden","hidden")}return i.initNetworkState_=i.networkState,i.parentNode&&!t&&i.parentNode.insertBefore(e,i),Z(i,e),this.children_.unshift(i),this.el_.setAttribute("lang",this.language_),this.el_=e},t.crossOrigin=function(t){if(!t)return this.techGet_("crossOrigin");"anonymous"===t||"use-credentials"===t?this.techCall_("setCrossOrigin",t):m.warn('crossOrigin must be "anonymous" or "use-credentials", given "'+t+'"')},t.width=function(t){return this.dimension("width",t)},t.height=function(t){return this.dimension("height",t)},t.dimension=function(t,e){var i=t+"_";if(void 0===e)return this[i]||0;if(""===e||"auto"===e)return this[i]=void 0,void this.updateStyleEl_();var n=parseFloat(e);isNaN(n)?m.error('Improper value "'+e+'" supplied for for '+t):(this[i]=n,this.updateStyleEl_())},t.fluid=function(t){var e,i=this;if(void 0===t)return!!this.fluid_;this.fluid_=!!t,ee(this)&&this.off(["playerreset","resize"],this.updateStyleEl_),t?(this.addClass("vjs-fluid"),this.fill(!1),e=function(){i.on(["playerreset","resize"],i.updateStyleEl_)},ee(t=this)?e():(t.eventedCallbacks||(t.eventedCallbacks=[]),t.eventedCallbacks.push(e))):this.removeClass("vjs-fluid"),this.updateStyleEl_()},t.fill=function(t){if(void 0===t)return!!this.fill_;this.fill_=!!t,t?(this.addClass("vjs-fill"),this.fluid(!1)):this.removeClass("vjs-fill")},t.aspectRatio=function(t){if(void 0===t)return this.aspectRatio_;if(!/^\d+\:\d+$/.test(t))throw new Error("Improper value supplied for aspect ratio. The format should be width:height, for example 16:9.");this.aspectRatio_=t,this.fluid(!0),this.updateStyleEl_()},t.updateStyleEl_=function(){var t,e,i,n;!0!==d.VIDEOJS_NO_DYNAMIC_STYLE?(n=(i=(void 0!==this.aspectRatio_&&"auto"!==this.aspectRatio_?this.aspectRatio_:0<this.videoWidth()?this.videoWidth()+":"+this.videoHeight():"16:9").split(":"))[1]/i[0],t=void 0!==this.width_?this.width_:void 0!==this.height_?this.height_/n:this.videoWidth()||300,e=void 0!==this.height_?this.height_:t*n,i=/^[^a-zA-Z]/.test(this.id())?"dimensions-"+this.id():this.id()+"-dimensions",this.addClass(i),At(this.styleEl_,"\n      ."+i+" {\n        width: "+t+"px;\n        height: "+e+"px;\n      }\n\n      ."+i+".vjs-fluid {\n        padding-top: "+100*n+"%;\n      }\n    ")):(e="number"==typeof this.width_?this.width_:this.options_.width,i="number"==typeof this.height_?this.height_:this.options_.height,(n=this.tech_&&this.tech_.el())&&(0<=e&&(n.width=e),0<=i&&(n.height=i)))},t.loadTech_=function(t,e){var i=this;this.tech_&&this.unloadTech_();var n=oe(t),r=t.charAt(0).toLowerCase()+t.slice(1);"Html5"!==n&&this.tag&&(Gi.getTech("Html5").disposeMediaElement(this.tag),this.tag.player=null,this.tag=null),this.techName_=n,this.isReady_=!1;var a={source:e,autoplay:"string"!=typeof this.autoplay()&&this.autoplay(),nativeControlsForTouch:this.options_.nativeControlsForTouch,playerId:this.id(),techId:this.id()+"_"+r+"_api",playsinline:this.options_.playsinline,preload:this.options_.preload,loop:this.options_.loop,disablePictureInPicture:this.options_.disablePictureInPicture,muted:this.options_.muted,poster:this.poster(),language:this.language(),playerElIngest:this.playerElIngest_||!1,"vtt.js":this.options_["vtt.js"],canOverridePoster:!!this.options_.techCanOverridePoster,enableSourceset:this.options_.enableSourceset,Promise:this.options_.Promise};vi.names.forEach(function(t){t=vi[t];a[t.getterName]=i[t.privateName]}),b(a,this.options_[n]),b(a,this.options_[r]),b(a,this.options_[t.toLowerCase()]),this.tag&&(a.tag=this.tag),e&&e.src===this.cache_.src&&0<this.cache_.currentTime&&(a.startTime=this.cache_.currentTime);var s,t=Gi.getTech(t);if(!t)throw new Error("No Tech named '"+n+"' exists! '"+n+"' should be registered using videojs.registerTech()'");this.tech_=new t(a),this.tech_.ready(Ht(this,this.handleTechReady_),!0),t=this.textTracksJson_||[],s=this.tech_,t.forEach(function(t){var e=s.addRemoteTextTrack(t).track;!t.src&&t.cues&&t.cues.forEach(function(t){return e.addCue(t)})}),s.textTracks(),er.forEach(function(t){i.on(i.tech_,t,i["handleTech"+oe(t)+"_"])}),Object.keys(ir).forEach(function(e){i.on(i.tech_,e,function(t){0===i.tech_.playbackRate()&&i.tech_.seeking()?i.queuedCallbacks_.push({callback:i["handleTech"+ir[e]+"_"].bind(i),event:t}):i["handleTech"+ir[e]+"_"](t)})}),this.on(this.tech_,"loadstart",this.handleTechLoadStart_),this.on(this.tech_,"sourceset",this.handleTechSourceset_),this.on(this.tech_,"waiting",this.handleTechWaiting_),this.on(this.tech_,"ended",this.handleTechEnded_),this.on(this.tech_,"seeking",this.handleTechSeeking_),this.on(this.tech_,"play",this.handleTechPlay_),this.on(this.tech_,"firstplay",this.handleTechFirstPlay_),this.on(this.tech_,"pause",this.handleTechPause_),this.on(this.tech_,"durationchange",this.handleTechDurationChange_),this.on(this.tech_,"fullscreenchange",this.handleTechFullscreenChange_),this.on(this.tech_,"fullscreenerror",this.handleTechFullscreenError_),this.on(this.tech_,"enterpictureinpicture",this.handleTechEnterPictureInPicture_),this.on(this.tech_,"leavepictureinpicture",this.handleTechLeavePictureInPicture_),this.on(this.tech_,"error",this.handleTechError_),this.on(this.tech_,"loadedmetadata",this.updateStyleEl_),this.on(this.tech_,"posterchange",this.handleTechPosterChange_),this.on(this.tech_,"textdata",this.handleTechTextData_),this.on(this.tech_,"ratechange",this.handleTechRateChange_),this.usingNativeControls(this.techGet_("controls")),this.controls()&&!this.usingNativeControls()&&this.addTechControlsListeners_(),this.tech_.el().parentNode===this.el()||"Html5"===n&&this.tag||Z(this.tech_.el(),this.el()),this.tag&&(this.tag.player=null,this.tag=null)},t.unloadTech_=function(){var t,e,i,n=this;vi.names.forEach(function(t){t=vi[t];n[t.privateName]=n[t.getterName]()}),this.textTracksJson_=(t=this.tech_,e=t.$$("track"),i=Array.prototype.map.call(e,function(t){return t.track}),Array.prototype.map.call(e,function(t){var e=ke(t.track);return t.src&&(e.src=t.src),e}).concat(Array.prototype.filter.call(t.textTracks(),function(t){return-1===i.indexOf(t)}).map(ke))),this.isReady_=!1,this.tech_.dispose(),this.tech_=!1,this.isPosterFromTech_&&(this.poster_="",this.trigger("posterchange")),this.isPosterFromTech_=!1},t.tech=function(t){return void 0===t&&m.warn("Using the tech directly can be dangerous. I hope you know what you're doing.\nSee https://github.com/videojs/video.js/issues/2617 for more info.\n"),this.tech_},t.addTechControlsListeners_=function(){this.removeTechControlsListeners_(),this.on(this.tech_,"mouseup",this.handleTechClick_),this.on(this.tech_,"dblclick",this.handleTechDoubleClick_),this.on(this.tech_,"touchstart",this.handleTechTouchStart_),this.on(this.tech_,"touchmove",this.handleTechTouchMove_),this.on(this.tech_,"touchend",this.handleTechTouchEnd_),this.on(this.tech_,"tap",this.handleTechTap_)},t.removeTechControlsListeners_=function(){this.off(this.tech_,"tap",this.handleTechTap_),this.off(this.tech_,"touchstart",this.handleTechTouchStart_),this.off(this.tech_,"touchmove",this.handleTechTouchMove_),this.off(this.tech_,"touchend",this.handleTechTouchEnd_),this.off(this.tech_,"mouseup",this.handleTechClick_),this.off(this.tech_,"dblclick",this.handleTechDoubleClick_)},t.handleTechReady_=function(){this.triggerReady(),this.cache_.volume&&this.techCall_("setVolume",this.cache_.volume),this.handleTechPosterChange_(),this.handleTechDurationChange_()},t.handleTechLoadStart_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-seeking"),this.error(null),this.handleTechDurationChange_(),this.paused()?(this.hasStarted(!1),this.trigger("loadstart")):(this.trigger("loadstart"),this.trigger("firstplay")),this.manualAutoplay_(this.autoplay())},t.manualAutoplay_=function(e){var n=this;if(this.tech_&&"string"==typeof e){var t,i=function(){var t=n.muted();function e(){n.muted(t)}n.muted(!0),n.playTerminatedQueue_.push(e);var i=n.play();if(Se(i))return i.catch(e)};if("any"===e&&!0!==this.muted()?Se(t=this.play())&&(t=t.catch(i)):t="muted"===e&&!0!==this.muted()?i():this.play(),Se(t))return t.then(function(){n.trigger({type:"autoplay-success",autoplay:e})}).catch(function(t){n.trigger({type:"autoplay-failure",autoplay:e})})}},t.updateSourceCaches_=function(t){var e=t=void 0===t?"":t,i="";"string"!=typeof e&&(e=t.src,i=t.type),this.cache_.source=this.cache_.source||{},this.cache_.sources=this.cache_.sources||[],e&&!i&&(i=function(t,e){if(!e)return"";if(t.cache_.source.src===e&&t.cache_.source.type)return t.cache_.source.type;var i=t.cache_.sources.filter(function(t){return t.src===e});if(i.length)return i[0].type;for(var n=t.$$("source"),r=0;r<n.length;r++){var a=n[r];if(a.type&&a.src&&a.src===e)return a.type}return nn(e)}(this,e)),this.cache_.source=le({},t,{src:e,type:i});for(var i=this.cache_.sources.filter(function(t){return t.src&&t.src===e}),n=[],r=this.$$("source"),a=[],s=0;s<r.length;s++){var o=at(r[s]);n.push(o),o.src&&o.src===e&&a.push(o.src)}a.length&&!i.length?this.cache_.sources=n:i.length||(this.cache_.sources=[this.cache_.source]),this.cache_.src=e},t.handleTechSourceset_=function(t){var e,i,n,r=this;this.changingSrc_||(e=function(t){return r.updateSourceCaches_(t)},i=this.currentSource().src,n=t.src,i&&!/^blob:/.test(i)&&/^blob:/.test(n)&&(this.lastSource_&&(this.lastSource_.tech===n||this.lastSource_.player===i)||(e=function(){})),e(n),t.src||this.tech_.any(["sourceset","loadstart"],function(t){"sourceset"!==t.type&&(t=r.techGet("currentSrc"),r.lastSource_.tech=t,r.updateSourceCaches_(t))})),this.lastSource_={player:this.currentSource().src,tech:t.src},this.trigger({src:t.src,type:"sourceset"})},t.hasStarted=function(t){if(void 0===t)return this.hasStarted_;t!==this.hasStarted_&&(this.hasStarted_=t,this.hasStarted_?(this.addClass("vjs-has-started"),this.trigger("firstplay")):this.removeClass("vjs-has-started"))},t.handleTechPlay_=function(){this.removeClass("vjs-ended"),this.removeClass("vjs-paused"),this.addClass("vjs-playing"),this.hasStarted(!0),this.trigger("play")},t.handleTechRateChange_=function(){0<this.tech_.playbackRate()&&0===this.cache_.lastPlaybackRate&&(this.queuedCallbacks_.forEach(function(t){return t.callback(t.event)}),this.queuedCallbacks_=[]),this.cache_.lastPlaybackRate=this.tech_.playbackRate(),this.trigger("ratechange")},t.handleTechWaiting_=function(){var e=this;this.addClass("vjs-waiting"),this.trigger("waiting");var i=this.currentTime();this.on("timeupdate",function t(){i!==e.currentTime()&&(e.removeClass("vjs-waiting"),e.off("timeupdate",t))})},t.handleTechCanPlay_=function(){this.removeClass("vjs-waiting"),this.trigger("canplay")},t.handleTechCanPlayThrough_=function(){this.removeClass("vjs-waiting"),this.trigger("canplaythrough")},t.handleTechPlaying_=function(){this.removeClass("vjs-waiting"),this.trigger("playing")},t.handleTechSeeking_=function(){this.addClass("vjs-seeking"),this.trigger("seeking")},t.handleTechSeeked_=function(){this.removeClass("vjs-seeking"),this.removeClass("vjs-ended"),this.trigger("seeked")},t.handleTechFirstPlay_=function(){this.options_.starttime&&(m.warn("Passing the `starttime` option to the player will be deprecated in 6.0"),this.currentTime(this.options_.starttime)),this.addClass("vjs-has-started"),this.trigger("firstplay")},t.handleTechPause_=function(){this.removeClass("vjs-playing"),this.addClass("vjs-paused"),this.trigger("pause")},t.handleTechEnded_=function(){this.addClass("vjs-ended"),this.options_.loop?(this.currentTime(0),this.play()):this.paused()||this.pause(),this.trigger("ended")},t.handleTechDurationChange_=function(){this.duration(this.techGet_("duration"))},t.handleTechClick_=function(t){_t(t)&&this.controls_&&(this.paused()?Ee(this.play()):this.pause())},t.handleTechDoubleClick_=function(e){this.controls_&&(Array.prototype.some.call(this.$$(".vjs-control-bar, .vjs-modal-dialog"),function(t){return t.contains(e.target)})||void 0!==this.options_&&void 0!==this.options_.userActions&&void 0!==this.options_.userActions.doubleClick&&!1===this.options_.userActions.doubleClick||(void 0!==this.options_&&void 0!==this.options_.userActions&&"function"==typeof this.options_.userActions.doubleClick?this.options_.userActions.doubleClick.call(this,e):this.isFullscreen()?this.exitFullscreen():this.requestFullscreen()))},t.handleTechTap_=function(){this.userActive(!this.userActive())},t.handleTechTouchStart_=function(){this.userWasActive=this.userActive()},t.handleTechTouchMove_=function(){this.userWasActive&&this.reportUserActivity()},t.handleTechTouchEnd_=function(t){t.cancelable&&t.preventDefault()},t.handleStageClick_=function(){this.reportUserActivity()},t.toggleFullscreenClass_=function(){this.isFullscreen()?this.addClass("vjs-fullscreen"):this.removeClass("vjs-fullscreen")},t.documentFullscreenChange_=function(t){var e=t.target.player;e&&e!==this||(t=this.el(),!(e=c[this.fsApi_.fullscreenElement]===t)&&t.matches?e=t.matches(":"+this.fsApi_.fullscreen):!e&&t.msMatchesSelector&&(e=t.msMatchesSelector(":"+this.fsApi_.fullscreen)),this.isFullscreen(e))},t.handleTechFullscreenChange_=function(t,e){e&&(e.nativeIOSFullscreen&&this.toggleClass("vjs-ios-native-fs"),this.isFullscreen(e.isFullscreen))},t.handleTechFullscreenError_=function(t,e){this.trigger("fullscreenerror",e)},t.togglePictureInPictureClass_=function(){this.isInPictureInPicture()?this.addClass("vjs-picture-in-picture"):this.removeClass("vjs-picture-in-picture")},t.handleTechEnterPictureInPicture_=function(t){this.isInPictureInPicture(!0)},t.handleTechLeavePictureInPicture_=function(t){this.isInPictureInPicture(!1)},t.handleTechError_=function(){var t=this.tech_.error();this.error(t)},t.handleTechTextData_=function(t,e){e=1<arguments.length?e:null;this.trigger("textdata",e)},t.getCache=function(){return this.cache_},t.resetCache_=function(){this.cache_={currentTime:0,initTime:0,inactivityTimeout:this.options_.inactivityTimeout,duration:NaN,lastVolume:1,lastPlaybackRate:this.defaultPlaybackRate(),media:null,src:"",source:{},sources:[],volume:1}},t.techCall_=function(e,i){this.ready(function(){if(e in Zi)return t=this.middleware_,this.tech_[e](t.reduce(en(e),i));var t;if(e in tn)return Qi(this.middleware_,this.tech_,e,i);try{this.tech_&&this.tech_[e](i)}catch(t){throw m(t),t}},!0)},t.techGet_=function(e){if(this.tech_&&this.tech_.isReady_){if(e in Ji)return t=this.middleware_,i=this.tech_,t.reduceRight(en(e),i[e]());if(e in tn)return Qi(this.middleware_,this.tech_,e);try{return this.tech_[e]()}catch(t){if(void 0===this.tech_[e])throw m("Video.js: "+e+" method not defined for "+this.techName_+" playback technology.",t),t;if("TypeError"===t.name)throw m("Video.js: "+e+" unavailable on "+this.techName_+" playback technology element.",t),this.tech_.isReady_=!1,t;throw m(t),t}}var t,i},t.play=function(){var e=this,t=this.options_.Promise||d.Promise;return t?new t(function(t){e.play_(t)}):this.play_()},t.play_=function(t){var e=this;this.playCallbacks_.push(t=void 0===t?Ee:t);t=Boolean(!this.changingSrc_&&(this.src()||this.currentSrc()));if(this.waitToPlay_&&(this.off(["ready","loadstart"],this.waitToPlay_),this.waitToPlay_=null),!this.isReady_||!t)return this.waitToPlay_=function(t){e.play_()},this.one(["ready","loadstart"],this.waitToPlay_),void(t||!H&&!z||this.load());t=this.techGet_("play");null===t?this.runPlayTerminatedQueue_():this.runPlayCallbacks_(t)},t.runPlayTerminatedQueue_=function(){var t=this.playTerminatedQueue_.slice(0);this.playTerminatedQueue_=[],t.forEach(function(t){t()})},t.runPlayCallbacks_=function(e){var t=this.playCallbacks_.slice(0);this.playCallbacks_=[],this.playTerminatedQueue_=[],t.forEach(function(t){t(e)})},t.pause=function(){this.techCall_("pause")},t.paused=function(){return!1!==this.techGet_("paused")},t.played=function(){return this.techGet_("played")||be(0,0)},t.scrubbing=function(t){if(void 0===t)return this.scrubbing_;this.scrubbing_=!!t,this.techCall_("setScrubbing",this.scrubbing_),t?this.addClass("vjs-scrubbing"):this.removeClass("vjs-scrubbing")},t.currentTime=function(t){return void 0!==t?(t<0&&(t=0),this.isReady_&&!this.changingSrc_&&this.tech_&&this.tech_.isReady_?(this.techCall_("setCurrentTime",t),void(this.cache_.initTime=0)):(this.cache_.initTime=t,this.off("canplay",this.applyInitTime_),void this.one("canplay",this.applyInitTime_))):(this.cache_.currentTime=this.techGet_("currentTime")||0,this.cache_.currentTime)},t.applyInitTime_=function(){this.currentTime(this.cache_.initTime)},t.duration=function(t){if(void 0===t)return void 0!==this.cache_.duration?this.cache_.duration:NaN;(t=(t=parseFloat(t))<0?1/0:t)!==this.cache_.duration&&((this.cache_.duration=t)===1/0?this.addClass("vjs-live"):this.removeClass("vjs-live"),isNaN(t)||this.trigger("durationchange"))},t.remainingTime=function(){return this.duration()-this.currentTime()},t.remainingTimeDisplay=function(){return Math.floor(this.duration())-Math.floor(this.currentTime())},t.buffered=function(){var t=this.techGet_("buffered");return t=!t||!t.length?be(0,0):t},t.bufferedPercent=function(){return we(this.buffered(),this.duration())},t.bufferedEnd=function(){var t=this.buffered(),e=this.duration(),t=t.end(t.length-1);return t=e<t?e:t},t.volume=function(t){var e;return void 0!==t?(e=Math.max(0,Math.min(1,parseFloat(t))),this.cache_.volume=e,this.techCall_("setVolume",e),void(0<e&&this.lastVolume_(e))):(e=parseFloat(this.techGet_("volume")),isNaN(e)?1:e)},t.muted=function(t){if(void 0===t)return this.techGet_("muted")||!1;this.techCall_("setMuted",t)},t.defaultMuted=function(t){return void 0!==t?this.techCall_("setDefaultMuted",t):this.techGet_("defaultMuted")||!1},t.lastVolume_=function(t){if(void 0===t||0===t)return this.cache_.lastVolume;this.cache_.lastVolume=t},t.supportsFullScreen=function(){return this.techGet_("supportsFullScreen")||!1},t.isFullscreen=function(t){if(void 0===t)return this.isFullscreen_;var e=this.isFullscreen_;this.isFullscreen_=Boolean(t),this.isFullscreen_!==e&&this.fsApi_.prefixed&&this.trigger("fullscreenchange"),this.toggleFullscreenClass_()},t.requestFullscreen=function(s){var t=this.options_.Promise||d.Promise;if(t){var o=this;return new t(function(t,i){function n(){o.off("fullscreenerror",r),o.off("fullscreenchange",e)}function e(){n(),t()}function r(t,e){n(),i(e)}o.one("fullscreenchange",e),o.one("fullscreenerror",r);var a=o.requestFullscreenHelper_(s);if(a)return a.then(n,n),a})}return this.requestFullscreenHelper_()},t.requestFullscreenHelper_=function(t){var e=this;if(this.fsApi_.prefixed||(i=this.options_.fullscreen&&this.options_.fullscreen.options||{},void 0!==t&&(i=t)),this.fsApi_.requestFullscreen){var i=this.el_[this.fsApi_.requestFullscreen](i);return i&&i.then(function(){return e.isFullscreen(!0)},function(){return e.isFullscreen(!1)}),i}this.tech_.supportsFullScreen()?this.techCall_("enterFullScreen"):this.enterFullWindow()},t.exitFullscreen=function(){var t=this.options_.Promise||d.Promise;if(t){var s=this;return new t(function(t,i){function n(){s.off("fullscreenerror",r),s.off("fullscreenchange",e)}function e(){n(),t()}function r(t,e){n(),i(e)}s.one("fullscreenchange",e),s.one("fullscreenerror",r);var a=s.exitFullscreenHelper_();if(a)return a.then(n,n),a})}return this.exitFullscreenHelper_()},t.exitFullscreenHelper_=function(){var t=this;if(this.fsApi_.requestFullscreen){var e=c[this.fsApi_.exitFullscreen]();return e&&e.then(function(){return t.isFullscreen(!1)}),e}this.tech_.supportsFullScreen()?this.techCall_("exitFullScreen"):this.exitFullWindow()},t.enterFullWindow=function(){this.isFullscreen(!0),this.isFullWindow=!0,this.docOrigOverflow=c.documentElement.style.overflow,Ft(c,"keydown",this.boundFullWindowOnEscKey_),c.documentElement.style.overflow="hidden",et(c.body,"vjs-full-window"),this.trigger("enterFullWindow")},t.fullWindowOnEscKey=function(t){Ce.isEventKey(t,"Esc")&&(!0===this.isFullscreen()?this.exitFullscreen():this.exitFullWindow())},t.exitFullWindow=function(){this.isFullscreen(!1),this.isFullWindow=!1,Ut(c,"keydown",this.boundFullWindowOnEscKey_),c.documentElement.style.overflow=this.docOrigOverflow,it(c.body,"vjs-full-window"),this.trigger("exitFullWindow")},t.disablePictureInPicture=function(t){if(void 0===t)return this.techGet_("disablePictureInPicture");this.techCall_("setDisablePictureInPicture",t),this.options_.disablePictureInPicture=t,this.trigger("disablepictureinpicturechanged")},t.isInPictureInPicture=function(t){return void 0!==t?(this.isInPictureInPicture_=!!t,void this.togglePictureInPictureClass_()):!!this.isInPictureInPicture_},t.requestPictureInPicture=function(){if("pictureInPictureEnabled"in c&&!1===this.disablePictureInPicture())return this.techGet_("requestPictureInPicture")},t.exitPictureInPicture=function(){if("pictureInPictureEnabled"in c)return c.exitPictureInPicture()},t.handleKeyDown=function(t){var e,i,n=this.options_.userActions;n&&n.hotkeys&&(e=this.el_.ownerDocument.activeElement,i=e.tagName.toLowerCase(),e.isContentEditable||("input"===i?-1===["button","checkbox","hidden","radio","reset","submit"].indexOf(e.type):-1!==["textarea"].indexOf(i))||("function"==typeof n.hotkeys?n.hotkeys.call(this,t):this.handleHotkeys(t)))},t.handleHotkeys=function(t){var e=this.options_.userActions?this.options_.userActions.hotkeys:{},i=e.fullscreenKey,n=void 0===i?function(t){return Ce.isEventKey(t,"f")}:i,i=e.muteKey,i=void 0===i?function(t){return Ce.isEventKey(t,"m")}:i,e=e.playPauseKey,e=void 0===e?function(t){return Ce.isEventKey(t,"k")||Ce.isEventKey(t,"Space")}:e;n.call(this,t)?(t.preventDefault(),t.stopPropagation(),n=de.getComponent("FullscreenToggle"),!1!==c[this.fsApi_.fullscreenEnabled]&&n.prototype.handleClick.call(this,t)):i.call(this,t)?(t.preventDefault(),t.stopPropagation(),de.getComponent("MuteToggle").prototype.handleClick.call(this,t)):e.call(this,t)&&(t.preventDefault(),t.stopPropagation(),de.getComponent("PlayToggle").prototype.handleClick.call(this,t))},t.canPlayType=function(t){for(var e,i=0,n=this.options_.techOrder;i<n.length;i++){var r=n[i],a=Gi.getTech(r);if(a=a||de.getComponent(r)){if(a.isSupported()&&(e=a.canPlayType(t)))return e}else m.error('The "'+r+'" tech is undefined. Skipped browser support check for that tech.')}return""},t.selectSource=function(t){function e(t,i,n){var r;return t.some(function(e){return i.some(function(t){if(r=n(e,t))return!0})}),r}function i(t,e){var i=t[0];if(t[1].canPlaySource(e,r.options_[i.toLowerCase()]))return{source:e,tech:i}}var n,r=this,a=this.options_.techOrder.map(function(t){return[t,Gi.getTech(t)]}).filter(function(t){var e=t[0],t=t[1];return t?t.isSupported():(m.error('The "'+e+'" tech is undefined. Skipped browser support check for that tech.'),!1)});return(this.options_.sourceOrder?e(t,a,(n=i,function(t,e){return n(e,t)})):e(a,t,i))||!1},t.src=function(t){var n=this;if(void 0===t)return this.cache_.src||"";var r=function e(t){var i;return t=Array.isArray(t)?(i=[],t.forEach(function(t){t=e(t),Array.isArray(t)?i=i.concat(t):w(t)&&i.push(t)}),i):"string"==typeof t&&t.trim()?[an({src:t})]:w(t)&&"string"==typeof t.src&&t.src&&t.src.trim()?[an(t)]:[]}(t);r.length?(this.changingSrc_=!0,this.cache_.sources=r,this.updateSourceCaches_(r[0]),Ki(this,r[0],function(t,e){return n.middleware_=e,n.cache_.sources=r,n.updateSourceCaches_(t),n.src_(t)?1<r.length?n.src(r.slice(1)):(n.changingSrc_=!1,n.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0),void n.triggerReady()):(i=n.tech_,void e.forEach(function(t){return t.setTech&&t.setTech(i)}));var i})):this.setTimeout(function(){this.error({code:4,message:this.localize(this.options_.notSupportedMessage)})},0)},t.src_=function(t){var e,i,n=this,r=this.selectSource([t]);return!r||(e=r.tech,i=this.techName_,oe(e)===oe(i)?this.ready(function(){this.tech_.constructor.prototype.hasOwnProperty("setSource")?this.techCall_("setSource",t):this.techCall_("src",t.src),this.changingSrc_=!1},!0):(this.changingSrc_=!0,this.loadTech_(r.tech,r.source),this.tech_.ready(function(){n.changingSrc_=!1})),!1)},t.load=function(){this.techCall_("load")},t.reset=function(){var t=this,e=this.options_.Promise||d.Promise;this.paused()||!e?this.doReset_():Ee(this.play().then(function(){return t.doReset_()}))},t.doReset_=function(){this.tech_&&this.tech_.clearTracks("text"),this.resetCache_(),this.poster(""),this.loadTech_(this.options_.techOrder[0],null),this.techCall_("reset"),this.resetControlBarUI_(),ee(this)&&this.trigger("playerreset")},t.resetControlBarUI_=function(){this.resetProgressBar_(),this.resetPlaybackRate_(),this.resetVolumeBar_()},t.resetProgressBar_=function(){this.currentTime(0);var t=this.controlBar,e=t.durationDisplay,t=t.remainingTimeDisplay;e&&e.updateContent(),t&&t.updateContent()},t.resetPlaybackRate_=function(){this.playbackRate(this.defaultPlaybackRate()),this.handleTechRateChange_()},t.resetVolumeBar_=function(){this.volume(1),this.trigger("volumechange")},t.currentSources=function(){var t=this.currentSource(),e=[];return 0!==Object.keys(t).length&&e.push(t),this.cache_.sources||e},t.currentSource=function(){return this.cache_.source||{}},t.currentSrc=function(){return this.currentSource()&&this.currentSource().src||""},t.currentType=function(){return this.currentSource()&&this.currentSource().type||""},t.preload=function(t){return void 0!==t?(this.techCall_("setPreload",t),void(this.options_.preload=t)):this.techGet_("preload")},t.autoplay=function(t){if(void 0===t)return this.options_.autoplay||!1;var e;"string"==typeof t&&/(any|play|muted)/.test(t)?(this.options_.autoplay=t,this.manualAutoplay_(t),e=!1):this.options_.autoplay=!!t,e=void 0===e?this.options_.autoplay:e,this.tech_&&this.techCall_("setAutoplay",e)},t.playsinline=function(t){return void 0!==t?(this.techCall_("setPlaysinline",t),this.options_.playsinline=t,this):this.techGet_("playsinline")},t.loop=function(t){return void 0!==t?(this.techCall_("setLoop",t),void(this.options_.loop=t)):this.techGet_("loop")},t.poster=function(t){if(void 0===t)return this.poster_;(t=t||"")!==this.poster_&&(this.poster_=t,this.techCall_("setPoster",t),this.isPosterFromTech_=!1,this.trigger("posterchange"))},t.handleTechPosterChange_=function(){var t;this.poster_&&!this.options_.techCanOverridePoster||!this.tech_||!this.tech_.poster||(t=this.tech_.poster()||"")!==this.poster_&&(this.poster_=t,this.isPosterFromTech_=!0,this.trigger("posterchange"))},t.controls=function(t){if(void 0===t)return!!this.controls_;this.controls_!==(t=!!t)&&(this.controls_=t,this.usingNativeControls()&&this.techCall_("setControls",t),this.controls_?(this.removeClass("vjs-controls-disabled"),this.addClass("vjs-controls-enabled"),this.trigger("controlsenabled"),this.usingNativeControls()||this.addTechControlsListeners_()):(this.removeClass("vjs-controls-enabled"),this.addClass("vjs-controls-disabled"),this.trigger("controlsdisabled"),this.usingNativeControls()||this.removeTechControlsListeners_()))},t.usingNativeControls=function(t){if(void 0===t)return!!this.usingNativeControls_;this.usingNativeControls_!==(t=!!t)&&(this.usingNativeControls_=t,this.usingNativeControls_?(this.addClass("vjs-using-native-controls"),this.trigger("usingnativecontrols")):(this.removeClass("vjs-using-native-controls"),this.trigger("usingcustomcontrols")))},t.error=function(t){if(void 0===t)return this.error_||null;if(this.options_.suppressNotSupportedError&&t&&4===t.code){var e=function(){this.error(t)};return this.options_.suppressNotSupportedError=!1,this.any(["click","touchstart"],e),void this.one("loadstart",function(){this.off(["click","touchstart"],e)})}if(null===t)return this.error_=t,this.removeClass("vjs-error"),void(this.errorDisplay&&this.errorDisplay.close());this.error_=new Te(t),this.addClass("vjs-error"),m.error("(CODE:"+this.error_.code+" "+Te.errorTypes[this.error_.code]+")",this.error_.message,this.error_),this.trigger("error")},t.reportUserActivity=function(t){this.userActivity_=!0},t.userActive=function(t){if(void 0===t)return this.userActive_;if((t=!!t)!==this.userActive_){if(this.userActive_=t,this.userActive_)return this.userActivity_=!0,this.removeClass("vjs-user-inactive"),this.addClass("vjs-user-active"),void this.trigger("useractive");this.tech_&&this.tech_.one("mousemove",function(t){t.stopPropagation(),t.preventDefault()}),this.userActivity_=!1,this.removeClass("vjs-user-active"),this.addClass("vjs-user-inactive"),this.trigger("userinactive")}},t.listenForUserActivity_=function(){function t(t){r(),this.clearInterval(e)}var e,i,n,r=Ht(this,this.reportUserActivity);this.on("mousedown",function(){r(),this.clearInterval(e),e=this.setInterval(r,250)}),this.on("mousemove",function(t){t.screenX===i&&t.screenY===n||(i=t.screenX,n=t.screenY,r())}),this.on("mouseup",t),this.on("mouseleave",t);var a,s=this.getChild("controlBar");!s||z||A||(s.on("mouseenter",function(t){this.player().cache_.inactivityTimeout=this.player().options_.inactivityTimeout,this.player().options_.inactivityTimeout=0}),s.on("mouseleave",function(t){this.player().options_.inactivityTimeout=this.player().cache_.inactivityTimeout})),this.on("keydown",r),this.on("keyup",r),this.setInterval(function(){var t;this.userActivity_&&(this.userActivity_=!1,this.userActive(!0),this.clearTimeout(a),(t=this.options_.inactivityTimeout)<=0||(a=this.setTimeout(function(){this.userActivity_||this.userActive(!1)},t)))},250)},t.playbackRate=function(t){if(void 0===t)return this.tech_&&this.tech_.featuresPlaybackRate?this.cache_.lastPlaybackRate||this.techGet_("playbackRate"):1;this.techCall_("setPlaybackRate",t)},t.defaultPlaybackRate=function(t){return void 0!==t?this.techCall_("setDefaultPlaybackRate",t):this.tech_&&this.tech_.featuresPlaybackRate?this.techGet_("defaultPlaybackRate"):1},t.isAudio=function(t){if(void 0===t)return!!this.isAudio_;this.isAudio_=!!t},t.addTextTrack=function(t,e,i){if(this.tech_)return this.tech_.addTextTrack(t,e,i)},t.addRemoteTextTrack=function(t,e){if(this.tech_)return this.tech_.addRemoteTextTrack(t,e)},t.removeRemoteTextTrack=function(t){var e=(e=(t=void 0===t?{}:t).track)||t;if(this.tech_)return this.tech_.removeRemoteTextTrack(e)},t.getVideoPlaybackQuality=function(){return this.techGet_("getVideoPlaybackQuality")},t.videoWidth=function(){return this.tech_&&this.tech_.videoWidth&&this.tech_.videoWidth()||0},t.videoHeight=function(){return this.tech_&&this.tech_.videoHeight&&this.tech_.videoHeight()||0},t.language=function(t){if(void 0===t)return this.language_;this.language_!==String(t).toLowerCase()&&(this.language_=String(t).toLowerCase(),ee(this)&&this.trigger("languagechange"))},t.languages=function(){return le(o.prototype.options_.languages,this.languages_)},t.toJSON=function(){var t=le(this.options_),e=t.tracks;t.tracks=[];for(var i=0;i<e.length;i++){var n=e[i];(n=le(n)).player=void 0,t.tracks[i]=n}return t},t.createModal=function(t,e){var i=this;(e=e||{}).content=t||"";var n=new Ae(this,e);return this.addChild(n),n.on("dispose",function(){i.removeChild(n)}),n.open(),n},t.updateCurrentBreakpoint_=function(){if(this.responsive())for(var t=this.currentBreakpoint(),e=this.currentWidth(),i=0;i<nr.length;i++){var n=nr[i];if(e<=this.breakpoints_[n]){if(t===n)return;t&&this.removeClass(rr[t]),this.addClass(rr[n]),this.breakpoint_=n;break}}},t.removeCurrentBreakpoint_=function(){var t=this.currentBreakpointClass();this.breakpoint_="",t&&this.removeClass(t)},t.breakpoints=function(t){return void 0===t||(this.breakpoint_="",this.breakpoints_=b({},ar,t),this.updateCurrentBreakpoint_()),b(this.breakpoints_)},t.responsive=function(t){return void 0===t?this.responsive_:(t=Boolean(t))!==this.responsive_?((this.responsive_=t)?(this.on("playerresize",this.updateCurrentBreakpoint_),this.updateCurrentBreakpoint_()):(this.off("playerresize",this.updateCurrentBreakpoint_),this.removeCurrentBreakpoint_()),t):void 0},t.currentBreakpoint=function(){return this.breakpoint_},t.currentBreakpointClass=function(){return rr[this.breakpoint_]||""},t.loadMedia=function(t,e){var i,n,r,a=this;t&&"object"==typeof t&&(this.reset(),this.cache_.media=le(t),i=(r=this.cache_.media).artwork,n=r.poster,t=r.src,r=r.textTracks,!i&&n&&(this.cache_.media.artwork=[{src:n,type:nn(n)}]),t&&this.src(t),n&&this.poster(n),Array.isArray(r)&&r.forEach(function(t){return a.addRemoteTextTrack(t,!1)}),this.ready(e))},t.getMedia=function(){if(this.cache_.media)return le(this.cache_.media);var t=this.poster(),e={src:this.currentSources(),textTracks:Array.prototype.map.call(this.remoteTextTracks(),function(t){return{kind:t.kind,label:t.label,language:t.language,src:t.src}})};return t&&(e.poster=t,e.artwork=[{src:e.poster,type:nn(e.poster)}]),e},o.getTagSettings=function(t){var e,i={sources:[],tracks:[]},n=at(t),r=n["data-setup"];if(tt(t,"vjs-fill")&&(n.fill=!0),tt(t,"vjs-fluid")&&(n.fluid=!0),null!==r&&(r=(e=function(t,e){var i,n=null;try{i=JSON.parse(t,e)}catch(t){n=t}return[n,i]}(r||"{}"))[0],e=e[1],r&&m.error(r),b(n,e)),b(i,n),t.hasChildNodes())for(var a=t.childNodes,s=0,o=a.length;s<o;s++){var l=a[s],u=l.nodeName.toLowerCase();"source"===u?i.sources.push(at(l)):"track"===u&&i.tracks.push(at(l))}return i},t.flexNotSupported_=function(){var t=c.createElement("i");return!("flexBasis"in t.style||"webkitFlexBasis"in t.style||"mozFlexBasis"in t.style||"msFlexBasis"in t.style||"msFlexOrder"in t.style)},t.debug=function(t){if(void 0===t)return this.debugEnabled_;t?(this.trigger("debugon"),this.previousLogLevel_=this.log.level,this.log.level("debug"),this.debugEnabled_=!0):(this.trigger("debugoff"),this.log.level(this.previousLogLevel_),this.previousLogLevel_=void 0,this.debugEnabled_=!1)},o}(de);vi.names.forEach(function(t){var e=vi[t];sr.prototype[e.getterName]=function(){return this.tech_?this.tech_[e.getterName]():(this[e.privateName]=this[e.privateName]||new e.ListClass,this[e.privateName])}}),sr.prototype.crossorigin=sr.prototype.crossOrigin,sr.players={};j=d.navigator;sr.prototype.options_={techOrder:Gi.defaultTechOrder_,html5:{},inactivityTimeout:2e3,playbackRates:[],liveui:!1,children:["mediaLoader","posterImage","textTrackDisplay","loadingSpinner","bigPlayButton","liveTracker","controlBar","errorDisplay","textTrackSettings","resizeManager"],language:j&&(j.languages&&j.languages[0]||j.userLanguage||j.language)||"en",languages:{},notSupportedMessage:"No compatible source was found for this media.",fullscreen:{options:{navigationUI:"hide"}},breakpoints:{},responsive:!1},["ended","seeking","seekable","networkState","readyState"].forEach(function(t){sr.prototype[t]=function(){return this.techGet_(t)}}),er.forEach(function(t){sr.prototype["handleTech"+oe(t)+"_"]=function(){return this.trigger(t)}}),de.registerComponent("Player",sr);var or=i(function(i){function n(t,e){return i.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(t,e)}i.exports=n});function lr(t){return gr.hasOwnProperty(t)}function ur(t){return lr(t)?gr[t]:void 0}function hr(t,e){t[mr]=t[mr]||{},t[mr][e]=!0}function cr(t,e,i){i=(i?"before":"")+"pluginsetup";t.trigger(i,e),t.trigger(i+":"+e.name,e)}function dr(r,a){return a.prototype.name=r,function(){cr(this,{name:r,plugin:a,instance:null},!0);for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=pr(a,[this].concat(e));return this[r]=function(){return n},cr(this,n.getEventHash()),n}}var pr=i(function(n){function r(t,e,i){return function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?n.exports=r=Reflect.construct:n.exports=r=function(t,e,i){var n=[null];n.push.apply(n,e);n=new(Function.bind.apply(t,n));return i&&or(n,i.prototype),n},r.apply(null,arguments)}n.exports=r}),fr="plugin",mr="activePlugins_",gr={},vr=((Ue=yr.prototype).version=function(){return this.constructor.VERSION},Ue.getEventHash=function(t){return(t=void 0===t?{}:t).name=this.name,t.plugin=this.constructor,t.instance=this,t},Ue.trigger=function(t,e){return jt(this.eventBusEl_,t,this.getEventHash(e=void 0===e?{}:e))},Ue.handleStateChanged=function(t){},Ue.dispose=function(){var t=this.name,e=this.player;this.trigger("dispose"),this.off(),e.off("dispose",this.dispose),e[mr][t]=!1,this.player=this.state=null,e[t]=dr(t,gr[t])},yr.isBasic=function(t){t="string"==typeof t?ur(t):t;return"function"==typeof t&&!yr.prototype.isPrototypeOf(t.prototype)},yr.registerPlugin=function(t,e){if("string"!=typeof t)throw new Error('Illegal plugin name, "'+t+'", must be a string, was '+typeof t+".");if(lr(t))m.warn('A plugin named "'+t+'" already exists. You may want to avoid re-registering plugins!');else if(sr.prototype.hasOwnProperty(t))throw new Error('Illegal plugin name, "'+t+'", cannot share a name with an existing player method!');if("function"!=typeof e)throw new Error('Illegal plugin for "'+t+'", must be a function, was '+typeof e+".");return gr[t]=e,t!==fr&&(yr.isBasic(e)?sr.prototype[t]=(n=t,r=e,Object.keys(r).forEach(function(t){i[t]=r[t]}),i):sr.prototype[t]=dr(t,e)),e;function i(){cr(this,{name:n,plugin:r,instance:null},!0);var t=r.apply(this,arguments);return hr(this,n),cr(this,{name:n,plugin:r,instance:t}),t}var n,r},yr.deregisterPlugin=function(t){if(t===fr)throw new Error("Cannot de-register base plugin.");lr(t)&&(delete gr[t],delete sr.prototype[t])},yr.getPlugins=function(t){var i;return(t=void 0===t?Object.keys(gr):t).forEach(function(t){var e=ur(t);e&&((i=i||{})[t]=e)}),i},yr.getPluginVersion=function(t){t=ur(t);return t&&t.VERSION||""},yr);function yr(t){if(this.constructor===yr)throw new Error("Plugin must be sub-classed; not directly instantiated.");this.player=t,this.log||(this.log=this.player.log.createLogger(this.name)),ne(this),delete this.trigger,ae(this,this.constructor.defaultState),hr(t,this.name),this.dispose=Ht(this,this.dispose),t.on("dispose",this.dispose)}vr.getPlugin=ur,vr.BASE_PLUGIN_NAME=fr,vr.registerPlugin(fr,vr),sr.prototype.usingPlugin=function(t){return!!this[mr]&&!0===this[mr][t]},sr.prototype.hasPlugin=function(t){return!!lr(t)};function _r(t){return 0===t.indexOf("#")?t.slice(1):t}function br(t,e,i){if(r=br.getPlayer(t))return e&&m.warn('Player "'+t+'" is already initialised. Options will not be applied.'),i&&r.ready(i),r;var n="string"==typeof t?Tt("#"+_r(t)):t;if(!$(n))throw new TypeError("The element or ID supplied is not valid. (videojs)");n.ownerDocument.defaultView&&n.ownerDocument.body.contains(n)||m.warn("The element supplied is not included in the DOM"),e=e||{},br.hooks("beforesetup").forEach(function(t){t=t(n,le(e));w(t)&&!Array.isArray(t)?e=le(e,t):m.error("please return an object in beforesetup hooks")});var r=new(de.getComponent("Player"))(n,e,i);return br.hooks("setup").forEach(function(t){return t(r)}),r}br.hooks_={},br.hooks=function(t,e){return br.hooks_[t]=br.hooks_[t]||[],e&&(br.hooks_[t]=br.hooks_[t].concat(e)),br.hooks_[t]},br.hook=function(t,e){br.hooks(t,e)},br.hookOnce=function(i,t){br.hooks(i,[].concat(t).map(function(e){return function t(){return br.removeHook(i,t),e.apply(void 0,arguments)}}))},br.removeHook=function(t,e){e=br.hooks(t).indexOf(e);return!(e<=-1||(br.hooks_[t]=br.hooks_[t].slice(),br.hooks_[t].splice(e,1),0))},!0!==d.VIDEOJS_NO_DYNAMIC_STYLE&&X()&&((j=Tt(".vjs-styles-defaults"))||(j=It("vjs-styles-defaults"),(Ue=Tt("head"))&&Ue.insertBefore(j,Ue.firstChild),At(j,"\n      .video-js {\n        width: 300px;\n        height: 150px;\n      }\n\n      .vjs-fluid {\n        padding-top: 56.25%\n      }\n    "))),kt(1,br),br.VERSION="7.11.8",br.options=sr.prototype.options_,br.getPlayers=function(){return sr.players},br.getPlayer=function(t){var e=sr.players;if("string"==typeof t){var i=_r(t),n=e[i];if(n)return n;i=Tt("#"+i)}else i=t;if($(i)){t=i,i=t.player,t=t.playerId;if(i||e[t])return i||e[t]}},br.getAllPlayers=function(){return Object.keys(sr.players).map(function(t){return sr.players[t]}).filter(Boolean)},br.players=sr.players,br.getComponent=de.getComponent,br.registerComponent=function(t,e){Gi.isTech(e)&&m.warn("The "+t+" tech was registered as a component. It should instead be registered using videojs.registerTech(name, tech)"),de.registerComponent.call(de,t,e)},br.getTech=Gi.getTech,br.registerTech=Gi.registerTech,br.use=function(t,e){Xi[t]=Xi[t]||[],Xi[t].push(e)},Object.defineProperty(br,"middleware",{value:{},writeable:!1,enumerable:!0}),Object.defineProperty(br.middleware,"TERMINATOR",{value:Yi,writeable:!1,enumerable:!0}),br.browser=V,br.TOUCH_ENABLED=U,br.extend=function(t,e){var i,n=function(){t.apply(this,arguments)},r={};for(i in"object"==typeof(e=void 0===e?{}:e)?(e.constructor!==Object.prototype.constructor&&(n=e.constructor),r=e):"function"==typeof e&&(n=e),function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&or(t,e)}(n,t),t&&(n.super_=t),r)r.hasOwnProperty(i)&&(n.prototype[i]=r[i]);return n},br.mergeOptions=le,br.bind=Ht,br.registerPlugin=vr.registerPlugin,br.deregisterPlugin=vr.deregisterPlugin,br.plugin=function(t,e){return m.warn("videojs.plugin() is deprecated; use videojs.registerPlugin() instead"),vr.registerPlugin(t,e)},br.getPlugins=vr.getPlugins,br.getPlugin=vr.getPlugin,br.getPluginVersion=vr.getPluginVersion,br.addLanguage=function(t,e){var i;return t=(""+t).toLowerCase(),br.options.languages=le(br.options.languages,((i={})[t]=e,i)),br.options.languages[t]},br.log=m,br.createLogger=g,br.createTimeRange=br.createTimeRanges=be,br.formatTime=vn,br.setFormatTime=function(t){gn=t},br.resetFormatTime=function(){gn=mn},br.parseUrl=Me,br.isCrossOrigin=Be,br.EventTarget=Wt,br.on=Ft,br.one=qt,br.off=Ut,br.trigger=jt,br.xhr=ei,br.TextTrack=li,br.AudioTrack=a,br.VideoTrack=E,["isEl","isTextNode","createEl","hasClass","addClass","removeClass","toggleClass","setAttributes","getAttributes","emptyEl","appendContent","insertContent"].forEach(function(t){br[t]=function(){return m.warn("videojs."+t+"() is deprecated; use videojs.dom."+t+"() instead"),St[t].apply(null,arguments)}}),br.computedStyle=x,br.dom=St,br.url=Xe,br.defineLazyProperty=Kn;var wr=e(i(function(t){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.default=t.exports,t.exports.__esModule=!0})),Tr=i(function(i){function n(t,e){return i.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},i.exports.default=i.exports,i.exports.__esModule=!0,n(t,e)}i.exports=n,i.exports.default=i.exports,i.exports.__esModule=!0});function xr(t,e){return/^[a-z]+:/i.test(e)?e:(/\/\//i.test(t)||(t=Cr.buildAbsoluteURL(Ir.location&&Ir.location.href||"",t)),Cr.buildAbsoluteURL(t,e))}e(Tr);var Sr=e(i(function(t){t.exports=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Tr(t,e)},t.exports.default=t.exports,t.exports.__esModule=!0})),Xe=void 0!==t?t:"undefined"!=typeof window?window:{},Er="undefined"!=typeof document?document:Xe["__GLOBAL_DOCUMENT_CACHE@4"]||(Xe["__GLOBAL_DOCUMENT_CACHE@4"]=r),kr="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},Cr=i(function(t,e){var i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,a=/^([^\/?#]*)(.*)$/,n=/(?:\/|^)\.(?=\/)/g,r=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(t,e,i){if(i=i||{},t=t.trim(),!(e=e.trim())){if(!i.alwaysNormalize)return t;var n=s.parseURL(t);if(!n)throw new Error("Error trying to parse base URL.");return n.path=s.normalizePath(n.path),s.buildURLFromParts(n)}n=s.parseURL(e);if(!n)throw new Error("Error trying to parse relative URL.");if(n.scheme)return i.alwaysNormalize?(n.path=s.normalizePath(n.path),s.buildURLFromParts(n)):e;e=s.parseURL(t);if(!e)throw new Error("Error trying to parse base URL.");!e.netLoc&&e.path&&"/"!==e.path[0]&&(r=a.exec(e.path),e.netLoc=r[1],e.path=r[2]),e.netLoc&&!e.path&&(e.path="/");var r,t={scheme:e.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};return n.netLoc||(t.netLoc=e.netLoc,"/"===n.path[0])||(n.path?(r=(r=e.path).substring(0,r.lastIndexOf("/")+1)+n.path,t.path=s.normalizePath(r)):(t.path=e.path,n.params||(t.params=e.params,n.query||(t.query=e.query)))),null===t.path&&(t.path=i.alwaysNormalize?s.normalizePath(n.path):n.path),s.buildURLFromParts(t)},parseURL:function(t){t=i.exec(t);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(n,"");t.length!==(t=t.replace(r,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}};t.exports=s}),Ir="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},Ar=i(function(i){function n(t,e){return i.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},i.exports.default=i.exports,i.exports.__esModule=!0,n(t,e)}i.exports=n,i.exports.default=i.exports,i.exports.__esModule=!0});e(Ar);var Pr=e(i(function(t){t.exports=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Ar(t,e)},t.exports.default=t.exports,t.exports.__esModule=!0})),r=((Xe=Mr.prototype).on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},Xe.off=function(t,e){if(!this.listeners[t])return!1;e=this.listeners[t].indexOf(e);return this.listeners[t]=this.listeners[t].slice(0),this.listeners[t].splice(e,1),-1<e},Xe.trigger=function(t,e){var i=this.listeners[t];if(i)if(2===arguments.length)for(var n=i.length,r=0;r<n;++r)i[r].call(this,e);else for(var a=Array.prototype.slice.call(arguments,1),s=i.length,o=0;o<s;++o)i[o].apply(this,a)},Xe.dispose=function(){this.listeners={}},Xe.pipe=function(e){this.on("data",function(t){e.push(t)})},Mr),Dr=e(i(function(t){function e(){return t.exports=e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i,n=arguments[e];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},t.exports.default=t.exports,t.exports.__esModule=!0,e.apply(this,arguments)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0})),Or=e(i(function(t){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.default=t.exports,t.exports.__esModule=!0})),Lr=function(t){return Ir.atob?Ir.atob(t):Buffer.from(t,"base64").toString("binary")};function Mr(){this.listeners={}}function Rr(t){for(var e=Lr(t),i=new Uint8Array(e.length),n=0;n<e.length;n++)i[n]=e.charCodeAt(n);return i}function Nr(t){for(var e,i=t.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')),n={},r=i.length;r--;)""!==i[r]&&((e=/([^=]*)=(.*)/.exec(i[r]).slice(1))[0]=e[0].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^\s+|\s+$/g,""),e[1]=e[1].replace(/^['"](.*)['"]$/g,"$1"),n[e[0]]=e[1]);return n}function Br(t){return zr.test(t)?"hls":Hr.test(t)?"dash":"application/vnd.videojs.vhs+json"===t?"vhs-json":null}var Fr,Ur=(Pr(Xr,Fr=r),Xr.prototype.push=function(t){var e;for(this.buffer+=t,e=this.buffer.indexOf("\n");-1<e;e=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,e)),this.buffer=this.buffer.substring(e+1)},Xr),jr=function(e){function t(){var t;return(t=e.call(this)||this).customParsers=[],t.tagMappers=[],t}Pr(t,e);var i=t.prototype;return i.push=function(i){var a,s,o=this;0!==(i=i.trim()).length&&("#"===i[0]?this.tagMappers.reduce(function(t,e){e=e(i);return e===i?t:t.concat([e])},[i]).forEach(function(t){for(var e,i,n,r=0;r<o.customParsers.length;r++)if(o.customParsers[r].call(o,t))return;if(0===t.indexOf("#EXT"))if(t=t.replace("\r",""),a=/^#EXTM3U/.exec(t))o.trigger("data",{type:"tag",tagType:"m3u"});else{if(a=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(t))return s={type:"tag",tagType:"inf"},a[1]&&(s.duration=parseFloat(a[1])),a[2]&&(s.title=a[2]),void o.trigger("data",s);if(a=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(t))return s={type:"tag",tagType:"targetduration"},a[1]&&(s.duration=parseInt(a[1],10)),void o.trigger("data",s);if(a=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(t))return s={type:"tag",tagType:"totalduration"},a[1]&&(s.duration=parseInt(a[1],10)),void o.trigger("data",s);if(a=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(t))return s={type:"tag",tagType:"version"},a[1]&&(s.version=parseInt(a[1],10)),void o.trigger("data",s);if(a=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return s={type:"tag",tagType:"media-sequence"},a[1]&&(s.number=parseInt(a[1],10)),void o.trigger("data",s);if(a=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(t))return s={type:"tag",tagType:"discontinuity-sequence"},a[1]&&(s.number=parseInt(a[1],10)),void o.trigger("data",s);if(a=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(t))return s={type:"tag",tagType:"playlist-type"},a[1]&&(s.playlistType=a[1]),void o.trigger("data",s);if(a=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(t))return s={type:"tag",tagType:"byterange"},a[1]&&(s.length=parseInt(a[1],10)),a[2]&&(s.offset=parseInt(a[2],10)),void o.trigger("data",s);if(a=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(t))return s={type:"tag",tagType:"allow-cache"},a[1]&&(s.allowed=!/NO/.test(a[1])),void o.trigger("data",s);if(a=/^#EXT-X-MAP:?(.*)$/.exec(t))s={type:"tag",tagType:"map"},a[1]&&((e=Nr(a[1])).URI&&(s.uri=e.URI),e.BYTERANGE&&(n=(i=e.BYTERANGE.split("@"))[0],i=i[1],s.byterange={},n&&(s.byterange.length=parseInt(n,10)),i&&(s.byterange.offset=parseInt(i,10)))),o.trigger("data",s);else if(a=/^#EXT-X-STREAM-INF:?(.*)$/.exec(t))s={type:"tag",tagType:"stream-inf"},a[1]&&(s.attributes=Nr(a[1]),s.attributes.RESOLUTION&&(n={},(i=s.attributes.RESOLUTION.split("x"))[0]&&(n.width=parseInt(i[0],10)),i[1]&&(n.height=parseInt(i[1],10)),s.attributes.RESOLUTION=n),s.attributes.BANDWIDTH&&(s.attributes.BANDWIDTH=parseInt(s.attributes.BANDWIDTH,10)),s.attributes["PROGRAM-ID"]&&(s.attributes["PROGRAM-ID"]=parseInt(s.attributes["PROGRAM-ID"],10))),o.trigger("data",s);else{if(a=/^#EXT-X-MEDIA:?(.*)$/.exec(t))return s={type:"tag",tagType:"media"},a[1]&&(s.attributes=Nr(a[1])),void o.trigger("data",s);if(a=/^#EXT-X-ENDLIST/.exec(t))o.trigger("data",{type:"tag",tagType:"endlist"});else{if(!(a=/^#EXT-X-DISCONTINUITY/.exec(t)))return(a=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(t))?(s={type:"tag",tagType:"program-date-time"},a[1]&&(s.dateTimeString=a[1],s.dateTimeObject=new Date(a[1])),void o.trigger("data",s)):(a=/^#EXT-X-KEY:?(.*)$/.exec(t))?(s={type:"tag",tagType:"key"},a[1]&&(s.attributes=Nr(a[1]),s.attributes.IV&&("0x"===s.attributes.IV.substring(0,2).toLowerCase()&&(s.attributes.IV=s.attributes.IV.substring(2)),s.attributes.IV=s.attributes.IV.match(/.{8}/g),s.attributes.IV[0]=parseInt(s.attributes.IV[0],16),s.attributes.IV[1]=parseInt(s.attributes.IV[1],16),s.attributes.IV[2]=parseInt(s.attributes.IV[2],16),s.attributes.IV[3]=parseInt(s.attributes.IV[3],16),s.attributes.IV=new Uint32Array(s.attributes.IV))),void o.trigger("data",s)):(a=/^#EXT-X-START:?(.*)$/.exec(t))?(s={type:"tag",tagType:"start"},a[1]&&(s.attributes=Nr(a[1]),s.attributes["TIME-OFFSET"]=parseFloat(s.attributes["TIME-OFFSET"]),s.attributes.PRECISE=/YES/.test(s.attributes.PRECISE)),void o.trigger("data",s)):(a=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(t))?(s={type:"tag",tagType:"cue-out-cont"},a[1]?s.data=a[1]:s.data="",void o.trigger("data",s)):(a=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(t))?(s={type:"tag",tagType:"cue-out"},a[1]?s.data=a[1]:s.data="",void o.trigger("data",s)):(a=/^#EXT-X-CUE-IN:?(.*)?$/.exec(t))?(s={type:"tag",tagType:"cue-in"},a[1]?s.data=a[1]:s.data="",void o.trigger("data",s)):void o.trigger("data",{type:"tag",data:t.slice(4)});o.trigger("data",{type:"tag",tagType:"discontinuity"})}}}else o.trigger("data",{type:"comment",text:t.slice(1)})}):this.trigger("data",{type:"uri",uri:i}))},i.addParser=function(t){var e=this,i=t.expression,n=t.customType,r=t.dataParser,a=t.segment;"function"!=typeof r&&(r=function(t){return t}),this.customParsers.push(function(t){if(i.exec(t))return e.trigger("data",{type:"custom",data:r(t),customType:n,segment:a}),!0})},i.addTagMapper=function(t){var e=t.expression,i=t.map;this.tagMappers.push(function(t){return e.test(t)?i(t):t})},t}(r),qr=function(e){function t(){var t;(t=e.call(this)||this).lineStream=new Ur,t.parseStream=new jr,t.lineStream.pipe(t.parseStream);var r,a,s=Or(t),o=[],l={},u={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},h=0;t.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};var c=0;return t.parseStream.on("data",function(e){var i,n;({tag:function(){({"allow-cache":function(){this.manifest.allowCache=e.allowed,"allowed"in e||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var t={};"length"in e&&((l.byterange=t).length=e.length,"offset"in e||(e.offset=c)),"offset"in e&&((l.byterange=t).offset=e.offset),c=t.offset+t.length},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),0<e.duration&&(l.duration=e.duration),0===e.duration&&(l.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=o},key:function(){if(e.attributes)if("NONE"!==e.attributes.METHOD)if(e.attributes.URI){if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===e.attributes.KEYFORMAT)return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(e.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===e.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==e.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):e.attributes.KEYID&&"0x"===e.attributes.KEYID.substring(0,2)?void(this.manifest.contentProtection={"com.widevine.alpha":{attributes:{schemeIdUri:e.attributes.KEYFORMAT,keyId:e.attributes.KEYID.substring(2)},pssh:Rr(e.attributes.URI.split(",")[1])}}):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}));e.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),a={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI},void 0!==e.attributes.IV&&(a.iv=e.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else a=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence":function(){isFinite(e.number)?this.manifest.mediaSequence=e.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number})},"discontinuity-sequence":function(){isFinite(e.number)?(this.manifest.discontinuitySequence=e.number,h=e.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number})},"playlist-type":function(){/VOD|EVENT/.test(e.playlistType)?this.manifest.playlistType=e.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist})},map:function(){r={},e.uri&&(r.uri=e.uri),e.byterange&&(r.byterange=e.byterange)},"stream-inf":function(){this.manifest.playlists=o,this.manifest.mediaGroups=this.manifest.mediaGroups||u,e.attributes?(l.attributes||(l.attributes={}),Dr(l.attributes,e.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media:function(){var t;this.manifest.mediaGroups=this.manifest.mediaGroups||u,e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME?((t=this.manifest.mediaGroups[e.attributes.TYPE])[e.attributes["GROUP-ID"]]=t[e.attributes["GROUP-ID"]]||{},i=t[e.attributes["GROUP-ID"]],(n={default:/yes/i.test(e.attributes.DEFAULT)}).default?n.autoselect=!0:n.autoselect=/yes/i.test(e.attributes.AUTOSELECT),e.attributes.LANGUAGE&&(n.language=e.attributes.LANGUAGE),e.attributes.URI&&(n.uri=e.attributes.URI),e.attributes["INSTREAM-ID"]&&(n.instreamId=e.attributes["INSTREAM-ID"]),e.attributes.CHARACTERISTICS&&(n.characteristics=e.attributes.CHARACTERISTICS),e.attributes.FORCED&&(n.forced=/yes/i.test(e.attributes.FORCED)),i[e.attributes.NAME]=n):this.trigger("warn",{message:"ignoring incomplete or missing media group"})},discontinuity:function(){h+=1,l.discontinuity=!0,this.manifest.discontinuityStarts.push(o.length)},"program-date-time":function(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=e.dateTimeString,this.manifest.dateTimeObject=e.dateTimeObject),l.dateTimeString=e.dateTimeString,l.dateTimeObject=e.dateTimeObject},targetduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration}):this.manifest.targetDuration=e.duration},totalduration:function(){!isFinite(e.duration)||e.duration<0?this.trigger("warn",{message:"ignoring invalid total duration: "+e.duration}):this.manifest.totalDuration=e.duration},start:function(){e.attributes&&!isNaN(e.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:e.attributes["TIME-OFFSET"],precise:e.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out":function(){l.cueOut=e.data},"cue-out-cont":function(){l.cueOutCont=e.data},"cue-in":function(){l.cueIn=e.data}}[e.tagType]||function(){}).call(s)},uri:function(){l.uri=e.uri,o.push(l),!this.manifest.targetDuration||"duration"in l||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),l.duration=this.manifest.targetDuration),a&&(l.key=a),l.timeline=h,r&&(l.map=r),l={}},comment:function(){},custom:function(){e.segment?(l.custom=l.custom||{},l.custom[e.customType]=e.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[e.customType]=e.data)}})[e.type].call(s)}),t}Pr(t,e);var i=t.prototype;return i.push=function(t){this.lineStream.push(t)},i.end=function(){this.lineStream.push("\n")},i.addParser=function(t){this.parseStream.addParser(t)},i.addTagMapper=function(t){this.parseStream.addTagMapper(t)},t}(r),zr=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i,Hr=/^application\/dash\+xml/i,Vr="undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},Wr={entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",times:"×",divide:"÷",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",fnof:"ƒ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",bull:"•",hellip:"…",permil:"‰",prime:"′",Prime:"″",lsaquo:"‹",rsaquo:"›",oline:"‾",euro:"€",trade:"™",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦"}},Xe=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,r=new RegExp("[\\-\\.0-9"+Xe.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),Gr=new RegExp("^"+Xe.source+r.source+"*(?::"+Xe.source+r.source+"*)?$");function Xr(){var t;return(t=Fr.call(this)||this).buffer="",t}function $r(){}function Yr(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function Kr(t,e,i){for(var n,r=t.tagName,a=null,s=t.length;s--;){var o,l=t[s],u=l.qName,h=l.value,u=0<(n=u.indexOf(":"))?(o=l.prefix=u.slice(0,n),c=u.slice(n+1),"xmlns"===o&&c):(o=null,"xmlns"===(c=u)&&"");l.localName=c,!1!==u&&(null==a&&(a={},Qr(i,i={})),i[u]=a[u]=h,l.uri="http://www.w3.org/2000/xmlns/",e.startPrefixMapping(u,h))}for(s=t.length;s--;)(o=(l=t[s]).prefix)&&("xml"===o&&(l.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==o&&(l.uri=i[o||""]));var c=0<(n=r.indexOf(":"))?(o=t.prefix=r.slice(0,n),t.localName=r.slice(n+1)):(o=null,t.localName=r),d=t.uri=i[o||""];if(e.startElement(d,c,r,t),!t.closed)return t.currentNSMap=i,t.localNSMap=a,1;if(e.endElement(d,c,r),a)for(o in a)e.endPrefixMapping(o)}function Qr(t,e){for(var i in t)e[i]=t[i]}function Jr(t){}$r.prototype={parse:function(t,e,i){var n=this.domBuilder;n.startDocument(),Qr(e,e={}),function(i,t,n,r,a){function s(t){var e=t.slice(1,-1);return e in n?n[e]:"#"===e.charAt(0)?function(t){if(65535<t){var e=55296+((t-=65536)>>10);return String.fromCharCode(e,56320+(1023&t))}return String.fromCharCode(t)}(parseInt(e.substr(1).replace("x","0x"))):(a.error("entity not found:"+t),t)}function e(t){var e;_<t&&(e=i.substring(_,t).replace(/&#?\w+;/g,s),g&&o(_),r.characters(e,0,t-_),_=t)}function o(t,e){for(;f<=t&&(e=m.exec(i));)p=e.index,f=p+e[0].length,g.lineNumber++;g.columnNumber=t-p+1}for(var l,u,h,c,d,p=0,f=0,m=/.*(?:\r\n?|\n)|.*$/g,g=r.locator,v=[{currentNSMap:t}],y={},_=0;;){try{var b,w,T=i.indexOf("<",_);if(T<0)return i.substr(_).match(/^\s*$/)||(w=(b=r.doc).createTextNode(i.substr(_)),b.appendChild(w),r.currentElement=w);switch(_<T&&e(T),i.charAt(T+1)){case"/":var x=i.indexOf(">",T+3),S=i.substring(T+2,x),E=v.pop();x<0?(S=i.substring(T+2).replace(/[\s<].*/,""),a.error("end tag name: "+S+" is not complete:"+E.tagName),x=T+1+S.length):S.match(/\s</)&&(S=S.replace(/[\s<].*/,""),a.error("end tag name: "+S+" maybe not complete"),x=T+1+S.length);var k=E.localNSMap,C=E.tagName==S;if(C||E.tagName&&E.tagName.toLowerCase()==S.toLowerCase()){if(r.endElement(E.uri,E.localName,S),k)for(var I in k)r.endPrefixMapping(I);C||a.fatalError("end tag name: "+S+" is not match the current start tagName:"+E.tagName)}else v.push(E);x++;break;case"?":g&&o(T),x=function(t,e,i){var n=t.indexOf("?>",e);if(n){e=t.substring(e,n).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return e?(e[0].length,i.processingInstruction(e[1],e[2]),n+2):-1}return-1}(i,T,r);break;case"!":g&&o(T),x=function(t,r,e,i){if("-"===t.charAt(r+2))return"-"!==t.charAt(r+3)?-1:r<(n=t.indexOf("--\x3e",r+4))?(e.comment(t,r+4,n-r-4),n+3):(i.error("Unclosed comment"),-1);if("CDATA["==t.substr(r+3,6)){var n=t.indexOf("]]>",r+9);return e.startCDATA(),e.characters(t,r+9,n-r-9),e.endCDATA(),n+3}var a=function(t){var e,i=[],n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(n.lastIndex=r,n.exec(t);e=n.exec(t);)if(i.push(e),e[1])return i}(t),s=a.length;if(1<s&&/!doctype/i.test(a[0][0])){i=a[1][0],n=!1,t=!1;3<s&&(/^public$/i.test(a[2][0])?(n=a[3][0],t=4<s&&a[4][0]):/^system$/i.test(a[2][0])&&(t=a[3][0]));s=a[s-1];return e.startDTD(i,n&&n.replace(/^(['"])(.*?)\1$/,"$2"),t&&t.replace(/^(['"])(.*?)\1$/,"$2")),e.endDTD(),s.index+s[0].length}return-1}(i,T,r,a);break;default:g&&o(T);var A=new Jr,P=v[v.length-1].currentNSMap,D=(x=function(t,e,i,n,r,a){for(var s,o=++e,l=0;;){var u=t.charAt(o);switch(u){case"=":if(1===l)s=t.slice(e,o),l=3;else{if(2!==l)throw new Error("attribute equal must after attrName");l=3}break;case"'":case'"':if(3===l||1===l){if(1===l&&(a.warning('attribute value must after "="'),s=t.slice(e,o)),!(0<(o=t.indexOf(u,e=o+1))))throw new Error("attribute value no end '"+u+"' match");h=t.slice(e,o).replace(/&#?\w+;/g,r),i.add(s,h,e-1),l=5}else{if(4!=l)throw new Error('attribute value must after "="');h=t.slice(e,o).replace(/&#?\w+;/g,r),i.add(s,h,e),a.warning('attribute "'+s+'" missed start quot('+u+")!!"),e=o+1,l=5}break;case"/":switch(l){case 0:i.setTagName(t.slice(e,o));case 5:case 6:case 7:l=7,i.closed=!0;case 4:case 1:case 2:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return a.error("unexpected end of input"),0==l&&i.setTagName(t.slice(e,o)),o;case">":switch(l){case 0:i.setTagName(t.slice(e,o));case 5:case 6:case 7:break;case 4:case 1:"/"===(h=t.slice(e,o)).slice(-1)&&(i.closed=!0,h=h.slice(0,-1));case 2:2===l&&(h=s),4==l?(a.warning('attribute "'+h+'" missed quot(")!!'),i.add(s,h.replace(/&#?\w+;/g,r),e)):("http://www.w3.org/1999/xhtml"===n[""]&&h.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+h+'" missed value!! "'+h+'" instead!!'),i.add(h,h,e));break;case 3:throw new Error("attribute value missed!!")}return o;case"":u=" ";default:if(u<=" ")switch(l){case 0:i.setTagName(t.slice(e,o)),l=6;break;case 1:s=t.slice(e,o),l=2;break;case 4:var h=t.slice(e,o).replace(/&#?\w+;/g,r);a.warning('attribute "'+h+'" missed quot(")!!'),i.add(s,h,e);case 5:l=6}else switch(l){case 2:i.tagName,"http://www.w3.org/1999/xhtml"===n[""]&&s.match(/^(?:disabled|checked|selected)$/i)||a.warning('attribute "'+s+'" missed value!! "'+s+'" instead2!!'),i.add(s,s,e),e=o,l=1;break;case 5:a.warning('attribute space is required"'+s+'"!!');case 6:l=1,e=o;break;case 3:l=4,e=o;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}o++}}(i,T,A,P,s,a),A.length);if(!A.closed&&(l=i,u=x,h=A.tagName,d=void 0,null==(d=(c=y)[h])&&((d=l.lastIndexOf("</"+h+">"))<u&&(d=l.lastIndexOf("</"+h)),c[h]=d),d<u)&&(A.closed=!0,n.nbsp||a.warning("unclosed xml attribute")),g&&D){for(var O=Yr(g,{}),L=0;L<D;L++){var M=A[L];o(M.offset),M.locator=Yr(g,{})}r.locator=O,Kr(A,r,P)&&v.push(A),r.locator=g}else Kr(A,r,P)&&v.push(A);"http://www.w3.org/1999/xhtml"!==A.uri||A.closed?x++:x=function(t,e,i,n,r){if(/^(?:script|textarea)$/i.test(i)){var a=t.indexOf("</"+i+">",e),t=t.substring(e+1,a);if(/[&<]/.test(t))return/^script$/i.test(i)||(t=t.replace(/&#?\w+;/g,n)),r.characters(t,0,t.length),a}return e+1}(i,x,A.tagName,s,r)}}catch(t){a.error("element parse error: "+t),x=-1}_<x?_=x:e(Math.max(T,_)+1)}}(t,e,i,n,this.errorHandler),n.endDocument()}},Jr.prototype={setTagName:function(t){if(!Gr.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},add:function(t,e,i){if(!Gr.test(t))throw new Error("invalid attribute:"+t);this[this.length++]={qName:t,value:e,offset:i}},length:0,getLocalName:function(t){return this[t].localName},getLocator:function(t){return this[t].locator},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}};var Zr=$r;function ta(t,e){for(var i in t)e[i]=t[i]}function ea(t,e){var i,n=t.prototype;n instanceof e||((i=function(){}).prototype=e.prototype,ta(n,i=new i),t.prototype=n=i),n.constructor!=t&&(n.constructor=t)}var Xe={},r=(Xe.ELEMENT_NODE=1,Xe.ATTRIBUTE_NODE=2,Xe.TEXT_NODE=3,Xe.CDATA_SECTION_NODE=4,Xe.ENTITY_REFERENCE_NODE=5,Xe.ENTITY_NODE=6,Xe.PROCESSING_INSTRUCTION_NODE=7,Xe.COMMENT_NODE=8,Xe.DOCUMENT_NODE=9,Xe.DOCUMENT_TYPE_NODE=10,Xe.DOCUMENT_FRAGMENT_NODE=11,Xe.NOTATION_NODE=12,{}),ia={};r.INDEX_SIZE_ERR=(ia[1]="Index size error",1),r.DOMSTRING_SIZE_ERR=(ia[2]="DOMString size error",2),r.HIERARCHY_REQUEST_ERR=(ia[3]="Hierarchy request error",3),r.WRONG_DOCUMENT_ERR=(ia[4]="Wrong document",4),r.INVALID_CHARACTER_ERR=(ia[5]="Invalid character",5),r.NO_DATA_ALLOWED_ERR=(ia[6]="No data allowed",6),r.NO_MODIFICATION_ALLOWED_ERR=(ia[7]="No modification allowed",7),r.NOT_FOUND_ERR=(ia[8]="Not found",8),r.NOT_SUPPORTED_ERR=(ia[9]="Not supported",9),r.INUSE_ATTRIBUTE_ERR=(ia[10]="Attribute in use",10);function na(t,e){var i;return e instanceof Error?i=e:(i=this,Error.call(this,ia[t]),this.message=ia[t],Error.captureStackTrace&&Error.captureStackTrace(this,na)),i.code=t,e&&(this.message=this.message+": "+e),i}function ra(){}function aa(t,e){this._node=t,this._refresh=e,sa(this)}function sa(t){var e,i=t._node._inc||t._node.ownerDocument._inc;t._inc!=i&&(e=t._refresh(t._node),Na(t,"length",e.length),ta(e,t),t._inc=i)}function oa(){}function la(t,e){for(var i=t.length;i--;)if(t[i]===e)return i}function ua(t,e,i,n){var r;n?e[la(e,n)]=i:e[e.length++]=i,t&&(r=(i.ownerElement=t).ownerDocument)&&(n&&ga(r,t,n),t=t,i=i,r&&r._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&(t._nsMap[i.prefix?i.localName:""]=i.value))}function ha(t,e,i){var n=la(e,i);if(!(0<=n))throw na(8,new Error(t.tagName+"@"+i));for(var r,a=e.length-1;n<a;)e[n]=e[++n];e.length=a,t&&(r=t.ownerDocument)&&(ga(r,t,i),i.ownerElement=null)}function ca(t){if(this._features={},t)for(var e in t)this._features=t[e]}function da(){}function pa(t){return("<"==t?"&lt;":">"==t&&"&gt;")||"&"==t&&"&amp;"||'"'==t&&"&quot;"||"&#"+t.charCodeAt()+";"}function fa(t,e){if(e(t))return 1;if(t=t.firstChild)do{if(fa(t,e))return 1}while(t=t.nextSibling)}function ma(){}function ga(t,e,i){t&&t._inc++,"http://www.w3.org/2000/xmlns/"==i.namespaceURI&&delete e._nsMap[i.prefix?i.localName:""]}function va(t,e,i){if(t&&t._inc){t._inc++;var n=e.childNodes;if(i)n[n.length++]=i;else{for(var r=e.firstChild,a=0;r;)r=(n[a++]=r).nextSibling;n.length=a}}}function ya(t,e){var i=e.previousSibling,n=e.nextSibling;return i?i.nextSibling=n:t.firstChild=n,n?n.previousSibling=i:t.lastChild=i,va(t.ownerDocument,t),e}function _a(t,e,i){var n=e.parentNode;if(n&&n.removeChild(e),11===e.nodeType){var r=e.firstChild;if(null==r)return e;var a=e.lastChild}else r=a=e;n=i?i.previousSibling:t.lastChild;for(r.previousSibling=n,a.nextSibling=i,n?n.nextSibling=r:t.firstChild=r,null==i?t.lastChild=a:i.previousSibling=a;r.parentNode=t,r!==a&&(r=r.nextSibling););return va(t.ownerDocument||t,t),11==e.nodeType&&(e.firstChild=e.lastChild=null),e}function ba(){this._nsMap={}}function wa(){}function Ta(){}function xa(){}function Sa(){}function Ea(){}function ka(){}function Ca(){}function Ia(){}function Aa(){}function Pa(){}function Da(){}function Oa(){}function La(t,e){var i,n=[],r=9==this.nodeType&&this.documentElement||this,a=r.prefix,s=r.namespaceURI;return Ra(this,n,t,e,i=s&&null==a&&null==(a=r.lookupPrefix(s))?[{namespace:s,prefix:null}]:i),n.join("")}function Ma(t,e,i){var n=t.prefix||"",r=t.namespaceURI;if((n||r)&&("xml"!==n||"http://www.w3.org/XML/1998/namespace"!==r)&&"http://www.w3.org/2000/xmlns/"!=r){for(var a=i.length;a--;){var s=i[a];if(s.prefix==n)return s.namespace!=r}return 1}}function Ra(t,e,i,n,r){if(n){if(!(t=n(t)))return;if("string"==typeof t)return e.push(t),0}switch(t.nodeType){case 1:r=r||[];var a=t.attributes,s=a.length,o=t.firstChild,l=t.tagName;i="http://www.w3.org/1999/xhtml"===t.namespaceURI||i,e.push("<",l);for(var u,h,c,d=0;d<s;d++)"xmlns"==(u=a.item(d)).prefix?r.push({prefix:u.localName,namespace:u.value}):"xmlns"==u.nodeName&&r.push({prefix:"",namespace:u.value});for(d=0;d<s;d++)Ma(u=a.item(d),0,r)&&(h=u.prefix||"",c=u.namespaceURI,e.push(h?" xmlns:"+h:" xmlns",'="',c,'"'),r.push({prefix:h,namespace:c})),Ra(u,e,i,n,r);if(Ma(t,0,r)&&(h=t.prefix||"",c=t.namespaceURI,e.push(h?" xmlns:"+h:" xmlns",'="',c,'"'),r.push({prefix:h,namespace:c})),o||i&&!/^(?:meta|link|img|br|hr|input)$/i.test(l)){if(e.push(">"),i&&/^script$/i.test(l))for(;o;)o.data?e.push(o.data):Ra(o,e,i,n,r),o=o.nextSibling;else for(;o;)Ra(o,e,i,n,r),o=o.nextSibling;e.push("</",l,">")}else e.push("/>");return;case 9:case 11:for(o=t.firstChild;o;)Ra(o,e,i,n,r),o=o.nextSibling;return;case 2:return e.push(" ",t.name,'="',t.value.replace(/[<&"]/g,pa),'"');case 3:return e.push(t.data.replace(/[<&]/g,pa));case 4:return e.push("<![CDATA[",t.data,"]]>");case 8:return e.push("\x3c!--",t.data,"--\x3e");case 10:var p=t.publicId,l=t.systemId;return e.push("<!DOCTYPE ",t.name),void(p?(e.push(' PUBLIC "',p),l&&"."!=l&&e.push('" "',l),e.push('">')):l&&"."!=l?e.push(' SYSTEM "',l,'">'):((l=t.internalSubset)&&e.push(" [",l,"]"),e.push(">")));case 7:return e.push("<?",t.target," ",t.data,"?>");case 5:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function Na(t,e,i){t[e]=i}r.INVALID_STATE_ERR=(ia[11]="Invalid state",11),r.SYNTAX_ERR=(ia[12]="Syntax error",12),r.INVALID_MODIFICATION_ERR=(ia[13]="Invalid modification",13),r.NAMESPACE_ERR=(ia[14]="Invalid namespace",14),r.INVALID_ACCESS_ERR=(ia[15]="Invalid access",15),na.prototype=Error.prototype,ta(r,na),ra.prototype={length:0,item:function(t){return this[t]||null},toString:function(t,e){for(var i=[],n=0;n<this.length;n++)Ra(this[n],i,t,e);return i.join("")}},aa.prototype.item=function(t){return sa(this),this[t]},ea(aa,ra),oa.prototype={length:0,item:ra.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var i=this[e];if(i.nodeName==t)return i}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new na(10);e=this.getNamedItem(t.nodeName);return ua(this._ownerElement,this,t,e),e},setNamedItemNS:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new na(10);return e=this.getNamedItemNS(t.namespaceURI,t.localName),ua(this._ownerElement,this,t,e),e},removeNamedItem:function(t){t=this.getNamedItem(t);return ha(this._ownerElement,this,t),t},removeNamedItemNS:function(t,e){e=this.getNamedItemNS(t,e);return ha(this._ownerElement,this,e),e},getNamedItemNS:function(t,e){for(var i=this.length;i--;){var n=this[i];if(n.localName==e&&n.namespaceURI==t)return n}return null}},ca.prototype={hasFeature:function(t,e){t=this._features[t.toLowerCase()];return!(!t||e&&!(e in t))},createDocument:function(t,e,i){var n=new ma;return n.implementation=this,n.childNodes=new ra,(n.doctype=i)&&n.appendChild(i),e&&(e=n.createElementNS(t,e),n.appendChild(e)),n},createDocumentType:function(t,e,i){var n=new ka;return n.name=t,n.nodeName=t,n.publicId=e,n.systemId=i,n}},da.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return _a(this,t,e)},replaceChild:function(t,e){this.insertBefore(t,e),e&&this.removeChild(e)},removeChild:function(t){return ya(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(t){return function t(e,i,n){var r,a=new i.constructor;for(r in i){var s=i[r];"object"!=typeof s&&s!=a[r]&&(a[r]=s)}switch(i.childNodes&&(a.childNodes=new ra),a.ownerDocument=e,a.nodeType){case 1:var o=i.attributes,l=a.attributes=new oa,u=o.length;l._ownerElement=a;for(var h=0;h<u;h++)a.setAttributeNode(t(e,o.item(h),!0));break;case 2:n=!0}if(n)for(var c=i.firstChild;c;)a.appendChild(t(e,c,n)),c=c.nextSibling;return a}(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&3==e.nodeType&&3==t.nodeType?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return 0<this.attributes.length},lookupPrefix:function(t){for(var e=this;e;){var i=e._nsMap;if(i)for(var n in i)if(i[n]==t)return n;e=2==e.nodeType?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var i=e._nsMap;if(i&&t in i)return i[t];e=2==e.nodeType?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){return null==this.lookupPrefix(t)}},ta(Xe,da),ta(Xe,da.prototype),ma.prototype={nodeName:"#document",nodeType:9,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(11!=t.nodeType)return null==this.documentElement&&1==t.nodeType&&(this.documentElement=t),_a(this,t,e),t.ownerDocument=this,t;for(var i=t.firstChild;i;){var n=i.nextSibling;this.insertBefore(i,e),i=n}return t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),ya(this,t)},importNode:function(t,e){return function t(e,i,n){var r;switch(i.nodeType){case 1:(r=i.cloneNode(!1)).ownerDocument=e;case 11:break;case 2:n=!0}if((r=r||i.cloneNode(!1)).ownerDocument=e,r.parentNode=null,n)for(var a=i.firstChild;a;)r.appendChild(t(e,a,n)),a=a.nextSibling;return r}(this,t,e)},getElementById:function(e){var i=null;return fa(this.documentElement,function(t){if(1==t.nodeType&&t.getAttribute("id")==e)return i=t,!0}),i},getElementsByClassName:function(t){var n=new RegExp("(^|\\s)"+t+"(\\s|$)");return new aa(this,function(e){var i=[];return fa(e.documentElement,function(t){t!==e&&1==t.nodeType&&n.test(t.getAttribute("class"))&&i.push(t)}),i})},createElement:function(t){var e=new ba;return e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.childNodes=new ra,(e.attributes=new oa)._ownerElement=e},createDocumentFragment:function(){var t=new Pa;return t.ownerDocument=this,t.childNodes=new ra,t},createTextNode:function(t){var e=new xa;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new Sa;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new Ea;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var i=new Da;return i.ownerDocument=this,i.tagName=i.target=t,i.nodeValue=i.data=e,i},createAttribute:function(t){var e=new wa;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new Aa;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var i=new ba,n=e.split(":"),r=i.attributes=new oa;return i.childNodes=new ra,i.ownerDocument=this,i.nodeName=e,i.tagName=e,i.namespaceURI=t,2==n.length?(i.prefix=n[0],i.localName=n[1]):i.localName=e,r._ownerElement=i},createAttributeNS:function(t,e){var i=new wa,n=e.split(":");return i.ownerDocument=this,i.nodeName=e,i.name=e,i.namespaceURI=t,i.specified=!0,2==n.length?(i.prefix=n[0],i.localName=n[1]):i.localName=e,i}},ea(ma,da),ma.prototype.getElementsByTagName=(ba.prototype={nodeType:1,hasAttribute:function(t){return null!=this.getAttributeNode(t)},getAttribute:function(t){t=this.getAttributeNode(t);return t&&t.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){t=this.ownerDocument.createAttribute(t);t.value=t.nodeValue=""+e,this.setAttributeNode(t)},removeAttribute:function(t){t=this.getAttributeNode(t);t&&this.removeAttributeNode(t)},appendChild:function(t){return 11===t.nodeType?this.insertBefore(t,null):(e=this,(t=(i=t).parentNode)&&(n=e.lastChild,t.removeChild(i),n=e.lastChild),n=e.lastChild,i.parentNode=e,i.previousSibling=n,i.nextSibling=null,n?n.nextSibling=i:e.firstChild=i,e.lastChild=i,va(e.ownerDocument,e,i),i);var e,i,n},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){e=this.getAttributeNodeNS(t,e);e&&this.removeAttributeNode(e)},hasAttributeNS:function(t,e){return null!=this.getAttributeNodeNS(t,e)},getAttributeNS:function(t,e){e=this.getAttributeNodeNS(t,e);return e&&e.value||""},setAttributeNS:function(t,e,i){e=this.ownerDocument.createAttributeNS(t,e);e.value=e.nodeValue=""+i,this.setAttributeNode(e)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(n){return new aa(this,function(e){var i=[];return fa(e,function(t){t===e||1!=t.nodeType||"*"!==n&&t.tagName!=n||i.push(t)}),i})},getElementsByTagNameNS:function(n,r){return new aa(this,function(e){var i=[];return fa(e,function(t){t===e||1!==t.nodeType||"*"!==n&&t.namespaceURI!==n||"*"!==r&&t.localName!=r||i.push(t)}),i})}}).getElementsByTagName,ma.prototype.getElementsByTagNameNS=ba.prototype.getElementsByTagNameNS,ea(ba,da),wa.prototype.nodeType=2,ea(wa,da),Ta.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(t){throw new Error(ia[3])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,i){i=this.data.substring(0,t)+i+this.data.substring(t+e),this.nodeValue=this.data=i,this.length=i.length}},ea(Ta,da),xa.prototype={nodeName:"#text",nodeType:3,splitText:function(t){var e=(i=this.data).substring(t),i=i.substring(0,t);this.data=this.nodeValue=i,this.length=i.length;e=this.ownerDocument.createTextNode(e);return this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling),e}},ea(xa,Ta),Sa.prototype={nodeName:"#comment",nodeType:8},ea(Sa,Ta),Ea.prototype={nodeName:"#cdata-section",nodeType:4},ea(Ea,Ta),ka.prototype.nodeType=10,ea(ka,da),Ca.prototype.nodeType=12,ea(Ca,da),Ia.prototype.nodeType=6,ea(Ia,da),Aa.prototype.nodeType=5,ea(Aa,da),Pa.prototype.nodeName="#document-fragment",Pa.prototype.nodeType=11,ea(Pa,da),Da.prototype.nodeType=7,ea(Da,da),Oa.prototype.serializeToString=function(t,e,i){return La.call(t,e,i)},da.prototype.toString=La;try{Object.defineProperty&&(Object.defineProperty(aa.prototype,"length",{get:function(){return sa(this),this.$$length}}),Object.defineProperty(da.prototype,"textContent",{get:function(){return function t(e){switch(e.nodeType){case 1:case 11:var i=[];for(e=e.firstChild;e;)7!==e.nodeType&&8!==e.nodeType&&i.push(t(e)),e=e.nextSibling;return i.join("");default:return e.nodeValue}}(this)},set:function(t){switch(this.nodeType){case 1:case 11:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=t,this.nodeValue=t}}}),Na=function(t,e,i){t["$$"+e]=i})}catch(t){}function Ba(t){return t&&"object"==typeof t}function Fa(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return e.reduce(function(e,i){return"object"!=typeof i||Object.keys(i).forEach(function(t){Array.isArray(e[t])&&Array.isArray(i[t])?e[t]=e[t].concat(i[t]):Ba(e[t])&&Ba(i[t])?e[t]=Fa(e[t],i[t]):e[t]=i[t]}),e},{})}function Ua(t){return t.reduce(function(t,e){return t.concat(e)},[])}function ja(t){if(!t.length)return[];for(var e=[],i=0;i<t.length;i++)e.push(t[i]);return e}function qa(t){var e=t.baseUrl,i=t.source,n=void 0===i?"":i,i=t.range,i=void 0===i?"":i,t=t.indexRange,t=void 0===t?"":t,n={uri:n,resolvedUri:xr((void 0===e?"":e)||"",n)};return(i||t)&&(i=(i||t).split("-"),t=parseInt(i[0],10),i=parseInt(i[1],10),n.byterange={length:i-t+1,offset:t}),n}function za(t){return t&&"number"!=typeof t&&(t=parseInt(t,10)),isNaN(t)?null:t}function Ha(t){var s,e=t.type,i=void 0===e?"static":e,n=t.duration,r=t.timescale,a=void 0===r?1:r,e=t.sourceDuration,r=Cs[i](t),t=function(t,e){for(var i=[],n=t;n<e;n++)i.push(n);return i}(r.start,r.end).map((s=t,function(t,e){var i=s.duration,n=s.timescale,r=s.periodIndex,a=s.startNumber;return{number:(void 0===a?1:a)+t,duration:i/(void 0===n?1:n),timeline:r,time:e*i}}));return"static"===i&&(t[i=t.length-1].duration=e-n/a*i),t}function Va(t){var e=t.baseUrl,i=t.initialization,n=void 0===i?{}:i,r=t.sourceDuration,a=t.indexRange,i=void 0===a?"":a,a=t.duration;if(!e)throw new Error(Es);n=qa({baseUrl:e,source:n.sourceURL,range:n.range}),i=qa({baseUrl:e,source:e,indexRange:i});return i.map=n,a?(t=Ha(t)).length&&(i.duration=t[0].duration,i.timeline=t[0].timeline):r&&(i.duration=r,i.timeline=0),i.number=0,[i]}function Wa(t,e,i){for(var n=t.sidx.map||null,r=t.sidx.duration,a=t.timeline||0,s=t.sidx.byterange,s=s.offset+s.length,o=e.timescale,l=e.references.filter(function(t){return 1!==t.referenceType}),u=[],h=s+e.firstOffset,c=0;c<l.length;c++){var d=e.references[c],p=d.referencedSize,d=Va({baseUrl:i,timescale:o,timeline:a,periodIndex:a,duration:d.subsegmentDuration,sourceDuration:r,indexRange:h+"-"+(h+p-1)})[0];n&&(d.map=n),u.push(d),h+=p}return t.segments=u,t}function Ga(t){return e=t.reduce(function(t,e){var i,n=e.attributes.id+(e.attributes.lang||"");return t[n]?(e.segments[0]&&(e.segments[0].discontinuity=!0),(i=t[n].segments).push.apply(i,e.segments),e.attributes.contentProtection&&(t[n].attributes.contentProtection=e.attributes.contentProtection)):t[n]=e,t},{}),Object.keys(e).map(function(t){return e[t]}).map(function(t){return t.discontinuityStarts=t.segments.reduce(function(t,e,i){return e.discontinuity&&t.push(i),t},[]),t});var e}function Xa(t,e){if(void 0===e&&(e={}),!Object.keys(e).length)return t;for(var i in t){var n=t[i];n.sidx&&(i=e[i=n.sidx.uri+"-"+(i=(r=n.sidx.byterange).offset+r.length-1,r.offset+"-"+i)]&&e[i].sidx,n.sidx&&i&&Wa(n,i,n.sidx.resolvedUri))}var r;return t}function $a(t){var e=t.attributes,i=t.segments,n=t.sidx,i={attributes:((t={NAME:e.id,AUDIO:"audio",SUBTITLES:"subs",RESOLUTION:{width:e.width,height:e.height},CODECS:e.codecs,BANDWIDTH:e.bandwidth})["PROGRAM-ID"]=1,t),uri:"",endList:"static"===(e.type||"static"),timeline:e.periodIndex,resolvedUri:"",targetDuration:e.duration,segments:i,mediaSequence:i.length?i[0].number:1};return e.contentProtection&&(i.contentProtection=e.contentProtection),n&&(i.sidx=n),i}function Ya(t,e,i){if(void 0===i&&(i={}),!t.length)return{};var r,n=t[0].attributes,a=n.sourceDuration,s=n.type,o=void 0===s?"static":s,l=n.suggestedPresentationDelay,u=n.minimumUpdatePeriod,s=Ga(t.filter(function(t){t=t.attributes;return"video/mp4"===t.mimeType||"video/webm"===t.mimeType||"video"===t.contentType})).map($a),h=Ga(t.filter(function(t){t=t.attributes;return"audio/mp4"===t.mimeType||"audio/webm"===t.mimeType||"audio"===t.contentType})),n=t.filter(function(t){t=t.attributes;return"text/vtt"===t.mimeType||"text"===t.contentType}),s={allowCache:!0,discontinuityStarts:[],segments:[],endList:!0,mediaGroups:((t={AUDIO:{},VIDEO:{}})["CLOSED-CAPTIONS"]={},t.SUBTITLES={},t),uri:"",duration:a,playlists:Xa(s,i)};return 0<=u&&(s.minimumUpdatePeriod=1e3*u),e&&(s.locations=e),"dynamic"===o&&(s.suggestedPresentationDelay=l),h.length&&(s.mediaGroups.AUDIO.audio=function(o){var l;void 0===i&&(o={});var t=h.reduce(function(t,e){var i,n,r=e.attributes.role&&e.attributes.role.value||"",a=e.attributes.lang||"",s="main";return t[s=a?e.attributes.lang+(r?" ("+r+")":""):s]&&t[s].playlists[0].attributes.BANDWIDTH>e.attributes.bandwidth||(t[s]={language:a,autoselect:!0,default:"main"===r,playlists:Xa([(i=e.attributes,n=e.segments,s=e.sidx,n={attributes:((a={NAME:i.id,BANDWIDTH:i.bandwidth,CODECS:i.codecs})["PROGRAM-ID"]=1,a),uri:"",endList:"static"===(i.type||"static"),timeline:i.periodIndex,resolvedUri:"",targetDuration:i.duration,segments:n,mediaSequence:n.length?n[0].number:1},i.contentProtection&&(n.contentProtection=i.contentProtection),s&&(n.sidx=s),n)],o),uri:""},void 0===l&&"main"===r&&((l=e).default=!0)),t},{});return l||(t[Object.keys(t)[0]].default=!0),t}(i)),n.length&&(s.mediaGroups.SUBTITLES.subs=(r=void 0===i?{}:i,n.reduce(function(t,n){var e=n.attributes.lang||"text";return t[e]||(t[e]={language:e,default:!1,autoselect:!1,playlists:Xa([function(){var t=n.attributes,e=n.segments;void 0===e&&(e=[{uri:t.baseUrl,timeline:t.periodIndex,resolvedUri:t.baseUrl||"",duration:t.sourceDuration,number:0}],t.duration=t.sourceDuration);var i=((i={NAME:t.id,BANDWIDTH:t.bandwidth})["PROGRAM-ID"]=1,i);return t.codecs&&(i.CODECS=t.codecs),{attributes:i,uri:"",endList:"static"===(t.type||"static"),timeline:t.periodIndex,resolvedUri:t.baseUrl||"",targetDuration:t.duration,segments:e,mediaSequence:e.length?e[0].number:1}}()],r),uri:""}),t},{}))),s}function Ka(t,e){for(var i,n,r,a,s,o=t.type,l=void 0===o?"static":o,o=t.minimumUpdatePeriod,u=void 0===o?0:o,o=t.media,h=void 0===o?"":o,c=t.sourceDuration,o=t.timescale,d=void 0===o?1:o,o=t.startNumber,p=void 0===o?1:o,f=t.periodIndex,m=[],g=-1,v=0;v<e.length;v++){var y=e[v],_=y.d,b=y.r||0,w=y.t||0;g<0&&(g=w),w&&g<w&&(g=w);var T,x=void 0;x=b<0?(T=v+1)===e.length?"dynamic"===l&&0<u&&0<h.indexOf("$Number$")?(i=g,n=t.NOW,r=t.clientOffset,a=t.availabilityStartTime,s=t.timescale,y=t.start,w=t.minimumUpdatePeriod,Math.ceil((((n+r)/1e3+(void 0===w?0:w)-(a+(void 0===y?0:y)))*(void 0===s?1:s)-i)/_)):(c*d-g)/_:(e[T].t-g)/_:b+1;for(var S=p+m.length+x,E=p+m.length;E<S;)m.push({number:E,duration:_/d,time:g,timeline:f}),g+=_,E++}return m}function Qa(t,e){return t.replace(Is,(r=e,function(t,e,i,n){if("$$"===t)return"$";if(void 0===r[e])return t;t=""+r[e];return"RepresentationID"===e||(n=i?parseInt(n,10):1)<=t.length?t:new Array(n-t.length+1).join("0")+t}));var r}function Ja(i,t){var n={RepresentationID:i.id,Bandwidth:i.bandwidth||0},e=i.initialization,e=void 0===e?{sourceURL:"",range:""}:e,r=qa({baseUrl:i.baseUrl,source:Qa(e.sourceURL,n),range:e.range});return e=t,((t=i).duration||e?t.duration?Ha(t):Ka(t,e):[{number:t.startNumber||1,duration:t.sourceDuration,time:0,timeline:t.periodIndex}]).map(function(t){n.Number=t.number,n.Time=t.time;var e=Qa(i.media||"",n);return{uri:e,timeline:t.timeline,duration:t.duration,resolvedUri:xr(i.baseUrl||"",e),map:r,number:t.number}})}function Za(n,t){var e=n.duration,i=n.segmentUrls,i=void 0===i?[]:i;if(!e&&!t||e&&t)throw new Error(ks);var r,a=i.map(function(t){return e=t,i=n.baseUrl,t=n.initialization,t=qa({baseUrl:i,source:(t=void 0===t?{}:t).sourceURL,range:t.range}),(e=qa({baseUrl:i,source:e.media,range:e.mediaRange})).map=t,e;var e,i});return e&&(r=Ha(n)),(r=t?Ka(n,t):r).map(function(t,e){if(a[e]){e=a[e];return e.timeline=t.timeline,e.duration=t.duration,e.number=t.number,e}}).filter(function(t){return t})}function ts(t){var e,i=t.attributes,n=t.segmentInfo;n.template?(a=Ja,e=Fa(i,n.template)):n.base?(a=Va,e=Fa(i,n.base)):n.list&&(a=Za,e=Fa(i,n.list));var r={attributes:i};if(!a)return r;var a,t=a(e,n.timeline);return e.duration?(a=(i=e).duration,i=i.timescale,e.duration=a/(void 0===i?1:i)):t.length?e.duration=t.reduce(function(t,e){return Math.max(t,Math.ceil(e.duration))},0):e.duration=0,r.attributes=e,r.segments=t,n.base&&e.indexRange&&(r.sidx=t[0],r.segments=[]),r}function es(t,e){return ja(t.childNodes).filter(function(t){return t.tagName===e})}function is(t){return t.textContent.trim()}function ns(t){var e=/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)D)?(?:T(?:(\d*)H)?(?:(\d*)M)?(?:([\d.]*)S)?)?/.exec(t);if(!e)return 0;var i=e.slice(1),n=i[0],r=i[1],a=i[2],t=i[3],e=i[4],i=i[5];return 31536e3*parseFloat(n||0)+2592e3*parseFloat(r||0)+86400*parseFloat(a||0)+3600*parseFloat(t||0)+60*parseFloat(e||0)+parseFloat(i||0)}function rs(t){return t&&t.attributes?ja(t.attributes).reduce(function(t,e){var i=As[e.name]||As.DEFAULT;return t[e.name]=i(e.value),t},{}):{}}function as(t,i){return i.length?Ua(t.map(function(e){return i.map(function(t){return xr(e,is(t))})})):t}function ss(t){var e=es(t,"SegmentTemplate")[0],i=es(t,"SegmentList")[0],n=i&&es(i,"SegmentURL").map(function(t){return Fa({tag:"SegmentURL"},rs(t))}),r=es(t,"SegmentBase")[0],a=i||e,t=a&&es(a,"SegmentTimeline")[0],a=i||r||e,a=a&&es(a,"Initialization")[0],e=e&&rs(e);e&&a?e.initialization=a&&rs(a):e&&e.initialization&&(e.initialization={sourceURL:e.initialization});var s={template:e,timeline:t&&es(t,"S").map(rs),list:i&&Fa(rs(i),{segmentUrls:n,initialization:rs(a)}),base:r&&Fa(rs(r),{initialization:rs(a)})};return Object.keys(s).forEach(function(t){s[t]||delete s[t]}),s}function os(o,l,u){return function(t){var e=rs(t),i=as(l,es(t,"BaseURL")),n={role:rs(es(t,"Role")[0])},e=Fa(o,e,n),n=es(t,"ContentProtection").reduce(function(t,e){var i=rs(e),n=Ps[i.schemeIdUri];return n&&(t[n]={attributes:i},(e=es(e,"cenc:pssh")[0])&&(e=(e=is(e))&&Rr(e),t[n].pssh=e)),t},{});Object.keys(n).length&&(e=Fa(e,{contentProtection:n}));var r,a,s,n=ss(t),t=es(t,"Representation"),n=Fa(u,n);return Ua(t.map((r=e,a=i,s=n,function(t){var e=es(t,"BaseURL"),e=as(a,e),i=Fa(r,rs(t)),n=ss(t);return e.map(function(t){return{segmentInfo:Fa(s,n),attributes:Fa(i,{baseUrl:t})}})})))}}function ls(t){if(""===t)throw new Error(xs);var e,i,n=new ws;try{i=(e=n.parseFromString(t,"application/xml"))&&"MPD"===e.documentElement.tagName?e.documentElement:null}catch(t){}if(!i||0<i.getElementsByTagName("parsererror").length)throw new Error(Ss);return i}function us(t,e){void 0===e&&(e={});t=function(t,e){var i=e=void 0===e?{}:e,n=void 0===(s=i.manifestUri)?"":s,r=i.NOW,a=void 0===r?Date.now():r,s=void 0===(e=i.clientOffset)?0:e;if(!(r=es(t,"Period")).length)throw new Error(Ts);var o,l,i=es(t,"Location"),e=rs(t),t=as([n],es(t,"BaseURL"));return e.sourceDuration=e.mediaPresentationDuration||0,e.NOW=a,e.clientOffset=s,i.length&&(e.locations=i.map(is)),{locations:e.locations,representationInfo:Ua(r.map((o=e,l=t,function(t,e){var i=as(l,es(t,"BaseURL")),n=rs(t),n=parseInt(n.id,10),e=Vr.isNaN(n)?e:n,n=Fa(o,{periodIndex:e}),e=es(t,"AdaptationSet"),t=ss(t);return Ua(e.map(os(n,i,t)))})))}}(ls(t),e);return Ya(t.representationInfo.map(ts),t.locations,e.sidxMapping)}function hs(t){return t instanceof Uint8Array?t:(Array.isArray(t)||(e=t,ArrayBuffer.isView(e))||t instanceof ArrayBuffer||(t="number"!=typeof t||"number"==typeof t&&t!=t?0:[t]),new Uint8Array(t&&t.buffer||t,t&&t.byteOffset||0,t&&t.byteLength||0));var e}function cs(t,e){if("string"!=typeof(t="string"!=typeof t&&t&&"function"==typeof t.toString?t.toString():t))return new Uint8Array;e||(t=unescape(encodeURIComponent(t)));for(var i=new Uint8Array(t.length),n=0;n<t.length;n++)i[n]=t.charCodeAt(n);return i}function ds(i,t,e){var n=void 0===e?{}:e,e=n.offset,r=void 0===e?0:e,n=n.mask,a=void 0===n?[]:n;i=hs(i);n=((t=hs(t)).every?t:Array.prototype).every;return t.length&&i.length-r>=t.length&&n.call(t,function(t,e){return t===(a[e]?a[e]&i[r+e]:i[r+e])})}function ps(n,t){return void 0===t&&(t=0),(n=hs(n)).length-t<10||!ds(n,Rs,{offset:t})?t:ps(n,t+=function(t,e){void 0===e&&(e=0);var i=(t=hs(n))[e+5],e=t[e+6]<<21|t[e+7]<<14|t[e+8]<<7|t[e+9];return(16&i)>>4?20+e:10+e}(0,t))}function fs(t){return"string"==typeof t?cs(t):t}function ms(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1);var r=function(t){for(var e=1,i=0;i<Bs.length&&!(t&Bs[i]);i++)e++;return e}(t[e]),a=t.subarray(e,e+r);return i&&((a=Array.prototype.slice.call(t,e,e+r))[0]^=Bs[r-1]),{length:r,value:function(n,t){var e=t.signed,e=void 0!==e&&e,t=t.le,r=void 0!==t&&t;n=hs(n);t=r?"reduce":"reduceRight",t=(n[t]||Array.prototype[t]).call(n,function(t,e,i){i=r?i:Math.abs(i+1-n.length);return t+Ls(e)*Ms[i]},Ls(0));return!e||(e=Ms[n.length]/Ls(2)-Ls(1))<(t=Ls(t))&&(t-=e,t-=e,t-=Ls(2)),Number(t)}(a,{signed:n}),bytes:a}}function gs(t){return"string"==typeof t?t.match(/.{1,2}/g).map(gs):"number"==typeof t?function(t,e){for(var i=void 0!==(e=(void 0===e?{}:e).le)&&e,n=(e=t=Ls(t="bigint"!=typeof t&&"number"!=typeof t||"number"==typeof t&&t!=t?0:t),Math.ceil(e.toString(2).length/8)),r=new Uint8Array(new ArrayBuffer(n)),a=0;a<n;a++){var s=i?a:Math.abs(a+1-r.length);r[s]=Number(t/Ms[a]&Ls(255)),t<0&&(r[s]=Math.abs(~r[s]),r[s]-=0===a?1:2)}return r}(t):t}function vs(t,e){var i;i=e,e=Array.isArray(i)?i.map(gs):[gs(i)],t=hs(t);var n=[];if(!e.length)return n;for(var r=0;r<t.length;){var a=ms(t,r,!1),s=ms(t,r+a.length),o=r+a.length+s.length;127===s.value&&(s.value=function t(e,i,n){if(n>=i.length)return i.length;var r=ms(i,n,!1);if(ds(e.bytes,r.bytes))return n;var a=ms(i,n+r.length);return t(e,i,n+a.length+a.value+r.length)}(a,t,o),s.value!==t.length&&(s.value-=o));var l=o+s.value>t.length?t.length:o+s.value,l=t.subarray(o,l);ds(e[0],a.bytes)&&(1===e.length?n.push(l):n=n.concat(vs(l,e.slice(1)))),r+=a.length+s.length+l.length}return n}function ys(t,e,i,n){void 0===n&&(n=1/0),t=hs(t),i=[].concat(i);for(var r,a=0,s=0;a<t.length&&(s<n||r);){var o=void 0;if(ds(t.subarray(a),Fs)?o=4:ds(t.subarray(a),Us)&&(o=3),o){if(s++,r)return function(t){for(var e=[],i=1;i<t.length-2;)ds(t.subarray(i,i+3),js)&&(e.push(i+2),i++),i++;if(0===e.length)return t;for(var n=t.length-e.length,r=new Uint8Array(n),a=0,i=0;i<n;a++,i++)a===e[0]&&(a++,e.shift()),r[i]=t[a];return r}(t.subarray(r,a));var l=void 0;"h264"===e?l=31&t[a+o]:"h265"===e&&(l=t[a+o]>>1&63),-1!==i.indexOf(l)&&(r=a+o),a+=o+("h264"===e?1:2)}else a++}return t.subarray(0,0)}var _s=ca,bs=Oa,r=i(function(t,e){function i(t){this.options=t||{locator:{}}}function u(){this.cdata=!1}function h(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function r(t,e,i){return"string"==typeof t?t.substr(e,i):t.length>=e+i||e?new java.lang.String(t,e,i)+"":t}function c(t,e){(t.currentElement||t.doc).appendChild(e)}i.prototype.parseFromString=function(t,e){var i=this.options,n=new d,s=i.domBuilder||new u,r=i.errorHandler,a=i.locator,o=i.xmlns||{},l=/\/x?html?$/.test(e),e=l?Wr.entityMap:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return a&&s.setDocumentLocator(a),n.errorHandler=function(n,r){if(!n){if(s instanceof u)return s;n=s}var t={},a=n instanceof Function;function e(e){var i=n[e];!i&&a&&(i=2==n.length?function(t){n(e,t)}:n),t[e]=i?function(t){i("[xmldom "+e+"]\t"+t+function(t){if(t)return"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]"}(r))}:function(){}}return r=r||{},e("warning"),e("error"),e("fatalError"),t}(r,a),n.domBuilder=i.domBuilder||s,l&&(o[""]="http://www.w3.org/1999/xhtml"),o.xml=o.xml||"http://www.w3.org/XML/1998/namespace",t&&"string"==typeof t?n.parse(t,o,e):n.errorHandler.error("invalid doc source"),s.doc},u.prototype={startDocument:function(){this.doc=(new n).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(t,e,i,n){var r=this.doc,a=r.createElementNS(t,i||e),s=n.length;c(this,a),this.currentElement=a,this.locator&&h(this.locator,a);for(var o=0;o<s;o++){t=n.getURI(o);var l=n.getValue(o),u=(i=n.getQName(o),r.createAttributeNS(t,i));this.locator&&h(n.getLocator(o),u),u.value=u.nodeValue=l,a.setAttributeNode(u)}},endElement:function(t,e,i){var n=this.currentElement;n.tagName,this.currentElement=n.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){e=this.doc.createProcessingInstruction(t,e);this.locator&&h(this.locator,e),c(this,e)},ignorableWhitespace:function(t,e,i){},characters:function(t,e,i){var n;(t=r.apply(this,arguments))&&(n=this.cdata?this.doc.createCDATASection(t):this.doc.createTextNode(t),this.currentElement?this.currentElement.appendChild(n):/^\s*$/.test(t)&&this.doc.appendChild(n),this.locator&&h(this.locator,n))},skippedEntity:function(t){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,i){t=r.apply(this,arguments);t=this.doc.createComment(t);this.locator&&h(this.locator,t),c(this,t)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,i){var n=this.doc.implementation;n&&n.createDocumentType&&(i=n.createDocumentType(t,e,i),this.locator&&h(this.locator,i),c(this,i))},warning:function(t){},error:function(t){},fatalError:function(t){throw t}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(t){u.prototype[t]=function(){return null}});var d=Zr,n=e.DOMImplementation=_s;e.XMLSerializer=bs,e.DOMParser=i}),ws=(r.DOMImplementation,r.XMLSerializer,r.DOMParser),Ts="INVALID_NUMBER_OF_PERIOD",xs="DASH_EMPTY_MANIFEST",Ss="DASH_INVALID_XML",Es="NO_BASE_URL",ks="SEGMENT_TIME_UNSPECIFIED",Cs={static:function(t){var e=t.duration,i=t.timescale,n=void 0===i?1:i,i=t.sourceDuration,t=za(t.endNumber);return{start:0,end:"number"==typeof t?t:Math.ceil(i/(e/n))}},dynamic:function(t){var e=t.NOW,i=t.clientOffset,n=t.availabilityStartTime,r=t.timescale,a=void 0===r?1:r,s=t.duration,o=t.start,l=void 0===o?0:o,r=t.minimumUpdatePeriod,o=void 0===r?0:r,r=t.timeShiftBufferDepth,r=void 0===r?1/0:r,t=za(t.endNumber),i=(e+i)/1e3,l=n+l,o=Math.ceil((i+o-l)*a/s),r=Math.floor((i-l-r)*a/s),s=Math.floor((i-l)*a/s);return{start:Math.max(0,r),end:"number"==typeof t?t:Math.min(o,s)}}},Is=/\$([A-z]*)(?:(%0)([0-9]+)d)?\$/g,As={mediaPresentationDuration:ns,availabilityStartTime:function(t){return/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(t=t)&&(t+="Z"),Date.parse(t)/1e3},minimumUpdatePeriod:ns,suggestedPresentationDelay:ns,type:function(t){return t},timeShiftBufferDepth:ns,start:ns,width:function(t){return parseInt(t,10)},height:function(t){return parseInt(t,10)},bandwidth:function(t){return parseInt(t,10)},startNumber:function(t){return parseInt(t,10)},timescale:function(t){return parseInt(t,10)},duration:function(t){var e=parseInt(t,10);return isNaN(e)?ns(t):e},d:function(t){return parseInt(t,10)},t:function(t){return parseInt(t,10)},r:function(t){return parseInt(t,10)},DEFAULT:function(t){return t}},Ps={"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b":"org.w3.clearkey","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed":"com.widevine.alpha","urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95":"com.microsoft.playready","urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb":"com.adobe.primetime"},Ds=Wa,Os=Math.pow(2,32),Ls=Ir.BigInt||Number,Ms=[Ls("0x1"),Ls("0x100"),Ls("0x10000"),Ls("0x1000000"),Ls("0x100000000"),Ls("0x10000000000"),Ls("0x1000000000000"),Ls("0x100000000000000"),Ls("0x10000000000000000")],Rs=hs([73,68,51]),Ns={EBML:hs([26,69,223,163]),DocType:hs([66,130]),Segment:hs([24,83,128,103]),SegmentInfo:hs([21,73,169,102]),Tracks:hs([22,84,174,107]),Track:hs([174]),TrackNumber:hs([215]),DefaultDuration:hs([35,227,131]),TrackEntry:hs([174]),TrackType:hs([131]),FlagDefault:hs([136]),CodecID:hs([134]),CodecPrivate:hs([99,162]),VideoTrack:hs([224]),AudioTrack:hs([225]),Cluster:hs([31,67,182,117]),Timestamp:hs([231]),TimestampScale:hs([42,215,177]),BlockGroup:hs([160]),BlockDuration:hs([155]),Block:hs([161]),SimpleBlock:hs([163])},Bs=[128,64,32,16,8,4,2,1],Fs=hs([0,0,0,1]),Us=hs([0,0,1]),js=hs([0,0,3]),qs={webm:hs([119,101,98,109]),matroska:hs([109,97,116,114,111,115,107,97]),flac:hs([102,76,97,67]),ogg:hs([79,103,103,83]),ac3:hs([11,119]),riff:hs([82,73,70,70]),avi:hs([65,86,73]),wav:hs([87,65,86,69]),"3gp":hs([102,116,121,112,51,103]),mp4:hs([102,116,121,112]),fmp4:hs([115,116,121,112]),mov:hs([102,116,121,112,113,116])},zs={aac:function(t){return ds(t,[255,16],{offset:ps(t),mask:[255,22]})},mp3:function(t){return ds(t,[255,2],{offset:ps(t),mask:[255,6]})},webm:function(t){return ds(vs(t,[Ns.EBML,Ns.DocType])[0],qs.webm)},mkv:function(t){return ds(vs(t,[Ns.EBML,Ns.DocType])[0],qs.matroska)},mp4:function(t){return!zs["3gp"](t)&&!zs.mov(t)&&(ds(t,qs.mp4,{offset:4})||ds(t,qs.fmp4,{offset:4}))},mov:function(t){return ds(t,qs.mov,{offset:4})},"3gp":function(t){return ds(t,qs["3gp"],{offset:4})},ac3:function(t){var e=ps(t);return ds(t,qs.ac3,{offset:e})},ts:function(t){if(t.length<189&&1<=t.length)return 71===t[0];for(var e=0;e+188<t.length&&e<188;){if(71===t[e]&&71===t[e+188])return!0;e+=1}return!1},flac:function(t){var e=ps(t);return ds(t,qs.flac,{offset:e})},ogg:function(t){return ds(t,qs.ogg)},avi:function(t){return ds(t,qs.riff)&&ds(t,qs.avi,{offset:8})},wav:function(t){return ds(t,qs.riff)&&ds(t,qs.wav,{offset:8})},h264:function(t){return ys(t,"h264",7,3).length},h265:function(t){return ys(t,"h265",[32,33],3).length}},Hs=Object.keys(zs).filter(function(t){return"ts"!==t&&"h264"!==t&&"h265"!==t}).concat(["ts","h264","h265"]);function Vs(t){t=hs(t);for(var e=0;e<Hs.length;e++){var i=Hs[e];if(Gs[i](t))return i}return""}function Ws(t){return 0<function t(e,i,n){var r;void 0===n&&(n=!1),r=i,i=Array.isArray(r)?r.map(fs):[fs(r)],e=hs(e);var a=[];if(!i.length)return a;for(var s=0;s<e.length;){var o=(e[s]<<24|e[s+1]<<16|e[s+2]<<8|e[s+3])>>>0,l=e.subarray(s+4,s+8);if(0==o)break;var u=s+o;if(u>e.length){if(n)break;u=e.length}o=e.subarray(s+8,u),ds(l,i[0])&&(1===i.length?a.push(o):a.push.apply(a,t(o,i.slice(1),n))),s=u}return a}(t,["moof"]).length}Hs.forEach(function(t){var e=zs[t];zs[t]=function(t){return e(hs(t))}});var Gs=zs,Xs=27,$s=15;function Ys(t){var e=31&t[1];return(e<<=8)|t[2]}function Ks(t){return!!(64&t[1])}function Qs(t){var e=0;return 1<(48&t[3])>>>4&&(e+=t[4]+1),e}function Js(t){switch(t){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}}function Zs(t,e){var i=0<=(i=t[e+6]<<21|t[e+7]<<14|t[e+8]<<7|t[e+9])?i:0;return(16&t[e+5])>>4?i+20:i+10}function to(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]}var eo=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],Xe={isLikelyAacData:function(t){var e=function t(e,i){return e.length-i<10||e[i]!=="I".charCodeAt(0)||e[i+1]!=="D".charCodeAt(0)||e[i+2]!=="3".charCodeAt(0)?i:t(e,i+=Zs(e,i))}(t,0);return t.length>=e+2&&255==(255&t[e])&&240==(240&t[e+1])&&16==(22&t[e+1])},parseId3TagSize:Zs,parseAdtsSize:function(t,e){var i=(224&t[e+5])>>5,n=t[e+4]<<3;return 6144&t[e+3]|n|i},parseType:function(t,e){return t[e]==="I".charCodeAt(0)&&t[e+1]==="D".charCodeAt(0)&&t[e+2]==="3".charCodeAt(0)?"timed-metadata":!0&t[e]&&240==(240&t[e+1])?"audio":null},parseSampleRate:function(t){for(var e=0;e+5<t.length;){if(255===t[e]&&240==(246&t[e+1]))return eo[(60&t[e+2])>>>2];e++}return null},parseAacTimestamp:function(t){var e,i=10;64&t[5]&&(i+=4,i+=to(t.subarray(10,14)));do{if((e=to(t.subarray(i+4,i+8)))<1)return null;if("PRIV"===String.fromCharCode(t[i],t[i+1],t[i+2],t[i+3]))for(var n=t.subarray(i+10,i+e+10),r=0;r<n.byteLength;r++)if(0===n[r]){if("com.apple.streaming.transportStreamTimestamp"!==unescape(function(t,e){for(var i="",n=0;n<e;n++)i+="%"+("00"+t[n].toString(16)).slice(-2);return i}(n,r)))break;var a=n.subarray(r+1),s=(1&a[3])<<30|a[4]<<22|a[5]<<14|a[6]<<6|a[7]>>>2;return(s*=4)+(3&a[7])}}while(i+=10,(i+=e)<t.byteLength);return null}},io=function(t,e){var i=1;for(e<t&&(i=-1);4294967296<Math.abs(e-t);)t+=8589934592*i;return t},no={};function ro(t){var e,i={pid:null,table:null},n={};for(e in function(t,e){for(var i,n=0,r=ho;r<t.byteLength;)if(71!==t[n]||71!==t[r])n++,r++;else{switch(i=t.subarray(n,r),no.ts.parseType(i,e.pid)){case"pat":e.pid||(e.pid=no.ts.parsePat(i));break;case"pmt":e.table||(e.table=no.ts.parsePmt(i))}if(e.pid&&e.table)return;n+=ho,r+=ho}}(t,i),i.table)if(i.table.hasOwnProperty(e))switch(i.table[e]){case Xs:n.video=[],function(t,e,i){for(var n,r,a,s,o,l,u,h,c=0,d=ho,p=!1,f={data:[],size:0};d<t.byteLength;)if(71!==t[c]||71!==t[d])c++,d++;else{if("pes"===(n=t.subarray(c,d),no.ts.parseType(n,e.pid)))if(r=no.ts.parsePesType(n,e.table),a=no.ts.parsePayloadUnitStartIndicator(n),"video"===r&&(a&&!p&&(s=no.ts.parsePesTime(n))&&(s.type="video",i.video.push(s),p=!0),!i.firstKeyFrame)){if(a&&0!==f.size){for(o=new Uint8Array(f.size),l=0;f.data.length;)u=f.data.shift(),o.set(u,l),l+=u.byteLength;!no.ts.videoPacketContainsKeyFrame(o)||(h=no.ts.parsePesTime(o))&&(i.firstKeyFrame=h,i.firstKeyFrame.type="video"),f.size=0}f.data.push(n),f.size+=n.byteLength}if(p&&i.firstKeyFrame)break;c+=ho,d+=ho}for(c=(d=t.byteLength)-ho,p=!1;0<=c;)if(71!==t[c]||71!==t[d])c--,d--;else{if("pes"===(n=t.subarray(c,d),no.ts.parseType(n,e.pid))&&(r=no.ts.parsePesType(n,e.table),a=no.ts.parsePayloadUnitStartIndicator(n),"video"===r&&a&&(s=no.ts.parsePesTime(n))&&(s.type="video",i.video.push(s),p=!0)),p)break;c-=ho,d-=ho}}(t,i,n),0===n.video.length&&delete n.video;break;case $s:n.audio=[],function(t,e,i){for(var n,r,a,s,o=0,l=ho,u=!1;l<=t.byteLength;)if(71!==t[o]||71!==t[l]&&l!==t.byteLength)o++,l++;else{if("pes"===(n=t.subarray(o,l),no.ts.parseType(n,e.pid))&&(r=no.ts.parsePesType(n,e.table),a=no.ts.parsePayloadUnitStartIndicator(n),"audio"===r&&a&&(s=no.ts.parsePesTime(n))&&(s.type="audio",i.audio.push(s),u=!0)),u)break;o+=ho,l+=ho}for(o=(l=t.byteLength)-ho,u=!1;0<=o;)if(71!==t[o]||71!==t[l]&&l!==t.byteLength)o--,l--;else{if("pes"===(n=t.subarray(o,l),no.ts.parseType(n,e.pid))&&(r=no.ts.parsePesType(n,e.table),a=no.ts.parsePayloadUnitStartIndicator(n),"audio"===r&&a&&(s=no.ts.parsePesTime(n))&&(s.type="audio",i.audio.push(s),u=!0)),u)break;o-=ho,l-=ho}}(t,i,n),0===n.audio.length&&delete n.audio}return n}no.ts={parseType:function(t,e){t=Ys(t);return 0===t?"pat":t===e?"pmt":e?"pes":null},parsePat:function(t){var e=Ks(t),i=4+Qs(t);return e&&(i+=t[i]+1),(31&t[i+10])<<8|t[i+11]},parsePmt:function(t){var e={},i=Ks(t),n=4+Qs(t);if(i&&(n+=t[n]+1),1&t[n+5]){for(var r=3+((15&t[n+1])<<8|t[n+2])-4,a=12+((15&t[n+10])<<8|t[n+11]);a<r;){var s=n+a;e[(31&t[s+1])<<8|t[s+2]]=t[s],a+=5+((15&t[s+3])<<8|t[s+4])}return e}},parsePayloadUnitStartIndicator:Ks,parsePesType:function(t,e){switch(e[Ys(t)]){case Xs:return"video";case $s:return"audio";case 21:return"timed-metadata";default:return null}},parsePesTime:function(t){if(!Ks(t))return null;var e=4+Qs(t);if(e>=t.byteLength)return null;var i,n=null;return 192&(i=t[e+7])&&((n={}).pts=(14&t[e+9])<<27|(255&t[e+10])<<20|(254&t[e+11])<<12|(255&t[e+12])<<5|(254&t[e+13])>>>3,n.pts*=4,n.pts+=(6&t[e+13])>>>1,n.dts=n.pts,64&i&&(n.dts=(14&t[e+14])<<27|(255&t[e+15])<<20|(254&t[e+16])<<12|(255&t[e+17])<<5|(254&t[e+18])>>>3,n.dts*=4,n.dts+=(6&t[e+18])>>>1)),n},videoPacketContainsKeyFrame:function(t){for(var e=4+Qs(t),i=t.subarray(e),n=0,r=0,a=!1;r<i.byteLength-3;r++)if(1===i[r+2]){n=r+5;break}for(;n<i.byteLength;)switch(i[n]){case 0:if(0!==i[n-1]){n+=2;break}if(0!==i[n-2]){n++;break}for(r+3!==n-2&&"slice_layer_without_partitioning_rbsp_idr"===Js(31&i[r+3])&&(a=!0);1!==i[++n]&&n<i.length;);r=n-2,n+=3;break;case 1:if(0!==i[n-1]||0!==i[n-2]){n+=3;break}"slice_layer_without_partitioning_rbsp_idr"===Js(31&i[r+3])&&(a=!0),r=n-2,n+=3;break;default:n+=3}return i=i.subarray(r),n-=r,r=0,a=i&&3<i.byteLength&&"slice_layer_without_partitioning_rbsp_idr"===Js(31&i[r+3])?!0:a}},no.aac=Xe;function ao(t){return t>>>0}function so(t,e){var i,n,r,a=[];if(!e.length)return null;for(i=0;i<t.byteLength;)n=po(t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3]),r=co(t.subarray(i+4,i+8)),n=1<n?i+n:t.byteLength,r===e[0]&&(1===e.length?a.push(t.subarray(i+8,n)):(r=so(t.subarray(i+8,n),e.slice(1))).length&&(a=a.concat(r))),i=n;return a}function oo(t){return("00"+t.toString(16)).slice(-2)}var lo,uo=9e4,ho=188,co=function(t){var e="";return e+=String.fromCharCode(t[0]),e+=String.fromCharCode(t[1]),(e+=String.fromCharCode(t[2]))+String.fromCharCode(t[3])},po=ao,fo=ao;function mo(t){return t&&t.replace(/avc1\.(\d+)\.(\d+)/i,function(t,e,i){return"avc1."+("00"+Number(e).toString(16)).slice(-2)+"00"+("00"+Number(i).toString(16)).slice(-2)})}function go(t){var t=(t=void 0===t?"":t).split(","),a=[];return t.forEach(function(n){var r;n=n.trim(),ql.forEach(function(t){var e,i=jl[t].exec(n.toLowerCase());!i||i.length<=1||(r=t,e=n.substring(0,i[1].length),i=n.replace(e,""),a.push({type:e,details:i,mediaType:t}))}),r||a.push({type:n,details:"",mediaType:"unknown"})}),a}function vo(t){return jl.audio.test((t=void 0===t?"":t).trim().toLowerCase())}function yo(t){if(t&&"string"==typeof t){var e=t.toLowerCase().split(",").map(function(t){return mo(t.trim())}),i="video";1===e.length&&vo(e[0])?i="audio":1===e.length&&(n=e[0],jl.text.test((n=void 0===n?"":n).trim().toLowerCase()))&&(i="application");n="mp4";return e.every(function(t){return jl.mp4.test(t)})?n="mp4":e.every(function(t){return jl.webm.test(t)})?n="webm":e.every(function(t){return jl.ogg.test(t)})&&(n="ogg"),i+"/"+n+';codecs="'+t+'"'}var n}function _o(t){return void 0===t&&(t=""),Ir.MediaSource&&Ir.MediaSource.isTypeSupported&&Ir.MediaSource.isTypeSupported(yo(t))||!1}function bo(t){return(t=void 0===t?"":t).toLowerCase().split(",").every(function(t){t=t.trim();for(var e=0;e<zl.length;e++)if(jl["muxer"+zl[e]].test(t))return!0;return!1})}function wo(t,e,i){return t&&i&&i.responseURL&&e!==i.responseURL?i.responseURL:e}function To(t){return br.log.debug?br.log.debug.bind(br,"VHS:",t+" >"):function(){}}function xo(t){var e=t.onwarn,i=t.oninfo,n=t.manifestString,r=t.customTagParsers,r=void 0===r?[]:r,t=t.customTagMappers,t=void 0===t?[]:t,a=new qr;return e&&a.on("warn",e),i&&a.on("info",i),r.forEach(function(t){return a.addParser(t)}),t.forEach(function(t){return a.addTagMapper(t)}),a.push(n),a.end(),a.manifest}function So(r,a){["AUDIO","SUBTITLES"].forEach(function(t){for(var e in r.mediaGroups[t])for(var i in r.mediaGroups[t][e]){var n=r.mediaGroups[t][e][i];a(n,t,e,i)}})}function Eo(t){var e=t.playlist,i=t.uri,t=t.id;e.id=t,i&&(e.uri=i),e.attributes=e.attributes||{}}function ko(r,t){r.uri=t;for(var e,i=0;i<r.playlists.length;i++)r.playlists[i].uri||(r.playlists[i].uri="placeholder-uri-"+i);So(r,function(t,e,i,n){t.playlists&&t.playlists.length&&!t.playlists[0].uri&&(n="0-"+(i="placeholder-uri-"+e+"-"+i+"-"+n),t.playlists[0].uri=i,t.playlists[0].id=n,r.playlists[n]=t.playlists[0],r.playlists[i]=t.playlists[0])}),function(t){for(var e=t.playlists.length;e--;){var i=t.playlists[e];Eo({playlist:i,id:e+"-"+i.uri}),i.resolvedUri=Vl(t.uri,i.uri),t.playlists[i.id]=i,(t.playlists[i.uri]=i).attributes.BANDWIDTH||Wl.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute.")}}(r),So(e=r,function(t){t.uri&&(t.resolvedUri=Vl(e.uri,t.uri))})}function Co(t,e){t.resolvedUri||(t.resolvedUri=Vl(e,t.uri)),t.key&&!t.key.resolvedUri&&(t.key.resolvedUri=Vl(e,t.key.uri)),t.map&&!t.map.resolvedUri&&(t.map.resolvedUri=Vl(e,t.map.uri))}function Io(t,e){return t===e||t.segments&&e.segments&&t.segments.length===e.segments.length&&t.endList===e.endList&&t.mediaSequence===e.mediaSequence}function Ao(t,e,i){void 0===i&&(i=Io);var n=Gl(t,{}),t=n.playlists[e.id];if(!t)return null;if(i(t,e))return null;var r=Gl(t,e);t.segments&&(r.segments=function(t,e,i){var n=e.slice();i=i||0;for(var r=Math.min(t.length,e.length+i),a=i;a<r;a++)n[a-i]=Gl(t[a],n[a-i]);return n}(t.segments,e.segments,e.mediaSequence-t.mediaSequence)),r.segments.forEach(function(t){Co(t,r.resolvedUri)});for(var a=0;a<n.playlists.length;a++)n.playlists[a].id===e.id&&(n.playlists[a]=r);return n.playlists[e.id]=r,n.playlists[e.uri]=r,n}function Po(t,e){var i=t.segments[t.segments.length-1];return e&&i&&i.duration?1e3*i.duration:500*(t.targetDuration||10)}function Do(t,e){var i,n=[];if(t&&t.length)for(i=0;i<t.length;i++)e(t.start(i),t.end(i))&&n.push([t.start(i),t.end(i)]);return br.createTimeRanges(n)}function Oo(t,i){return Do(t,function(t,e){return t-.1<=i&&i<=e+.1})}function Lo(t,e){return Do(t,function(t){return e<=t-$l})}function Mo(t){var e=[];if(!t||!t.length)return"";for(var i=0;i<t.length;i++)e.push(t.start(i)+" => "+t.end(i));return e.join(", ")}function Ro(t){for(var e=[],i=0;i<t.length;i++)e.push({start:t.start(i),end:t.end(i)});return e}function No(t,r,e){if((r=void 0===r?t.mediaSequence+t.segments.length:r)<t.mediaSequence)return 0;var i=function(t){var e=0,i=r-t.mediaSequence,n=t.segments[i];if(n){if(void 0!==n.start)return{result:n.start,precise:!0};if(void 0!==n.end)return{result:n.end-n.duration,precise:!0}}for(;i--;){if(void 0!==(n=t.segments[i]).end)return{result:e+n.end,precise:!0};if(e+=n.duration,void 0!==n.start)return{result:e+n.start,precise:!0}}return{result:e,precise:!1}}(t);if(i.precise)return i.result;t=function(t){for(var e,i=0,n=r-t.mediaSequence;n<t.segments.length;n++){if(void 0!==(e=t.segments[n]).start)return{result:e.start-i,precise:!0};if(i+=e.duration,void 0!==e.end)return{result:e.end-i,precise:!0}}return{result:-1,precise:!1}}(t);return t.precise?t.result:i.result+e}function Bo(t,e,i){if(!t)return 0;if(void 0===e){if(t.totalDuration)return t.totalDuration;if(!t.endList)return kr.Infinity}return No(t,e,i="number"!=typeof i?0:i)}function Fo(t,e,i){var n,r=0;if(i<e&&(e=(n=[i,e])[0],i=n[1]),e<0){for(var a=e;a<Math.min(0,i);a++)r+=t.targetDuration;e=0}for(var s=e;s<i;s++)r+=t.segments[s].duration;return r}function Uo(t,e){if(!t.segments.length)return 0;var i=t.segments.length,n=t.segments[i-1].duration||t.targetDuration,r="number"==typeof e?e:n+2*t.targetDuration;if(0===r)return i;for(var a=0;i--&&!(r<=(a+=t.segments[i].duration)););return Math.max(0,i)}function jo(t,e,i,n){if(!t||!t.segments)return null;if(t.endList)return Bo(t);if(null===e)return null;e=e||0;n=i?Uo(t,n):t.segments.length;return No(t,t.mediaSequence+n,e)}function qo(t){return t.excludeUntil&&t.excludeUntil>Date.now()}function zo(t){return t.excludeUntil&&t.excludeUntil===1/0}function Ho(t){var e=qo(t);return!t.disabled&&!e}function Vo(t,e){return e.attributes&&e.attributes[t]}function Wo(t,e){if(1===t.playlists.length)return!0;var i=e.attributes.BANDWIDTH||Number.MAX_VALUE;return 0===t.playlists.filter(function(t){return!!Ho(t)&&(t.attributes.BANDWIDTH||0)<i}).length}function Go(t,e,i,n){var r="arraybuffer"===t.responseType?t.response:t.responseText;!e&&r&&(t.responseTime=Date.now(),t.roundTripTime=t.responseTime-t.requestTime,t.bytesReceived=r.byteLength||r.length,t.bandwidth||(t.bandwidth=Math.floor(t.bytesReceived/t.roundTripTime*8*1e3))),i.headers&&(t.responseHeaders=i.headers),e&&"ETIMEDOUT"===e.code&&(t.timedout=!0),n(e=!e&&!t.aborted&&200!==i.statusCode&&206!==i.statusCode&&0!==i.statusCode?new Error("XHR Failed with a response of: "+(t&&(r||t.responseText))):e,t)}function Xo(){function a(t,i){t=Jl({timeout:45e3},t);var e=a.beforeRequest||br.Vhs.xhr.beforeRequest;!e||"function"!=typeof e||(e=e(t))&&(t=e);var n=(!0===br.Vhs.xhr.original?Ql:br.Vhs.xhr)(t,function(t,e){return Go(n,t,e,i)}),r=n.abort;return n.abort=function(){return n.aborted=!0,r.apply(n,arguments)},n.uri=t.uri,n.requestTime=Date.now(),n}return a.original=!0,a}function $o(t){var e,i={};return t.byterange&&(i.Range=(e=t.byterange,t=e.offset+e.length-1,"bytes="+e.offset+"-"+t)),i}function Yo(t,e){t=t.toString(16);return"00".substring(0,2-t.length)+t+(e%2?" ":"")}function Ko(t){return 32<=t&&t<126?String.fromCharCode(t):"."}function Qo(i){var n={};return Object.keys(i).forEach(function(t){var e=i[t];ArrayBuffer.isView(e)?n[t]={bytes:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}:n[t]=e}),n}function Jo(t){var e=t.byterange||{length:1/0,offset:0};return[e.length,e.offset,t.resolvedUri].join(",")}function Zo(t){return t.resolvedUri}function tl(t){for(var e=Array.prototype.slice.call(t),i="",n=0;n<e.length/16;n++)i+=e.slice(16*n,16*n+16).map(Yo).join("")+" "+e.slice(16*n,16*n+16).map(Ko).join("")+"\n";return i}function el(t,e){if(4===t.readyState)return e()}function il(t,e){if(!Io(t,e))return!1;if(t.sidx&&e.sidx&&(t.sidx.offset!==e.sidx.offset||t.sidx.length!==e.sidx.length))return!1;if(!t.sidx&&e.sidx||t.sidx&&!e.sidx)return!1;if(t.segments&&!e.segments||!t.segments&&e.segments)return!1;if(!t.segments&&!e.segments)return!0;for(var i=0;i<t.segments.length;i++){var n=t.segments[i],r=e.segments[i];if(n.uri!==r.uri)return!1;if(n.byterange||r.byterange){n=n.byterange,r=r.byterange;if(n&&!r||!n&&r)return!1;if(n.offset!==r.offset||n.length!==r.length)return!1}}return!0}function nl(t){var e=t.byterange.offset+t.byterange.length-1;return t.uri+"-"+t.byterange.offset+"-"+e}function rl(t,e){var i,n={};for(i in t){var r=t[i].sidx;if(r){var a=nl(r);if(!e[a])break;var s=e[a].sidxInfo,r=r;(Boolean(!s.map&&!r.map)||Boolean(s.map&&r.map&&s.map.byterange.offset===r.map.byterange.offset&&s.map.byterange.length===r.map.byterange.length))&&s.uri===r.uri&&s.byterange.offset===r.byterange.offset&&s.byterange.length===r.byterange.length&&(n[a]=e[a])}}return n}function al(t){for(var e=new Uint8Array(new ArrayBuffer(t.length)),i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e.buffer}function sl(t){return t.on=t.addEventListener,t.off=t.removeEventListener,t}function ol(n){return function(){var t=function(e){try{return URL.createObjectURL(new Blob([e],{type:"application/javascript"}))}catch(t){var i=new BlobBuilder;return i.append(e),URL.createObjectURL(i.getBlob())}}(n),e=sl(new Worker(t));e.objURL=t;var i=e.terminate;return e.on=e.addEventListener,e.off=e.removeEventListener,e.terminate=function(){return URL.revokeObjectURL(t),i.call(this)},e}}function ll(t){return"var browserWorkerPolyFill = "+sl.toString()+";\nbrowserWorkerPolyFill(self);\n"+t}function ul(t){return t.toString().replace(/^function.+?{/,"").slice(0,-1)}function hl(i){var n=i.transmuxer,t=i.bytes,e=i.audioAppendStart,r=i.gopsToAlignWith,a=i.isPartial,s=i.remux,o=i.onData,l=i.onTrackInfo,u=i.onAudioTimingInfo,h=i.onVideoTimingInfo,c=i.onVideoSegmentTimingInfo,d=i.onAudioSegmentTimingInfo,p=i.onId3,f=i.onCaptions,m=i.onDone,g=i.onEndedTimeline,v=i.isEndOfTimeline,y={isPartial:a,buffer:[]},_=v;n.onmessage=function(t){var e;n.currentTransmux===i&&("data"===t.data.action&&function(t,e,i){var n=t.data.segment,r=n.type,a=n.initSegment,s=n.captions,o=n.captionStreams,l=n.metadata,u=n.videoFrameDtsTime,n=n.videoFramePtsTime;e.buffer.push({captions:s,captionStreams:o,metadata:l});t=t.data.segment.boxes||{data:t.data.segment.data},a={type:r,data:new Uint8Array(t.data,t.data.byteOffset,t.data.byteLength),initSegment:new Uint8Array(a.data,a.byteOffset,a.byteLength)};void 0!==u&&(a.videoFrameDtsTime=u),void 0!==n&&(a.videoFramePtsTime=n),i(a)}(t,y,o),"trackinfo"===t.data.action&&l(t.data.trackInfo),"gopInfo"===t.data.action&&(y.gopInfo=t.data.gopInfo),"audioTimingInfo"===t.data.action&&u(t.data.audioTimingInfo),"videoTimingInfo"===t.data.action&&h(t.data.videoTimingInfo),"videoSegmentTimingInfo"===t.data.action&&c(t.data.videoSegmentTimingInfo),"audioSegmentTimingInfo"===t.data.action&&d(t.data.audioSegmentTimingInfo),"id3Frame"===t.data.action&&p([t.data.id3Frame],t.data.id3Frame.dispatchType),"caption"===t.data.action&&f(t.data.caption),"endedtimeline"===t.data.action&&(_=!1,g()),"transmuxed"===t.data.type&&(_||(n.onmessage=null,t=(e={transmuxedData:y,callback:m}).transmuxedData,e=e.callback,t.buffer=[],e(t),Nl(n))))},e&&n.postMessage({action:"setAudioAppendStart",appendStart:e}),Array.isArray(r)&&n.postMessage({action:"alignGopsWith",gopsToAlignWith:r}),void 0!==s&&n.postMessage({action:"setRemux",remux:s}),t.byteLength&&(r=t instanceof ArrayBuffer?t:t.buffer,s=t instanceof ArrayBuffer?0:t.byteOffset,n.postMessage({action:"push",data:r,byteOffset:s,byteLength:t.byteLength},[r])),n.postMessage({action:a?"partialFlush":"flush"}),v&&n.postMessage({action:"endTimeline"})}function cl(t,e){t.postMessage({action:e}),Nl(t)}function dl(t){t.forEach(function(t){t.abort()})}function pl(t,e){return e.timedout?{status:e.status,message:"HLS request timed-out at URL: "+e.uri,code:ru,xhr:e}:e.aborted?{status:e.status,message:"HLS request aborted at URL: "+e.uri,code:au,xhr:e}:t?{status:e.status,message:"HLS request errored at URL: "+e.uri,code:nu,xhr:e}:null}function fl(t){var i=t.segment,e=t.bytes,n=t.isPartial,r=t.trackInfoFn,a=t.timingInfoFn,s=t.videoSegmentTimingInfoFn,o=t.audioSegmentTimingInfoFn,l=t.id3Fn,u=t.captionsFn,h=t.isEndOfTimeline,c=t.endedTimelineFn,d=t.dataFn,p=t.doneFn,t=i.map&&i.map.tracks||{},f=Boolean(t.audio&&t.video),m=a.bind(null,i,"audio","start"),g=a.bind(null,i,"audio","end"),v=a.bind(null,i,"video","start"),y=a.bind(null,i,"video","end");n||i.lastReachedChar||(a=function(t,e){var i,n,r="number"!=typeof e||isNaN(e)?void 0:9e4*e,t=(e=t,t=r,(r=(no.aac.isLikelyAacData(e)?function(t){for(var e,i=!1,n=0,r=null,a=null,s=0,o=0;3<=t.length-o;){switch(no.aac.parseType(t,o)){case"timed-metadata":if(t.length-o<10){i=!0;break}if((s=no.aac.parseId3TagSize(t,o))>t.length){i=!0;break}null===a&&(e=t.subarray(o,o+s),a=no.aac.parseAacTimestamp(e)),o+=s;break;case"audio":if(t.length-o<7){i=!0;break}if((s=no.aac.parseAdtsSize(t,o))>t.length){i=!0;break}null===r&&(e=t.subarray(o,o+s),r=no.aac.parseSampleRate(e)),n++,o+=s;break;default:o++}if(i)return null}if(null===r||null===a)return null;var l=uo/r;return{audio:[{type:"audio",dts:a,pts:a},{type:"audio",dts:a+1024*n*l,pts:a+1024*n*l}]}}:ro)(e))&&(r.audio||r.video)?(e=t,(t=r).audio&&t.audio.length&&(void 0!==(i=e)&&!isNaN(i)||(i=t.audio[0].dts),t.audio.forEach(function(t){t.dts=io(t.dts,i),t.pts=io(t.pts,i),t.dtsTime=t.dts/uo,t.ptsTime=t.pts/uo})),t.video&&t.video.length&&(void 0!==(n=e)&&!isNaN(n)||(n=t.video[0].dts),t.video.forEach(function(t){t.dts=io(t.dts,n),t.pts=io(t.pts,n),t.dtsTime=t.dts/uo,t.ptsTime=t.pts/uo}),t.firstKeyFrame&&((t=t.firstKeyFrame).dts=io(t.dts,n),t.pts=io(t.pts,n),t.dtsTime=t.dts/uo,t.ptsTime=t.pts/uo)),r):null);if(!t)return null;r={hasVideo:t.video&&2===t.video.length||!1,hasAudio:t.audio&&2===t.audio.length||!1};return r.hasVideo&&(r.videoStart=t.video[0].ptsTime),r.hasAudio&&(r.audioStart=t.audio[0].ptsTime),r}(e,i.baseStartTime))&&(r(i,{hasAudio:a.hasAudio,hasVideo:a.hasVideo,isMuxed:f}),r=null,a.hasAudio&&!f&&m(a.audioStart),a.hasVideo&&v(a.videoStart),v=m=null),function(t){if(!t.transmuxer.currentTransmux)return hl(t.transmuxer.currentTransmux=t);t.transmuxer.transmuxQueue.push(t)}({bytes:e,transmuxer:i.transmuxer,audioAppendStart:i.audioAppendStart,gopsToAlignWith:i.gopsToAlignWith,isPartial:n,remux:f,onData:function(t){t.type="combined"===t.type?"video":t.type,d(i,t)},onTrackInfo:function(t){r&&(f&&(t.isMuxed=!0),r(i,t))},onAudioTimingInfo:function(t){m&&void 0!==t.start&&(m(t.start),m=null),g&&void 0!==t.end&&g(t.end)},onVideoTimingInfo:function(t){v&&void 0!==t.start&&(v(t.start),v=null),y&&void 0!==t.end&&y(t.end)},onVideoSegmentTimingInfo:function(t){s(t)},onAudioSegmentTimingInfo:function(t){o(t)},onId3:function(t,e){l(i,t,e)},onCaptions:function(t){u(i,[t])},isEndOfTimeline:h&&!n,onEndedTimeline:function(){c()},onDone:function(t){p&&!n&&(t.type="combined"===t.type?"video":t.type,p(null,i,t))}})}function ml(t){var n=t.segment,r=t.bytes,e=t.isPartial,i=t.trackInfoFn,a=t.timingInfoFn,s=t.videoSegmentTimingInfoFn,o=t.audioSegmentTimingInfoFn,l=t.id3Fn,u=t.captionsFn,h=t.isEndOfTimeline,c=t.endedTimelineFn,d=t.dataFn,p=t.doneFn,f=new Uint8Array(r);if(Ws(f)){n.isFmp4=!0;var m=n.map.tracks,g={isFmp4:!0,hasVideo:!!m.video,hasAudio:!!m.audio};m.audio&&m.audio.codec&&"enca"!==m.audio.codec&&(g.audioCodec=m.audio.codec),m.video&&m.video.codec&&"encv"!==m.video.codec&&(g.videoCodec=m.video.codec),m.video&&m.audio&&(g.isMuxed=!0),i(n,g);var v=Fl(n.map.timescales,f);g.hasAudio&&!g.isMuxed&&a(n,"audio","start",v),g.hasVideo&&a(n,"video","start",v);var y=function(t){d(n,{data:r,type:g.hasAudio&&!g.isMuxed?"audio":"video"}),t&&t.length&&u(n,t),p(null,n,{})};if(!m.video||!r.byteLength||!n.transmuxer)return y(),0;t=r instanceof ArrayBuffer?r:r.buffer,v=r instanceof ArrayBuffer?0:r.byteOffset;return n.transmuxer.addEventListener("message",function t(e){var i;"mp4Captions"===e.data.action&&(n.transmuxer.removeEventListener("message",t),i=e.data.data,n.bytes=r=new Uint8Array(i,i.byteOffset||0,i.byteLength),y(e.data.captions))}),n.transmuxer.postMessage({action:"pushMp4Captions",timescales:n.map.timescales,trackIds:[m.video.id],data:t,byteOffset:v,byteLength:r.byteLength},[t]),0}if(n.transmuxer){if(void 0===n.container&&(n.container=Vs(f)),"ts"!==n.container&&"aac"!==n.container)return i(n,{hasAudio:!1,hasVideo:!1}),p(null,n,{}),0;fl({segment:n,bytes:r,isPartial:e,trackInfoFn:i,timingInfoFn:a,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:o,id3Fn:l,captionsFn:u,isEndOfTimeline:h,endedTimelineFn:c,dataFn:d,doneFn:p})}else p(null,n,{})}function gl(t){var f=t.activeXhrs,m=t.decryptionWorker,g=t.trackInfoFn,v=t.timingInfoFn,y=t.videoSegmentTimingInfoFn,_=t.audioSegmentTimingInfoFn,b=t.id3Fn,w=t.captionsFn,T=t.isEndOfTimeline,x=t.endedTimelineFn,S=t.dataFn,E=t.doneFn,k=0,C=!1;return function(t,e){if(!C){if(t)return C=!0,dl(f),E(t,e);if((k+=1)===f.length){if(e.endOfAllRequests=Date.now(),e.encryptedBytes)return n=(t={decryptionWorker:m,segment:e,trackInfoFn:g,timingInfoFn:v,videoSegmentTimingInfoFn:y,audioSegmentTimingInfoFn:_,id3Fn:b,captionsFn:w,isEndOfTimeline:T,endedTimelineFn:x,dataFn:S,doneFn:E}).segment,r=t.trackInfoFn,a=t.timingInfoFn,s=t.videoSegmentTimingInfoFn,o=t.audioSegmentTimingInfoFn,l=t.id3Fn,u=t.captionsFn,h=t.isEndOfTimeline,c=t.endedTimelineFn,d=t.dataFn,p=t.doneFn,(i=t.decryptionWorker).addEventListener("message",function t(e){e.data.source===n.requestId&&(i.removeEventListener("message",t),e=e.data.decrypted,n.bytes=new Uint8Array(e.bytes,e.byteOffset,e.byteLength),ml({segment:n,bytes:n.bytes,isPartial:!1,trackInfoFn:r,timingInfoFn:a,videoSegmentTimingInfoFn:s,audioSegmentTimingInfoFn:o,id3Fn:l,captionsFn:u,isEndOfTimeline:h,endedTimelineFn:c,dataFn:d,doneFn:p}))}),t=n.key.bytes.slice?n.key.bytes.slice():new Uint32Array(Array.prototype.slice.call(n.key.bytes)),void i.postMessage(Qo({source:n.requestId,encrypted:n.encryptedBytes,key:t,iv:n.key.iv}),[n.encryptedBytes.buffer,t.buffer]);ml({segment:e,bytes:e.bytes,isPartial:!1,trackInfoFn:g,timingInfoFn:v,videoSegmentTimingInfoFn:y,audioSegmentTimingInfoFn:_,id3Fn:b,captionsFn:w,isEndOfTimeline:T,endedTimelineFn:x,dataFn:S,doneFn:E})}}var i,n,r,a,s,o,l,u,h,c,d,p}}function vl(t){var n=t.segment,r=t.progressFn,a=t.trackInfoFn,s=t.timingInfoFn,o=t.videoSegmentTimingInfoFn,l=t.audioSegmentTimingInfoFn,u=t.id3Fn,h=t.captionsFn,c=t.isEndOfTimeline,d=t.endedTimelineFn,p=t.dataFn,f=t.handlePartialData;return function(t){var e,i=t.target;if(!i.aborted)return f&&!n.key&&i.responseText&&8<=i.responseText.length&&(e=al(i.responseText.substring(n.lastReachedChar||0)),!n.lastReachedChar&&Ws(new Uint8Array(e))||(n.lastReachedChar=i.responseText.length,ml({segment:n,bytes:e,isPartial:!0,trackInfoFn:a,timingInfoFn:s,videoSegmentTimingInfoFn:o,audioSegmentTimingInfoFn:l,id3Fn:u,captionsFn:h,isEndOfTimeline:c,endedTimelineFn:d,dataFn:p}))),n.stats=br.mergeOptions(n.stats,(e=(i=t).target,(e={bandwidth:1/0,bytesReceived:0,roundTripTime:Date.now()-e.requestTime||0}).bytesReceived=i.loaded,e.bandwidth=Math.floor(e.bytesReceived/e.roundTripTime*8*1e3),e)),!n.stats.firstBytesReceivedAt&&n.stats.bytesReceived&&(n.stats.firstBytesReceivedAt=Date.now()),r(t,n)}}function yl(t){var n,r,e,a,s,i=t.xhr,o=t.xhrOptions,l=t.decryptionWorker,u=t.segment,h=t.abortFn,c=t.progressFn,d=t.trackInfoFn,p=t.timingInfoFn,f=t.videoSegmentTimingInfoFn,m=t.audioSegmentTimingInfoFn,g=t.id3Fn,v=t.captionsFn,y=t.isEndOfTimeline,_=t.endedTimelineFn,b=t.dataFn,w=t.doneFn,t=t.handlePartialData,T=[],w=gl({activeXhrs:T,decryptionWorker:l,trackInfoFn:d,timingInfoFn:p,videoSegmentTimingInfoFn:f,audioSegmentTimingInfoFn:m,id3Fn:g,captionsFn:v,isEndOfTimeline:y,endedTimelineFn:_,dataFn:b,doneFn:w});u.key&&!u.key.bytes&&(e=i(br.mergeOptions(o,{uri:u.key.resolvedUri,responseType:"arraybuffer"}),(n=u,r=w,function(t,e){var i=e.response,t=pl(t,e);if(t)return r(t,n);if(16!==i.byteLength)return r({status:e.status,message:"Invalid HLS key at URL: "+e.uri,code:nu,xhr:e},n);i=new DataView(i);return n.key.bytes=new Uint32Array([i.getUint32(0),i.getUint32(4),i.getUint32(8),i.getUint32(12)]),r(null,n)})),T.push(e)),u.map&&!u.map.bytes&&(e=i(br.mergeOptions(o,{uri:u.map.resolvedUri,responseType:"arraybuffer",headers:$o(u.map)}),(a=(e={segment:u,finishProcessingFn:w}).segment,s=e.finishProcessingFn,function(t,e){var i=e.response,t=pl(t,e);if(t)return s(t,a);if(0===i.byteLength)return s({status:e.status,message:"Empty HLS segment content at URL: "+e.uri,code:nu,xhr:e},a);a.map.bytes=new Uint8Array(e.response);i=Vs(a.map.bytes);return"mp4"!==i?s({status:e.status,message:"Found unsupported "+(i||"unknown")+" container for initialization segment at URL: "+e.uri,code:nu,internal:!0,xhr:e},a):(Ul(a.map.bytes).forEach(function(t){a.map.tracks=a.map.tracks||{},a.map.tracks[t.type]||"number"==typeof(a.map.tracks[t.type]=t).id&&t.timescale&&(a.map.timescales=a.map.timescales||{},a.map.timescales[t.id]=t.timescale)}),s(null,a))})),T.push(e));o=br.mergeOptions(o,{uri:u.resolvedUri,responseType:"arraybuffer",headers:$o(u)});t&&(o.responseType="text",o.beforeSend=function(t){t.overrideMimeType("text/plain; charset=x-user-defined")});var x,S,E,o=i(o,(o={segment:u,finishProcessingFn:w,responseType:o.responseType},x=o.segment,S=o.finishProcessingFn,E=o.responseType,function(t,e){var i=e.response,t=pl(t,e);if(t)return S(t,x);t="arraybuffer"!==E&&e.responseText?al(e.responseText.substring(x.lastReachedChar||0)):e.response;return 0===i.byteLength?S({status:e.status,message:"Empty HLS segment content at URL: "+e.uri,code:nu,xhr:e},x):(x.stats={bandwidth:e.bandwidth,bytesReceived:e.bytesReceived||0,roundTripTime:e.roundTripTime||0},x.key?x.encryptedBytes=new Uint8Array(t):x.bytes=new Uint8Array(t),S(null,x))}));o.addEventListener("progress",vl({segment:u,progressFn:c,trackInfoFn:d,timingInfoFn:p,videoSegmentTimingInfoFn:f,audioSegmentTimingInfoFn:m,id3Fn:g,captionsFn:v,isEndOfTimeline:y,endedTimelineFn:_,dataFn:b,handlePartialData:t})),T.push(o);var k={};return T.forEach(function(t){var e,i;t.addEventListener("loadend",(e=(t={loadendState:k,abortFn:h}).loadendState,i=t.abortFn,function(t){t.target.aborted&&i&&!e.calledAbortFn&&(i(),e.calledAbortFn=!0)}))}),function(){return dl(T)}}function _l(t,e){e=e.attributes||{};return t&&t.mediaGroups&&t.mediaGroups.AUDIO&&e.AUDIO&&t.mediaGroups.AUDIO[e.AUDIO]}function bl(t){var n={};return t.forEach(function(t){var e=t.mediaType,i=t.type,t=t.details;n[e]=n[e]||[],n[e].push(mo(""+i+t))}),Object.keys(n).forEach(function(t){return 1<n[t].length?(su("multiple "+t+" codecs found as attributes: "+n[t].join(", ")+". Setting playlist codecs to null so that we wait for mux.js to probe segments for real codecs."),void(n[t]=null)):void(n[t]=n[t][0])}),n}function wl(t){var e=0;return t.audio&&e++,t.video&&e++,e}function Tl(r,n){var t=n.attributes||{},e=bl(function(){var t=n.attributes||{};if(t.CODECS)return go(t.CODECS)}()||[]);return!_l(r,n)||e.audio||function(){if(!_l(r,n))return 1;var t,e=n.attributes||{},i=r.mediaGroups.AUDIO[e.AUDIO];for(t in i)if(!i[t].uri&&!i[t].playlists)return 1}()||(t=bl(function(t){if(!r.mediaGroups.AUDIO||!t)return null;var e,i=r.mediaGroups.AUDIO[t];if(!i)return null;for(e in i){var n=i[e];if(n.default&&n.playlists)return go(n.playlists[0].attributes.CODECS)}return null}(t.AUDIO)||[])).audio&&(e.audio=t.audio),e}function xl(t){if(t&&t.playlist){var e=t.playlist;return JSON.stringify({id:e.id,bandwidth:t.bandwidth,width:t.width,height:t.height,codecs:e.attributes&&e.attributes.CODECS||""})}}function Sl(t,e){if(!t)return"";t=kr.getComputedStyle(t);return t?t[e]:""}function El(t,n){var r=t.slice();t.sort(function(t,e){var i=n(t,e);return 0===i?r.indexOf(t)-r.indexOf(e):i})}function kl(t,e){var i,n;return(i=(i=t.attributes.BANDWIDTH?t.attributes.BANDWIDTH:i)||kr.Number.MAX_VALUE)-((n=e.attributes.BANDWIDTH?e.attributes.BANDWIDTH:n)||kr.Number.MAX_VALUE)}function Cl(t,e,i,n,r){if(t){var a={bandwidth:e,width:i,height:n,limitRenditionByPlayerDimensions:r},s=t.playlists.map(function(t){var e=t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width,i=t.attributes.RESOLUTION&&t.attributes.RESOLUTION.height;return{bandwidth:t.attributes.BANDWIDTH||kr.Number.MAX_VALUE,width:e,height:i,playlist:t}});El(s,function(t,e){return t.bandwidth-e.bandwidth});var o=(s=s.filter(function(t){return!Kl.isIncompatible(t.playlist)})).filter(function(t){return Kl.isEnabled(t.playlist)}),l=(o=!o.length?s.filter(function(t){return!Kl.isDisabled(t.playlist)}):o).filter(function(t){return t.bandwidth*eu.BANDWIDTH_VARIANCE<e}),u=l[l.length-1],t=l.filter(function(t){return t.bandwidth===u.bandwidth})[0];if(!1===r){var h=t||o[0]||s[0];if(h&&h.playlist){r=t?"bandwidthBestRep":"sortedPlaylistReps";return o[0]&&(r="enabledPlaylistReps"),ou("choosing "+xl(h)+" using "+r+" with options",a),h.playlist}return ou("could not choose a playlist with options",a),null}h=l.filter(function(t){return t.width&&t.height});El(h,function(t,e){return t.width-e.width});var c,d,l=h.filter(function(t){return t.width===i&&t.height===n}),u=l[l.length-1],l=l.filter(function(t){return t.bandwidth===u.bandwidth})[0];l||(p=(c=h.filter(function(t){return t.width>i||t.height>n})).filter(function(t){return t.width===c[0].width&&t.height===c[0].height}),u=p[p.length-1],d=p.filter(function(t){return t.bandwidth===u.bandwidth})[0]);var p=d||l||t||o[0]||s[0];if(p&&p.playlist){s="sortedPlaylistReps";return d?s="resolutionPlusOneRep":l?s="resolutionBestRep":t?s="bandwidthBestRep":o[0]&&(s="enabledPlaylistReps"),ou("choosing "+xl(p)+" using "+s+" with options",a),p.playlist}return ou("could not choose a playlist with options",a),null}}function Il(){var t=this.useDevicePixelRatio&&kr.devicePixelRatio||1;return Cl(this.playlists.master,this.systemBandwidth,parseInt(Sl(this.tech_.el(),"width"),10)*t,parseInt(Sl(this.tech_.el(),"height"),10)*t,this.limitRenditionByPlayerDimensions)}function Al(t){var e=t.inbandTextTracks,i=t.metadataArray,r=t.timestampOffset,n=t.videoDuration;if(i){var a=kr.WebKitDataCue||kr.VTTCue,s=e.metadataTrack_;if(s&&(i.forEach(function(t){var n=t.cueTime+r;!("number"!=typeof n||kr.isNaN(n)||n<0)&&n<1/0&&t.frames.forEach(function(t){var e,i=new a(n,n,t.value||t.url||t.data||"");i.frame=t,i.value=t,e=i,Object.defineProperties(e.frame,{id:{get:function(){return br.log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),e.value.key}},value:{get:function(){return br.log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),e.value.data}},privateData:{get:function(){return br.log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),e.value.data}}}),s.addCue(i)})}),s.cues&&s.cues.length)){for(var o=s.cues,l=[],u=0;u<o.length;u++)o[u]&&l.push(o[u]);var h=l.reduce(function(t,e){var i=t[e.startTime]||[];return i.push(e),t[e.startTime]=i,t},{}),c=Object.keys(h).sort(function(t,e){return Number(t)-Number(e)});c.forEach(function(t,e){var t=h[t],i=Number(c[e+1])||n;t.forEach(function(t){t.endTime=i})})}}}function Pl(t,e,i){var n,r;if(i&&i.cues)for(n=i.cues.length;n--;)(r=i.cues[n]).startTime>=t&&r.endTime<=e&&i.removeCue(r)}function Dl(t){return"number"==typeof t&&isFinite(t)}function Ol(t){return t+"TimingInfo"}function Ll(t){var e=t.segmentTimeline,i=t.currentTimeline,n=t.startOfSegment,r=t.buffered;return t.overrideCheck||e!==i?!(e<i)&&r.length?r.end(r.length-1):n:null}function Ml(t){var e=t.timelineChangeController,i=t.currentTimeline,n=t.segmentTimeline,r=t.loaderType,t=t.audioDisabled;if(i!==n){if("audio"===r){i=e.lastTimelineChange({type:"main"});return!i||i.to!==n}if("main"===r&&t){e=e.pendingTimelineChange({type:"audio"});return!e||e.to!==n}}}function Rl(t){var e=t.segmentDuration,t=t.maxDuration;return!!e&&Math.round(e)>t+$l}function Nl(t){t.currentTransmux=null,t.transmuxQueue.length&&(t.currentTransmux=t.transmuxQueue.shift(),"function"==typeof t.currentTransmux?t.currentTransmux():hl(t.currentTransmux))}function Bl(t){!function(t,e){if(!e.currentTransmux)return e.currentTransmux=t,cl(e,t);e.transmuxQueue.push(cl.bind(null,e,t))}("reset",t)}var Fl=function(n,t){var t=so(t,["moof","traf"]),t=[].concat.apply([],t.map(function(i){return so(i,["tfhd"]).map(function(t){var e=fo(t[4]<<24|t[5]<<16|t[6]<<8|t[7]),t=n[e]||9e4;return(e="number"!=typeof(e=so(i,["tfdt"]).map(function(t){var e=t[0],i=fo(t[4]<<24|t[5]<<16|t[6]<<8|t[7]);return 1===e&&(i*=Math.pow(2,32),i+=fo(t[8]<<24|t[9]<<16|t[10]<<8|t[11])),i})[0])||isNaN(e)?1/0:e)/t})})),t=Math.min.apply(null,t);return isFinite(t)?t:0},Ul=function(t){var t=so(t,["moov","trak"]),s=[];return t.forEach(function(t){var e={},i=so(t,["tkhd"])[0];i&&(i=(n=new DataView(i.buffer,i.byteOffset,i.byteLength)).getUint8(0),e.id=0===i?n.getUint32(12):n.getUint32(20));var n=so(t,["mdia","hdlr"])[0];n&&(a=co(n.subarray(8,12)),e.type="vide"===a?"video":"soun"===a?"audio":a);var r,a=so(t,["mdia","minf","stbl","stsd"])[0];a&&(a=a.subarray(8),e.codec=co(a.subarray(4,8)),(a=so(a,[e.codec])[0])&&(/^[a-z]vc[1-9]$/i.test(e.codec)?(r=a.subarray(78),"avcC"===co(r.subarray(4,8))&&11<r.length?(e.codec+=".",e.codec+=oo(r[9]),e.codec+=oo(r[10]),e.codec+=oo(r[11])):e.codec="avc1.4d400d"):/^mp4[a,v]$/i.test(e.codec)?(r=a.subarray(28),"esds"===co(r.subarray(4,8))&&20<r.length&&0!==r[19]?(e.codec+="."+oo(r[19]),e.codec+="."+oo(r[20]>>>2&63).replace(/^0/,"")):e.codec="mp4a.40.2"):e.codec=e.codec.toLowerCase()));t=so(t,["mdia","mdhd"])[0];t&&(e.timescale=lo(t)),s.push(e)}),s},jl=(lo=function(t){var e=0===t[0]?12:20;return fo(t[e]<<24|t[1+e]<<16|t[2+e]<<8|t[3+e])},{mp4:/^(av0?1|avc0?[1234]|vp0?9|flac|opus|mp3|mp4a|mp4v|stpp.ttml.im1t)/,webm:/^(vp0?[89]|av0?1|opus|vorbis)/,ogg:/^(vp0?[89]|theora|flac|opus|vorbis)/,video:/^(av0?1|avc0?[1234]|vp0?[89]|hvc1|hev1|theora|mp4v)/,audio:/^(mp4a|flac|vorbis|opus|ac-[34]|ec-3|alac|mp3|speex|aac)/,text:/^(stpp.ttml.im1t)/,muxerVideo:/^(avc0?1)/,muxerAudio:/^(mp4a)/,muxerText:/a^/}),ql=["video","audio","text"],zl=["Video","Audio","Text"],Hl="mp4a.40.2",Vl=xr,Wl=br.log,Gl=br.mergeOptions,Xl=function(a){function t(t,e,i){var n;if(void 0===i&&(i={}),n=a.call(this)||this,!t)throw new Error("A non-empty playlist URL or object is required");n.logger_=To("PlaylistLoader");var r=i,i=r.withCredentials,i=void 0!==i&&i,r=r.handleManifestRedirects,r=void 0!==r&&r;n.src=t,n.vhs_=e,n.withCredentials=i,n.handleManifestRedirects=r;e=e.options_;return n.customTagParsers=e&&e.customTagParsers||[],n.customTagMappers=e&&e.customTagMappers||[],n.state="HAVE_NOTHING",n.on("mediaupdatetimeout",function(){"HAVE_METADATA"===n.state&&(n.state="HAVE_CURRENT_METADATA",n.request=n.vhs_.xhr({uri:Vl(n.master.uri,n.media().uri),withCredentials:n.withCredentials},function(t,e){if(n.request)return t?n.playlistRequestError(n.request,n.media(),"HAVE_METADATA"):void n.haveMetadata({playlistString:n.request.responseText,url:n.media().uri,id:n.media().id})}))}),n}Sr(t,a);var e=t.prototype;return e.playlistRequestError=function(t,e,i){var n=e.uri,e=e.id;this.request=null,i&&(this.state=i),this.error={playlist:this.master.playlists[e],status:t.status,message:"HLS playlist request error at URL: "+n+".",responseText:t.responseText,code:500<=t.status?4:2},this.trigger("error")},e.haveMetadata=function(t){var e=this,i=t.playlistString,n=t.playlistObject,r=t.url,a=t.id;this.request=null,this.state="HAVE_METADATA";i=n||xo({onwarn:function(t){t=t.message;return e.logger_("m3u8-parser warn for "+a+": "+t)},oninfo:function(t){t=t.message;return e.logger_("m3u8-parser info for "+a+": "+t)},manifestString:i,customTagParsers:this.customTagParsers,customTagMappers:this.customTagMappers});i.lastRequest=Date.now(),Eo({playlist:i,uri:r,id:a});r=Ao(this.master,i);this.targetDuration=i.targetDuration,r?(this.master=r,this.media_=this.master.playlists[a]):this.trigger("playlistunchanged"),this.media().endList||(kr.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=kr.setTimeout(function(){e.trigger("mediaupdatetimeout")},Po(this.media(),!!r))),this.trigger("loadedplaylist")},e.dispose=function(){this.trigger("dispose"),this.stopRequest(),kr.clearTimeout(this.mediaUpdateTimeout),kr.clearTimeout(this.finalRenditionTimeout),this.off()},e.stopRequest=function(){var t;this.request&&(t=this.request,this.request=null,t.onreadystatechange=null,t.abort())},e.media=function(i,t){var n=this;if(!i)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);if("string"==typeof i){if(!this.master.playlists[i])throw new Error("Unknown playlist URI: "+i);i=this.master.playlists[i]}if(kr.clearTimeout(this.finalRenditionTimeout),t){var e=i.targetDuration/2*1e3||5e3;this.finalRenditionTimeout=kr.setTimeout(this.media.bind(this,i,!1),e)}else{var r=this.state,e=!this.media_||i.id!==this.media_.id;if(this.master.playlists[i.id].endList||i.endList&&i.segments.length)return this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null),this.state="HAVE_METADATA",this.media_=i,void(e&&(this.trigger("mediachanging"),"HAVE_MASTER"===r?this.trigger("loadedmetadata"):this.trigger("mediachange")));if(e){if(this.state="SWITCHING_MEDIA",this.request){if(i.resolvedUri===this.request.url)return;this.request.onreadystatechange=null,this.request.abort(),this.request=null}this.media_&&this.trigger("mediachanging"),this.request=this.vhs_.xhr({uri:i.resolvedUri,withCredentials:this.withCredentials},function(t,e){if(n.request){if(i.lastRequest=Date.now(),i.resolvedUri=wo(n.handleManifestRedirects,i.resolvedUri,e),t)return n.playlistRequestError(n.request,i,r);n.haveMetadata({playlistString:e.responseText,url:i.uri,id:i.id}),"HAVE_MASTER"===r?n.trigger("loadedmetadata"):n.trigger("mediachange")}})}}},e.pause=function(){this.stopRequest(),kr.clearTimeout(this.mediaUpdateTimeout),"HAVE_NOTHING"===this.state&&(this.started=!1),"SWITCHING_MEDIA"===this.state?this.media_?this.state="HAVE_METADATA":this.state="HAVE_MASTER":"HAVE_CURRENT_METADATA"===this.state&&(this.state="HAVE_METADATA")},e.load=function(t){var e=this;kr.clearTimeout(this.mediaUpdateTimeout);var i=this.media();t?(t=i?i.targetDuration/2*1e3:5e3,this.mediaUpdateTimeout=kr.setTimeout(function(){return e.load()},t)):this.started?i&&!i.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist"):this.start()},e.start=function(){var i=this;if(this.started=!0,"object"==typeof this.src)return this.src.uri||(this.src.uri=kr.location.href),this.src.resolvedUri=this.src.uri,void setTimeout(function(){i.setupInitialPlaylist(i.src)},0);this.request=this.vhs_.xhr({uri:this.src,withCredentials:this.withCredentials},function(t,e){if(i.request){if(i.request=null,t)return i.error={status:e.status,message:"HLS playlist request error at URL: "+i.src+".",responseText:e.responseText,code:2},"HAVE_NOTHING"===i.state&&(i.started=!1),i.trigger("error");i.src=wo(i.handleManifestRedirects,i.src,e);e=xo({manifestString:e.responseText,customTagParsers:i.customTagParsers,customTagMappers:i.customTagMappers});i.setupInitialPlaylist(e)}})},e.srcUri=function(){return"string"==typeof this.src?this.src:this.src.uri},e.setupInitialPlaylist=function(t){if(this.state="HAVE_MASTER",t.playlists)return this.master=t,ko(this.master,this.srcUri()),t.playlists.forEach(function(e){e.segments&&e.segments.forEach(function(t){Co(t,e.resolvedUri)})}),this.trigger("loadedplaylist"),void(this.request||this.media(this.master.playlists[0]));var e,i,n,r=this.srcUri()||kr.location.href;this.master=(i="0-"+(e=r),(n={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:kr.location.href,resolvedUri:kr.location.href,playlists:[{uri:e,id:i,resolvedUri:e,attributes:{}}]}).playlists[i]=n.playlists[0],n.playlists[e]=n.playlists[0],n),this.haveMetadata({playlistObject:t,url:r,id:this.master.playlists[0].id}),this.trigger("loadedmetadata")},t}(br.EventTarget),$l=1/30,Yl=br.createTimeRange,Kl={duration:Bo,seekable:function(t,e,i){var n=e||0,i=jo(t,e,!0,i);return null===i?Yl():Yl(n,i)},safeLiveIndex:Uo,getMediaInfoForTime:function(t,e,i,n){var r,a=t.segments.length,s=e-n;if(s<0){if(0<i)for(r=i-1;0<=r;r--)if(0<(s+=t.segments[r].duration+$l))return{mediaIndex:r,startTime:n-Fo(t,i,r)};return{mediaIndex:0,startTime:e}}if(i<0){for(r=i;r<0;r++)if((s-=t.targetDuration)<0)return{mediaIndex:0,startTime:e};i=0}for(r=i;r<a;r++)if((s-=t.segments[r].duration+$l)<0)return{mediaIndex:r,startTime:n+Fo(t,i,r)};return{mediaIndex:a-1,startTime:e}},isEnabled:Ho,isDisabled:function(t){return t.disabled},isBlacklisted:qo,isIncompatible:zo,playlistEnd:jo,isAes:function(t){for(var e=0;e<t.segments.length;e++)if(t.segments[e].key)return!0;return!1},hasAttribute:Vo,estimateSegmentRequestTime:function(t,e,i,n){return void 0===n&&(n=0),Vo("BANDWIDTH",i)?(t*i.attributes.BANDWIDTH-8*n)/e:NaN},isLowestEnabledRendition:Wo},Ql=br.xhr,Jl=br.mergeOptions,r=Object.freeze({__proto__:null,createTransferableMessage:Qo,initSegmentId:Jo,segmentKeyId:Zo,hexDump:tl,tagDump:function(t){return tl(t.bytes)},textRanges:function(t){for(var e,i,n="",r=0;r<t.length;r++)n+=(i=r,(e=t).start(i)+"-"+e.end(i)+" ");return n}}),Zl=br.mergeOptions,tu=function(a){function t(t,e,i,n){var r;void 0===i&&(i={}),(r=a.call(this)||this).masterPlaylistLoader_=n||wr(r),n||(r.isMaster_=!0);n=i,i=n.withCredentials,i=void 0!==i&&i,n=n.handleManifestRedirects,n=void 0!==n&&n;if(r.vhs_=e,r.withCredentials=i,r.handleManifestRedirects=n,!t)throw new Error("A non-empty playlist URL or object is required");return r.on("minimumUpdatePeriod",function(){r.refreshXml_()}),r.on("mediaupdatetimeout",function(){r.refreshMedia_(r.media().id)}),r.state="HAVE_NOTHING",r.loadedPlaylists_={},r.logger_=To("DashPlaylistLoader"),r.isMaster_?(r.masterPlaylistLoader_.srcUrl=t,r.masterPlaylistLoader_.sidxMapping_={}):r.childPlaylist_=t,r}Sr(t,a);var e=t.prototype;return e.requestErrored_=function(t,e,i){return!this.request||(this.request=null,t?(this.error="object"!=typeof t||t instanceof Error?{status:e.status,message:"DASH request error at URL: "+e.uri,response:e.response,code:2}:t,i&&(this.state=i),this.trigger("error"),!0):void 0)},e.addSidxSegments_=function(a,i,n){var s,r,o,t,l,u,h,c,d,p=this,f=a.sidx&&nl(a.sidx);function m(t,e,i,n){return e.abort(),c=!0,l(t,e,i,n)}function g(t,e){if(!c){if(t)return m(t,e,"",h);var i=e.responseText.substring(h&&h.byteLength||0,e.responseText.length);if(h=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];if((e=e.filter(function(t){return t&&(t.byteLength||t.length)&&"string"!=typeof t})).length<=1)return hs(e[0]);var n=e.reduce(function(t,e,i){return t+(e.byteLength||e.length)},0),r=new Uint8Array(n),a=0;return e.forEach(function(t){t=hs(t),r.set(t,a),a+=t.byteLength}),r}(h,cs(i,!0)),u=u||ps(h),h.length<10||u&&h.length<u+2)return el(e,function(){return m(t,e,"",h)});i=Vs(h);return"ts"===i&&h.length<188||!i&&h.length<376?el(e,function(){return m(t,e,"",h)}):m(null,e,i,h)}}a.sidx&&f&&!this.masterPlaylistLoader_.sidxMapping_[f]?(s=wo(this.handleManifestRedirects,a.sidx.resolvedUri),(r=this.masterPlaylistLoader_.sidxMapping_)[f]={sidxInfo:a.sidx},o=function(t,e){if(!p.requestErrored_(t,e,i)){e=function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),references:[],referenceId:e.getUint32(4),timescale:e.getUint32(8)},n=12;0===i.version?(i.earliestPresentationTime=e.getUint32(n),i.firstOffset=e.getUint32(n+4),n+=8):(i.earliestPresentationTime=e.getUint32(n)*Os+e.getUint32(n+4),i.firstOffset=e.getUint32(n+8)*Os+e.getUint32(n+12),n+=16);var r=e.getUint16(n+=2);for(n+=2;0<r;n+=12,r--)i.references.push({referenceType:(128&t[n])>>>7,referencedSize:2147483647&e.getUint32(n),subsegmentDuration:e.getUint32(n+4),startsWithSap:!!(128&t[n+8]),sapType:(112&t[n+8])>>>4,sapDeltaTime:268435455&e.getUint32(n+8)});return i}(hs(e.response).subarray(8));return r[f].sidx=e,Ds(a,e,a.sidx.resolvedUri),n(!0)}},this.request=(t=this.vhs_.xhr,l=function(t,e,i,n){if(t)return o(t,e);if(!i||"mp4"!==i)return o({status:e.status,message:"Unsupported "+(i||"unknown")+" container type for sidx segment at URL: "+s,response:"",playlist:a,internal:!0,blacklistDuration:1/0,code:2},e);var r=a.sidx.byterange,i=r.offset,r=r.length;if(n.length>=r+i)return o(t,{response:n.subarray(i,i+r),status:e.status,uri:e.uri});p.request=p.vhs_.xhr({uri:s,responseType:"arraybuffer",headers:$o({byterange:a.sidx.byterange})},o)},c=!(h=[]),d=t({uri:s,beforeSend:function(e){e.overrideMimeType("text/plain; charset=x-user-defined"),e.addEventListener("progress",function(t){return t.total,t.loaded,Go(e,null,{statusCode:e.status},g)})}},function(t,e){return Go(d,t,e,g)}))):this.mediaRequest_=kr.setTimeout(function(){return n(!1)},0)},e.dispose=function(){this.trigger("dispose"),this.stopRequest(),this.loadedPlaylists_={},kr.clearTimeout(this.minimumUpdatePeriodTimeout_),kr.clearTimeout(this.mediaRequest_),kr.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null,this.mediaRequest_=null,this.minimumUpdatePeriodTimeout_=null,this.masterPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.masterPlaylistLoader_.createMupOnMedia_),this.masterPlaylistLoader_.createMupOnMedia_=null),this.off()},e.hasPendingRequest=function(){return this.request||this.mediaRequest_},e.stopRequest=function(){var t;this.request&&(t=this.request,this.request=null,t.onreadystatechange=null,t.abort())},e.media=function(e){var i=this;if(!e)return this.media_;if("HAVE_NOTHING"===this.state)throw new Error("Cannot switch media playlist from "+this.state);var n=this.state;if("string"==typeof e){if(!this.masterPlaylistLoader_.master.playlists[e])throw new Error("Unknown playlist URI: "+e);e=this.masterPlaylistLoader_.master.playlists[e]}var t=!this.media_||e.id!==this.media_.id;if(t&&this.loadedPlaylists_[e.id]&&this.loadedPlaylists_[e.id].endList)return this.state="HAVE_METADATA",this.media_=e,void(t&&(this.trigger("mediachanging"),this.trigger("mediachange")));t&&(this.media_&&this.trigger("mediachanging"),this.addSidxSegments_(e,n,function(t){i.haveMetadata({startingState:n,playlist:e})}))},e.haveMetadata=function(t){var e=t.startingState,t=t.playlist;this.state="HAVE_METADATA",this.loadedPlaylists_[t.id]=t,this.mediaRequest_=null,this.refreshMedia_(t.id),"HAVE_MASTER"===e?this.trigger("loadedmetadata"):this.trigger("mediachange")},e.pause=function(){this.masterPlaylistLoader_.createMupOnMedia_&&(this.off("loadedmetadata",this.masterPlaylistLoader_.createMupOnMedia_),this.masterPlaylistLoader_.createMupOnMedia_=null),this.stopRequest(),kr.clearTimeout(this.mediaUpdateTimeout),kr.clearTimeout(this.masterPlaylistLoader_.minimumUpdatePeriodTimeout_),this.masterPlaylistLoader_.minimumUpdatePeriodTimeout_=null,this.mediaUpdateTimeout=null,"HAVE_NOTHING"===this.state&&(this.started=!1)},e.load=function(t){var e=this;kr.clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=null;var i=this.media();t?(t=i?i.targetDuration/2*1e3:5e3,this.mediaUpdateTimeout=kr.setTimeout(function(){return e.load()},t)):this.started?i&&!i.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist"):this.start()},e.start=function(){var i=this;this.started=!0,this.isMaster_?this.requestMaster_(function(t,e){i.haveMaster_(),i.hasPendingRequest()||i.media_||i.media(i.masterPlaylistLoader_.master.playlists[0])}):this.mediaRequest_=kr.setTimeout(function(){return i.haveMaster_()},0)},e.requestMaster_=function(n){var r=this;this.request=this.vhs_.xhr({uri:this.masterPlaylistLoader_.srcUrl,withCredentials:this.withCredentials},function(t,e){if(!r.requestErrored_(t,e)){var i=e.responseText!==r.masterPlaylistLoader_.masterXml_;return r.masterPlaylistLoader_.masterXml_=e.responseText,e.responseHeaders&&e.responseHeaders.date?r.masterLoaded_=Date.parse(e.responseHeaders.date):r.masterLoaded_=Date.now(),r.masterPlaylistLoader_.srcUrl=wo(r.handleManifestRedirects,r.masterPlaylistLoader_.srcUrl,e),i?(r.handleMaster_(),void r.syncClientServerClock_(function(){return n(e,i)})):n(e,i)}"HAVE_NOTHING"===r.state&&(r.started=!1)})},e.syncClientServerClock_=function(i){var n,r=this,a=(n=this.masterPlaylistLoader_.masterXml_,function(){var t=es(ls(n),"UTCTiming")[0];if(!t)return null;var e=rs(t);switch(e.schemeIdUri){case"urn:mpeg:dash:utc:http-head:2014":case"urn:mpeg:dash:utc:http-head:2012":e.method="HEAD";break;case"urn:mpeg:dash:utc:http-xsdate:2014":case"urn:mpeg:dash:utc:http-iso:2014":case"urn:mpeg:dash:utc:http-xsdate:2012":case"urn:mpeg:dash:utc:http-iso:2012":e.method="GET";break;case"urn:mpeg:dash:utc:direct:2014":case"urn:mpeg:dash:utc:direct:2012":e.method="DIRECT",e.value=Date.parse(e.value);break;default:throw new Error("UNSUPPORTED_UTC_TIMING_SCHEME")}return e}());return null===a?(this.masterPlaylistLoader_.clientOffset_=this.masterLoaded_-Date.now(),i()):"DIRECT"===a.method?(this.masterPlaylistLoader_.clientOffset_=a.value-Date.now(),i()):void(this.request=this.vhs_.xhr({uri:Vl(this.masterPlaylistLoader_.srcUrl,a.value),method:a.method,withCredentials:this.withCredentials},function(t,e){if(r.request){if(t)return r.masterPlaylistLoader_.clientOffset_=r.masterLoaded_-Date.now(),i();e="HEAD"===a.method?e.responseHeaders&&e.responseHeaders.date?Date.parse(e.responseHeaders.date):r.masterLoaded_:Date.parse(e.responseText);r.masterPlaylistLoader_.clientOffset_=e-Date.now(),i()}}))},e.haveMaster_=function(){this.state="HAVE_MASTER",this.isMaster_?this.trigger("loadedplaylist"):this.media_||this.media(this.childPlaylist_)},e.handleMaster_=function(){this.mediaRequest_=null;var t=(ko(i=us((i={masterXml:this.masterPlaylistLoader_.masterXml_,srcUrl:this.masterPlaylistLoader_.srcUrl,clientOffset:this.masterPlaylistLoader_.clientOffset_,sidxMapping:this.masterPlaylistLoader_.sidxMapping_}).masterXml,{manifestUri:e=i.srcUrl,clientOffset:i.clientOffset,sidxMapping:i.sidxMapping}),e),i),e=this.masterPlaylistLoader_.master;e&&(t=function(t,e,i){for(var a=!0,s=Zl(t,{duration:e.duration,minimumUpdatePeriod:e.minimumUpdatePeriod}),n=0;n<e.playlists.length;n++){var r,o=e.playlists[n];o.sidx&&(r=nl(o.sidx),i&&i[r]&&Ds(o,i[r].sidx,o.sidx.resolvedUri));o=Ao(s,o,il);o&&(s=o,a=!1)}return So(e,function(t,e,i,n){var r;t.playlists&&t.playlists.length&&(r=t.playlists[0].id,(t=Ao(s,t.playlists[0],il))&&((s=t).mediaGroups[e][i][n].playlists[0]=s.playlists[r],a=!1))}),(a=e.minimumUpdatePeriod!==t.minimumUpdatePeriod?!1:a)?null:s}(e,t,this.masterPlaylistLoader_.sidxMapping_)),this.masterPlaylistLoader_.master=t||e;var i=this.masterPlaylistLoader_.master.locations&&this.masterPlaylistLoader_.master.locations[0];return i&&i!==this.masterPlaylistLoader_.srcUrl&&(this.masterPlaylistLoader_.srcUrl=i),(!e||t&&t.minimumUpdatePeriod!==e.minimumUpdatePeriod)&&this.updateMinimumUpdatePeriodTimeout_(),Boolean(t)},e.updateMinimumUpdatePeriodTimeout_=function(){var t=this.masterPlaylistLoader_;t.createMupOnMedia_&&(t.off("loadedmetadata",t.createMupOnMedia_),t.createMupOnMedia_=null),t.minimumUpdatePeriodTimeout_&&(kr.clearTimeout(t.minimumUpdatePeriodTimeout_),t.minimumUpdatePeriodTimeout_=null);var e=t.master&&t.master.minimumUpdatePeriod;0===e&&(t.media()?e=1e3*t.media().targetDuration:(t.createMupOnMedia_=t.updateMinimumUpdatePeriodTimeout_,t.one("loadedmetadata",t.createMupOnMedia_))),"number"!=typeof e||e<=0?e<0&&this.logger_("found invalid minimumUpdatePeriod of "+e+", not setting a timeout"):this.createMUPTimeout_(e)},e.createMUPTimeout_=function(t){var e=this.masterPlaylistLoader_;e.minimumUpdatePeriodTimeout_=kr.setTimeout(function(){e.minimumUpdatePeriodTimeout_=null,e.trigger("minimumUpdatePeriod"),e.createMUPTimeout_(t)},t)},e.refreshXml_=function(){var i=this;this.requestMaster_(function(t,e){var r,a;e&&(i.media_&&(i.media_=i.masterPlaylistLoader_.master.playlists[i.media_.id]),i.masterPlaylistLoader_.sidxMapping_=(e=i.masterPlaylistLoader_.master,r=i.masterPlaylistLoader_.sidxMapping_,a=rl(e.playlists,r),So(e,function(t,e,i,n){t.playlists&&t.playlists.length&&(t=t.playlists,a=Zl(a,rl(t,r)))}),a),i.addSidxSegments_(i.media(),i.state,function(t){i.refreshMedia_(i.media().id)}))})},e.refreshMedia_=function(t){var e=this;if(!t)throw new Error("refreshMedia_ must take a media id");this.media_&&this.isMaster_&&this.handleMaster_();var i=this.masterPlaylistLoader_.master.playlists,n=!this.media_||this.media_!==i[t];n?this.media_=i[t]:this.trigger("playlistunchanged"),this.mediaUpdateTimeout||function t(){e.media().endList||(e.mediaUpdateTimeout=kr.setTimeout(function(){e.trigger("mediaupdatetimeout"),t()},Po(e.media(),Boolean(n))))}(),this.trigger("loadedplaylist")},t}(br.EventTarget),eu={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,BACK_BUFFER_LENGTH:30,GOAL_BUFFER_LENGTH_RATE:1,INITIAL_BANDWIDTH:4194304,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:16,BUFFER_LOW_WATER_LINE_RATE:1,BUFFER_HIGH_WATER_LINE:30},iu=ol(ll(ul(function(){function t(){this.init=function(){var a={};this.on=function(t,e){a[t]||(a[t]=[]),a[t]=a[t].concat(e)},this.off=function(t,e){return!!a[t]&&(e=a[t].indexOf(e),a[t]=a[t].slice(),a[t].splice(e,1),-1<e)},this.trigger=function(t){var e,i,n,r;if(e=a[t])if(2===arguments.length)for(n=e.length,i=0;i<n;++i)e[i].call(this,arguments[1]);else{for(r=[],i=arguments.length,i=1;i<arguments.length;++i)r.push(arguments[i]);for(n=e.length,i=0;i<n;++i)e[i].apply(this,r)}},this.dispose=function(){a={}}}}t.prototype.pipe=function(e){return this.on("data",function(t){e.push(t)}),this.on("done",function(t){e.flush(t)}),this.on("partialdone",function(t){e.partialFlush(t)}),this.on("endedtimeline",function(t){e.endTimeline(t)}),this.on("reset",function(t){e.reset(t)}),e},t.prototype.push=function(t){this.trigger("data",t)},t.prototype.flush=function(t){this.trigger("done",t)},t.prototype.partialFlush=function(t){this.trigger("partialdone",t)},t.prototype.endTimeline=function(t){this.trigger("endedtimeline",t)},t.prototype.reset=function(t){this.trigger("reset",t)};var l,e,i,n,r,a,s,o,u,h,c,d,p,f,m=t,g=Math.pow(2,32)-1;function v(t,e){var i={size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0,isNonSyncSample:1}};return i.dataOffset=e,i.compositionTimeOffset=t.pts-t.dts,i.duration=t.duration,i.size=4*t.length,i.size+=t.byteLength,t.keyFrame&&(i.flags.dependsOn=2,i.flags.isNonSyncSample=0),i}function y(t){for(var e=[];t--;)e.push(0);return e}function _(t){t=t||{},_.prototype.init.call(this),this.parse708captions_="boolean"!=typeof t.parse708captions||t.parse708captions,this.captionPackets_=[],this.ccStreams_=[new St(0,0),new St(0,1),new St(1,0),new St(1,1)],this.parse708captions_&&(this.cc708Stream_=new _t),this.reset(),this.ccStreams_.forEach(function(t){t.on("data",this.trigger.bind(this,"data")),t.on("partialdone",this.trigger.bind(this,"partialdone")),t.on("done",this.trigger.bind(this,"done"))},this),this.parse708captions_&&(this.cc708Stream_.on("data",this.trigger.bind(this,"data")),this.cc708Stream_.on("partialdone",this.trigger.bind(this,"partialdone")),this.cc708Stream_.on("done",this.trigger.bind(this,"done")))}!function(){if(l={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],pasp:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},"undefined"!=typeof Uint8Array){for(var t in l)l.hasOwnProperty(t)&&(l[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);e=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]),n=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]),i=new Uint8Array([0,0,0,1]),r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),a=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),s={video:r,audio:a},h=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),u=new Uint8Array([0,0,0,0,0,0,0,0]),c=new Uint8Array([0,0,0,0,0,0,0,0]),d=c,p=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),f=c,o=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}}();function b(t){return N(l.mdat,t)}function w(t){var e=st(),i=V(t);return(t=new Uint8Array(e.byteLength+i.byteLength)).set(e),t.set(i,e.byteLength),t}function T(t){var e,i,n=[],r=[];for(r.byteLength=0,r.nalCount=0,r.duration=0,e=n.byteLength=0;e<t.length;e++)"access_unit_delimiter_rbsp"===(i=t[e]).nalUnitType?(n.length&&(n.duration=i.dts-n.dts,r.byteLength+=n.byteLength,r.nalCount+=n.length,r.duration+=n.duration,r.push(n)),(n=[i]).byteLength=i.data.byteLength,n.pts=i.pts,n.dts=i.dts):("slice_layer_without_partitioning_rbsp_idr"===i.nalUnitType&&(n.keyFrame=!0),n.duration=i.dts-n.dts,n.byteLength+=i.data.byteLength,n.push(i));return r.length&&(!n.duration||n.duration<=0)&&(n.duration=r[r.length-1].duration),r.byteLength+=n.byteLength,r.nalCount+=n.length,r.duration+=n.duration,r.push(n),r}function x(t){var e,i,n=[],r=[];for(n.byteLength=0,n.nalCount=0,n.duration=0,n.pts=t[0].pts,n.dts=t[0].dts,r.byteLength=0,r.nalCount=0,r.duration=0,r.pts=t[0].pts,r.dts=t[0].dts,e=0;e<t.length;e++)(i=t[e]).keyFrame?(n.length&&(r.push(n),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration),(n=[i]).nalCount=i.length,n.byteLength=i.byteLength,n.pts=i.pts,n.dts=i.dts,n.duration=i.duration):(n.duration+=i.duration,n.nalCount+=i.length,n.byteLength+=i.byteLength,n.push(i));return r.length&&n.duration<=0&&(n.duration=r[r.length-1].duration),r.byteLength+=n.byteLength,r.nalCount+=n.nalCount,r.duration+=n.duration,r.push(n),r}function S(t){var e;return!t[0][0].keyFrame&&1<t.length&&(e=t.shift(),t.byteLength-=e.byteLength,t.nalCount-=e.nalCount,t[0][0].dts=e.dts,t[0][0].pts=e.pts,t[0][0].duration+=e.duration),t}function E(t){return 9e4*t}function k(t,e,i){return R(i?t:t-e)}function C(t,e,i,n){var r,a,s,o,l,u,h,c=0,d=0;if(e.length&&(r=dt(t.baseMediaDecodeTime,t.samplerate),a=Math.ceil(ht/(t.samplerate/1024)),i&&n&&(u=r-Math.max(i,n),d=(c=Math.floor(u/a))*a),!(c<1||ht/2<d))){for(M||(u={96e3:[lt,[227,64],y(154),[56]],88200:[lt,[231],y(170),[56]],64e3:[lt,[248,192],y(240),[56]],48e3:[lt,[255,192],y(268),[55,148,128],y(54),[112]],44100:[lt,[255,192],y(268),[55,163,128],y(84),[112]],32e3:[lt,[255,192],y(268),[55,234],y(226),[112]],24e3:[lt,[255,192],y(268),[55,255,128],y(268),[111,112],y(126),[224]],16e3:[lt,[255,192],y(268),[55,255,128],y(268),[111,255],y(269),[223,108],y(195),[1,192]],12e3:[ut,y(268),[3,127,248],y(268),[6,255,240],y(268),[13,255,224],y(268),[27,253,128],y(259),[56]],11025:[ut,y(268),[3,127,248],y(268),[6,255,240],y(268),[13,255,224],y(268),[27,255,192],y(268),[55,175,128],y(108),[112]],8e3:[ut,y(268),[3,121,16],y(47),[7]]},h=u,M=Object.keys(h).reduce(function(t,e){return t[e]=new Uint8Array(h[e].reduce(function(t,e){return t.concat(e)},[])),t},{})),s=(s=M[t.samplerate])||e[0].data,o=0;o<c;o++)l=e[0],e.splice(0,0,{data:s,dts:l.dts-a,pts:l.pts-a});return t.baseMediaDecodeTime-=Math.floor(pt(d,t.samplerate)),d}}function I(t,e,i){return e.minSegmentDts>=i?t:(e.minSegmentDts=1/0,t.filter(function(t){return t.dts>=i&&(e.minSegmentDts=Math.min(e.minSegmentDts,t.dts),e.minSegmentPts=e.minSegmentDts,!0)}))}function A(t){for(var e,i=[],n=0;n<t.length;n++)e=t[n],i.push({size:e.data.byteLength,duration:1024});return i}function P(t){for(var e,i=0,n=new Uint8Array(function(t){for(var e=0,i=0;i<t.length;i++)e+=t[i].data.byteLength;return e}(t)),r=0;r<t.length;r++)e=t[r],n.set(e.data,i),i+=e.data.byteLength;return n}function D(t){delete t.minSegmentDts,delete t.maxSegmentDts,delete t.minSegmentPts,delete t.maxSegmentPts}function O(t,e){var i=t.minSegmentDts;return e||(i-=t.timelineStartInfo.dts),e=t.timelineStartInfo.baseMediaDecodeTime,e+=i,e=Math.max(0,e),"audio"===t.type&&(e*=t.samplerate/ft,e=Math.floor(e)),e}function L(t,e){"number"==typeof e.pts&&(void 0===t.timelineStartInfo.pts&&(t.timelineStartInfo.pts=e.pts),void 0===t.minSegmentPts?t.minSegmentPts=e.pts:t.minSegmentPts=Math.min(t.minSegmentPts,e.pts),void 0===t.maxSegmentPts?t.maxSegmentPts=e.pts:t.maxSegmentPts=Math.max(t.maxSegmentPts,e.pts)),"number"==typeof e.dts&&(void 0===t.timelineStartInfo.dts&&(t.timelineStartInfo.dts=e.dts),void 0===t.minSegmentDts?t.minSegmentDts=e.dts:t.minSegmentDts=Math.min(t.minSegmentDts,e.dts),void 0===t.maxSegmentDts?t.maxSegmentDts=e.dts:t.maxSegmentDts=Math.max(t.maxSegmentDts,e.dts))}var M,R,N=function(t){for(var e,i=[],n=0,r=1;r<arguments.length;r++)i.push(arguments[r]);for(r=i.length;r--;)n+=i[r].byteLength;for(e=new Uint8Array(n+8),new DataView(e.buffer,e.byteOffset,e.byteLength).setUint32(0,e.byteLength),e.set(t,4),r=0,n=8;r<i.length;r++)e.set(i[r],n),n+=i[r].byteLength;return e},B=function(){return N(l.dinf,N(l.dref,h))},F=function(t){return N(l.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,t.audioobjecttype<<3|t.samplingfrequencyindex>>>1,t.samplingfrequencyindex<<7|t.channelcount<<3,6,1,2]))},U=function(t){return N(l.hdlr,s[t])},j=function(t){var e=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,85,196,0,0]);return t.samplerate&&(e[12]=t.samplerate>>>24&255,e[13]=t.samplerate>>>16&255,e[14]=t.samplerate>>>8&255,e[15]=255&t.samplerate),N(l.mdhd,e)},q=function(t){return N(l.mdia,j(t),U(t.type),H(t))},z=function(t){return N(l.mfhd,new Uint8Array([0,0,0,0,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t]))},H=function(t){return N(l.minf,"video"===t.type?N(l.vmhd,o):N(l.smhd,u),B(),$(t))},V=function(t){for(var e=t.length,i=[];e--;)i[e]=tt(t[e]);return N.apply(null,[l.moov,G(4294967295)].concat(i).concat(W(t)))},W=function(t){for(var e=t.length,i=[];e--;)i[e]=et(t[e]);return N.apply(null,[l.mvex].concat(i))},G=function(t){t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return N(l.mvhd,t)},X=function(t){for(var e,i=t.samples||[],n=new Uint8Array(4+i.length),r=0;r<i.length;r++)e=i[r].flags,n[r+4]=e.dependsOn<<4|e.isDependedOn<<2|e.hasRedundancy;return N(l.sdtp,n)},$=function(t){return N(l.stbl,Y(t),N(l.stts,f),N(l.stsc,d),N(l.stsz,p),N(l.stco,c))},Y=function(t){return N(l.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),("video"===t.type?K:Q)(t))},K=function(t){for(var e=t.sps||[],i=t.pps||[],n=[],r=[],a=0;a<e.length;a++)n.push((65280&e[a].byteLength)>>>8),n.push(255&e[a].byteLength),n=n.concat(Array.prototype.slice.call(e[a]));for(a=0;a<i.length;a++)r.push((65280&i[a].byteLength)>>>8),r.push(255&i[a].byteLength),r=r.concat(Array.prototype.slice.call(i[a]));var s,o=[l.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&t.width)>>8,255&t.width,(65280&t.height)>>8,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),N(l.avcC,new Uint8Array([1,t.profileIdc,t.profileCompatibility,t.levelIdc,255].concat([e.length],n,[i.length],r))),N(l.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]))];return t.sarRatio&&(s=t.sarRatio[0],t=t.sarRatio[1],o.push(N(l.pasp,new Uint8Array([(4278190080&s)>>24,(16711680&s)>>16,(65280&s)>>8,255&s,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t])))),N.apply(null,o)},Q=function(t){return N(l.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&t.channelcount)>>8,255&t.channelcount,(65280&t.samplesize)>>8,255&t.samplesize,0,0,0,0,(65280&t.samplerate)>>8,255&t.samplerate,0,0]),F(t))},J=function(t){t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,0,(4278190080&t.duration)>>24,(16711680&t.duration)>>16,(65280&t.duration)>>8,255&t.duration,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&t.width)>>8,255&t.width,0,0,(65280&t.height)>>8,255&t.height,0,0]);return N(l.tkhd,t)},Z=function(t){var e,i=N(l.tfhd,new Uint8Array([0,0,0,58,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),n=Math.floor(t.baseMediaDecodeTime/(1+g)),r=Math.floor(t.baseMediaDecodeTime%(1+g)),n=N(l.tfdt,new Uint8Array([1,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r]));return"audio"===t.type?(e=at(t,92),N(l.traf,i,n,e)):(r=X(t),e=at(t,r.length+92),N(l.traf,i,n,e,r))},tt=function(t){return t.duration=t.duration||4294967295,N(l.trak,J(t),q(t))},et=function(t){var e=new Uint8Array([0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return"video"!==t.type&&(e[e.length-1]=0),N(l.trex,e)},it=function(t,e){var i=0,n=0,r=0,a=0;return t.length&&(void 0!==t[0].duration&&(i=1),void 0!==t[0].size&&(n=2),void 0!==t[0].flags&&(r=4),void 0!==t[0].compositionTimeOffset&&(a=8)),[0,0,i|n|r|a,1,(4278190080&t.length)>>>24,(16711680&t.length)>>>16,(65280&t.length)>>>8,255&t.length,(4278190080&e)>>>24,(16711680&e)>>>16,(65280&e)>>>8,255&e]},nt=function(t,e){var i,n,r,a,s;for(e+=20+16*(r=t.samples||[]).length,e=it(r,e),(n=new Uint8Array(e.length+16*r.length)).set(e),i=e.length,s=0;s<r.length;s++)a=r[s],n[i++]=(4278190080&a.duration)>>>24,n[i++]=(16711680&a.duration)>>>16,n[i++]=(65280&a.duration)>>>8,n[i++]=255&a.duration,n[i++]=(4278190080&a.size)>>>24,n[i++]=(16711680&a.size)>>>16,n[i++]=(65280&a.size)>>>8,n[i++]=255&a.size,n[i++]=a.flags.isLeading<<2|a.flags.dependsOn,n[i++]=a.flags.isDependedOn<<6|a.flags.hasRedundancy<<4|a.flags.paddingValue<<1|a.flags.isNonSyncSample,n[i++]=61440&a.flags.degradationPriority,n[i++]=15&a.flags.degradationPriority,n[i++]=(4278190080&a.compositionTimeOffset)>>>24,n[i++]=(16711680&a.compositionTimeOffset)>>>16,n[i++]=(65280&a.compositionTimeOffset)>>>8,n[i++]=255&a.compositionTimeOffset;return N(l.trun,n)},rt=function(t,e){var i,n,r,a,s;for(e+=20+8*(r=t.samples||[]).length,e=it(r,e),(i=new Uint8Array(e.length+8*r.length)).set(e),n=e.length,s=0;s<r.length;s++)a=r[s],i[n++]=(4278190080&a.duration)>>>24,i[n++]=(16711680&a.duration)>>>16,i[n++]=(65280&a.duration)>>>8,i[n++]=255&a.duration,i[n++]=(4278190080&a.size)>>>24,i[n++]=(16711680&a.size)>>>16,i[n++]=(65280&a.size)>>>8,i[n++]=255&a.size;return N(l.trun,i)},at=function(t,e){return("audio"===t.type?rt:nt)(t,e)},st=function(){return N(l.ftyp,e,i,e,n)},ot=function(t,e){for(var i=[],n=e.length;n--;)i[n]=Z(e[n]);return N.apply(null,[l.moof,z(t)].concat(i))},lt=[33,16,5,32,164,27],ut=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],ht=9e4,ct=R=function(t){return t/9e4},dt=function(t,e){return t/e*9e4},pt=function(t,e){return t/9e4*e},ft=ht;function mt(t){return 32<=t&&t<=127||160<=t&&t<=255}function gt(t){this.windowNum=t,this.reset()}(_.prototype=new m).push=function(t){var e,i;if("sei_rbsp"===t.nalUnitType&&(e=function(t){for(var e=0,i={payloadType:-1,payloadSize:0},n=0,r=0;e<t.byteLength&&128!==t[e];){for(;255===t[e];)n+=255,e++;for(n+=t[e++];255===t[e];)r+=255,e++;if(r+=t[e++],!i.payload&&4===n){if("GA94"===String.fromCharCode(t[e+3],t[e+4],t[e+5],t[e+6])){i.payloadType=n,i.payloadSize=r,i.payload=t.subarray(e,e+r);break}i.payload=void 0}e+=r,r=n=0}return i}(t.escapedRBSP)).payload&&4===e.payloadType&&(i=181!==(i=e).payload[0]||49!=(i.payload[1]<<8|i.payload[2])||"GA94"!==String.fromCharCode(i.payload[3],i.payload[4],i.payload[5],i.payload[6])||3!==i.payload[7]?null:i.payload.subarray(8,i.payload.length-1)))if(t.dts<this.latestDts_)this.ignoreNextEqualDts_=!0;else{if(t.dts===this.latestDts_&&this.ignoreNextEqualDts_)return this.numSameDts_--,void(this.numSameDts_||(this.ignoreNextEqualDts_=!1));i=function(t,e){var i,n,r,a,s=[];if(!(64&e[0]))return s;for(n=31&e[0],i=0;i<n;i++)a={type:3&e[2+(r=3*i)],pts:t},4&e[2+r]&&(a.ccData=e[3+r]<<8|e[4+r],s.push(a));return s}(t.pts,i),this.captionPackets_=this.captionPackets_.concat(i),this.latestDts_!==t.dts&&(this.numSameDts_=0),this.numSameDts_++,this.latestDts_=t.dts}},_.prototype.flushCCStreams=function(e){this.ccStreams_.forEach(function(t){return"flush"===e?t.flush():t.partialFlush()},this)},_.prototype.flushStream=function(t){this.captionPackets_.length&&(this.captionPackets_.forEach(function(t,e){t.presortIndex=e}),this.captionPackets_.sort(function(t,e){return t.pts===e.pts?t.presortIndex-e.presortIndex:t.pts-e.pts}),this.captionPackets_.forEach(function(t){t.type<2?this.dispatchCea608Packet(t):this.dispatchCea708Packet(t)},this),this.captionPackets_.length=0),this.flushCCStreams(t)},_.prototype.flush=function(){return this.flushStream("flush")},_.prototype.partialFlush=function(){return this.flushStream("partialFlush")},_.prototype.reset=function(){this.latestDts_=null,this.ignoreNextEqualDts_=!1,this.numSameDts_=0,this.activeCea608Channel_=[null,null],this.ccStreams_.forEach(function(t){t.reset()})},_.prototype.dispatchCea608Packet=function(t){this.setsTextOrXDSActive(t)?this.activeCea608Channel_[t.type]=null:this.setsChannel1Active(t)?this.activeCea608Channel_[t.type]=0:this.setsChannel2Active(t)&&(this.activeCea608Channel_[t.type]=1),null!==this.activeCea608Channel_[t.type]&&this.ccStreams_[(t.type<<1)+this.activeCea608Channel_[t.type]].push(t)},_.prototype.setsChannel1Active=function(t){return 4096==(30720&t.ccData)},_.prototype.setsChannel2Active=function(t){return 6144==(30720&t.ccData)},_.prototype.setsTextOrXDSActive=function(t){return 256==(28928&t.ccData)||4138==(30974&t.ccData)||6186==(30974&t.ccData)},_.prototype.dispatchCea708Packet=function(t){this.parse708captions_&&this.cc708Stream_.push(t)};var vt={127:9834,4128:32,4129:160,4133:8230,4138:352,4140:338,4144:9608,4145:8216,4146:8217,4147:8220,4148:8221,4149:8226,4153:8482,4154:353,4156:339,4157:8480,4159:376,4214:8539,4215:8540,4216:8541,4217:8542,4218:9168,4219:9124,4220:9123,4221:9135,4222:9126,4223:9121,4256:12600};function yt(t){this.serviceNum=t,this.text="",this.currentWindow=new gt(-1),this.windows=[]}gt.prototype.reset=function(){this.clearText(),this.pendingNewLine=!1,this.winAttr={},this.penAttr={},this.penLoc={},this.penColor={},this.visible=0,this.rowLock=0,this.columnLock=0,this.priority=0,this.relativePositioning=0,this.anchorVertical=0,this.anchorHorizontal=0,this.anchorPoint=0,this.rowCount=1,this.virtualRowCount=this.rowCount+1,this.columnCount=41,this.windowStyle=0,this.penStyle=0},gt.prototype.getText=function(){return this.rows.join("\n")},gt.prototype.clearText=function(){this.rows=[""],this.rowIdx=0},gt.prototype.newLine=function(t){for(this.rows.length>=this.virtualRowCount&&"function"==typeof this.beforeRowOverflow&&this.beforeRowOverflow(t),0<this.rows.length&&(this.rows.push(""),this.rowIdx++);this.rows.length>this.virtualRowCount;)this.rows.shift(),this.rowIdx--},gt.prototype.isEmpty=function(){return 0===this.rows.length||1===this.rows.length&&""===this.rows[0]},gt.prototype.addText=function(t){this.rows[this.rowIdx]+=t},gt.prototype.backspace=function(){var t;this.isEmpty()||(t=this.rows[this.rowIdx],this.rows[this.rowIdx]=t.substr(0,t.length-1))},yt.prototype.init=function(t,e){this.startPts=t;for(var i=0;i<8;i++)this.windows[i]=new gt(i),"function"==typeof e&&(this.windows[i].beforeRowOverflow=e)},yt.prototype.setCurrentWindow=function(t){this.currentWindow=this.windows[t]};var _t=function t(){t.prototype.init.call(this);var e=this;this.current708Packet=null,this.services={},this.push=function(t){3!==t.type&&null!==e.current708Packet||e.new708Packet(),e.add708Bytes(t)}};function bt(t){return null===t?"":(t=Tt[t]||t,String.fromCharCode(t))}function wt(){for(var t=[],e=15;e--;)t.push("");return t}_t.prototype=new m,_t.prototype.new708Packet=function(){null!==this.current708Packet&&this.push708Packet(),this.current708Packet={data:[],ptsVals:[]}},_t.prototype.add708Bytes=function(t){var e=t.ccData,i=e>>>8,e=255&e;this.current708Packet.ptsVals.push(t.pts),this.current708Packet.data.push(i),this.current708Packet.data.push(e)},_t.prototype.push708Packet=function(){var t,e=this.current708Packet,i=e.data,n=null,r=0,a=i[r++];for(e.seq=a>>6,e.sizeCode=63&a;r<i.length;r++)t=31&(a=i[r++]),7==(n=a>>5)&&0<t&&(n=i[r++]),this.pushServiceBlock(n,r,t),0<t&&(r+=t-1)},_t.prototype.pushServiceBlock=function(t,e,i){for(var n,r=e,a=this.current708Packet.data,s=(s=this.services[t])||this.initService(t,r);r<e+i&&r<a.length;r++)mt(n=a[r])?r=this.handleText(r,s):16===n?r=this.extendedCommands(r,s):128<=n&&n<=135?r=this.setCurrentWindow(r,s):152<=n&&n<=159?r=this.defineWindow(r,s):136===n?r=this.clearWindows(r,s):140===n?r=this.deleteWindows(r,s):137===n?r=this.displayWindows(r,s):138===n?r=this.hideWindows(r,s):139===n?r=this.toggleWindows(r,s):151===n?r=this.setWindowAttributes(r,s):144===n?r=this.setPenAttributes(r,s):145===n?r=this.setPenColor(r,s):146===n?r=this.setPenLocation(r,s):143===n?s=this.reset(r,s):8===n?s.currentWindow.backspace():12===n?s.currentWindow.clearText():13===n?s.currentWindow.pendingNewLine=!0:14===n?s.currentWindow.clearText():141===n&&r++},_t.prototype.extendedCommands=function(t,e){return t=mt(this.current708Packet.data[++t])?this.handleText(t,e,!0):t},_t.prototype.getPts=function(t){return this.current708Packet.ptsVals[Math.floor(t/2)]},_t.prototype.initService=function(e,t){var i=this;return this.services[e]=new yt(e),this.services[e].init(this.getPts(t),function(t){i.flushDisplayed(t,i.services[e])}),this.services[e]},_t.prototype.handleText=function(t,e,i){var n,i=(n=(i?4096:0)|this.current708Packet.data[t],i=vt[n]||n,4096&n&&n===i?"":String.fromCharCode(i)),e=e.currentWindow;return e.pendingNewLine&&!e.isEmpty()&&e.newLine(this.getPts(t)),e.pendingNewLine=!1,e.addText(i),t},_t.prototype.setCurrentWindow=function(t,e){var i=7&this.current708Packet.data[t];return e.setCurrentWindow(i),t},_t.prototype.defineWindow=function(t,e){var i=this.current708Packet.data,n=i[t];e.setCurrentWindow(7&n);e=e.currentWindow,n=i[++t];return e.visible=(32&n)>>5,e.rowLock=(16&n)>>4,e.columnLock=(8&n)>>3,e.priority=7&n,n=i[++t],e.relativePositioning=(128&n)>>7,e.anchorVertical=127&n,n=i[++t],e.anchorHorizontal=n,n=i[++t],e.anchorPoint=(240&n)>>4,e.rowCount=15&n,n=i[++t],e.columnCount=63&n,n=i[++t],e.windowStyle=(56&n)>>3,e.penStyle=7&n,e.virtualRowCount=e.rowCount+1,t},_t.prototype.setWindowAttributes=function(t,e){var i=this.current708Packet.data,n=(i[t],e.currentWindow.winAttr),e=i[++t];return n.fillOpacity=(192&e)>>6,n.fillRed=(48&e)>>4,n.fillGreen=(12&e)>>2,n.fillBlue=3&e,e=i[++t],n.borderType=(192&e)>>6,n.borderRed=(48&e)>>4,n.borderGreen=(12&e)>>2,n.borderBlue=3&e,e=i[++t],n.borderType+=(128&e)>>5,n.wordWrap=(64&e)>>6,n.printDirection=(48&e)>>4,n.scrollDirection=(12&e)>>2,n.justify=3&e,e=i[++t],n.effectSpeed=(240&e)>>4,n.effectDirection=(12&e)>>2,n.displayEffect=3&e,t},_t.prototype.flushDisplayed=function(t,e){for(var i=[],n=0;n<8;n++)e.windows[n].visible&&!e.windows[n].isEmpty()&&i.push(e.windows[n].getText());e.endPts=t,e.text=i.join("\n\n"),this.pushCaption(e),e.startPts=t},_t.prototype.pushCaption=function(t){""!==t.text&&(this.trigger("data",{startPts:t.startPts,endPts:t.endPts,text:t.text,stream:"cc708_"+t.serviceNum}),t.text="",t.startPts=t.endPts)},_t.prototype.displayWindows=function(t,e){var i=this.current708Packet.data[++t],n=this.getPts(t);this.flushDisplayed(n,e);for(var r=0;r<8;r++)i&1<<r&&(e.windows[r].visible=1);return t},_t.prototype.hideWindows=function(t,e){var i=this.current708Packet.data[++t],n=this.getPts(t);this.flushDisplayed(n,e);for(var r=0;r<8;r++)i&1<<r&&(e.windows[r].visible=0);return t},_t.prototype.toggleWindows=function(t,e){var i=this.current708Packet.data[++t],n=this.getPts(t);this.flushDisplayed(n,e);for(var r=0;r<8;r++)i&1<<r&&(e.windows[r].visible^=1);return t},_t.prototype.clearWindows=function(t,e){var i=this.current708Packet.data[++t],n=this.getPts(t);this.flushDisplayed(n,e);for(var r=0;r<8;r++)i&1<<r&&e.windows[r].clearText();return t},_t.prototype.deleteWindows=function(t,e){var i=this.current708Packet.data[++t],n=this.getPts(t);this.flushDisplayed(n,e);for(var r=0;r<8;r++)i&1<<r&&e.windows[r].reset();return t},_t.prototype.setPenAttributes=function(t,e){var i=this.current708Packet.data,n=(i[t],e.currentWindow.penAttr),e=i[++t];return n.textTag=(240&e)>>4,n.offset=(12&e)>>2,n.penSize=3&e,e=i[++t],n.italics=(128&e)>>7,n.underline=(64&e)>>6,n.edgeType=(56&e)>>3,n.fontStyle=7&e,t},_t.prototype.setPenColor=function(t,e){var i=this.current708Packet.data,n=(i[t],e.currentWindow.penColor),e=i[++t];return n.fgOpacity=(192&e)>>6,n.fgRed=(48&e)>>4,n.fgGreen=(12&e)>>2,n.fgBlue=3&e,e=i[++t],n.bgOpacity=(192&e)>>6,n.bgRed=(48&e)>>4,n.bgGreen=(12&e)>>2,n.bgBlue=3&e,e=i[++t],n.edgeRed=(48&e)>>4,n.edgeGreen=(12&e)>>2,n.edgeBlue=3&e,t},_t.prototype.setPenLocation=function(t,e){var i=this.current708Packet.data,n=(i[t],e.currentWindow.penLoc);return e.currentWindow.pendingNewLine=!0,e=i[++t],n.row=15&e,e=i[++t],n.column=63&e,t},_t.prototype.reset=function(t,e){var i=this.getPts(t);return this.flushDisplayed(i,e),this.initService(e.serviceNum,t)};var Tt={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},xt=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],St=function t(e,i){t.prototype.init.call(this),this.field_=e||0,this.dataChannel_=i||0,this.name_="CC"+(1+(this.field_<<1|this.dataChannel_)),this.setConstants(),this.reset(),this.push=function(t){var e,i,n,r,a;(e=32639&t.ccData)!==this.lastControlCode_?(4096==(61440&e)?this.lastControlCode_=e:e!==this.PADDING_&&(this.lastControlCode_=null),i=e>>>8,n=255&e,e!==this.PADDING_&&(e===this.RESUME_CAPTION_LOADING_?this.mode_="popOn":e===this.END_OF_CAPTION_?(this.mode_="popOn",this.clearFormatting(t.pts),this.flushDisplayed(t.pts),a=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=a,this.startPts_=t.pts):e===this.ROLL_UP_2_ROWS_?(this.rollUpRows_=2,this.setRollUp(t.pts)):e===this.ROLL_UP_3_ROWS_?(this.rollUpRows_=3,this.setRollUp(t.pts)):e===this.ROLL_UP_4_ROWS_?(this.rollUpRows_=4,this.setRollUp(t.pts)):e===this.CARRIAGE_RETURN_?(this.clearFormatting(t.pts),this.flushDisplayed(t.pts),this.shiftRowsUp_(),this.startPts_=t.pts):e===this.BACKSPACE_?"popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1):e===this.ERASE_DISPLAYED_MEMORY_?(this.flushDisplayed(t.pts),this.displayed_=wt()):e===this.ERASE_NON_DISPLAYED_MEMORY_?this.nonDisplayed_=wt():e===this.RESUME_DIRECT_CAPTIONING_?("paintOn"!==this.mode_&&(this.flushDisplayed(t.pts),this.displayed_=wt()),this.mode_="paintOn",this.startPts_=t.pts):this.isSpecialCharacter(i,n)?(r=bt((i=(3&i)<<8)|n),this[this.mode_](t.pts,r),this.column_++):this.isExtCharacter(i,n)?("popOn"===this.mode_?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[this.row_]=this.displayed_[this.row_].slice(0,-1),r=bt((i=(3&i)<<8)|n),this[this.mode_](t.pts,r),this.column_++):this.isMidRowCode(i,n)?(this.clearFormatting(t.pts),this[this.mode_](t.pts," "),this.column_++,14==(14&n)&&this.addFormatting(t.pts,["i"]),1==(1&n)&&this.addFormatting(t.pts,["u"])):this.isOffsetControlCode(i,n)?this.column_+=3&n:this.isPAC(i,n)?(a=xt.indexOf(7968&e),"rollUp"===this.mode_&&(a-this.rollUpRows_+1<0&&(a=this.rollUpRows_-1),this.setRollUp(t.pts,a)),a!==this.row_&&(this.clearFormatting(t.pts),this.row_=a),1&n&&-1===this.formatting_.indexOf("u")&&this.addFormatting(t.pts,["u"]),16==(16&e)&&(this.column_=4*((14&e)>>1)),this.isColorPAC(n)&&14==(14&n)&&this.addFormatting(t.pts,["i"])):this.isNormalChar(i)&&(0===n&&(n=null),r=bt(i),r+=bt(n),this[this.mode_](t.pts,r),this.column_+=r.length))):this.lastControlCode_=null}};function Et(t,e){var i=1;for(e<t&&(i=-1);4294967296<Math.abs(e-t);)t+=8589934592*i;return t}function kt(t){var e,i;kt.prototype.init.call(this),this.type_=t||"shared",this.push=function(t){"shared"!==this.type_&&t.type!==this.type_||(void 0===i&&(i=t.dts),t.dts=Et(t.dts,i),t.pts=Et(t.pts,i),e=t.dts,this.trigger("data",t))},this.flush=function(){i=e,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.discontinuity=function(){e=i=void 0},this.reset=function(){this.discontinuity(),this.trigger("reset")}}St.prototype=new m,St.prototype.flushDisplayed=function(t){var e=this.displayed_.map(function(t){try{return t.trim()}catch(t){return""}}).join("\n").replace(/^\n+|\n+$/g,"");e.length&&this.trigger("data",{startPts:this.startPts_,endPts:t,text:e,stream:this.name_})},St.prototype.reset=function(){this.mode_="popOn",this.topRow_=0,this.startPts_=0,this.displayed_=wt(),this.nonDisplayed_=wt(),this.lastControlCode_=null,this.column_=0,this.row_=14,this.rollUpRows_=2,this.formatting_=[]},St.prototype.setConstants=function(){0===this.dataChannel_?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):1===this.dataChannel_&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31),this.PADDING_=0,this.RESUME_CAPTION_LOADING_=32|this.CONTROL_,this.END_OF_CAPTION_=47|this.CONTROL_,this.ROLL_UP_2_ROWS_=37|this.CONTROL_,this.ROLL_UP_3_ROWS_=38|this.CONTROL_,this.ROLL_UP_4_ROWS_=39|this.CONTROL_,this.CARRIAGE_RETURN_=45|this.CONTROL_,this.RESUME_DIRECT_CAPTIONING_=41|this.CONTROL_,this.BACKSPACE_=33|this.CONTROL_,this.ERASE_DISPLAYED_MEMORY_=44|this.CONTROL_,this.ERASE_NON_DISPLAYED_MEMORY_=46|this.CONTROL_},St.prototype.isSpecialCharacter=function(t,e){return t===this.EXT_&&48<=e&&e<=63},St.prototype.isExtCharacter=function(t,e){return(t===this.EXT_+1||t===this.EXT_+2)&&32<=e&&e<=63},St.prototype.isMidRowCode=function(t,e){return t===this.EXT_&&32<=e&&e<=47},St.prototype.isOffsetControlCode=function(t,e){return t===this.OFFSET_&&33<=e&&e<=35},St.prototype.isPAC=function(t,e){return t>=this.BASE_&&t<this.BASE_+8&&64<=e&&e<=127},St.prototype.isColorPAC=function(t){return 64<=t&&t<=79||96<=t&&t<=127},St.prototype.isNormalChar=function(t){return 32<=t&&t<=127},St.prototype.setRollUp=function(t,e){if("rollUp"!==this.mode_&&(this.row_=14,this.mode_="rollUp",this.flushDisplayed(t),this.nonDisplayed_=wt(),this.displayed_=wt()),void 0!==e&&e!==this.row_)for(var i=0;i<this.rollUpRows_;i++)this.displayed_[e-i]=this.displayed_[this.row_-i],this.displayed_[this.row_-i]="";void 0===e&&(e=this.row_),this.topRow_=e-this.rollUpRows_+1},St.prototype.addFormatting=function(t,e){this.formatting_=this.formatting_.concat(e);e=e.reduce(function(t,e){return t+"<"+e+">"},"");this[this.mode_](t,e)},St.prototype.clearFormatting=function(t){var e;this.formatting_.length&&(e=this.formatting_.reverse().reduce(function(t,e){return t+"</"+e+">"},""),this.formatting_=[],this[this.mode_](t,e))},St.prototype.popOn=function(t,e){var i=this.nonDisplayed_[this.row_];this.nonDisplayed_[this.row_]=i+=e},St.prototype.rollUp=function(t,e){var i=this.displayed_[this.row_];this.displayed_[this.row_]=i+=e},St.prototype.shiftRowsUp_=function(){for(var t=0;t<this.topRow_;t++)this.displayed_[t]="";for(t=this.row_+1;t<15;t++)this.displayed_[t]="";for(t=this.topRow_;t<this.row_;t++)this.displayed_[t]=this.displayed_[t+1];this.displayed_[this.row_]=""},St.prototype.paintOn=function(t,e){var i=this.displayed_[this.row_];this.displayed_[this.row_]=i+=e};var Ct={CaptionStream:_,Cea608Stream:St,Cea708Stream:_t},It={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21};function At(t,e,i){for(var n="",r=e;r<i;r++)n+="%"+("00"+t[r].toString(16)).slice(-2);return n}function Pt(t,e,i){return decodeURIComponent(At(t,e,i))}function Dt(t){return t[0]<<21|t[1]<<14|t[2]<<7|t[3]}kt.prototype=new m;var Ot,Lt=kt,Mt={TXXX:function(t){var e;if(3===t.data[0]){for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=Pt(t.data,1,e),t.value=Pt(t.data,e+1,t.data.length).replace(/\0*$/,"");break}t.data=t.value}},WXXX:function(t){var e;if(3===t.data[0])for(e=1;e<t.data.length;e++)if(0===t.data[e]){t.description=Pt(t.data,1,e),t.url=Pt(t.data,e+1,t.data.length);break}},PRIV:function(t){for(var e,i=0;i<t.data.length;i++)if(0===t.data[i]){t.owner=(e=t.data,unescape(At(e,0,i)));break}t.privateData=t.data.subarray(i+1),t.data=t.privateData}};(Ot=function(t){var e,l={debug:!(!t||!t.debug),descriptor:t&&t.descriptor},u=0,h=[],c=0;if(Ot.prototype.init.call(this),this.dispatchType=It.METADATA_STREAM_TYPE.toString(16),l.descriptor)for(e=0;e<l.descriptor.length;e++)this.dispatchType+=("00"+l.descriptor[e].toString(16)).slice(-2);this.push=function(t){var e,i,n,r,a,s,o;if("timed-metadata"===t.type)if(t.dataAlignmentIndicator&&(c=0,h.length=0),0===h.length&&(t.data.length<10||t.data[0]!=="I".charCodeAt(0)||t.data[1]!=="D".charCodeAt(0)||t.data[2]!=="3".charCodeAt(0)))l.debug;else if(h.push(t),c+=t.data.byteLength,1===h.length&&(u=Dt(t.data.subarray(6,10)),u+=10),!(c<u)){for(e={data:new Uint8Array(u),frames:[],pts:h[0].pts,dts:h[0].dts},a=0;a<u;)e.data.set(h[0].data.subarray(0,u-a),a),a+=h[0].data.byteLength,c-=h[0].data.byteLength,h.shift();i=10,64&e.data[5]&&(i+=4,i+=Dt(e.data.subarray(10,14)),u-=Dt(e.data.subarray(16,20)));do{if((n=Dt(e.data.subarray(i+4,i+8)))<1)return}while((r={id:String.fromCharCode(e.data[i],e.data[i+1],e.data[i+2],e.data[i+3]),data:e.data.subarray(i+10,i+n+10)}).key=r.id,Mt[r.id]&&(Mt[r.id](r),"com.apple.streaming.transportStreamTimestamp"===r.owner)&&(o=(1&(s=r.data)[3])<<30|s[4]<<22|s[5]<<14|s[6]<<6|s[7]>>>2,o*=4,o+=3&s[7],r.timeStamp=o,void 0===e.pts&&void 0===e.dts&&(e.pts=r.timeStamp,e.dts=r.timeStamp),this.trigger("timestamp",r)),e.frames.push(r),i+=10,(i+=n)<u);this.trigger("data",e)}}}).prototype=new m;var Rt,Nt,Bt,Ft=Ot,Lt=Lt;(Rt=function(){var r=new Uint8Array(188),a=0;Rt.prototype.init.call(this),this.push=function(t){var e,i=0,n=188;for(a?((e=new Uint8Array(t.byteLength+a)).set(r.subarray(0,a)),e.set(t,a),a=0):e=t;n<e.byteLength;)71!==e[i]||71!==e[n]?(i++,n++):(this.trigger("data",e.subarray(i,n)),i+=188,n+=188);i<e.byteLength&&(r.set(e.subarray(i),0),a=e.byteLength-i)},this.flush=function(){188===a&&71===r[0]&&(this.trigger("data",r),a=0),this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")},this.reset=function(){a=0,this.trigger("reset")}}).prototype=new m,(Nt=function(){var n,r,a,s;Nt.prototype.init.call(this),(s=this).packetsWaitingForPmt=[],this.programMapTable=void 0,n=function(t,e){var i=0;e.payloadUnitStartIndicator&&(i+=t[i]+1),("pat"===e.type?r:a)(t.subarray(i),e)},r=function(t,e){e.section_number=t[7],e.last_section_number=t[8],s.pmtPid=(31&t[10])<<8|t[11],e.pmtPid=s.pmtPid},a=function(t,e){var i,n;if(1&t[5]){for(s.programMapTable={video:null,audio:null,"timed-metadata":{}},i=3+((15&t[1])<<8|t[2])-4,n=12+((15&t[10])<<8|t[11]);n<i;){var r=t[n],a=(31&t[n+1])<<8|t[n+2];r===It.H264_STREAM_TYPE&&null===s.programMapTable.video?s.programMapTable.video=a:r===It.ADTS_STREAM_TYPE&&null===s.programMapTable.audio?s.programMapTable.audio=a:r===It.METADATA_STREAM_TYPE&&(s.programMapTable["timed-metadata"][a]=r),n+=5+((15&t[n+3])<<8|t[n+4])}e.programMapTable=s.programMapTable}},this.push=function(t){var e={},i=4;if(e.payloadUnitStartIndicator=!!(64&t[1]),e.pid=31&t[1],e.pid<<=8,e.pid|=t[2],1<(48&t[3])>>>4&&(i+=t[i]+1),0===e.pid)e.type="pat",n(t.subarray(i),e),this.trigger("data",e);else if(e.pid===this.pmtPid)for(e.type="pmt",n(t.subarray(i),e),this.trigger("data",e);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else void 0===this.programMapTable?this.packetsWaitingForPmt.push([t,i,e]):this.processPes_(t,i,e)},this.processPes_=function(t,e,i){i.pid===this.programMapTable.video?i.streamType=It.H264_STREAM_TYPE:i.pid===this.programMapTable.audio?i.streamType=It.ADTS_STREAM_TYPE:i.streamType=this.programMapTable["timed-metadata"][i.pid],i.type="pes",i.data=t.subarray(e),this.trigger("data",i)}}).prototype=new m,Nt.STREAM_TYPES={h264:27,adts:15},(Bt=function(){function n(t,e,i){var n,r,a,s,o=new Uint8Array(t.size),l={type:e},u=0,h=0;if(t.data.length&&!(t.size<9)){for(l.trackId=t.data[0].pid,u=0;u<t.data.length;u++)n=t.data[u],o.set(n.data,h),h+=n.data.byteLength;a=l,s=(r=o)[0]<<16|r[1]<<8|r[2],a.data=new Uint8Array,1==s&&(a.packetLength=6+(r[4]<<8|r[5]),a.dataAlignmentIndicator=0!=(4&r[6]),192&(s=r[7])&&(a.pts=(14&r[9])<<27|(255&r[10])<<20|(254&r[11])<<12|(255&r[12])<<5|(254&r[13])>>>3,a.pts*=4,a.pts+=(6&r[13])>>>1,a.dts=a.pts,64&s&&(a.dts=(14&r[14])<<27|(255&r[15])<<20|(254&r[16])<<12|(255&r[17])<<5|(254&r[18])>>>3,a.dts*=4,a.dts+=(6&r[18])>>>1)),a.data=r.subarray(9+r[8])),e="video"===e||l.packetLength<=t.size,(i||e)&&(t.size=0,t.data.length=0),e&&c.trigger("data",l)}}var e,c=this,r={data:[],size:0},a={data:[],size:0},s={data:[],size:0};Bt.prototype.init.call(this),this.push=function(i){({pat:function(){},pes:function(){var t,e;switch(i.streamType){case It.H264_STREAM_TYPE:t=r,e="video";break;case It.ADTS_STREAM_TYPE:t=a,e="audio";break;case It.METADATA_STREAM_TYPE:t=s,e="timed-metadata";break;default:return}i.payloadUnitStartIndicator&&n(t,e,!0),t.data.push(i),t.size+=i.data.byteLength},pmt:function(){var t={type:"metadata",tracks:[]};null!==(e=i.programMapTable).video&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.video,codec:"avc",type:"video"}),null!==e.audio&&t.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+e.audio,codec:"adts",type:"audio"}),c.trigger("data",t)}})[i.type]()},this.reset=function(){r.size=0,r.data.length=0,a.size=0,a.data.length=0,this.trigger("reset")},this.flushStreams_=function(){n(r,"video"),n(a,"audio"),n(s,"timed-metadata")},this.flush=function(){this.flushStreams_(),this.trigger("done")}}).prototype=new m;var Ut,jt={PAT_PID:0,MP2T_PACKET_LENGTH:188,TransportPacketStream:Rt,TransportParseStream:Nt,ElementaryStream:Bt,TimestampRolloverStream:Lt,CaptionStream:Ct.CaptionStream,Cea608Stream:Ct.Cea608Stream,Cea708Stream:Ct.Cea708Stream,MetadataStream:Ft};for(Ut in It)It.hasOwnProperty(Ut)&&(jt[Ut]=It[Ut]);var qt,zt=jt,Ht=ht,Vt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];(qt=function(o){var l,u=0;qt.prototype.init.call(this),this.push=function(t){var e,i,n,r,a,s=0;if(o||(u=0),"audio"===t.type)for(l?(n=l,(l=new Uint8Array(n.byteLength+t.data.byteLength)).set(n),l.set(t.data,n.byteLength)):l=t.data;s+5<l.length;)if(255===l[s]&&240==(246&l[s+1])){if(e=2*(1&~l[s+1]),i=(3&l[s+3])<<11|l[s+4]<<3|(224&l[s+5])>>5,a=(r=1024*(1+(3&l[s+6])))*Ht/Vt[(60&l[s+2])>>>2],l.byteLength<(i=s+i))return;if(this.trigger("data",{pts:t.pts+u*a,dts:t.dts+u*a,sampleCount:r,audioobjecttype:1+(l[s+2]>>>6&3),channelcount:(1&l[s+2])<<2|(192&l[s+3])>>>6,samplerate:Vt[(60&l[s+2])>>>2],samplingfrequencyindex:(60&l[s+2])>>>2,samplesize:16,data:l.subarray(s+7+e,i)}),u++,l.byteLength===i)return void(l=void 0);l=l.subarray(i)}else s++},this.flush=function(){u=0,this.trigger("done")},this.reset=function(){l=void 0,this.trigger("reset")},this.endTimeline=function(){l=void 0,this.trigger("endedtimeline")}}).prototype=new m;function Wt(n){var r=n.byteLength,a=0,s=0;this.length=function(){return 8*r},this.bitsAvailable=function(){return 8*r+s},this.loadWord=function(){var t=n.byteLength-r,e=new Uint8Array(4),i=Math.min(4,r);if(0===i)throw new Error("no bytes available");e.set(n.subarray(t,t+i)),a=new DataView(e.buffer).getUint32(0),s=8*i,r-=i},this.skipBits=function(t){var e;t<s||(t-=s,t-=8*(e=Math.floor(t/8)),r-=e,this.loadWord()),a<<=t,s-=t},this.readBits=function(t){var e=Math.min(s,t),i=a>>>32-e;return 0<(s-=e)?a<<=e:0<r&&this.loadWord(),0<(e=t-e)?i<<e|this.readBits(e):i},this.skipLeadingZeros=function(){for(var t=0;t<s;++t)if(0!=(a&2147483648>>>t))return a<<=t,s-=t,t;return this.loadWord(),t+this.skipLeadingZeros()},this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())},this.readUnsignedExpGolomb=function(){var t=this.skipLeadingZeros();return this.readBits(t+1)-1},this.readExpGolomb=function(){var t=this.readUnsignedExpGolomb();return 1&t?1+t>>>1:-1*(t>>>1)},this.readBoolean=function(){return 1===this.readBits(1)},this.readUnsignedByte=function(){return this.readBits(8)},this.loadWord()}var Gt,Xt,$t,Yt=qt;function Kt(t,e){var i=0<=(i=t[e+6]<<21|t[e+7]<<14|t[e+8]<<7|t[e+9])?i:0;return(16&t[e+5])>>4?i+20:i+10}(Xt=function(){var n,r,a=0;Xt.prototype.init.call(this),this.push=function(t){for(var e,i=(r=r?((e=new Uint8Array(r.byteLength+t.data.byteLength)).set(r),e.set(t.data,r.byteLength),e):t.data).byteLength;a<i-3;a++)if(1===r[a+2]){n=a+5;break}for(;n<i;)switch(r[n]){case 0:if(0!==r[n-1]){n+=2;break}if(0!==r[n-2]){n++;break}for(a+3!==n-2&&this.trigger("data",r.subarray(a+3,n-2));1!==r[++n]&&n<i;);a=n-2,n+=3;break;case 1:if(0!==r[n-1]||0!==r[n-2]){n+=3;break}this.trigger("data",r.subarray(a+3,n-2)),a=n-2,n+=3;break;default:n+=3}r=r.subarray(a),n-=a,a=0},this.reset=function(){r=null,a=0,this.trigger("reset")},this.flush=function(){r&&3<r.byteLength&&this.trigger("data",r.subarray(a+3)),r=null,a=0,this.trigger("done")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline")}}).prototype=new m,$t={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0},(Gt=function(){var i,n,r,a,s,o,g,e=new Xt;Gt.prototype.init.call(this),(i=this).push=function(t){"video"===t.type&&(n=t.trackId,r=t.pts,a=t.dts,e.push(t))},e.on("data",function(t){var e={trackId:n,pts:r,dts:a,data:t};switch(31&t[0]){case 5:e.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:e.nalUnitType="sei_rbsp",e.escapedRBSP=s(t.subarray(1));break;case 7:e.nalUnitType="seq_parameter_set_rbsp",e.escapedRBSP=s(t.subarray(1)),e.config=o(e.escapedRBSP);break;case 8:e.nalUnitType="pic_parameter_set_rbsp";break;case 9:e.nalUnitType="access_unit_delimiter_rbsp"}i.trigger("data",e)}),e.on("done",function(){i.trigger("done")}),e.on("partialdone",function(){i.trigger("partialdone")}),e.on("reset",function(){i.trigger("reset")}),e.on("endedtimeline",function(){i.trigger("endedtimeline")}),this.flush=function(){e.flush()},this.partialFlush=function(){e.partialFlush()},this.reset=function(){e.reset()},this.endTimeline=function(){e.endTimeline()},g=function(t,e){for(var i=8,n=8,r=0;r<t;r++)i=0===(n=0!==n?(i+e.readExpGolomb()+256)%256:n)?i:n},s=function(t){for(var e=t.byteLength,i=[],n=1;n<e-2;)0===t[n]&&0===t[n+1]&&3===t[n+2]?(i.push(n+2),n+=2):n++;if(0===i.length)return t;for(var r=e-i.length,a=new Uint8Array(r),s=0,n=0;n<r;s++,n++)s===i[0]&&(s++,i.shift()),a[n]=t[s];return a},o=function(t){var e,i,n,r,a,s,o,l=0,u=0,h=0,c=0,d=1,p=(e=new Wt(t)).readUnsignedByte(),f=e.readUnsignedByte(),m=e.readUnsignedByte();if(e.skipUnsignedExpGolomb(),$t[p]&&(3===(n=e.readUnsignedExpGolomb())&&e.skipBits(1),e.skipUnsignedExpGolomb(),e.skipUnsignedExpGolomb(),e.skipBits(1),e.readBoolean()))for(a=3!==n?8:12,o=0;o<a;o++)e.readBoolean()&&g(o<6?16:64,e);if(e.skipUnsignedExpGolomb(),0===(r=e.readUnsignedExpGolomb()))e.readUnsignedExpGolomb();else if(1===r)for(e.skipBits(1),e.skipExpGolomb(),e.skipExpGolomb(),i=e.readUnsignedExpGolomb(),o=0;o<i;o++)e.skipExpGolomb();if(e.skipUnsignedExpGolomb(),e.skipBits(1),t=e.readUnsignedExpGolomb(),n=e.readUnsignedExpGolomb(),0===(r=e.readBits(1))&&e.skipBits(1),e.skipBits(1),e.readBoolean()&&(l=e.readUnsignedExpGolomb(),u=e.readUnsignedExpGolomb(),h=e.readUnsignedExpGolomb(),c=e.readUnsignedExpGolomb()),e.readBoolean()&&e.readBoolean()){switch(e.readUnsignedByte()){case 1:s=[1,1];break;case 2:s=[12,11];break;case 3:s=[10,11];break;case 4:s=[16,11];break;case 5:s=[40,33];break;case 6:s=[24,11];break;case 7:s=[20,11];break;case 8:s=[32,11];break;case 9:s=[80,33];break;case 10:s=[18,11];break;case 11:s=[15,11];break;case 12:s=[64,33];break;case 13:s=[160,99];break;case 14:s=[4,3];break;case 15:s=[3,2];break;case 16:s=[2,1];break;case 255:s=[e.readUnsignedByte()<<8|e.readUnsignedByte(),e.readUnsignedByte()<<8|e.readUnsignedByte()]}s&&(d=s[0]/s[1])}return{profileIdc:p,levelIdc:m,profileCompatibility:f,width:Math.ceil((16*(t+1)-2*l-2*u)*d),height:(2-r)*(n+1)*16-2*h-2*c,sarRatio:s}}}).prototype=new m;function Qt(t){var e=function t(e,i){return e.length-i<10||e[i]!=="I".charCodeAt(0)||e[i+1]!=="D".charCodeAt(0)||e[i+2]!=="3".charCodeAt(0)?i:t(e,i+=Kt(e,i))}(t,0);return t.length>=e+2&&255==(255&t[e])&&240==(240&t[e+1])&&16==(22&t[e+1])}var Jt,Ft={H264Stream:Gt,NalByteStream:Xt},Zt=Kt;function te(t,e){var i;if(t.length===e.length){for(i=0;i<t.length;i++)if(t[i]!==e[i])return;return 1}}function ee(t,e,i,n,r,a){return{start:{dts:t,pts:t+(i-e)},end:{dts:t+(n-e),pts:t+(r-i)},prependedContentDuration:a,baseMediaDecodeTime:t}}(Jt=function(){var l=new Uint8Array,u=0;Jt.prototype.init.call(this),this.setTimestamp=function(t){u=t},this.push=function(t){var e,i,n,r,a,s=0,o=0;for(l.length?(e=l.length,(l=new Uint8Array(t.byteLength+e)).set(l.subarray(0,e)),l.set(t,e)):l=t;3<=l.length-o;)if(l[o]!=="I".charCodeAt(0)||l[o+1]!=="D".charCodeAt(0)||l[o+2]!=="3".charCodeAt(0))if(255!=(255&l[o])||240!=(240&l[o+1]))o++;else{if(l.length-o<7)break;if(o+(a=r=void 0,r=(224&(i=l)[(n=o)+5])>>5,a=i[n+4]<<3,s=6144&i[n+3]|a|r)>l.length)break;r={type:"audio",data:l.subarray(o,o+s),pts:u,dts:u},this.trigger("data",r),o+=s}else{if(l.length-o<10)break;if(o+(s=Zt(l,o))>l.length)break;r={type:"timed-metadata",data:l.subarray(o,o+s)},this.trigger("data",r),o+=s}t=l.length-o,l=0<t?l.subarray(o):new Uint8Array},this.reset=function(){l=new Uint8Array,this.trigger("reset")},this.endTimeline=function(){l=new Uint8Array,this.trigger("endedtimeline")}}).prototype=new m;var ie,ne,re,ae,se=Jt,oe=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],le=["width","height","profileIdc","levelIdc","profileCompatibility","sarRatio"],ue=Ft.H264Stream,he=Qt,ce=ht;function de(r,a){var s=[],o=0,l=0,u=0,h=1/0,c=null,d=null;a=a||{},de.prototype.init.call(this),this.push=function(e){L(r,e),r&&oe.forEach(function(t){r[t]=e[t]}),s.push(e)},this.setEarliestDts=function(t){l=t},this.setVideoBaseMediaDecodeTime=function(t){h=t},this.setAudioAppendStart=function(t){u=t},this.processFrames_=function(){var t,e,i,n;0!==s.length&&0!==(n=I(s,r,l)).length&&(r.baseMediaDecodeTime=O(r,a.keepOriginalTimestamps),C(r,n,u,h),r.samples=A(n),e=b(P(n)),s=[],t=ot(o,[r]),o++,r.initSegment=w([r]),(i=new Uint8Array(t.byteLength+e.byteLength)).set(t),i.set(e,t.byteLength),D(r),null===c&&(d=c=n[0].pts),d+=n.length*(1024*me/r.samplerate),n={start:c},this.trigger("timingInfo",n),this.trigger("data",{track:r,boxes:i}))},this.flush=function(){this.processFrames_(),this.trigger("timingInfo",{start:c,end:d}),this.resetTiming_(),this.trigger("done","AudioSegmentStream")},this.partialFlush=function(){this.processFrames_(),this.trigger("partialdone","AudioSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","AudioSegmentStream")},this.resetTiming_=function(){D(r),d=c=null},this.reset=function(){this.resetTiming_(),s=[],this.trigger("reset")}}(ne=function(a,s){var o=[],l=0,u=0,h=0,c=1/0;s=s||{},ne.prototype.init.call(this),this.push=function(e){L(a,e),a&&oe.forEach(function(t){a[t]=e[t]}),o.push(e)},this.setEarliestDts=function(t){u=t},this.setVideoBaseMediaDecodeTime=function(t){c=t},this.setAudioAppendStart=function(t){h=t},this.flush=function(){var t,e,i,n,r;0!==o.length&&(t=I(o,a,u),a.baseMediaDecodeTime=O(a,s.keepOriginalTimestamps),r=C(a,t,h,c),a.samples=A(t),e=b(P(t)),o=[],n=ot(l,[a]),i=new Uint8Array(n.byteLength+e.byteLength),l++,i.set(n),i.set(e,n.byteLength),D(a),n=Math.ceil(1024*ce/a.samplerate),t.length&&(n=t.length*n,this.trigger("segmentTimingInfo",ee(dt(a.baseMediaDecodeTime,a.samplerate),t[0].dts,t[0].pts,t[0].dts+n,t[0].pts+n,r||0)),this.trigger("timingInfo",{start:t[0].pts,end:t[0].pts+n})),this.trigger("data",{track:a,boxes:i})),this.trigger("done","AudioSegmentStream")},this.reset=function(){D(a),o=[],this.trigger("reset")}}).prototype=new m,(ie=function(s,a){var e,i,o=0,l=[],u=[];a=a||{},ie.prototype.init.call(this),delete s.minPTS,this.gopCache_=[],this.push=function(t){L(s,t),"seq_parameter_set_rbsp"!==t.nalUnitType||e||(e=t.config,s.sps=[t.data],le.forEach(function(t){s[t]=e[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||i||(i=t.data,s.pps=[t.data]),l.push(t)},this.flush=function(){for(var t,e,i,n,r=0;l.length&&"access_unit_delimiter_rbsp"!==l[0].nalUnitType;)l.shift();if(0===l.length)return this.resetStream_(),void this.trigger("done","VideoSegmentStream");if(t=T(l),(e=x(t))[0][0].keyFrame||((i=this.getGopForFusion_(l[0],s))?(r=i.duration,e.unshift(i),e.byteLength+=i.byteLength,e.nalCount+=i.nalCount,e.pts=i.pts,e.dts=i.dts,e.duration+=i.duration):e=S(e)),u.length){if(!(n=a.alignGopsAtEnd?this.alignGopsAtEnd_(e):this.alignGopsAtStart_(e)))return this.gopCache_.unshift({gop:e.pop(),pps:s.pps,sps:s.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),l=[],this.resetStream_(),void this.trigger("done","VideoSegmentStream");D(s),e=n}L(s,e),s.samples=function(t,e){for(var i,n,r,a=e||0,s=[],o=0;o<t.length;o++)for(r=t[o],i=0;i<r.length;i++)a+=(n=v(r[i],a)).size,s.push(n);return s}(e),t=b(function(t){for(var e,i,n,r,a,s=0,o=t.byteLength,l=t.nalCount,u=new Uint8Array(o+4*l),h=new DataView(u.buffer),c=0;c<t.length;c++)for(n=t[c],e=0;e<n.length;e++)for(r=n[e],i=0;i<r.length;i++)a=r[i],h.setUint32(s,a.data.byteLength),u.set(a.data,s+=4),s+=a.data.byteLength;return u}(e)),s.baseMediaDecodeTime=O(s,a.keepOriginalTimestamps),this.trigger("processedGopsInfo",e.map(function(t){return{pts:t.pts,dts:t.dts,byteLength:t.byteLength}})),i=e[0],n=e[e.length-1],this.trigger("segmentTimingInfo",ee(s.baseMediaDecodeTime,i.dts,i.pts,n.dts+n.duration,n.pts+n.duration,r)),this.trigger("timingInfo",{start:e[0].pts,end:e[e.length-1].pts+e[e.length-1].duration}),this.gopCache_.unshift({gop:e.pop(),pps:s.pps,sps:s.sps}),this.gopCache_.length=Math.min(6,this.gopCache_.length),l=[],this.trigger("baseMediaDecodeTime",s.baseMediaDecodeTime),this.trigger("timelineStartInfo",s.timelineStartInfo),r=ot(o,[s]),e=new Uint8Array(r.byteLength+t.byteLength),o++,e.set(r),e.set(t,r.byteLength),this.trigger("data",{track:s,boxes:e}),this.resetStream_(),this.trigger("done","VideoSegmentStream")},this.reset=function(){this.resetStream_(),l=[],this.gopCache_.length=0,u.length=0,this.trigger("reset")},this.resetStream_=function(){D(s),i=e=void 0},this.getGopForFusion_=function(t){for(var e,i,n,r=1/0,a=0;a<this.gopCache_.length;a++)i=(n=this.gopCache_[a]).gop,s.pps&&te(s.pps[0],n.pps[0])&&s.sps&&te(s.sps[0],n.sps[0])&&(i.dts<s.timelineStartInfo.dts||-1e4<=(i=t.dts-i.dts-i.duration)&&i<=45e3&&(!e||i<r)&&(e=n,r=i));return e?e.gop:null},this.alignGopsAtStart_=function(t){for(var e,i,n,r,a=t.byteLength,s=t.nalCount,o=t.duration,l=e=0;l<u.length&&e<t.length&&(i=u[l],n=t[e],i.pts!==n.pts);)n.pts>i.pts?l++:(e++,a-=n.byteLength,s-=n.nalCount,o-=n.duration);return 0===e?t:e===t.length?null:((r=t.slice(e)).byteLength=a,r.duration=o,r.nalCount=s,r.pts=r[0].pts,r.dts=r[0].dts,r)},this.alignGopsAtEnd_=function(t){for(var e,i,n=u.length-1,r=t.length-1,a=null,s=!1;0<=n&&0<=r;){if(e=u[n],i=t[r],e.pts===i.pts){s=!0;break}e.pts>i.pts?n--:(n===u.length-1&&(a=r),r--)}if(!s&&null===a)return null;if(0===(l=s?r:a))return t;var o=t.slice(l),l=o.reduce(function(t,e){return t.byteLength+=e.byteLength,t.duration+=e.duration,t.nalCount+=e.nalCount,t},{byteLength:0,duration:0,nalCount:0});return o.byteLength=l.byteLength,o.duration=l.duration,o.nalCount=l.nalCount,o.pts=o[0].pts,o.dts=o[0].dts,o},this.alignGopsWith=function(t){u=t}}).prototype=new m,(ae=function(t,e){this.numberOfTracks=0,this.metadataStream=e,void 0!==(t=t||{}).remux?this.remuxTracks=!!t.remux:this.remuxTracks=!0,"boolean"==typeof t.keepOriginalTimestamps?this.keepOriginalTimestamps=t.keepOriginalTimestamps:this.keepOriginalTimestamps=!1,this.pendingTracks=[],this.videoTrack=null,this.pendingBoxes=[],this.pendingCaptions=[],this.pendingMetadata=[],this.pendingBytes=0,this.emittedTracks=0,ae.prototype.init.call(this),this.push=function(t){return t.text?this.pendingCaptions.push(t):t.frames?this.pendingMetadata.push(t):(this.pendingTracks.push(t.track),this.pendingBytes+=t.boxes.byteLength,"video"===t.track.type&&(this.videoTrack=t.track,this.pendingBoxes.push(t.boxes)),void("audio"===t.track.type&&(this.audioTrack=t.track,this.pendingBoxes.unshift(t.boxes))))}}).prototype=new m,ae.prototype.flush=function(t){var e,i,n,r=0,a={captions:[],captionStreams:{},metadata:[],info:{}},s=0;if(this.pendingTracks.length<this.numberOfTracks){if("VideoSegmentStream"!==t&&"AudioSegmentStream"!==t)return;if(this.remuxTracks)return;if(0===this.pendingTracks.length)return this.emittedTracks++,void(this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0))}if(this.videoTrack?(s=this.videoTrack.timelineStartInfo.pts,le.forEach(function(t){a.info[t]=this.videoTrack[t]},this)):this.audioTrack&&(s=this.audioTrack.timelineStartInfo.pts,oe.forEach(function(t){a.info[t]=this.audioTrack[t]},this)),this.videoTrack||this.audioTrack){for(1===this.pendingTracks.length?a.type=this.pendingTracks[0].type:a.type="combined",this.emittedTracks+=this.pendingTracks.length,t=w(this.pendingTracks),a.initSegment=new Uint8Array(t.byteLength),a.initSegment.set(t),a.data=new Uint8Array(this.pendingBytes),n=0;n<this.pendingBoxes.length;n++)a.data.set(this.pendingBoxes[n],r),r+=this.pendingBoxes[n].byteLength;for(n=0;n<this.pendingCaptions.length;n++)(e=this.pendingCaptions[n]).startTime=k(e.startPts,s,this.keepOriginalTimestamps),e.endTime=k(e.endPts,s,this.keepOriginalTimestamps),a.captionStreams[e.stream]=!0,a.captions.push(e);for(n=0;n<this.pendingMetadata.length;n++)(i=this.pendingMetadata[n]).cueTime=k(i.pts,s,this.keepOriginalTimestamps),a.metadata.push(i);for(a.metadata.dispatchType=this.metadataStream.dispatchType,this.pendingTracks.length=0,this.videoTrack=null,this.pendingBoxes.length=0,this.pendingCaptions.length=0,this.pendingBytes=0,this.pendingMetadata.length=0,this.trigger("data",a),n=0;n<a.captions.length;n++)e=a.captions[n],this.trigger("caption",e);for(n=0;n<a.metadata.length;n++)i=a.metadata[n],this.trigger("id3Frame",i)}this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)},ae.prototype.setRemux=function(t){this.remuxTracks=t},(re=function(n){var r,a,s=this,i=!0;re.prototype.init.call(this),n=n||{},this.baseMediaDecodeTime=n.baseMediaDecodeTime||0,this.transmuxPipeline_={},this.setupAacPipeline=function(){var e={};(this.transmuxPipeline_=e).type="aac",e.metadataStream=new zt.MetadataStream,e.aacStream=new se,e.audioTimestampRolloverStream=new zt.TimestampRolloverStream("audio"),e.timedMetadataTimestampRolloverStream=new zt.TimestampRolloverStream("timed-metadata"),e.adtsStream=new Yt,e.coalesceStream=new ae(n,e.metadataStream),e.headOfPipeline=e.aacStream,e.aacStream.pipe(e.audioTimestampRolloverStream).pipe(e.adtsStream),e.aacStream.pipe(e.timedMetadataTimestampRolloverStream).pipe(e.metadataStream).pipe(e.coalesceStream),e.metadataStream.on("timestamp",function(t){e.aacStream.setTimestamp(t.timeStamp)}),e.aacStream.on("data",function(t){"timed-metadata"!==t.type&&"audio"!==t.type||e.audioSegmentStream||(a=a||{timelineStartInfo:{baseMediaDecodeTime:s.baseMediaDecodeTime},codec:"adts",type:"audio"},e.coalesceStream.numberOfTracks++,e.audioSegmentStream=new ne(a,n),e.audioSegmentStream.on("timingInfo",s.trigger.bind(s,"audioTimingInfo")),e.adtsStream.pipe(e.audioSegmentStream).pipe(e.coalesceStream),s.trigger("trackinfo",{hasAudio:!!a,hasVideo:!!r}))}),e.coalesceStream.on("data",this.trigger.bind(this,"data")),e.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setupTsPipeline=function(){var i={};(this.transmuxPipeline_=i).type="ts",i.metadataStream=new zt.MetadataStream,i.packetStream=new zt.TransportPacketStream,i.parseStream=new zt.TransportParseStream,i.elementaryStream=new zt.ElementaryStream,i.timestampRolloverStream=new zt.TimestampRolloverStream,i.adtsStream=new Yt,i.h264Stream=new ue,i.captionStream=new zt.CaptionStream(n),i.coalesceStream=new ae(n,i.metadataStream),i.headOfPipeline=i.packetStream,i.packetStream.pipe(i.parseStream).pipe(i.elementaryStream).pipe(i.timestampRolloverStream),i.timestampRolloverStream.pipe(i.h264Stream),i.timestampRolloverStream.pipe(i.adtsStream),i.timestampRolloverStream.pipe(i.metadataStream).pipe(i.coalesceStream),i.h264Stream.pipe(i.captionStream).pipe(i.coalesceStream),i.elementaryStream.on("data",function(t){var e;if("metadata"===t.type){for(e=t.tracks.length;e--;)r||"video"!==t.tracks[e].type?a||"audio"!==t.tracks[e].type||((a=t.tracks[e]).timelineStartInfo.baseMediaDecodeTime=s.baseMediaDecodeTime):(r=t.tracks[e]).timelineStartInfo.baseMediaDecodeTime=s.baseMediaDecodeTime;r&&!i.videoSegmentStream&&(i.coalesceStream.numberOfTracks++,i.videoSegmentStream=new ie(r,n),i.videoSegmentStream.on("timelineStartInfo",function(t){a&&!n.keepOriginalTimestamps&&(a.timelineStartInfo=t,i.audioSegmentStream.setEarliestDts(t.dts-s.baseMediaDecodeTime))}),i.videoSegmentStream.on("processedGopsInfo",s.trigger.bind(s,"gopInfo")),i.videoSegmentStream.on("segmentTimingInfo",s.trigger.bind(s,"videoSegmentTimingInfo")),i.videoSegmentStream.on("baseMediaDecodeTime",function(t){a&&i.audioSegmentStream.setVideoBaseMediaDecodeTime(t)}),i.videoSegmentStream.on("timingInfo",s.trigger.bind(s,"videoTimingInfo")),i.h264Stream.pipe(i.videoSegmentStream).pipe(i.coalesceStream)),a&&!i.audioSegmentStream&&(i.coalesceStream.numberOfTracks++,i.audioSegmentStream=new ne(a,n),i.audioSegmentStream.on("timingInfo",s.trigger.bind(s,"audioTimingInfo")),i.audioSegmentStream.on("segmentTimingInfo",s.trigger.bind(s,"audioSegmentTimingInfo")),i.adtsStream.pipe(i.audioSegmentStream).pipe(i.coalesceStream)),s.trigger("trackinfo",{hasAudio:!!a,hasVideo:!!r})}}),i.coalesceStream.on("data",this.trigger.bind(this,"data")),i.coalesceStream.on("id3Frame",function(t){t.dispatchType=i.metadataStream.dispatchType,s.trigger("id3Frame",t)}),i.coalesceStream.on("caption",this.trigger.bind(this,"caption")),i.coalesceStream.on("done",this.trigger.bind(this,"done"))},this.setBaseMediaDecodeTime=function(t){var e=this.transmuxPipeline_;n.keepOriginalTimestamps||(this.baseMediaDecodeTime=t),a&&(a.timelineStartInfo.dts=void 0,a.timelineStartInfo.pts=void 0,D(a),e.audioTimestampRolloverStream&&e.audioTimestampRolloverStream.discontinuity()),r&&(e.videoSegmentStream&&(e.videoSegmentStream.gopCache_=[]),r.timelineStartInfo.dts=void 0,r.timelineStartInfo.pts=void 0,D(r),e.captionStream.reset()),e.timestampRolloverStream&&e.timestampRolloverStream.discontinuity()},this.setAudioAppendStart=function(t){a&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(t)},this.setRemux=function(t){var e=this.transmuxPipeline_;n.remux=t,e&&e.coalesceStream&&e.coalesceStream.setRemux(t)},this.alignGopsWith=function(t){r&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(t)},this.push=function(t){var e;i&&((e=he(t))&&"aac"!==this.transmuxPipeline_.type?this.setupAacPipeline():e||"ts"===this.transmuxPipeline_.type||this.setupTsPipeline(),i=!1),this.transmuxPipeline_.headOfPipeline.push(t)},this.flush=function(){i=!0,this.transmuxPipeline_.headOfPipeline.flush()},this.endTimeline=function(){this.transmuxPipeline_.headOfPipeline.endTimeline()},this.reset=function(){this.transmuxPipeline_.headOfPipeline&&this.transmuxPipeline_.headOfPipeline.reset()},this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}}).prototype=new m;var pe=re,fe={Adts:Yt,h264:Ft},me=ht;function ge(o,l){var e,i,u,h=0,c=[],d=[],p=null,f=null,m=!0;l=l||{},ge.prototype.init.call(this),this.push=function(t){L(o,t),void 0===o.timelineStartInfo.dts&&(o.timelineStartInfo.dts=t.dts),"seq_parameter_set_rbsp"!==t.nalUnitType||e||(e=t.config,o.sps=[t.data],le.forEach(function(t){o[t]=e[t]},this)),"pic_parameter_set_rbsp"!==t.nalUnitType||i||(i=t.data,o.pps=[t.data]),c.push(t)},this.processNals_=function(t){var e;for(c=d.concat(c);c.length&&"access_unit_delimiter_rbsp"!==c[0].nalUnitType;)c.shift();if(0!==c.length){var i=T(c);if(i.length)if(d=i[i.length-1],t&&(i.pop(),i.duration-=d.duration,i.nalCount-=d.length,i.byteLength-=d.byteLength),i.length){if(this.trigger("timelineStartInfo",o.timelineStartInfo),m){if(!(u=x(i))[0][0].keyFrame){if(!(u=S(u))[0][0].keyFrame)return c=[].concat.apply([],i).concat(d),void(d=[]);(i=[].concat.apply([],u)).duration=u.duration}m=!1}for(null===p&&(p=i[0].pts,f=p),f+=i.duration,this.trigger("timingInfo",{start:p,end:f}),e=0;e<i.length;e++){var n=i[e];o.samples=(s=[],a=v(n,(a=void 0)||0),s.push(a),s);var r=b(function(t){for(var e,i=0,n=t.byteLength,r=t.length,a=new Uint8Array(n+4*r),s=new DataView(a.buffer),o=0;o<t.length;o++)e=t[o],s.setUint32(i,e.data.byteLength),a.set(e.data,i+=4),i+=e.data.byteLength;return a}(n));D(o),L(o,n),o.baseMediaDecodeTime=O(o,l.keepOriginalTimestamps);var a=ot(h,[o]);h++,o.initSegment=w([o]);var s=new Uint8Array(a.byteLength+r.byteLength);s.set(a),s.set(r,a.byteLength),this.trigger("data",{track:o,boxes:s,sequence:h,videoFrameDts:n.dts,videoFramePts:n.pts})}c=[]}else c=[]}},this.resetTimingAndConfig_=function(){i=e=void 0,f=p=null},this.partialFlush=function(){this.processNals_(!0),this.trigger("partialdone","VideoSegmentStream")},this.flush=function(){this.processNals_(!1),this.resetTimingAndConfig_(),this.trigger("done","VideoSegmentStream")},this.endTimeline=function(){this.flush(),this.trigger("endedtimeline","VideoSegmentStream")},this.reset=function(){this.resetTimingAndConfig_(),d=[],c=[],m=!0,this.trigger("reset")}}de.prototype=new m;var ve=de;function ye(t){return t.prototype=new m,t.prototype.init.call(t),t}function _e(e,i){e.on("data",i.trigger.bind(i,"data")),e.on("done",i.trigger.bind(i,"done")),e.on("partialdone",i.trigger.bind(i,"partialdone")),e.on("endedtimeline",i.trigger.bind(i,"endedtimeline")),e.on("audioTimingInfo",i.trigger.bind(i,"audioTimingInfo")),e.on("videoTimingInfo",i.trigger.bind(i,"videoTimingInfo")),e.on("trackinfo",i.trigger.bind(i,"trackinfo")),e.on("id3Frame",function(t){t.dispatchType=e.metadataStream.dispatchType,t.cueTime=ct(t.pts),i.trigger("id3Frame",t)}),e.on("caption",function(t){i.trigger("caption",t)})}function be(s){var o=null,l=!0;s=s||{},be.prototype.init.call(this),s.baseMediaDecodeTime=s.baseMediaDecodeTime||0,this.push=function(t){var e,i,n,r,a;l&&(!(e=Te(t))||o&&"aac"===o.type?e||o&&"ts"===o.type||(r=s,(a={type:"ts",tracks:{audio:null,video:null},packet:new zt.TransportPacketStream,parse:new zt.TransportParseStream,elementary:new zt.ElementaryStream,timestampRollover:new zt.TimestampRolloverStream,adts:new fe.Adts,h264:new fe.h264.H264Stream,captionStream:new zt.CaptionStream(r),metadataStream:new zt.MetadataStream}).headOfPipeline=a.packet,a.packet.pipe(a.parse).pipe(a.elementary).pipe(a.timestampRollover),a.timestampRollover.pipe(a.h264),a.h264.pipe(a.captionStream),a.timestampRollover.pipe(a.metadataStream),a.timestampRollover.pipe(a.adts),a.elementary.on("data",function(t){if("metadata"===t.type){for(var e=0;e<t.tracks.length;e++)a.tracks[t.tracks[e].type]||(a.tracks[t.tracks[e].type]=t.tracks[e],a.tracks[t.tracks[e].type].timelineStartInfo.baseMediaDecodeTime=r.baseMediaDecodeTime);a.tracks.video&&!a.videoSegmentStream&&(a.videoSegmentStream=new we(a.tracks.video,r),a.videoSegmentStream.on("timelineStartInfo",function(t){a.tracks.audio&&!r.keepOriginalTimestamps&&a.audioSegmentStream.setEarliestDts(t.dts-r.baseMediaDecodeTime)}),a.videoSegmentStream.on("timingInfo",a.trigger.bind(a,"videoTimingInfo")),a.videoSegmentStream.on("data",function(t){a.trigger("data",{type:"video",data:t})}),a.videoSegmentStream.on("done",a.trigger.bind(a,"done")),a.videoSegmentStream.on("partialdone",a.trigger.bind(a,"partialdone")),a.videoSegmentStream.on("endedtimeline",a.trigger.bind(a,"endedtimeline")),a.h264.pipe(a.videoSegmentStream)),a.tracks.audio&&!a.audioSegmentStream&&(a.audioSegmentStream=new ve(a.tracks.audio,r),a.audioSegmentStream.on("data",function(t){a.trigger("data",{type:"audio",data:t})}),a.audioSegmentStream.on("done",a.trigger.bind(a,"done")),a.audioSegmentStream.on("partialdone",a.trigger.bind(a,"partialdone")),a.audioSegmentStream.on("endedtimeline",a.trigger.bind(a,"endedtimeline")),a.audioSegmentStream.on("timingInfo",a.trigger.bind(a,"audioTimingInfo")),a.adts.pipe(a.audioSegmentStream)),a.trigger("trackinfo",{hasAudio:!!a.tracks.audio,hasVideo:!!a.tracks.video})}}),a.captionStream.on("data",function(t){var e=a.tracks.video&&a.tracks.video.timelineStartInfo.pts||0;t.startTime=k(t.startPts,e,r.keepOriginalTimestamps),t.endTime=k(t.endPts,e,r.keepOriginalTimestamps),a.trigger("caption",t)}),(a=ye(a)).metadataStream.on("data",a.trigger.bind(a,"id3Frame")),_e(o=a,this)):(i=s,(n={type:"aac",tracks:{audio:null},metadataStream:new zt.MetadataStream,aacStream:new se,audioRollover:new zt.TimestampRolloverStream("audio"),timedMetadataRollover:new zt.TimestampRolloverStream("timed-metadata"),adtsStream:new Yt(!0)}).headOfPipeline=n.aacStream,n.aacStream.pipe(n.audioRollover).pipe(n.adtsStream),n.aacStream.pipe(n.timedMetadataRollover).pipe(n.metadataStream),n.metadataStream.on("timestamp",function(t){n.aacStream.setTimestamp(t.timeStamp)}),n.aacStream.on("data",function(t){"timed-metadata"!==t.type&&"audio"!==t.type||n.audioSegmentStream||(n.tracks.audio=n.tracks.audio||{timelineStartInfo:{baseMediaDecodeTime:i.baseMediaDecodeTime},codec:"adts",type:"audio"},n.audioSegmentStream=new ve(n.tracks.audio,i),n.audioSegmentStream.on("data",function(t){n.trigger("data",{type:"audio",data:t})}),n.audioSegmentStream.on("partialdone",n.trigger.bind(n,"partialdone")),n.audioSegmentStream.on("done",n.trigger.bind(n,"done")),n.audioSegmentStream.on("endedtimeline",n.trigger.bind(n,"endedtimeline")),n.audioSegmentStream.on("timingInfo",n.trigger.bind(n,"audioTimingInfo")),n.adtsStream.pipe(n.audioSegmentStream),n.trigger("trackinfo",{hasAudio:!!n.tracks.audio,hasVideo:!!n.tracks.video}))}),(n=ye(n)).metadataStream.on("data",n.trigger.bind(n,"id3Frame")),_e(o=n,this)),l=!1),o.headOfPipeline.push(t)},this.flush=function(){o&&(l=!0,o.headOfPipeline.flush())},this.partialFlush=function(){o&&o.headOfPipeline.partialFlush()},this.endTimeline=function(){o&&o.headOfPipeline.endTimeline()},this.reset=function(){o&&o.headOfPipeline.reset()},this.setBaseMediaDecodeTime=function(t){s.keepOriginalTimestamps||(s.baseMediaDecodeTime=t),o&&(o.tracks.audio&&(o.tracks.audio.timelineStartInfo.dts=void 0,o.tracks.audio.timelineStartInfo.pts=void 0,D(o.tracks.audio),o.audioRollover&&o.audioRollover.discontinuity()),o.tracks.video&&(o.videoSegmentStream&&(o.videoSegmentStream.gopCache_=[]),o.tracks.video.timelineStartInfo.dts=void 0,o.tracks.video.timelineStartInfo.pts=void 0,D(o.tracks.video)),o.timestampRollover&&o.timestampRollover.discontinuity())},this.setRemux=function(t){s.remux=t,o&&o.coalesceStream&&o.coalesceStream.setRemux(t)},this.setAudioAppendStart=function(t){o&&o.tracks.audio&&o.audioSegmentStream&&o.audioSegmentStream.setAudioAppendStart(t)},this.alignGopsWith=function(t){}}ge.prototype=new m;var we=ge,Te=Qt;function xe(t,h){var i=Pe(t,["moof","traf"]),t=Pe(t,["mdat"]),c={},n=[];return t.forEach(function(t,e){e=i[e];n.push({mdat:t,traf:e})}),n.forEach(function(t){var e,i,n,r,a,s=t.mdat,o=t.traf,l=Pe(o,["tfhd"]),u=Me(l[0]),t=u.trackId,l=Pe(o,["tfdt"]),l=0<l.length?Oe(l[0]).baseMediaDecodeTime:0,o=Pe(o,["trun"]);h===t&&0<o.length&&(o=function(t,e,i){for(var n,r,a=new DataView(t.buffer,t.byteOffset,t.byteLength),s=[],o=0;o+4<t.length;o+=n)if(n=a.getUint32(o),o+=4,!(n<=0))switch(31&t[o]){case 6:var l=t.subarray(o+1,o+1+n),u=function(t,e){for(var i=t,n=0;n<e.length;n++){var r=e[n];if(i<r.size)return r;i-=r.size}return null}(o,e),l={nalUnitType:"sei_rbsp",size:n,data:l,escapedRBSP:Re(l),trackId:i};if(u)l.pts=u.pts,l.dts=u.dts,r=u;else{if(!r)break;l.pts=r.pts,l.dts=r.dts}s.push(l)}return s}(s,(e=l,i=u.defaultSampleDuration||0,n=u.defaultSampleSize||0,r=u.trackId,a=[],o.forEach(function(t){t=Le(t).samples;t.forEach(function(t){void 0===t.duration&&(t.duration=i),void 0===t.size&&(t.size=n),t.trackId=r,t.dts=e,void 0===t.compositionTimeOffset&&(t.compositionTimeOffset=0),t.pts=e+t.compositionTimeOffset,e+=t.duration}),a=a.concat(t)}),a),t),c[t]||(c[t]=[]),c[t]=c[t].concat(o))}),c}function Se(t){return"AudioSegmentStream"===t?"audio":"VideoSegmentStream"===t?"video":""}be.prototype=new m;function Ee(t){return t>>>0}function ke(t){return{isLeading:(12&t[0])>>>2,dependsOn:3&t[0],isDependedOn:(192&t[1])>>>6,hasRedundancy:(48&t[1])>>>4,paddingValue:(14&t[1])>>>1,isNonSyncSample:1&t[1],degradationPriority:t[2]<<8|t[3]}}function Ce(){var e,s,o,l,u,i,n=!1;this.isInitialized=function(){return n},this.init=function(t){e=new Ne,n=!0,i=!!t&&t.isPartial,e.on("data",function(t){t.startTime=t.startPts/l,t.endTime=t.endPts/l,u.captions.push(t),u.captionStreams[t.stream]=!0})},this.isNewInit=function(t,e){return!(t&&0===t.length||e&&"object"==typeof e&&0===Object.keys(e).length||o===t[0]&&l===e[o])},this.parse=function(t,e,i){var n,r;if(!this.isInitialized())return null;if(!e||!i)return null;if(this.isNewInit(e,i))o=e[0],l=i[o];else if(null===o||!l)return s.push(t),null;for(;0<s.length;){var a=s.shift();this.parse(a,e,i)}return null!==(r=l,r=null===(n=o)?null:{seiNals:xe(t,n)[n],timescale:r})&&r.seiNals?(this.pushNals(r.seiNals),this.flushStream(),u):null},this.pushNals=function(t){if(!this.isInitialized()||!t||0===t.length)return null;t.forEach(function(t){e.push(t)})},this.flushStream=function(){if(!this.isInitialized())return null;i?e.partialFlush():e.flush()},this.clearParsedCaptions=function(){u.captions=[],u.captionStreams={}},this.resetCaptionStream=function(){if(!this.isInitialized())return null;e.reset()},this.clearAllCaptions=function(){this.clearParsedCaptions(),this.resetCaptionStream()},this.reset=function(){s=[],l=o=null,u?this.clearParsedCaptions():u={captions:[],captionStreams:{}},this.resetCaptionStream()},this.reset()}var Ie=be,Ae=Ee,Pe=function t(e,i){var n,r,a,s,o=[];if(!i.length)return null;for(n=0;n<e.byteLength;)r=Ae(e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3]),a=e.subarray(n+4,n+8),s="",s+=String.fromCharCode(a[0]),s+=String.fromCharCode(a[1]),a=(s+=String.fromCharCode(a[2]))+String.fromCharCode(a[3]),r=1<r?n+r:e.byteLength,a===i[0]&&(1===i.length?o.push(e.subarray(n+8,r)):(a=t(e.subarray(n+8,r),i.slice(1))).length&&(o=o.concat(a))),n=r;return o},De=Ee,Oe=function(t){var e={version:t[0],flags:new Uint8Array(t.subarray(1,4)),baseMediaDecodeTime:De(t[4]<<24|t[5]<<16|t[6]<<8|t[7])};return 1===e.version&&(e.baseMediaDecodeTime*=Math.pow(2,32),e.baseMediaDecodeTime+=De(t[8]<<24|t[9]<<16|t[10]<<8|t[11])),e},Le=function(t){var e,i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),samples:[]},n=new DataView(t.buffer,t.byteOffset,t.byteLength),r=1&i.flags[2],a=4&i.flags[2],s=1&i.flags[1],o=2&i.flags[1],l=4&i.flags[1],u=8&i.flags[1],h=n.getUint32(4),c=8;for(r&&(i.dataOffset=n.getInt32(c),c+=4),a&&h&&(e={flags:ke(t.subarray(c,c+4))},c+=4,s&&(e.duration=n.getUint32(c),c+=4),o&&(e.size=n.getUint32(c),c+=4),u&&(1===i.version?e.compositionTimeOffset=n.getInt32(c):e.compositionTimeOffset=n.getUint32(c),c+=4),i.samples.push(e),h--);h--;)e={},s&&(e.duration=n.getUint32(c),c+=4),o&&(e.size=n.getUint32(c),c+=4),l&&(e.flags=ke(t.subarray(c,c+4)),c+=4),u&&(1===i.version?e.compositionTimeOffset=n.getInt32(c):e.compositionTimeOffset=n.getUint32(c),c+=4),i.samples.push(e);return i},Me=function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength),i={version:t[0],flags:new Uint8Array(t.subarray(1,4)),trackId:e.getUint32(4)},n=1&i.flags[2],r=2&i.flags[2],a=8&i.flags[2],s=16&i.flags[2],o=32&i.flags[2],l=65536&i.flags[0],u=131072&i.flags[0],t=8;return n&&(t+=4,i.baseDataOffset=e.getUint32(12),t+=4),r&&(i.sampleDescriptionIndex=e.getUint32(t),t+=4),a&&(i.defaultSampleDuration=e.getUint32(t),t+=4),s&&(i.defaultSampleSize=e.getUint32(t),t+=4),o&&(i.defaultSampleFlags=e.getUint32(t)),l&&(i.durationIsEmpty=!0),!n&&u&&(i.baseDataOffsetIsMoof=!0),i},Re=function(t){for(var e=t.byteLength,i=[],n=1;n<e-2;)0===t[n]&&0===t[n+1]&&3===t[n+2]?(i.push(n+2),n+=2):n++;if(0===i.length)return t;for(var r=e-i.length,a=new Uint8Array(r),s=0,n=0;n<r;s++,n++)s===i[0]&&(s++,i.shift()),a[n]=t[s];return a},Ne=Ct.CaptionStream,Be=((Ct=Fe.prototype).init=function(){var i,n,t;this.transmuxer&&this.transmuxer.dispose(),this.transmuxer=new(this.options.handlePartialData?Ie:pe)(this.options),this.options.handlePartialData?(n=this.self,(t=this.transmuxer).on("data",function(t){var e={data:t.data.track.initSegment.buffer,byteOffset:t.data.track.initSegment.byteOffset,byteLength:t.data.track.initSegment.byteLength},e={boxes:{data:t.data.boxes.buffer,byteOffset:t.data.boxes.byteOffset,byteLength:t.data.boxes.byteLength},initSegment:e,type:t.type,sequence:t.data.sequence};void 0!==t.data.videoFrameDts&&(e.videoFrameDtsTime=ct(t.data.videoFrameDts)),void 0!==t.data.videoFramePts&&(e.videoFramePtsTime=ct(t.data.videoFramePts)),n.postMessage({action:"data",segment:e},[e.boxes.data,e.initSegment.data])}),t.on("id3Frame",function(t){n.postMessage({action:"id3Frame",id3Frame:t})}),t.on("caption",function(t){n.postMessage({action:"caption",caption:t})}),t.on("done",function(t){n.postMessage({action:"done",type:Se(t)})}),t.on("partialdone",function(t){n.postMessage({action:"partialdone",type:Se(t)})}),t.on("endedsegment",function(t){n.postMessage({action:"endedSegment",type:Se(t)})}),t.on("trackinfo",function(t){n.postMessage({action:"trackinfo",trackInfo:t})}),t.on("audioTimingInfo",function(t){var e;null!==t.start?(e={start:ct(t.start)},t.end&&(e.end=ct(t.end)),n.postMessage({action:"audioTimingInfo",audioTimingInfo:e})):n.postMessage({action:"audioTimingInfo",audioTimingInfo:t})}),t.on("videoTimingInfo",function(t){var e={start:ct(t.start)};t.end&&(e.end=ct(t.end)),n.postMessage({action:"videoTimingInfo",videoTimingInfo:e})})):(i=this.self,(t=this.transmuxer).on("data",function(t){var e=t.initSegment;t.initSegment={data:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength};e=t.data;t.data=e.buffer,i.postMessage({action:"data",segment:t,byteOffset:e.byteOffset,byteLength:e.byteLength},[t.data])}),t.on("done",function(t){i.postMessage({action:"done"})}),t.on("gopInfo",function(t){i.postMessage({action:"gopInfo",gopInfo:t})}),t.on("videoSegmentTimingInfo",function(t){var e={start:{decode:ct(t.start.dts),presentation:ct(t.start.pts)},end:{decode:ct(t.end.dts),presentation:ct(t.end.pts)},baseMediaDecodeTime:ct(t.baseMediaDecodeTime)};t.prependedContentDuration&&(e.prependedContentDuration=ct(t.prependedContentDuration)),i.postMessage({action:"videoSegmentTimingInfo",videoSegmentTimingInfo:e})}),t.on("audioSegmentTimingInfo",function(t){var e={start:{decode:ct(t.start.dts),presentation:ct(t.start.pts)},end:{decode:ct(t.end.dts),presentation:ct(t.end.pts)},baseMediaDecodeTime:ct(t.baseMediaDecodeTime)};t.prependedContentDuration&&(e.prependedContentDuration=ct(t.prependedContentDuration)),i.postMessage({action:"audioSegmentTimingInfo",audioSegmentTimingInfo:e})}),t.on("id3Frame",function(t){i.postMessage({action:"id3Frame",id3Frame:t})}),t.on("caption",function(t){i.postMessage({action:"caption",caption:t})}),t.on("trackinfo",function(t){i.postMessage({action:"trackinfo",trackInfo:t})}),t.on("audioTimingInfo",function(t){i.postMessage({action:"audioTimingInfo",audioTimingInfo:{start:ct(t.start),end:ct(t.end)}})}),t.on("videoTimingInfo",function(t){i.postMessage({action:"videoTimingInfo",videoTimingInfo:{start:ct(t.start),end:ct(t.end)}})}))},Ct.pushMp4Captions=function(t){this.captionParser||(this.captionParser=new Ce,this.captionParser.init());var e=new Uint8Array(t.data,t.byteOffset,t.byteLength),t=this.captionParser.parse(e,t.trackIds,t.timescales);this.self.postMessage({action:"mp4Captions",captions:t&&t.captions||[],data:e.buffer},[e.buffer])},Ct.clearAllMp4Captions=function(){this.captionParser&&this.captionParser.clearAllCaptions()},Ct.clearParsedMp4Captions=function(){this.captionParser&&this.captionParser.clearParsedCaptions()},Ct.push=function(t){t=new Uint8Array(t.data,t.byteOffset,t.byteLength);this.transmuxer.push(t)},Ct.reset=function(){this.transmuxer.reset()},Ct.setTimestampOffset=function(t){t=t.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(E(t)))},Ct.setAudioAppendStart=function(t){this.transmuxer.setAudioAppendStart(Math.ceil(E(t.appendStart)))},Ct.setRemux=function(t){this.transmuxer.setRemux(t.remux)},Ct.flush=function(t){this.transmuxer.flush(),self.postMessage({action:"done",type:"transmuxed"})},Ct.partialFlush=function(t){this.transmuxer.partialFlush(),self.postMessage({action:"partialdone",type:"transmuxed"})},Ct.endTimeline=function(){this.transmuxer.endTimeline(),self.postMessage({action:"endedtimeline",type:"transmuxed"})},Ct.alignGopsWith=function(t){this.transmuxer.alignGopsWith(t.gopsToAlignWith.slice())},Fe);function Fe(t,e){this.options=e||{},this.self=t,this.init()}self.onmessage=function(t){"init"===t.data.action&&t.data.options?this.messageHandlers=new Be(self,t.data.options):(this.messageHandlers||(this.messageHandlers=new Be(self)),t.data&&t.data.action&&"init"!==t.data.action&&this.messageHandlers[t.data.action]&&this.messageHandlers[t.data.action](t.data))}}))),nu=2,ru=-101,au=-102,su=To("CodecUtils"),ou=To("PlaylistSelector"),lu=function(n){function t(t,e){var i=n.call(this)||this;if(!t)throw new TypeError("Initialization settings are required");if("function"!=typeof t.currentTime)throw new TypeError("No currentTime getter specified");if(!t.mediaSource)throw new TypeError("No MediaSource specified");return i.bandwidth=t.bandwidth,i.throughput={rate:0,count:0},i.roundTrip=NaN,i.resetStats_(),i.mediaIndex=null,i.hasPlayed_=t.hasPlayed,i.currentTime_=t.currentTime,i.seekable_=t.seekable,i.seeking_=t.seeking,i.duration_=t.duration,i.mediaSource_=t.mediaSource,i.vhs_=t.vhs,i.loaderType_=t.loaderType,i.currentMediaInfo_=void 0,i.startingMediaInfo_=void 0,i.segmentMetadataTrack_=t.segmentMetadataTrack,i.goalBufferLength_=t.goalBufferLength,i.sourceType_=t.sourceType,i.sourceUpdater_=t.sourceUpdater,i.inbandTextTracks_=t.inbandTextTracks,i.state_="INIT",i.handlePartialData_=t.handlePartialData,i.timelineChangeController_=t.timelineChangeController,i.shouldSaveSegmentTimingInfo_=!0,i.parse708captions_=t.parse708captions,i.checkBufferTimeout_=null,i.error_=void 0,i.currentTimeline_=-1,i.pendingSegment_=null,i.xhrOptions_=null,i.pendingSegments_=[],i.audioDisabled_=!1,i.isPendingTimestampOffset_=!1,i.gopBuffer_=[],i.timeMapping_=0,i.safeAppend_=11<=br.browser.IE_VERSION,i.appendInitSegment_={audio:!0,video:!0},i.playlistOfLastInitSegment_={audio:null,video:null},i.callQueue_=[],i.loadQueue_=[],i.metadataQueue_={id3:[],caption:[]},i.waitingOnRemove_=!1,i.quotaExceededErrorRetryTimeout_=null,i.activeInitSegmentId_=null,i.initSegments_={},i.cacheEncryptionKeys_=t.cacheEncryptionKeys,i.keyCache_={},i.decrypter_=t.decrypter,i.syncController_=t.syncController,i.syncPoint_={segmentIndex:0,time:0},i.transmuxer_=i.createTransmuxer_(),i.triggerSyncInfoUpdate_=function(){return i.trigger("syncinfoupdate")},i.syncController_.on("syncinfoupdate",i.triggerSyncInfoUpdate_),i.mediaSource_.addEventListener("sourceopen",function(){i.isEndOfStream_()||(i.ended_=!1)}),i.fetchAtBuffer_=!1,i.logger_=To("SegmentLoader["+i.loaderType_+"]"),Object.defineProperty(wr(i),"state",{get:function(){return this.state_},set:function(t){t!==this.state_&&(this.logger_(this.state_+" -> "+t),this.state_=t,this.trigger("statechange"))}}),i.sourceUpdater_.on("ready",function(){i.hasEnoughInfoToAppend_()&&i.processCallQueue_()}),"main"===i.loaderType_&&i.timelineChangeController_.on("pendingtimelinechange",function(){i.hasEnoughInfoToAppend_()&&i.processCallQueue_()}),"audio"===i.loaderType_&&i.timelineChangeController_.on("timelinechange",function(){i.hasEnoughInfoToLoad_()&&i.processLoadQueue_(),i.hasEnoughInfoToAppend_()&&i.processCallQueue_()}),i}Sr(t,n);var e=t.prototype;return e.createTransmuxer_=function(){return function(t){var e=new iu;e.currentTransmux=null,e.transmuxQueue=[];var i=e.terminate;return e.terminate=function(){return e.currentTransmux=null,e.transmuxQueue.length=0,i.call(e)},e.postMessage({action:"init",options:t}),e}({remux:!1,alignGopsAtEnd:this.safeAppend_,keepOriginalTimestamps:!0,handlePartialData:this.handlePartialData_,parse708captions:this.parse708captions_})},e.resetStats_=function(){this.mediaBytesTransferred=0,this.mediaRequests=0,this.mediaRequestsAborted=0,this.mediaRequestsTimedout=0,this.mediaRequestsErrored=0,this.mediaTransferDuration=0,this.mediaSecondsLoaded=0},e.dispose=function(){this.trigger("dispose"),this.state="DISPOSED",this.pause(),this.abort_(),this.transmuxer_&&this.transmuxer_.terminate(),this.resetStats_(),this.checkBufferTimeout_&&kr.clearTimeout(this.checkBufferTimeout_),this.syncController_&&this.triggerSyncInfoUpdate_&&this.syncController_.off("syncinfoupdate",this.triggerSyncInfoUpdate_),this.off()},e.setAudio=function(t){this.audioDisabled_=!t,t?this.appendInitSegment_.audio=!0:this.sourceUpdater_.removeAudio(0,this.duration_())},e.abort=function(){"WAITING"===this.state?(this.abort_(),this.state="READY",this.paused()||this.monitorBuffer_()):this.pendingSegment_&&(this.pendingSegment_=null)},e.abort_=function(){this.pendingSegment_&&this.pendingSegment_.abortRequests&&this.pendingSegment_.abortRequests(),this.pendingSegment_=null,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.timelineChangeController_.clearPendingTimelineChange(this.loaderType_),this.waitingOnRemove_=!1,kr.clearTimeout(this.quotaExceededErrorRetryTimeout_),this.quotaExceededErrorRetryTimeout_=null},e.checkForAbort_=function(t){return"APPENDING"!==this.state||this.pendingSegment_?!this.pendingSegment_||this.pendingSegment_.requestId!==t:(this.state="READY",!0)},e.error=function(t){return void 0!==t&&(this.logger_("error occurred:",t),this.error_=t),this.pendingSegment_=null,this.error_},e.endOfStream=function(){this.ended_=!0,this.transmuxer_&&Bl(this.transmuxer_),this.gopBuffer_.length=0,this.pause(),this.trigger("ended")},e.buffered_=function(){if(!this.sourceUpdater_||!this.startingMediaInfo_)return br.createTimeRanges();if("main"===this.loaderType_){var t=this.startingMediaInfo_,e=t.hasAudio,i=t.hasVideo,t=t.isMuxed;if(i&&e&&!this.audioDisabled_&&!t)return this.sourceUpdater_.buffered();if(i)return this.sourceUpdater_.videoBuffered()}return this.sourceUpdater_.audioBuffered()},e.initSegmentForMap=function(t,e){if(void 0===e&&(e=!1),!t)return null;var i=Jo(t),n=this.initSegments_[i];return e&&!n&&t.bytes&&(this.initSegments_[i]=n={resolvedUri:t.resolvedUri,byterange:t.byterange,bytes:t.bytes,tracks:t.tracks,timescales:t.timescales}),n||t},e.segmentKey=function(t,e){if(void 0===e&&(e=!1),!t)return null;var i=Zo(t),n=this.keyCache_[i];this.cacheEncryptionKeys_&&e&&!n&&t.bytes&&(this.keyCache_[i]=n={resolvedUri:t.resolvedUri,bytes:t.bytes});t={resolvedUri:(n||t).resolvedUri};return n&&(t.bytes=n.bytes),t},e.couldBeginLoading_=function(){return this.playlist_&&!this.paused()},e.load=function(){if(this.monitorBuffer_(),this.playlist_)return"INIT"===this.state&&this.couldBeginLoading_()?this.init_():void(!this.couldBeginLoading_()||"READY"!==this.state&&"INIT"!==this.state||(this.state="READY"))},e.init_=function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()},e.playlist=function(t,e){if(void 0===e&&(e={}),t){var i=this.playlist_,n=this.pendingSegment_;this.playlist_=t,this.xhrOptions_=e,"INIT"===this.state&&(t.syncInfo={mediaSequence:t.mediaSequence,time:0},"main"===this.loaderType_&&this.syncController_.setDateTimeMappingForStart(t));e=null;if(i&&(i.id?e=i.id:i.uri&&(e=i.uri)),this.logger_("playlist update ["+e+" => "+(t.id||t.uri)+"]"),this.trigger("syncinfoupdate"),"INIT"===this.state&&this.couldBeginLoading_())return this.init_();if(!i||i.uri!==t.uri)return null===this.mediaIndex&&!this.handlePartialData_||this.resyncLoader(),this.currentMediaInfo_=void 0,void this.trigger("playlistupdate");e=t.mediaSequence-i.mediaSequence;this.logger_("live window shift ["+e+"]"),null!==this.mediaIndex&&(this.mediaIndex-=e),n&&(n.mediaIndex-=e,0<=n.mediaIndex&&(n.segment=t.segments[n.mediaIndex])),this.syncController_.saveExpiredSegmentInfo(i,t)}},e.pause=function(){this.checkBufferTimeout_&&(kr.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)},e.paused=function(){return null===this.checkBufferTimeout_},e.resetEverything=function(t){this.ended_=!1,this.appendInitSegment_={audio:!0,video:!0},this.resetLoader(),this.remove(0,1/0,t),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"})},e.resetLoader=function(){this.fetchAtBuffer_=!1,this.resyncLoader()},e.resyncLoader=function(){this.transmuxer_&&Bl(this.transmuxer_),this.mediaIndex=null,this.syncPoint_=null,this.isPendingTimestampOffset_=!1,this.callQueue_=[],this.loadQueue_=[],this.metadataQueue_.id3=[],this.metadataQueue_.caption=[],this.abort(),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})},e.remove=function(o,t,e){if(void 0===e&&(e=function(){}),t===1/0&&(t=this.duration_()),this.sourceUpdater_&&this.startingMediaInfo_){var i,n=1,r=function(){0==--n&&e()};for(i in this.audioDisabled_||(n++,this.sourceUpdater_.removeAudio(o,t,r)),"main"===this.loaderType_&&(this.gopBuffer_=function(t,e,i){for(var n=Math.ceil(9e4*(o-i)),r=Math.ceil(9e4*(e-i)),i=t.slice(),a=t.length;a--&&!(t[a].pts<=r););if(-1===a)return i;for(var s=a+1;s--&&!(t[s].pts<=n););return s=Math.max(s,0),i.splice(s,a-s+1),i}(this.gopBuffer_,t,this.timeMapping_),n++,this.sourceUpdater_.removeVideo(o,t,r)),this.inbandTextTracks_)Pl(o,t,this.inbandTextTracks_[i]);Pl(o,t,this.segmentMetadataTrack_),r()}else this.logger_("skipping remove because no source updater or starting media info")},e.monitorBuffer_=function(){this.checkBufferTimeout_&&kr.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=kr.setTimeout(this.monitorBufferTick_.bind(this),1)},e.monitorBufferTick_=function(){"READY"===this.state&&this.fillBuffer_(),this.checkBufferTimeout_&&kr.clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=kr.setTimeout(this.monitorBufferTick_.bind(this),500)},e.fillBuffer_=function(){var t,e;this.sourceUpdater_.updating()||(this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_())),t=this.buffered_(),(e=this.checkBuffer_(t,this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_))&&(e.timestampOffset=Ll({segmentTimeline:e.timeline,currentTimeline:this.currentTimeline_,startOfSegment:e.startOfSegment,buffered:t,overrideCheck:this.isPendingTimestampOffset_}),this.isPendingTimestampOffset_=!1,"number"==typeof e.timestampOffset&&this.timelineChangeController_.pendingTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:e.timeline}),this.loadSegment_(e)))},e.isEndOfStream_=function(t,e){if(void 0===t&&(t=this.mediaIndex),!(e=void 0===e?this.playlist_:e)||!this.mediaSource_)return!1;t=t+1===e.segments.length;return e.endList&&"open"===this.mediaSource_.readyState&&t},e.checkBuffer_=function(t,e,i,n,r,a){var s=0;t.length&&(s=t.end(t.length-1));t=Math.max(0,s-r);if(!e.segments.length)return null;if(t>=this.goalBufferLength_())return null;if(!n&&1<=t)return null;var o,n=null,t=!1;null===a?(n=this.getSyncSegmentCandidate_(e),t=!0):null!==i?(o=(o=e.segments[i])&&o.end?o.end:s,n=i+1):o=this.fetchAtBuffer_?(n=(s=Kl.getMediaInfoForTime(e,s,a.segmentIndex,a.time)).mediaIndex,s.startTime):(n=(l=Kl.getMediaInfoForTime(e,r,a.segmentIndex,a.time)).mediaIndex,l.startTime);var l=this.generateSegmentInfo_(e,n,o,t);return!l||this.mediaSource_&&this.playlist_&&l.mediaIndex===this.playlist_.segments.length-1&&"ended"===this.mediaSource_.readyState&&!this.seeking_()?void 0:(this.logger_("checkBuffer_ returning "+l.uri,{segmentInfo:l,playlist:e,currentMediaIndex:i,nextMediaIndex:n,startOfSegment:o,isSyncRequest:t}),l)},e.getSyncSegmentCandidate_=function(t){var e=this;if(-1===this.currentTimeline_)return 0;var i=t.segments.map(function(t,e){return{timeline:t.timeline,segmentIndex:e}}).filter(function(t){return t.timeline===e.currentTimeline_});return i.length?i[Math.min(i.length-1,1)].segmentIndex:Math.max(t.segments.length-1,0)},e.generateSegmentInfo_=function(t,e,i,n){if(e<0||e>=t.segments.length)return null;var r,a,s=t.segments[e],o=this.sourceUpdater_.audioBuffered(),l=this.sourceUpdater_.videoBuffered();return o.length&&(r=o.end(o.length-1)-this.sourceUpdater_.audioTimestampOffset()),l.length&&(a=function(t,e,i){if(null==e||!t.length)return[];for(var n=Math.ceil(9e4*(e-i+3)),r=0;r<t.length&&!(t[r].pts>n);r++);return t.slice(r)}(this.gopBuffer_,this.currentTime_()-this.sourceUpdater_.videoTimestampOffset(),this.timeMapping_)),{requestId:"segment-loader-"+Math.random(),uri:s.resolvedUri,mediaIndex:e,isSyncRequest:n,startOfSegment:i,playlist:t,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:s.timeline,duration:s.duration,segment:s,byteLength:0,transmuxer:this.transmuxer_,audioAppendStart:r,gopsToAlignWith:a}},e.earlyAbortWhenNeeded_=function(t){var e,i,n,r,a,s,o,l,u,h,c,d,p;this.vhs_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH||Date.now()-(t.firstBytesReceivedAt||Date.now())<1e3||(e=this.currentTime_(),n=t.bandwidth,r=this.pendingSegment_.duration,i=Kl.estimateSegmentRequestTime(r,n,this.playlist_,t.bytesReceived),d=this.buffered_(),p=e,void 0===(t=this.vhs_.tech_.playbackRate())&&(t=1),i<=(t=((d.length?d.end(d.length-1):0)-p)/t-1)||(n={master:this.vhs_.playlists.master,currentTime:e,bandwidth:n,duration:this.duration_(),segmentDuration:r,timeUntilRebuffer:t,currentTimeline:this.currentTimeline_,syncController:this.syncController_},a=n.currentTime,s=n.bandwidth,o=n.duration,l=n.segmentDuration,u=n.timeUntilRebuffer,h=n.currentTimeline,c=n.syncController,El(r=(n=(r=!(r=(n=(r=n.master).playlists.filter(function(t){return!Kl.isIncompatible(t)})).filter(Kl.isEnabled)).length?n.filter(function(t){return!Kl.isDisabled(t)}):r).filter(Kl.hasAttribute.bind(null,"BANDWIDTH")).map(function(t){var e=c.getSyncPoint(t,o,h,a)?1:2;return{playlist:t,rebufferingImpact:Kl.estimateSegmentRequestTime(l,s,t)*e-u}})).filter(function(t){return t.rebufferingImpact<=0}),function(t,e){return kl(e.playlist,t.playlist)}),(n=r.length?r[0]:(El(n,function(t,e){return t.rebufferingImpact-e.rebufferingImpact}),n[0]||null))&&(i=i-t-n.rebufferingImpact,!n.playlist||n.playlist.uri===this.playlist_.uri||i<(t<=$l?1:.5)||(this.bandwidth=n.playlist.attributes.BANDWIDTH*eu.BANDWIDTH_VARIANCE+1,this.trigger("earlyabort")))))},e.handleAbort_=function(){this.mediaRequestsAborted+=1},e.handleProgress_=function(t,e){this.earlyAbortWhenNeeded_(e.stats),this.checkForAbort_(e.requestId)||this.trigger("progress")},e.handleTrackInfo_=function(t,e){this.earlyAbortWhenNeeded_(t.stats),this.checkForAbort_(t.requestId)||this.checkForIllegalMediaSwitch(e)||(function(t,e){if(!(!t&&!e||!t&&e||t&&!e)){if(t===e)return 1;var i=Object.keys(t).sort(),n=Object.keys(e).sort();if(i.length===n.length){for(var r=0;r<i.length;r++){var a=i[r];if(a!==n[r])return;if(t[a]!==e[a])return}return 1}}}(this.currentMediaInfo_,e=e||{})||(this.appendInitSegment_={audio:!0,video:!0},this.startingMediaInfo_=e,this.currentMediaInfo_=e,this.logger_("trackinfo update",e),this.trigger("trackinfo")),this.checkForAbort_(t.requestId)||(this.pendingSegment_.trackInfo=e,this.hasEnoughInfoToAppend_()&&this.processCallQueue_()))},e.handleTimingInfo_=function(t,e,i,n){var r;this.earlyAbortWhenNeeded_(t.stats),this.checkForAbort_(t.requestId)||((r=this.pendingSegment_)[t=Ol(e)]=r[t]||{},r[t][i]=n,this.logger_("timinginfo: "+e+" - "+i+" - "+n),this.hasEnoughInfoToAppend_()&&this.processCallQueue_())},e.handleCaptions_=function(t,e){var d,p,f=this;this.earlyAbortWhenNeeded_(t.stats),this.checkForAbort_(t.requestId)||(0!==e.length?this.pendingSegment_.hasAppendedData_?(d=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),p={},e.forEach(function(t){p[t.stream]=p[t.stream]||{startTime:1/0,captions:[],endTime:0};var e=p[t.stream];e.startTime=Math.min(e.startTime,t.startTime+d),e.endTime=Math.max(e.endTime,t.endTime+d),e.captions.push(t)}),Object.keys(p).forEach(function(t){var i,n,r,e,a,s,o=p[t],l=o.startTime,u=o.endTime,h=o.captions,c=f.inbandTextTracks_;f.logger_("adding cues from "+l+" -> "+u+" for "+t),e=c,a=f.vhs_.tech_,e[s=t]||(a.trigger({type:"usage",name:"vhs-608"}),a.trigger({type:"usage",name:"hls-608"}),o=a.textTracks().getTrackById(s),e[s]=o||a.addRemoteTextTrack({kind:"captions",id:s,label:s},!1).track),Pl(l,u,c[t]),n=(c={captionArray:h,inbandTextTracks:c,timestampOffset:d}).inbandTextTracks,r=c.timestampOffset,(c=c.captionArray)&&(i=kr.WebKitDataCue||kr.VTTCue,c.forEach(function(t){var e=t.stream;n[e].addCue(new i(t.startTime+r,t.endTime+r,t.text))}))}),this.transmuxer_&&this.transmuxer_.postMessage({action:"clearParsedMp4Captions"})):this.metadataQueue_.caption.push(this.handleCaptions_.bind(this,t,e)):this.logger_("SegmentLoader received no captions from a caption event"))},e.handleId3_=function(t,e,i){var n,r,a,s;this.earlyAbortWhenNeeded_(t.stats),this.checkForAbort_(t.requestId)||(this.pendingSegment_.hasAppendedData_?(n=null===this.sourceUpdater_.videoTimestampOffset()?this.sourceUpdater_.audioTimestampOffset():this.sourceUpdater_.videoTimestampOffset(),r=this.inbandTextTracks_,a=i,s=this.vhs_.tech_,r.metadataTrack_||(r.metadataTrack_=s.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,r.metadataTrack_.inBandMetadataTrackDispatchType=a),Al({inbandTextTracks:this.inbandTextTracks_,metadataArray:e,timestampOffset:n,videoDuration:this.duration_()})):this.metadataQueue_.id3.push(this.handleId3_.bind(this,t,e,i)))},e.processMetadataQueue_=function(){this.metadataQueue_.id3.forEach(function(t){return t()}),this.metadataQueue_.caption.forEach(function(t){return t()}),this.metadataQueue_.id3=[],this.metadataQueue_.caption=[]},e.processCallQueue_=function(){var t=this.callQueue_;this.callQueue_=[],t.forEach(function(t){return t()})},e.processLoadQueue_=function(){var t=this.loadQueue_;this.loadQueue_=[],t.forEach(function(t){return t()})},e.hasEnoughInfoToLoad_=function(){if("audio"!==this.loaderType_)return!0;var t=this.pendingSegment_;return!(!t||this.currentMediaInfo_&&Ml({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:t.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_}))},e.hasEnoughInfoToAppend_=function(){if(!this.sourceUpdater_.ready())return!1;if(this.waitingOnRemove_||this.quotaExceededErrorRetryTimeout_)return!1;var t=this.pendingSegment_;if(!t||!t.trackInfo)return!1;if(!this.handlePartialData_){var e=this.currentMediaInfo_,i=e.hasAudio,n=e.hasVideo,e=e.isMuxed;if(n&&!t.videoTimingInfo)return!1;if(i&&!this.audioDisabled_&&!e&&!t.audioTimingInfo)return!1}return!Ml({timelineChangeController:this.timelineChangeController_,currentTimeline:this.currentTimeline_,segmentTimeline:t.timeline,loaderType:this.loaderType_,audioDisabled:this.audioDisabled_})},e.handleData_=function(t,e){var i,n,r;this.earlyAbortWhenNeeded_(t.stats),this.checkForAbort_(t.requestId)||(!this.callQueue_.length&&this.hasEnoughInfoToAppend_()?(i=this.pendingSegment_,this.setTimeMapping_(i.timeline),this.updateMediaSecondsLoaded_(i.segment),"closed"!==this.mediaSource_.readyState&&(t.map&&(t.map=this.initSegmentForMap(t.map,!0),i.segment.map=t.map),t.key&&this.segmentKey(t.key,!0),i.isFmp4=t.isFmp4,i.timingInfo=i.timingInfo||{},i.isFmp4?(this.trigger("fmp4"),i.timingInfo.start=i[Ol(e.type)].start):((r="main"===this.loaderType_&&this.currentMediaInfo_.hasVideo)&&(n=this.handlePartialData_?e.videoFramePtsTime:i.videoTimingInfo.start),i.timingInfo.start=this.trueSegmentStart_({currentStart:i.timingInfo.start,playlist:i.playlist,mediaIndex:i.mediaIndex,currentVideoTimestampOffset:this.sourceUpdater_.videoTimestampOffset(),useVideoTimingInfo:r,firstVideoFrameTimeForData:n,videoTimingInfo:i.videoTimingInfo,audioTimingInfo:i.audioTimingInfo})),this.updateAppendInitSegmentStatus(i,e.type),this.updateSourceBufferTimestampOffset_(i),i.hasAppendedData_=!0,this.processMetadataQueue_(),this.appendData_(i,e))):this.callQueue_.push(this.handleData_.bind(this,t,e)))},e.updateAppendInitSegmentStatus=function(t,e){"main"!==this.loaderType_||"number"!=typeof t.timestampOffset||t.changedTimestampOffset||(this.appendInitSegment_={audio:!0,video:!0}),this.playlistOfLastInitSegment_[e]!==t.playlist&&(this.appendInitSegment_[e]=!0)},e.getInitSegmentAndUpdateState_=function(t){var e=t.type,i=t.initSegment,n=t.map,r=t.playlist;if(n){t=Jo(n);if(this.activeInitSegmentId_===t)return null;i=this.initSegmentForMap(n,!0).bytes,this.activeInitSegmentId_=t}return i&&this.appendInitSegment_[e]?(this.playlistOfLastInitSegment_[e]=r,this.appendInitSegment_[e]=!!n,this.activeInitSegmentId_=null,i):null},e.handleQuotaExceededError_=function(t,e){var i=this,n=t.segmentInfo,r=t.type,a=t.bytes,s=this.sourceUpdater_.audioBuffered(),o=this.sourceUpdater_.videoBuffered();1<s.length&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the audio buffer: "+Ro(s).join(", ")),1<o.length&&this.logger_("On QUOTA_EXCEEDED_ERR, found gaps in the video buffer: "+Ro(o).join(", "));var l=s.length?s.start(0):0,u=s.length?s.end(s.length-1):0,h=o.length?o.start(0):0,t=o.length?o.end(o.length-1):0;if(u-l<=1&&t-h<=1)return this.logger_("On QUOTA_EXCEEDED_ERR, single segment too large to append to buffer, triggering an error. Appended byte length: "+a.byteLength+", audio buffer: "+Ro(s).join(", ")+", video buffer: "+Ro(o).join(", ")+", "),this.error({message:"Quota exceeded error with append of a single segment of content",blacklistDuration:1/0}),void this.trigger("error");this.waitingOnRemove_=!0,this.callQueue_.push(this.appendToSourceBuffer_.bind(this,{segmentInfo:n,type:r,bytes:a}));var c=this.currentTime_()-1;this.logger_("On QUOTA_EXCEEDED_ERR, removing video from 0 to "+c),this.sourceUpdater_.removeVideo(0,c,function(){i.logger_("On QUOTA_EXCEEDED_ERR, removing audio from 0 to "+c),i.sourceUpdater_.removeAudio(0,c,function(){i.logger_("On QUOTA_EXCEEDED_ERR, retrying append in 1s"),i.waitingOnRemove_=!1,i.quotaExceededErrorRetryTimeout_=kr.setTimeout(function(){i.logger_("On QUOTA_EXCEEDED_ERR, re-processing call queue"),i.quotaExceededErrorRetryTimeout_=null,i.processCallQueue_()},1e3)})})},e.handleAppendError_=function(t,e){var i=t.segmentInfo,n=t.type,t=t.bytes;e&&(22!==e.code?(this.logger_("Received non QUOTA_EXCEEDED_ERR on append",e),this.error(n+" append of "+t.length+"b failed for segment #"+i.mediaIndex+" in playlist "+i.playlist.id),this.trigger("appenderror")):this.handleQuotaExceededError_({segmentInfo:i,type:n,bytes:t}))},e.appendToSourceBuffer_=function(t){var e,i,n=t.segmentInfo,r=t.type,a=t.initSegment,s=t.data,o=t.bytes;o||(t=[s],s=s.byteLength,a&&(t.unshift(a),s+=a.byteLength),i=0,(t={bytes:s,segments:t}).bytes&&(e=new Uint8Array(t.bytes),t.segments.forEach(function(t){e.set(t,i),i+=t.byteLength})),o=e),this.sourceUpdater_.appendBuffer({segmentInfo:n,type:r,bytes:o},this.handleAppendError_.bind(this,{segmentInfo:n,type:r,bytes:o}))},e.handleSegmentTimingInfo_=function(t,e,i){this.pendingSegment_&&e===this.pendingSegment_.requestId&&((e=this.pendingSegment_.segment)[t=t+"TimingInfo"]||(e[t]={}),e[t].transmuxerPrependedSeconds=i.prependedContentDuration||0,e[t].transmuxedPresentationStart=i.start.presentation,e[t].transmuxedDecodeStart=i.start.decode,e[t].transmuxedPresentationEnd=i.end.presentation,e[t].transmuxedDecodeEnd=i.end.decode,e[t].baseMediaDecodeTime=i.baseMediaDecodeTime)},e.appendData_=function(t,e){var i=e.type,n=e.data;!n||!n.byteLength||"audio"===i&&this.audioDisabled_||(e=this.getInitSegmentAndUpdateState_({type:i,initSegment:e.initSegment,playlist:t.playlist,map:t.isFmp4?t.segment.map:null}),this.appendToSourceBuffer_({segmentInfo:t,type:i,initSegment:e,data:n}))},e.loadSegment_=function(e){var i=this;this.state="WAITING",this.pendingSegment_=e,this.trimBackBuffer_(e),"number"==typeof e.timestampOffset&&this.transmuxer_&&this.transmuxer_.postMessage({action:"clearAllMp4Captions"}),this.hasEnoughInfoToLoad_()?this.updateTransmuxerAndRequestSegment_(e):this.loadQueue_.push(function(){var t=i.buffered_();"number"==typeof e.timestampOffset&&(e.timestampOffset=Ll({segmentTimeline:e.timeline,currentTimeline:i.currentTimeline_,startOfSegment:e.startOfSegment,buffered:t,overrideCheck:!0})),delete e.audioAppendStart;t=i.sourceUpdater_.audioBuffered();t.length&&(e.audioAppendStart=t.end(t.length-1)-i.sourceUpdater_.audioTimestampOffset()),i.updateTransmuxerAndRequestSegment_(e)})},e.updateTransmuxerAndRequestSegment_=function(t){var e=this;this.shouldUpdateTransmuxerTimestampOffset_(t.timestampOffset)&&(this.gopBuffer_.length=0,t.gopsToAlignWith=[],this.timeMapping_=0,this.transmuxer_.postMessage({action:"reset"}),this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:t.timestampOffset}));var i=this.createSimplifiedSegmentObj_(t),n=this.isEndOfStream_(t.mediaIndex,t.playlist),r=null!==this.mediaIndex,a=t.timeline!==this.currentTimeline_&&0<t.timeline,a=n||r&&a;t.abortRequests=yl({xhr:this.vhs_.xhr,xhrOptions:this.xhrOptions_,decryptionWorker:this.decrypter_,segment:i,handlePartialData:this.handlePartialData_,abortFn:this.handleAbort_.bind(this),progressFn:this.handleProgress_.bind(this),trackInfoFn:this.handleTrackInfo_.bind(this),timingInfoFn:this.handleTimingInfo_.bind(this),videoSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"video",t.requestId),audioSegmentTimingInfoFn:this.handleSegmentTimingInfo_.bind(this,"audio",t.requestId),captionsFn:this.handleCaptions_.bind(this),isEndOfTimeline:a,endedTimelineFn:function(){e.logger_("received endedtimeline callback")},id3Fn:this.handleId3_.bind(this),dataFn:this.handleData_.bind(this),doneFn:this.segmentRequestFinished_.bind(this)})},e.trimBackBuffer_=function(t){var e,i,n,r=(e=this.seekable_(),i=this.currentTime_(),n=this.playlist_.targetDuration||10,r=i-eu.BACK_BUFFER_LENGTH,e.length&&(r=Math.max(r,e.start(0))),Math.min(i-n,r));0<r&&this.remove(0,r)},e.createSimplifiedSegmentObj_=function(t){var e=t.segment,i={resolvedUri:e.resolvedUri,byterange:e.byterange,requestId:t.requestId,transmuxer:t.transmuxer,audioAppendStart:t.audioAppendStart,gopsToAlignWith:t.gopsToAlignWith},n=t.playlist.segments[t.mediaIndex-1];return n&&n.timeline===e.timeline&&(n.videoTimingInfo?i.baseStartTime=n.videoTimingInfo.transmuxedDecodeEnd:n.audioTimingInfo&&(i.baseStartTime=n.audioTimingInfo.transmuxedDecodeEnd)),e.key&&(t=e.key.iv||new Uint32Array([0,0,0,t.mediaIndex+t.playlist.mediaSequence]),i.key=this.segmentKey(e.key),i.key.iv=t),e.map&&(i.map=this.initSegmentForMap(e.map)),i},e.saveTransferStats_=function(t){this.mediaRequests+=1,t&&(this.mediaBytesTransferred+=t.bytesReceived,this.mediaTransferDuration+=t.roundTripTime)},e.saveBandwidthRelatedStats_=function(t,e){this.pendingSegment_.byteLength=e.bytesReceived,t<1/60?this.logger_("Ignoring segment's bandwidth because its duration of "+t+" is less than the min to record "+1/60):(this.bandwidth=e.bandwidth,this.roundTrip=e.roundTripTime)},e.handleTimeout_=function(){this.mediaRequestsTimedout+=1,this.bandwidth=1,this.roundTrip=NaN,this.trigger("bandwidthupdate")},e.segmentRequestFinished_=function(t,e,i){if(this.callQueue_.length)this.callQueue_.push(this.segmentRequestFinished_.bind(this,t,e,i));else if(this.saveTransferStats_(e.stats),this.pendingSegment_&&e.requestId===this.pendingSegment_.requestId){if(t)return this.pendingSegment_=null,this.state="READY",t.code===au?void 0:(this.pause(),t.code===ru?void this.handleTimeout_():(this.mediaRequestsErrored+=1,this.error(t),void this.trigger("error")));t=this.pendingSegment_;this.saveBandwidthRelatedStats_(t.duration,e.stats),t.endOfAllRequests=e.endOfAllRequests,i.gopInfo&&(this.gopBuffer_=function(t,e,i){if(!e.length)return t;if(i)return e.slice();for(var n=e[0].pts,r=0;r<t.length&&!(t[r].pts>=n);r++);return t.slice(0,r).concat(e)}(this.gopBuffer_,i.gopInfo,this.safeAppend_)),this.state="APPENDING",this.trigger("appending"),this.waitForAppendsToComplete_(t)}},e.setTimeMapping_=function(t){t=this.syncController_.mappingForTimeline(t);null!==t&&(this.timeMapping_=t)},e.updateMediaSecondsLoaded_=function(t){"number"==typeof t.start&&"number"==typeof t.end?this.mediaSecondsLoaded+=t.end-t.start:this.mediaSecondsLoaded+=t.duration},e.shouldUpdateTransmuxerTimestampOffset_=function(t){return null!==t&&("main"===this.loaderType_&&t!==this.sourceUpdater_.videoTimestampOffset()||!this.audioDisabled_&&t!==this.sourceUpdater_.audioTimestampOffset())},e.trueSegmentStart_=function(t){var e=t.currentStart,i=t.playlist,n=t.mediaIndex,r=t.firstVideoFrameTimeForData,a=t.currentVideoTimestampOffset,s=t.useVideoTimingInfo,o=t.videoTimingInfo,t=t.audioTimingInfo;if(void 0!==e)return e;if(!s)return t.start;i=i.segments[n-1];return 0!==n&&i&&void 0!==i.start&&i.end===r+a?o.start:r},e.waitForAppendsToComplete_=function(t){if(!this.currentMediaInfo_)return this.error({message:"No starting media returned, likely due to an unsupported media format.",blacklistDuration:1/0}),void this.trigger("error");var e=this.currentMediaInfo_,i=e.hasAudio,n=e.hasVideo,e=e.isMuxed,n="main"===this.loaderType_&&n,e=!this.audioDisabled_&&i&&!e;if(t.waitingOnAppends=0,!t.hasAppendedData_)return t.timingInfo||"number"!=typeof t.timestampOffset||(this.isPendingTimestampOffset_=!0),t.timingInfo={start:0},t.waitingOnAppends++,this.isPendingTimestampOffset_||(this.updateSourceBufferTimestampOffset_(t),this.processMetadataQueue_()),void this.checkAppendsDone_(t);n&&t.waitingOnAppends++,e&&t.waitingOnAppends++,n&&this.sourceUpdater_.videoQueueCallback(this.checkAppendsDone_.bind(this,t)),e&&this.sourceUpdater_.audioQueueCallback(this.checkAppendsDone_.bind(this,t))},e.checkAppendsDone_=function(t){this.checkForAbort_(t.requestId)||(t.waitingOnAppends--,0===t.waitingOnAppends&&this.handleAppendsDone_())},e.checkForIllegalMediaSwitch=function(t){var e,i,t=(e=this.loaderType_,i=this.currentMediaInfo_,"main"===e&&i&&t?t.hasAudio||t.hasVideo?i.hasVideo&&!t.hasVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!i.hasVideo&&t.hasVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null:"Neither audio nor video found in segment.":null);return!!t&&(this.error({message:t,blacklistDuration:1/0}),this.trigger("error"),!0)},e.updateSourceBufferTimestampOffset_=function(t){var e;null===t.timestampOffset||"number"!=typeof t.timingInfo.start||t.changedTimestampOffset||"main"!==this.loaderType_||(e=!1,t.timestampOffset-=t.timingInfo.start,t.changedTimestampOffset=!0,t.timestampOffset!==this.sourceUpdater_.videoTimestampOffset()&&(this.sourceUpdater_.videoTimestampOffset(t.timestampOffset),e=!0),t.timestampOffset!==this.sourceUpdater_.audioTimestampOffset()&&(this.sourceUpdater_.audioTimestampOffset(t.timestampOffset),e=!0),e&&this.trigger("timestampoffset"))},e.updateTimingInfoEnd_=function(t){t.timingInfo=t.timingInfo||{};var e="main"===this.loaderType_&&this.currentMediaInfo_.hasVideo&&t.videoTimingInfo?t.videoTimingInfo:t.audioTimingInfo;e&&(t.timingInfo.end="number"==typeof e.end?e.end:e.start+t.duration)},e.handleAppendsDone_=function(){if(this.pendingSegment_&&this.trigger("appendsdone"),!this.pendingSegment_)return this.state="READY",void(this.paused()||this.monitorBuffer_());var t,e,i,n,r,a,s=this.pendingSegment_;this.updateTimingInfoEnd_(s),this.shouldSaveSegmentTimingInfo_&&this.syncController_.saveSegmentTimingInfo({segmentInfo:s,shouldSaveTimelineMapping:"main"===this.loaderType_}),this.logger_((t=s.segment,e=t.start,i=t.end,o=s.playlist,n=o.mediaSequence,r=o.id,a=o.segments,t=s.mediaIndex,o=s.timeline,["appending ["+t+"] of ["+n+", "+(n+(void 0===a?[]:a).length)+"] from playlist ["+r+"]","["+e+" => "+i+"] in timeline ["+o+"]"].join(" ")));var o=function(t,e){if("hls"!==e)return null;var i=function(t,e){t=t&&"number"==typeof t.start&&"number"==typeof t.end?t.end-t.start:0,e=e&&"number"==typeof e.start&&"number"==typeof e.end?e.end-e.start:0;return Math.max(t,e)}(t.audioTimingInfo,t.videoTimingInfo);if(!i)return null;var n=t.playlist.targetDuration,r=Rl({segmentDuration:i,maxDuration:2*n}),e=Rl({segmentDuration:i,maxDuration:n}),n="Segment with index "+t.mediaIndex+" from playlist "+t.playlist.id+" has a duration of "+i+" when the reported duration is "+t.duration+" and the target duration is "+n+". For HLS content, a duration in excess of the target duration may result in playback issues. See the HLS specification section on EXT-X-TARGETDURATION for more details: https://tools.ietf.org/html/draft-pantos-http-live-streaming-23#section-4.3.3.1";return r||e?{severity:r?"warn":"info",message:n}:null}(s,this.sourceType_);o&&("warn"===o.severity?br.log.warn(o.message):this.logger_(o.message)),this.recordThroughput_(s),this.pendingSegment_=null,this.state="READY",s.isSyncRequest?this.trigger("syncinfoupdate"):(this.addSegmentMetadataCue_(s),this.fetchAtBuffer_=!0,this.currentTimeline_!==s.timeline&&(this.timelineChangeController_.lastTimelineChange({type:this.loaderType_,from:this.currentTimeline_,to:s.timeline}),"main"!==this.loaderType_||this.audioDisabled_||this.timelineChangeController_.lastTimelineChange({type:"audio",from:this.currentTimeline_,to:s.timeline})),this.currentTimeline_=s.timeline,this.trigger("syncinfoupdate"),(o=s.segment).end&&this.currentTime_()-o.end>3*s.playlist.targetDuration?this.resetEverything():(null!==this.mediaIndex&&this.trigger("bandwidthupdate"),this.trigger("progress"),this.mediaIndex=s.mediaIndex,this.isEndOfStream_(s.mediaIndex,s.playlist)&&this.endOfStream(),this.trigger("appended"),this.paused()||this.monitorBuffer_()))},e.recordThroughput_=function(t){var e,i;t.duration<1/60?this.logger_("Ignoring segment's throughput because its duration of "+t.duration+" is less than the min to record "+1/60):(e=this.throughput.rate,i=Date.now()-t.endOfAllRequests+1,i=Math.floor(t.byteLength/i*8*1e3),this.throughput.rate+=(i-e)/++this.throughput.count)},e.addSegmentMetadataCue_=function(t){var e,i,n,r;this.segmentMetadataTrack_&&(i=(e=t.segment).start,r=e.end,Dl(i)&&Dl(r)&&(Pl(i,r,this.segmentMetadataTrack_),n=kr.WebKitDataCue||kr.VTTCue,t={custom:e.custom,dateTimeObject:e.dateTimeObject,dateTimeString:e.dateTimeString,bandwidth:t.playlist.attributes.BANDWIDTH,resolution:t.playlist.attributes.RESOLUTION,codecs:t.playlist.attributes.CODECS,byteLength:t.byteLength,uri:t.uri,timeline:t.timeline,playlist:t.playlist.id,start:i,end:r},(r=new n(i,r,JSON.stringify(t))).value=t,this.segmentMetadataTrack_.addCue(r)))},t}(br.EventTarget);function uu(){}function hu(t){return"string"!=typeof t?t:t.replace(/./,function(t){return t.toUpperCase()})}function cu(t,e){var i=e[t+"Buffer"];return i&&i.updating||e.queuePending[t]}function du(t,e){if(0!==e.queue.length){var i=0,n=e.queue[i];if("mediaSource"!==n.type){if("mediaSource"!==t&&e.ready()&&"closed"!==e.mediaSource.readyState&&!cu(t,e)){if(n.type!==t){if(null===(i=function(t,e){for(var i=0;i<e.length;i++){var n=e[i];if("mediaSource"===n.type)return null;if(n.type===t)return i}return null}(t,e.queue)))return;n=e.queue[i]}return e.queue.splice(i,1),(e.queuePending[t]=n).action(t,e),n.doneFn?void 0:(e.queuePending[t]=null,void du(t,e))}}else e.updating()||"closed"===e.mediaSource.readyState||(e.queue.shift(),n.action(e),n.doneFn&&n.doneFn(),du("audio",e),du("video",e))}}function pu(t,e){var i=e[t+"Buffer"],n=hu(t);i&&(i.removeEventListener("updateend",e["on"+n+"UpdateEnd_"]),i.removeEventListener("error",e["on"+n+"Error_"]),e.codecs[t]=null,e[t+"Buffer"]=null)}function fu(t,e){return t&&e&&-1!==Array.prototype.indexOf.call(t.sourceBuffers,e)}function mu(t){var e=t.type,i=t.sourceUpdater,n=t.action,r=t.doneFn,t=t.name;i.queue.push({type:e,action:n,doneFn:r,name:t}),du(e,i)}function gu(i,n){return function(t){var e;n.queuePending[i]&&(e=n.queuePending[i].doneFn,n.queuePending[i]=null,e&&e(n[i+"Error_"])),du(i,n)}}function vu(t){return decodeURIComponent(escape(String.fromCharCode.apply(null,t)))}function yu(t,e){t.abort(),t.pause(),e&&e.activePlaylistLoader&&(e.activePlaylistLoader.pause(),e.activePlaylistLoader=null)}function _u(t,e){(e.activePlaylistLoader=t).load()}function bu(n){["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(t){Bu[t](t,n)});var h=n.mediaTypes,t=n.masterPlaylistLoader,e=n.tech,i=n.vhs;["AUDIO","SUBTITLES"].forEach(function(t){var s,o,e,i,a,l,r,u;h[t].activeGroup=(r=t,u=n,function(e){var t=u.masterPlaylistLoader,i=u.mediaTypes[r].groups,n=t.media();if(!n)return null;t=null,t=(t=n.attributes[r]?i[n.attributes[r]]:t)||i.main;return void 0===e?t:null!==e&&t.filter(function(t){return t.id===e.id})[0]||null}),h[t].activeTrack=Fu[t](t,n),h[t].onGroupChanged=(a=t,l=n,function(){var t=l.segmentLoaders,e=t[a],i=t.main,n=l.mediaTypes[a],r=n.activeTrack(),t=n.activeGroup(r),r=n.activePlaylistLoader;yu(e,n),t&&(t.playlistLoader?(e.resyncLoader(),_u(t.playlistLoader,n)):r&&i.resetEverything())}),h[t].onGroupChanging=(e=t,i=n,function(){var t=i.segmentLoaders[e];t.abort(),t.pause()}),h[t].onTrackChanged=(s=t,o=n,function(){var t=o.segmentLoaders,e=t[s],i=t.main,n=o.mediaTypes[s],r=n.activeTrack(),a=n.activeGroup(r),t=n.activePlaylistLoader;if(yu(e,n),a){if("AUDIO"===s){if(!a.playlistLoader)return i.setAudio(!0),void i.resetEverything();e.setAudio(!0),i.setAudio(!1)}t!==a.playlistLoader&&(e.track&&e.track(r),e.resetEverything()),_u(a.playlistLoader,n)}})});var r,a=h.AUDIO.activeGroup();function s(){h.AUDIO.onTrackChanged(),e.trigger({type:"usage",name:"vhs-audio-change"}),e.trigger({type:"usage",name:"hls-audio-change"})}for(r in a&&(a=(a.filter(function(t){return t.default})[0]||a[0]).id,h.AUDIO.tracks[a].enabled=!0,h.AUDIO.onTrackChanged()),t.on("mediachange",function(){["AUDIO","SUBTITLES"].forEach(function(t){return h[t].onGroupChanged()})}),t.on("mediachanging",function(){["AUDIO","SUBTITLES"].forEach(function(t){return h[t].onGroupChanging()})}),e.audioTracks().addEventListener("change",s),e.remoteTextTracks().addEventListener("change",h.SUBTITLES.onTrackChanged),i.on("dispose",function(){e.audioTracks().removeEventListener("change",s),e.remoteTextTracks().removeEventListener("change",h.SUBTITLES.onTrackChanged)}),e.clearTracks("audio"),h.AUDIO.tracks)e.audioTracks().addTrack(h.AUDIO.tracks[r])}function wu(t,e,i){var n,r,a,s,o=t.masterPlaylistController_,l=o[(t.options_.smoothQualityChange?"smooth":"fast")+"QualityChange_"].bind(o);e.attributes.RESOLUTION&&(n=e.attributes.RESOLUTION,this.width=n.width,this.height=n.height),this.bandwidth=e.attributes.BANDWIDTH,this.codecs=Tl(o.master(),e),this.playlist=e,this.id=i,this.enabled=(r=t.playlists,a=e.id,s=l,function(t){var e=r.master.playlists[a],i=zo(e),n=Ho(e);return void 0===t?n:(t?delete e.disabled:e.disabled=!0,t===n||i||(s(),t?r.trigger("renditionenabled"):r.trigger("renditiondisabled")),t)})}function Tu(t){!function e(i,t){var n=0,r=0,a=br.mergeOptions(Hu,t);function s(){r&&i.currentTime(r)}function o(t){null!=t&&(r=i.duration()!==1/0&&i.currentTime()||0,i.one("loadedmetadata",s),i.src(t),i.trigger({type:"usage",name:"vhs-error-reload"}),i.trigger({type:"usage",name:"hls-error-reload"}),i.play())}function l(){return Date.now()-n<1e3*a.errorInterval?(i.trigger({type:"usage",name:"vhs-error-reload-canceled"}),void i.trigger({type:"usage",name:"hls-error-reload-canceled"})):a.getSource&&"function"==typeof a.getSource?(n=Date.now(),a.getSource.call(i,o)):void br.log.error("ERROR: reloadSourceOnError - The option getSource must be a function!")}function u(){i.off("loadedmetadata",s),i.off("error",l),i.off("dispose",u)}i.ready(function(){i.trigger({type:"usage",name:"vhs-error-reload-initialized"}),i.trigger({type:"usage",name:"hls-error-reload-initialized"})}),i.on("error",l),i.on("dispose",u),i.reloadSourceOnError=function(t){u(),e(i,t)}}(this,t)}function xu(n,r){return function(t,e){var i=e[t+"Buffer"];fu(e.mediaSource,i)&&(e.logger_("Removing "+n+" to "+r+" from "+t+"Buffer"),i.remove(n,r))}}function Su(n){return function(t,e){var i=e[t+"Buffer"];fu(e.mediaSource,i)&&(e.logger_("Setting "+t+"timestampOffset to "+n),i.timestampOffset=n)}}function Eu(i){return function(t,e){i()}}var ku,Cu=["video","audio"],Iu=function(i){function t(t){var e;return(e=i.call(this)||this).mediaSource=t,e.sourceopenListener_=function(){return du("mediaSource",wr(e))},e.mediaSource.addEventListener("sourceopen",e.sourceopenListener_),e.logger_=To("SourceUpdater"),e.audioTimestampOffset_=0,e.videoTimestampOffset_=0,e.queue=[],e.queuePending={audio:null,video:null},e.delayedAudioAppendQueue_=[],e.videoAppendQueued_=!1,e.codecs={},e.onVideoUpdateEnd_=gu("video",wr(e)),e.onAudioUpdateEnd_=gu("audio",wr(e)),e.onVideoError_=function(t){e.videoError_=t},e.onAudioError_=function(t){e.audioError_=t},e.createdSourceBuffers_=!1,e.initializedEme_=!1,e.triggeredReady_=!1,e}Sr(t,i);var e=t.prototype;return e.initializedEme=function(){this.initializedEme_=!0,this.triggerReady()},e.hasCreatedSourceBuffers=function(){return this.createdSourceBuffers_},e.hasInitializedAnyEme=function(){return this.initializedEme_},e.ready=function(){return this.hasCreatedSourceBuffers()&&this.hasInitializedAnyEme()},e.createSourceBuffers=function(t){this.hasCreatedSourceBuffers()||(this.addOrChangeSourceBuffers(t),this.createdSourceBuffers_=!0,this.trigger("createdsourcebuffers"),this.triggerReady())},e.triggerReady=function(){this.ready()&&!this.triggeredReady_&&(this.triggeredReady_=!0,this.trigger("ready"))},e.addSourceBuffer=function(t,e){var n,r;mu({type:"mediaSource",sourceUpdater:this,action:(n=t,r=e,function(t){var e=hu(n),i=yo(r);t.logger_("Adding "+n+"Buffer with codec "+r+" to mediaSource");i=t.mediaSource.addSourceBuffer(i);i.addEventListener("updateend",t["on"+e+"UpdateEnd_"]),i.addEventListener("error",t["on"+e+"Error_"]),t.codecs[n]=r,t[n+"Buffer"]=i}),name:"addSourceBuffer"})},e.abort=function(t){mu({type:t,sourceUpdater:this,action:function(t,e){if("open"===e.mediaSource.readyState){var i=e[t+"Buffer"];if(fu(e.mediaSource,i)){e.logger_("calling abort on "+t+"Buffer");try{i.abort()}catch(e){br.log.warn("Failed to abort on "+t+"Buffer",e)}}}},name:"abort"})},e.removeSourceBuffer=function(t){var i;this.canRemoveSourceBuffer()?mu({type:"mediaSource",sourceUpdater:this,action:(i=t,function(t){var e=t[i+"Buffer"];if(pu(i,t),fu(t.mediaSource,e)){t.logger_("Removing "+i+"Buffer with codec "+t.codecs[i]+" from mediaSource");try{t.mediaSource.removeSourceBuffer(e)}catch(t){br.log.warn("Failed to removeSourceBuffer "+i+"Buffer",t)}}}),name:"removeSourceBuffer"}):br.log.error("removeSourceBuffer is not supported!")},e.canRemoveSourceBuffer=function(){return!br.browser.IE_VERSION&&!br.browser.IS_FIREFOX&&kr.MediaSource&&kr.MediaSource.prototype&&"function"==typeof kr.MediaSource.prototype.removeSourceBuffer},t.canChangeType=function(){return kr.SourceBuffer&&kr.SourceBuffer.prototype&&"function"==typeof kr.SourceBuffer.prototype.changeType},e.canChangeType=function(){return this.constructor.canChangeType()},e.changeType=function(t,e){var r;this.canChangeType()?mu({type:t,sourceUpdater:this,action:(r=e,function(t,e){var i=e[t+"Buffer"],n=yo(r);fu(e.mediaSource,i)&&e.codecs[t]!==r&&(e.logger_("changing "+t+"Buffer codec from "+e.codecs[t]+" to "+r),i.changeType(n),e.codecs[t]=r)}),name:"changeType"}):br.log.error("changeType is not supported!")},e.addOrChangeSourceBuffers=function(i){var n=this;if(!i||"object"!=typeof i||0===Object.keys(i).length)throw new Error("Cannot addOrChangeSourceBuffers to undefined codecs");Object.keys(i).forEach(function(t){var e=i[t];if(!n.hasCreatedSourceBuffers())return n.addSourceBuffer(t,e);n.canChangeType()&&n.changeType(t,e)})},e.appendBuffer=function(t,e){var n,r,a,i=this,s=t.segmentInfo,o=t.type,l=t.bytes;if(this.processedAppend_=!0,"audio"===o&&this.videoBuffer&&!this.videoAppendQueued_)return this.delayedAudioAppendQueue_.push([t,e]),void this.logger_("delayed audio append of "+l.length+" until video append");mu({type:o,sourceUpdater:this,action:(n=l,r=s||{mediaIndex:-1},function(t,e){var i=e[t+"Buffer"];if(fu(e.mediaSource,i)){e.logger_("Appending segment "+r.mediaIndex+"'s "+n.length+" bytes to "+t+"Buffer");try{i.appendBuffer(n)}catch(i){e.logger_("Error with code "+i.code+" "+(22===i.code?"(QUOTA_EXCEEDED_ERR) ":"")+"when appending segment "+r.mediaIndex+" to "+t+"Buffer"),e.queuePending[t]=null,a(i)}}}),doneFn:a=e,name:"appendBuffer"}),"video"===o&&(this.videoAppendQueued_=!0,this.delayedAudioAppendQueue_.length&&(o=this.delayedAudioAppendQueue_.slice(),this.logger_("queuing delayed audio "+o.length+" appendBuffers"),this.delayedAudioAppendQueue_.length=0,o.forEach(function(t){i.appendBuffer.apply(i,t)})))},e.audioBuffered=function(){return fu(this.mediaSource,this.audioBuffer)&&this.audioBuffer.buffered?this.audioBuffer.buffered:br.createTimeRange()},e.videoBuffered=function(){return fu(this.mediaSource,this.videoBuffer)&&this.videoBuffer.buffered?this.videoBuffer.buffered:br.createTimeRange()},e.buffered=function(){var t=fu(this.mediaSource,this.videoBuffer)?this.videoBuffer:null,e=fu(this.mediaSource,this.audioBuffer)?this.audioBuffer:null;return e&&!t?this.audioBuffered():t&&!e?this.videoBuffered():function(t,e){var i=null,n=null,r=0,a=[],s=[];if(!(t&&t.length&&e&&e.length))return br.createTimeRange();for(var o=t.length;o--;)a.push({time:t.start(o),type:"start"}),a.push({time:t.end(o),type:"end"});for(o=e.length;o--;)a.push({time:e.start(o),type:"start"}),a.push({time:e.end(o),type:"end"});for(a.sort(function(t,e){return t.time-e.time}),o=0;o<a.length;o++)"start"===a[o].type?2==++r&&(i=a[o].time):"end"===a[o].type&&1==--r&&(n=a[o].time),null!==i&&null!==n&&(s.push([i,n]),n=i=null);return br.createTimeRanges(s)}(this.audioBuffered(),this.videoBuffered())},e.setDuration=function(t,e){var i;mu({type:"mediaSource",sourceUpdater:this,action:(i=t,function(t){t.logger_("Setting mediaSource duration to "+i);try{t.mediaSource.duration=i}catch(t){br.log.warn("Failed to set media source duration",t)}}),name:"duration",doneFn:e=void 0===e?uu:e})},e.endOfStream=function(t,e){var i;mu({type:"mediaSource",sourceUpdater:this,action:(i=t="string"!=typeof(t=void 0===t?null:t)?void 0:t,function(t){if("open"===t.mediaSource.readyState){t.logger_("Calling mediaSource endOfStream("+(i||"")+")");try{t.mediaSource.endOfStream(i)}catch(t){br.log.warn("Failed to call media source endOfStream",t)}}}),name:"endOfStream",doneFn:e=void 0===e?uu:e})},e.removeAudio=function(t,e,i){void 0===i&&(i=uu),this.audioBuffered().length&&0!==this.audioBuffered().end(0)?mu({type:"audio",sourceUpdater:this,action:xu(t,e),doneFn:i,name:"remove"}):i()},e.removeVideo=function(t,e,i){void 0===i&&(i=uu),this.videoBuffered().length&&0!==this.videoBuffered().end(0)?mu({type:"video",sourceUpdater:this,action:xu(t,e),doneFn:i,name:"remove"}):i()},e.updating=function(){return!(!cu("audio",this)&&!cu("video",this))},e.audioTimestampOffset=function(t){return void 0!==t&&this.audioBuffer&&this.audioTimestampOffset_!==t&&(mu({type:"audio",sourceUpdater:this,action:Su(t),name:"timestampOffset"}),this.audioTimestampOffset_=t),this.audioTimestampOffset_},e.videoTimestampOffset=function(t){return void 0!==t&&this.videoBuffer&&this.videoTimestampOffset!==t&&(mu({type:"video",sourceUpdater:this,action:Su(t),name:"timestampOffset"}),this.videoTimestampOffset_=t),this.videoTimestampOffset_},e.audioQueueCallback=function(t){this.audioBuffer&&mu({type:"audio",sourceUpdater:this,action:Eu(t),name:"callback"})},e.videoQueueCallback=function(t){this.videoBuffer&&mu({type:"video",sourceUpdater:this,action:Eu(t),name:"callback"})},e.dispose=function(){var e=this;this.trigger("dispose"),Cu.forEach(function(t){e.abort(t),e.canRemoveSourceBuffer()?e.removeSourceBuffer(t):e[t+"QueueCallback"](function(){return pu(t,e)})}),this.videoAppendQueued_=!1,this.delayedAudioAppendQueue_.length=0,this.sourceopenListener_&&this.mediaSource.removeEventListener("sourceopen",this.sourceopenListener_),this.off()},t}(br.EventTarget),Au=new Uint8Array("\n\n".split("").map(function(t){return t.charCodeAt(0)})),Pu=function(i){function t(t,e){return(e=i.call(this,t,e=void 0===e?{}:e)||this).handlePartialData_=!1,e.mediaSource_=null,e.subtitlesTrack_=null,e.loaderType_="subtitle",e.featuresNativeTextTracks_=t.featuresNativeTextTracks,e.shouldSaveSegmentTimingInfo_=!1,e}Sr(t,i);var e=t.prototype;return e.createTransmuxer_=function(){return null},e.buffered_=function(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues||!this.subtitlesTrack_.cues.length)return br.createTimeRanges();var t=this.subtitlesTrack_.cues,e=t[0].startTime,t=t[t.length-1].startTime;return br.createTimeRanges([[e,t]])},e.initSegmentForMap=function(t,e){if(void 0===e&&(e=!1),!t)return null;var i=Jo(t),n=this.initSegments_[i];return e&&!n&&t.bytes&&(e=Au.byteLength+t.bytes.byteLength,(e=new Uint8Array(e)).set(t.bytes),e.set(Au,t.bytes.byteLength),this.initSegments_[i]=n={resolvedUri:t.resolvedUri,byterange:t.byterange,bytes:e}),n||t},e.couldBeginLoading_=function(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()},e.init_=function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()},e.track=function(t){return void 0===t||(this.subtitlesTrack_=t,"INIT"===this.state&&this.couldBeginLoading_()&&this.init_()),this.subtitlesTrack_},e.remove=function(t,e){Pl(t,e,this.subtitlesTrack_)},e.fillBuffer_=function(){var t=this;this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_()));var e=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);if(e=this.skipEmptySegments_(e)){if(null===this.syncController_.timestampOffsetForTimeline(e.timeline))return this.syncController_.one("timestampoffset",function(){t.state="READY",t.paused()||t.monitorBuffer_()}),void(this.state="WAITING_ON_TIMELINE");this.loadSegment_(e)}},e.skipEmptySegments_=function(t){for(;t&&t.segment.empty;)t=this.generateSegmentInfo_(t.playlist,t.mediaIndex+1,t.startOfSegment+t.duration,t.isSyncRequest);return t},e.stopForError=function(t){this.error(t),this.state="READY",this.pause(),this.trigger("error")},e.segmentRequestFinished_=function(t,e,i){var n=this;if(this.subtitlesTrack_){if(this.saveTransferStats_(e.stats),!this.pendingSegment_)return this.state="READY",void(this.mediaRequestsAborted+=1);if(t)return t.code===ru&&this.handleTimeout_(),t.code===au?this.mediaRequestsAborted+=1:this.mediaRequestsErrored+=1,void this.stopForError(t);var r=this.pendingSegment_;this.saveBandwidthRelatedStats_(r.duration,e.stats),this.state="APPENDING",this.trigger("appending");var a=r.segment;if(a.map&&(a.map.bytes=e.map.bytes),r.bytes=e.bytes,"function"!=typeof kr.WebVTT&&this.subtitlesTrack_&&this.subtitlesTrack_.tech_){var s=function(){n.subtitlesTrack_.tech_.off("vttjsloaded",o),n.stopForError({message:"Error loading vtt.js"})},o=function(){n.subtitlesTrack_.tech_.off("vttjserror",s),n.segmentRequestFinished_(t,e,i)};return this.state="WAITING_ON_VTTJS",this.subtitlesTrack_.tech_.one("vttjsloaded",o),void this.subtitlesTrack_.tech_.one("vttjserror",s)}a.requested=!0;try{this.parseVTTCues_(r)}catch(t){return void this.stopForError({message:t.message})}if(this.updateTimeMapping_(r,this.syncController_.timelines[r.timeline],this.playlist_),r.cues.length?r.timingInfo={start:r.cues[0].startTime,end:r.cues[r.cues.length-1].endTime}:r.timingInfo={start:r.startOfSegment,end:r.startOfSegment+r.duration},r.isSyncRequest)return this.trigger("syncinfoupdate"),this.pendingSegment_=null,void(this.state="READY");r.byteLength=r.bytes.byteLength,this.mediaSecondsLoaded+=a.duration,r.cues.forEach(function(t){n.subtitlesTrack_.addCue(n.featuresNativeTextTracks_?new kr.VTTCue(t.startTime,t.endTime,t.text):t)}),function(e){var t=e.cues;if(t)for(var i=0;i<t.length;i++){for(var n=[],r=0,a=0;a<t.length;a++)t[i].startTime===t[a].startTime&&t[i].endTime===t[a].endTime&&t[i].text===t[a].text&&1<++r&&n.push(t[a]);n.length&&n.forEach(function(t){return e.removeCue(t)})}}(this.subtitlesTrack_),this.handleAppendsDone_()}else this.state="READY"},e.handleData_=function(){},e.updateTimingInfoEnd_=function(){},e.parseVTTCues_=function(e){var t=!1;"function"==typeof kr.TextDecoder?i=new kr.TextDecoder("utf8"):(i=kr.WebVTT.StringDecoder(),t=!0);var i=new kr.WebVTT.Parser(kr,kr.vttjs,i);e.cues=[],e.timestampmap={MPEGTS:0,LOCAL:0},i.oncue=e.cues.push.bind(e.cues),i.ontimestampmap=function(t){e.timestampmap=t},i.onparsingerror=function(t){br.log.warn("Error encountered when parsing cues: "+t.message)},e.segment.map&&(n=e.segment.map.bytes,t&&(n=vu(n)),i.parse(n));var n=e.bytes;t&&(n=vu(n)),i.parse(n),i.flush()},e.updateTimeMapping_=function(t,e,i){var n,r,a=t.segment;e&&(t.cues.length?(r=t.timestampmap,n=r.MPEGTS/9e4-r.LOCAL+e.mapping,t.cues.forEach(function(t){t.startTime+=n,t.endTime+=n}),i.syncInfo||(r=t.cues[0].startTime,e=t.cues[t.cues.length-1].startTime,i.syncInfo={mediaSequence:i.mediaSequence+t.mediaIndex,time:Math.min(r,e-a.duration)})):a.empty=!0)},t}(lu),Du=[{name:"VOD",run:function(t,e,i,n,r){return i===1/0?null:{time:0,segmentIndex:0}}},{name:"ProgramDateTime",run:function(t,e,i,n,r){if(!Object.keys(t.timelineToDatetimeMappings).length)return null;var a=e.segments||[],s=null,o=null;r=r||0;for(var l=0;l<a.length;l++){var u=a[l],h=t.timelineToDatetimeMappings[u.timeline];if(h&&u.dateTimeObject){u=u.dateTimeObject.getTime()/1e3+h,h=Math.abs(r-u);if(null!==o&&(0===h||o<h))break;o=h,s={time:u,segmentIndex:l}}}return s}},{name:"Segment",run:function(t,e,i,n,r){var a=e.segments||[],s=null,o=null;r=r||0;for(var l=0;l<a.length;l++){var u=a[l];if(u.timeline===n&&void 0!==u.start){var h=Math.abs(r-u.start);if(null!==o&&o<h)break;(!s||null===o||h<=o)&&(o=h,s={time:u.start,segmentIndex:l})}}return s}},{name:"Discontinuity",run:function(t,e,i,n,r){var a=null;if(r=r||0,e.discontinuityStarts&&e.discontinuityStarts.length)for(var s=null,o=0;o<e.discontinuityStarts.length;o++){var l=e.discontinuityStarts[o],u=e.discontinuitySequence+o+1,h=t.discontinuities[u];if(h){u=Math.abs(r-h.time);if(null!==s&&s<u)break;(!a||null===s||u<=s)&&(s=u,a={time:h.time,segmentIndex:l})}}return a}},{name:"Playlist",run:function(t,e,i,n,r){return e.syncInfo?{time:e.syncInfo.time,segmentIndex:e.syncInfo.mediaSequence-e.mediaSequence}:null}}],Ou=function(i){function t(t){var e;return(e=i.call(this)||this).timelines=[],e.discontinuities=[],e.timelineToDatetimeMappings={},e.logger_=To("SyncController"),e}Sr(t,i);var e=t.prototype;return e.getSyncPoint=function(t,e,i,n){i=this.runStrategies_(t,e,i,n);return i.length?this.selectSyncPoint_(i,{key:"time",value:n}):null},e.getExpiredTime=function(t,e){if(!t||!t.segments)return null;e=this.runStrategies_(t,e,t.discontinuitySequence,0);if(!e.length)return null;e=this.selectSyncPoint_(e,{key:"segmentIndex",value:0});return 0<e.segmentIndex&&(e.time*=-1),Math.abs(e.time+Fo(t,e.segmentIndex,0))},e.runStrategies_=function(t,e,i,n){for(var r=[],a=0;a<Du.length;a++){var s=Du[a],o=s.run(this,t,e,i,n);o&&(o.strategy=s.name,r.push({strategy:s.name,syncPoint:o}))}return r},e.selectSyncPoint_=function(t,e){for(var i=t[0].syncPoint,n=Math.abs(t[0].syncPoint[e.key]-e.value),r=t[0].strategy,a=1;a<t.length;a++){var s=Math.abs(t[a].syncPoint[e.key]-e.value);s<n&&(n=s,i=t[a].syncPoint,r=t[a].strategy)}return this.logger_("syncPoint for ["+e.key+": "+e.value+"] chosen with strategy ["+r+"]: [time:"+i.time+", segmentIndex:"+i.segmentIndex+"]"),i},e.saveExpiredSegmentInfo=function(t,e){for(var i=e.mediaSequence-t.mediaSequence-1;0<=i;i--){var n=t.segments[i];if(n&&void 0!==n.start){e.syncInfo={mediaSequence:t.mediaSequence+i,time:n.start},this.logger_("playlist refresh sync: [time:"+e.syncInfo.time+", mediaSequence: "+e.syncInfo.mediaSequence+"]"),this.trigger("syncinfoupdate");break}}},e.setDateTimeMappingForStart=function(t){var e;this.timelineToDatetimeMappings={},t.segments&&t.segments.length&&t.segments[0].dateTimeObject&&(t=(e=t.segments[0]).dateTimeObject.getTime()/1e3,this.timelineToDatetimeMappings[e.timeline]=-t)},e.saveSegmentTimingInfo=function(t){var e=t.segmentInfo,i=t.shouldSaveTimelineMapping,n=this.calculateSegmentTimeMapping_(e,e.timingInfo,i),t=e.segment;n&&(this.saveDiscontinuitySyncInfo_(e),e.playlist.syncInfo||(e.playlist.syncInfo={mediaSequence:e.playlist.mediaSequence+e.mediaIndex,time:t.start}));e=t.dateTimeObject;t.discontinuity&&i&&e&&(this.timelineToDatetimeMappings[t.timeline]=-e.getTime()/1e3)},e.timestampOffsetForTimeline=function(t){return void 0===this.timelines[t]?null:this.timelines[t].time},e.mappingForTimeline=function(t){return void 0===this.timelines[t]?null:this.timelines[t].mapping},e.calculateSegmentTimeMapping_=function(t,e,i){var n=t.segment,r=this.timelines[t.timeline];if("number"==typeof t.timestampOffset)r={time:t.startOfSegment,mapping:t.startOfSegment-e.start},i&&(this.timelines[t.timeline]=r,this.trigger("timestampoffset"),this.logger_("time mapping for timeline "+t.timeline+": [time: "+r.time+"] [mapping: "+r.mapping+"]")),n.start=t.startOfSegment,n.end=e.end+r.mapping;else{if(!r)return!1;n.start=e.start+r.mapping,n.end=e.end+r.mapping}return!0},e.saveDiscontinuitySyncInfo_=function(t){var e=t.playlist,i=t.segment;if(i.discontinuity)this.discontinuities[i.timeline]={time:i.start,accuracy:0};else if(e.discontinuityStarts&&e.discontinuityStarts.length)for(var n=0;n<e.discontinuityStarts.length;n++){var r,a=e.discontinuityStarts[n],s=e.discontinuitySequence+n+1,o=a-t.mediaIndex,l=Math.abs(o);(!this.discontinuities[s]||this.discontinuities[s].accuracy>l)&&(r=void 0,r=o<0?i.start-Fo(e,t.mediaIndex,a):i.end+Fo(e,t.mediaIndex+1,a),this.discontinuities[s]={time:r,accuracy:l})}},e.dispose=function(){this.trigger("dispose"),this.off()},t}(br.EventTarget),Lu=function(e){function t(){var t;return(t=e.call(this)||this).pendingTimelineChanges_={},t.lastTimelineChanges_={},t}Sr(t,e);var i=t.prototype;return i.clearPendingTimelineChange=function(t){this.pendingTimelineChanges_[t]=null,this.trigger("pendingtimelinechange")},i.pendingTimelineChange=function(t){var e=t.type,i=t.from,t=t.to;return"number"==typeof i&&"number"==typeof t&&(this.pendingTimelineChanges_[e]={type:e,from:i,to:t},this.trigger("pendingtimelinechange")),this.pendingTimelineChanges_[e]},i.lastTimelineChange=function(t){var e=t.type,i=t.from,t=t.to;return"number"==typeof i&&"number"==typeof t&&(this.lastTimelineChanges_[e]={type:e,from:i,to:t},delete this.pendingTimelineChanges_[e],this.trigger("timelinechange")),this.lastTimelineChanges_[e]},i.dispose=function(){this.trigger("dispose"),this.pendingTimelineChanges_={},this.lastTimelineChanges_={},this.off()},t}(br.EventTarget),Mu=ol(ll(ul(function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r=((n=e.prototype).on=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},n.off=function(t,e){if(!this.listeners[t])return!1;e=this.listeners[t].indexOf(e);return this.listeners[t]=this.listeners[t].slice(0),this.listeners[t].splice(e,1),-1<e},n.trigger=function(t,e){var i=this.listeners[t];if(i)if(2===arguments.length)for(var n=i.length,r=0;r<n;++r)i[r].call(this,e);else for(var a=Array.prototype.slice.call(arguments,1),s=i.length,o=0;o<s;++o)i[o].apply(this,a)},n.dispose=function(){this.listeners={}},n.pipe=function(e){this.on("data",function(t){e.push(t)})},e);function e(){this.listeners={}}function m(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24}var i,n,a,h=null,g=(o.prototype.decrypt=function(t,e,i,n,r,a){for(var s,o,l,u=this._key[1],h=t^u[0],c=n^u[1],d=i^u[2],p=e^u[3],f=u.length/4-2,m=4,e=this._tables[1],g=e[0],v=e[1],y=e[2],_=e[3],b=e[4],w=0;w<f;w++)s=g[h>>>24]^v[c>>16&255]^y[d>>8&255]^_[255&p]^u[m],o=g[c>>>24]^v[d>>16&255]^y[p>>8&255]^_[255&h]^u[m+1],l=g[d>>>24]^v[p>>16&255]^y[h>>8&255]^_[255&c]^u[m+2],p=g[p>>>24]^v[h>>16&255]^y[c>>8&255]^_[255&d]^u[m+3],m+=4,h=s,c=o,d=l;for(w=0;w<4;w++)r[(3&-w)+a]=b[h>>>24]<<24^b[c>>16&255]<<16^b[d>>8&255]<<8^b[255&p]^u[m++],s=h,h=c,c=d,d=p,p=s},o),l=function(e){function t(){var t;return(t=e.call(this,r)||this).jobs=[],t.delay=1,t.timeout_=null,t}var i;n=e,(i=t).prototype=Object.create(n.prototype),(i.prototype.constructor=i).__proto__=n;var n=t.prototype;return n.processJob_=function(){this.jobs.shift()(),this.jobs.length?this.timeout_=setTimeout(this.processJob_.bind(this),this.delay):this.timeout_=null},n.push=function(t){this.jobs.push(t),this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))},t}(r),s=(u.prototype.decryptChunk_=function(e,i,n,r){return function(){var t=function(t,e,i){for(var n,r,a,s,o=new Int32Array(t.buffer,t.byteOffset,t.byteLength>>2),l=new g(Array.prototype.slice.call(e)),t=new Uint8Array(t.byteLength),u=new Int32Array(t.buffer),h=i[0],c=i[1],d=i[2],p=i[3],f=0;f<o.length;f+=4)n=m(o[f]),r=m(o[f+1]),a=m(o[f+2]),s=m(o[f+3]),l.decrypt(n,r,a,s,u,f),u[f]=m(u[f]^h),u[f+1]=m(u[f+1]^c),u[f+2]=m(u[f+2]^d),u[f+3]=m(u[f+3]^p),h=n,c=r,d=a,p=s;return t}(e,i,n);r.set(t,e.byteOffset)}},i=u,a=[{key:"STEP",get:function(){return 32e3}}],(n=null)&&t(i.prototype,n),a&&t(i,a),u);function u(t,e,i,n){var r=u.STEP,a=new Int32Array(t.buffer),s=new Uint8Array(t.byteLength),o=0;for(this.asyncStream_=new l,this.asyncStream_.push(this.decryptChunk_(a.subarray(o,o+r),e,i,s)),o=r;o<a.length;o+=r)i=new Uint32Array([m(a[o-4]),m(a[o-3]),m(a[o-2]),m(a[o-1])]),this.asyncStream_.push(this.decryptChunk_(a.subarray(o,o+r),e,i,s));this.asyncStream_.push(function(){n(null,s.subarray(0,s.byteLength-s[s.byteLength-1]))})}function o(t){var e,i,n;h=h||function(){for(var t,e,i,n,r,a,s,o=[[[],[],[],[],[]],[[],[],[],[],[]]],l=o[0],u=o[1],h=l[4],c=u[4],d=[],p=[],f=0;f<256;f++)p[(d[f]=f<<1^283*(f>>7))^f]=f;for(t=e=0;!h[t];t^=i||1,e=p[e]||1)for(r=(r=e^e<<1^e<<2^e<<3^e<<4)>>8^255&r^99,s=16843009*d[n=d[i=d[c[h[t]=r]=t]]]^65537*n^257*i^16843008*t,a=257*d[r]^16843008*r,f=0;f<4;f++)l[f][t]=a=a<<24^a>>>8,u[f][r]=s=s<<24^s>>>8;for(f=0;f<5;f++)l[f]=l[f].slice(0),u[f]=u[f].slice(0);return o}(),this._tables=[[h[0][0].slice(),h[0][1].slice(),h[0][2].slice(),h[0][3].slice(),h[0][4].slice()],[h[1][0].slice(),h[1][1].slice(),h[1][2].slice(),h[1][3].slice(),h[1][4].slice()]];var r=this._tables[0][4],a=this._tables[1],s=t.length,o=1;if(4!==s&&6!==s&&8!==s)throw new Error("Invalid aes key size");var l=t.slice(0),u=[];for(this._key=[l,u],e=s;e<4*s+28;e++)n=l[e-1],(e%s==0||8===s&&e%s==4)&&(n=r[n>>>24]<<24^r[n>>16&255]<<16^r[n>>8&255]<<8^r[255&n],e%s==0&&(n=n<<8^n>>>24^o<<24,o=o<<1^283*(o>>7))),l[e]=l[e-s]^n;for(i=0;e;i++,e--)n=l[3&i?e:e-4],u[i]=e<=4||i<4?n:a[0][r[n>>>24]]^a[1][r[n>>16&255]]^a[2][r[n>>8&255]]^a[3][r[255&n]]}self.onmessage=function(t){var r=t.data,e=new Uint8Array(r.encrypted.bytes,r.encrypted.byteOffset,r.encrypted.byteLength),i=new Uint32Array(r.key.bytes,r.key.byteOffset,r.key.byteLength/4),t=new Uint32Array(r.iv.bytes,r.iv.byteOffset,r.iv.byteLength/4);new s(e,i,t,function(t,e){var i,n;self.postMessage((i={source:r.source,decrypted:e},n={},Object.keys(i).forEach(function(t){var e=i[t];ArrayBuffer.isView(e)?n[t]={bytes:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}:n[t]=e}),n),[e.buffer])})}}))),Ru={AUDIO:function(s,o){return function(){var t=o.segmentLoaders[s],e=o.mediaTypes[s],i=o.blacklistCurrentPlaylist;yu(t,e);var n=e.activeTrack(),t=e.activeGroup(),t=(t.filter(function(t){return t.default})[0]||t[0]).id,r=e.tracks[t];if(n!==r){for(var a in br.log.warn("Problem encountered loading the alternate audio track.Switching back to default."),e.tracks)e.tracks[a].enabled=e.tracks[a]===r;e.onTrackChanged()}else i({message:"Problem encountered loading the default audio track."})}},SUBTITLES:function(i,n){return function(){var t=n.segmentLoaders[i],e=n.mediaTypes[i];br.log.warn("Problem encountered loading the subtitle track.Disabling subtitle track."),yu(t,e);t=e.activeTrack();t&&(t.mode="disabled"),e.onTrackChanged()}}},Nu={AUDIO:function(t,e,i){var n,r,a;e&&(n=i.tech,r=i.requestOptions,a=i.segmentLoaders[t],e.on("loadedmetadata",function(){var t=e.media();a.playlist(t,r),(!n.paused()||t.endList&&"none"!==n.preload())&&a.load()}),e.on("loadedplaylist",function(){a.playlist(e.media(),r),n.paused()||a.load()}),e.on("error",Ru[t](t,i)))},SUBTITLES:function(t,e,i){var n=i.tech,r=i.requestOptions,a=i.segmentLoaders[t],s=i.mediaTypes[t];e.on("loadedmetadata",function(){var t=e.media();a.playlist(t,r),a.track(s.activeTrack()),(!n.paused()||t.endList&&"none"!==n.preload())&&a.load()}),e.on("loadedplaylist",function(){a.playlist(e.media(),r),n.paused()||a.load()}),e.on("error",Ru[t](t,i))}},Bu={AUDIO:function(s,o){var t,l=o.vhs,u=o.sourceType,e=o.segmentLoaders[s],h=o.requestOptions,i=o.master,c=i.mediaGroups,n=i.playlists,i=o.mediaTypes[s],d=i.groups,p=i.tracks,f=o.masterPlaylistLoader;function r(r){d[r]||(d[r]=[]);var t,a=n.filter(function(t){return t.attributes[s]===r});for(t in c[s][r])!function(t){var e=c[s][r][t];!a.filter(function(t){return t.resolvedUri!==e.resolvedUri}).length&&a.length&&delete e.resolvedUri;var i,n="vhs-json"===u&&e.playlists?new Xl(e.playlists[0],l,h):e.resolvedUri?new Xl(e.resolvedUri,l,h):e.playlists&&"dash"===u?new tu(e.playlists[0],l,h,f):null,e=br.mergeOptions({id:t,playlistLoader:n},e);Nu[s](s,e.playlistLoader,o),d[r].push(e),void 0===p[t]&&(n=new br.AudioTrack({id:t,kind:(n=(i=e).default?"main":"alternative",n=i.characteristics&&0<=i.characteristics.indexOf("public.accessibility.describes-video")?"main-desc":n),enabled:!1,language:e.language,default:e.default,label:t}),p[t]=n)}(t)}for(t in c[s]&&0!==Object.keys(c[s]).length||(c[s]={main:{default:{default:!0}}}),c[s])r(t);e.on("error",Ru[s](s,o))},SUBTITLES:function(t,e){var i,n=e.tech,r=e.vhs,a=e.sourceType,s=e.segmentLoaders[t],o=e.requestOptions,l=e.master.mediaGroups,u=e.mediaTypes[t],h=u.groups,c=u.tracks,d=e.masterPlaylistLoader;for(i in l[t])for(var p in h[i]||(h[i]=[]),l[t][i])if(!l[t][i][p].forced){var f=l[t][i][p],m=void 0;if("hls"===a)m=new Xl(f.resolvedUri,r,o);else if("dash"===a){if(!f.playlists.filter(function(t){return t.excludeUntil!==1/0}).length)return;m=new tu(f.playlists[0],r,o,d)}else"vhs-json"===a&&(m=new Xl(f.playlists?f.playlists[0]:f.resolvedUri,r,o));var f=br.mergeOptions({id:p,playlistLoader:m},f);Nu[t](t,f.playlistLoader,e),h[i].push(f),void 0===c[p]&&(f=n.addRemoteTextTrack({id:p,kind:"subtitles",default:f.default&&f.autoselect,language:f.language,label:p},!1).track,c[p]=f)}s.on("error",Ru[t](t,e))},"CLOSED-CAPTIONS":function(t,e){var i,n=e.tech,r=e.master.mediaGroups,e=e.mediaTypes[t],a=e.groups,s=e.tracks;for(i in r[t])for(var o in a[i]||(a[i]=[]),r[t][i]){var l=r[t][i][o];l.instreamId.match(/CC\d/)&&(a[i].push(br.mergeOptions({id:o},l)),void 0===s[o])&&(l=n.addRemoteTextTrack({id:l.instreamId,kind:"captions",default:l.default&&l.autoselect,language:l.language,label:o},!1).track,s[o]=l)}}},Fu={AUDIO:function(i,n){return function(){var t,e=n.mediaTypes[i].tracks;for(t in e)if(e[t].enabled)return e[t];return null}},SUBTITLES:function(i,n){return function(){var t,e=n.mediaTypes[i].tracks;for(t in e)if("showing"===e[t].mode||"hidden"===e[t].mode)return e[t];return null}}},Uu=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred"],ju=function(g){function t(t){var e,i=g.call(this)||this,n=t.src,r=t.handleManifestRedirects,a=t.withCredentials,s=t.tech,o=t.bandwidth,l=t.externVhs,u=t.useCueTags,h=t.blacklistDuration,c=t.enableLowInitialPlaylist,d=t.sourceType,p=t.cacheEncryptionKeys,f=t.handlePartialData,m=t.experimentalBufferBasedABR;if(!n)throw new Error("A non-empty playlist URL or JSON manifest string is required");ku=l,i.experimentalBufferBasedABR=Boolean(m),i.withCredentials=a,i.tech_=s,i.vhs_=s.vhs,i.sourceType_=d,i.useCueTags_=u,i.blacklistDuration=h,i.enableLowInitialPlaylist=c,i.useCueTags_&&(i.cueTagsTrack_=i.tech_.addTextTrack("metadata","ad-cues"),i.cueTagsTrack_.inBandMetadataTrackDispatchType=""),i.requestOptions_={withCredentials:a,handleManifestRedirects:r,timeout:null},i.on("error",i.pauseLoading),i.mediaTypes_=(e={},["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(t){e[t]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:uu,activeTrack:uu,onGroupChanged:uu,onTrackChanged:uu}}),e),i.mediaSource=new kr.MediaSource,i.handleDurationChange_=i.handleDurationChange_.bind(wr(i)),i.handleSourceOpen_=i.handleSourceOpen_.bind(wr(i)),i.handleSourceEnded_=i.handleSourceEnded_.bind(wr(i)),i.mediaSource.addEventListener("durationchange",i.handleDurationChange_),i.mediaSource.addEventListener("sourceopen",i.handleSourceOpen_),i.mediaSource.addEventListener("sourceended",i.handleSourceEnded_),i.seekable_=br.createTimeRanges(),i.hasPlayed_=!1,i.syncController_=new Ou(t),i.segmentMetadataTrack_=s.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track,i.decrypter_=new Mu,i.sourceUpdater_=new Iu(i.mediaSource),i.inbandTextTracks_={},i.timelineChangeController_=new Lu;f={vhs:i.vhs_,parse708captions:t.parse708captions,mediaSource:i.mediaSource,currentTime:i.tech_.currentTime.bind(i.tech_),seekable:function(){return i.seekable()},seeking:function(){return i.tech_.seeking()},duration:function(){return i.duration()},hasPlayed:function(){return i.hasPlayed_},goalBufferLength:function(){return i.goalBufferLength()},bandwidth:o,syncController:i.syncController_,decrypter:i.decrypter_,sourceType:i.sourceType_,inbandTextTracks:i.inbandTextTracks_,cacheEncryptionKeys:p,handlePartialData:f,sourceUpdater:i.sourceUpdater_,timelineChangeController:i.timelineChangeController_};return i.masterPlaylistLoader_=new("dash"===i.sourceType_?tu:Xl)(n,i.vhs_,i.requestOptions_),i.setupMasterPlaylistLoaderListeners_(),i.mainSegmentLoader_=new lu(br.mergeOptions(f,{segmentMetadataTrack:i.segmentMetadataTrack_,loaderType:"main"}),t),i.audioSegmentLoader_=new lu(br.mergeOptions(f,{loaderType:"audio"}),t),i.subtitleSegmentLoader_=new Pu(br.mergeOptions(f,{loaderType:"vtt",featuresNativeTextTracks:i.tech_.featuresNativeTextTracks}),t),i.setupSegmentLoaderListeners_(),i.experimentalBufferBasedABR&&(i.masterPlaylistLoader_.one("loadedplaylist",function(){return i.startABRTimer_()}),i.tech_.on("pause",function(){return i.stopABRTimer_()}),i.tech_.on("play",function(){return i.startABRTimer_()})),Uu.forEach(function(t){i[t+"_"]=function(t){return this.audioSegmentLoader_[t]+this.mainSegmentLoader_[t]}.bind(wr(i),t)}),i.logger_=To("MPC"),i.triggeredFmp4Usage=!1,"none"===i.tech_.preload()?(i.loadOnPlay_=function(){i.loadOnPlay_=null,i.masterPlaylistLoader_.load()},i.tech_.one("play",i.loadOnPlay_)):i.masterPlaylistLoader_.load(),i}Sr(t,g);var e=t.prototype;return e.checkABR_=function(){var t=this.selectPlaylist();this.shouldSwitchToMedia_(t)&&this.masterPlaylistLoader_.media(t)},e.startABRTimer_=function(){var t=this;this.stopABRTimer_(),this.abrTimer_=kr.setInterval(function(){return t.checkABR_()},250)},e.stopABRTimer_=function(){this.tech_.scrubbing&&this.tech_.scrubbing()||(kr.clearInterval(this.abrTimer_),this.abrTimer_=null)},e.setupMasterPlaylistLoaderListeners_=function(){var i=this;this.masterPlaylistLoader_.on("loadedmetadata",function(){var t=i.masterPlaylistLoader_.media(),e=1.5*t.targetDuration*1e3;Wo(i.masterPlaylistLoader_.master,i.masterPlaylistLoader_.media())?i.requestOptions_.timeout=0:i.requestOptions_.timeout=e,t.endList&&"none"!==i.tech_.preload()&&(i.mainSegmentLoader_.playlist(t,i.requestOptions_),i.mainSegmentLoader_.load()),bu({sourceType:i.sourceType_,segmentLoaders:{AUDIO:i.audioSegmentLoader_,SUBTITLES:i.subtitleSegmentLoader_,main:i.mainSegmentLoader_},tech:i.tech_,requestOptions:i.requestOptions_,masterPlaylistLoader:i.masterPlaylistLoader_,vhs:i.vhs_,master:i.master(),mediaTypes:i.mediaTypes_,blacklistCurrentPlaylist:i.blacklistCurrentPlaylist.bind(i)}),i.triggerPresenceUsage_(i.master(),t),i.setupFirstPlay(),!i.mediaTypes_.AUDIO.activePlaylistLoader||i.mediaTypes_.AUDIO.activePlaylistLoader.media()?i.trigger("selectedinitialmedia"):i.mediaTypes_.AUDIO.activePlaylistLoader.one("loadedmetadata",function(){i.trigger("selectedinitialmedia")})}),this.masterPlaylistLoader_.on("loadedplaylist",function(){i.loadOnPlay_&&i.tech_.off("play",i.loadOnPlay_);var t,e=i.masterPlaylistLoader_.media();if(!e){if(i.excludeUnsupportedVariants_(),!(t=(t=i.enableLowInitialPlaylist?i.selectInitialPlaylist():t)||i.selectPlaylist())||!i.shouldSwitchToMedia_(t))return;if(i.initialMedia_=t,i.masterPlaylistLoader_.media(i.initialMedia_),"vhs-json"!==i.sourceType_||!i.initialMedia_.segments)return;e=i.initialMedia_}i.handleUpdatedMediaPlaylist(e)}),this.masterPlaylistLoader_.on("error",function(){i.blacklistCurrentPlaylist(i.masterPlaylistLoader_.error)}),this.masterPlaylistLoader_.on("mediachanging",function(){i.mainSegmentLoader_.abort(),i.mainSegmentLoader_.pause()}),this.masterPlaylistLoader_.on("mediachange",function(){var t=i.masterPlaylistLoader_.media(),e=1.5*t.targetDuration*1e3;Wo(i.masterPlaylistLoader_.master,i.masterPlaylistLoader_.media())?i.requestOptions_.timeout=0:i.requestOptions_.timeout=e,i.mainSegmentLoader_.playlist(t,i.requestOptions_),i.mainSegmentLoader_.load(),i.tech_.trigger({type:"mediachange",bubbles:!0})}),this.masterPlaylistLoader_.on("playlistunchanged",function(){var t=i.masterPlaylistLoader_.media();"playlist-unchanged"!==t.lastExcludeReason_&&i.stuckAtPlaylistEnd_(t)&&(i.blacklistCurrentPlaylist({message:"Playlist no longer updating.",reason:"playlist-unchanged"}),i.tech_.trigger("playliststuck"))}),this.masterPlaylistLoader_.on("renditiondisabled",function(){i.tech_.trigger({type:"usage",name:"vhs-rendition-disabled"}),i.tech_.trigger({type:"usage",name:"hls-rendition-disabled"})}),this.masterPlaylistLoader_.on("renditionenabled",function(){i.tech_.trigger({type:"usage",name:"vhs-rendition-enabled"}),i.tech_.trigger({type:"usage",name:"hls-rendition-enabled"})})},e.handleUpdatedMediaPlaylist=function(t){this.useCueTags_&&this.updateAdCues_(t),this.mainSegmentLoader_.playlist(t,this.requestOptions_),this.updateDuration(!t.endList),this.tech_.paused()||(this.mainSegmentLoader_.load(),this.audioSegmentLoader_&&this.audioSegmentLoader_.load())},e.triggerPresenceUsage_=function(t,e){var i,n=t.mediaGroups||{},r=!0,t=Object.keys(n.AUDIO);for(i in n.AUDIO)for(var a in n.AUDIO[i])n.AUDIO[i][a].uri||(r=!1);r&&(this.tech_.trigger({type:"usage",name:"vhs-demuxed"}),this.tech_.trigger({type:"usage",name:"hls-demuxed"})),Object.keys(n.SUBTITLES).length&&(this.tech_.trigger({type:"usage",name:"vhs-webvtt"}),this.tech_.trigger({type:"usage",name:"hls-webvtt"})),ku.Playlist.isAes(e)&&(this.tech_.trigger({type:"usage",name:"vhs-aes"}),this.tech_.trigger({type:"usage",name:"hls-aes"})),t.length&&1<Object.keys(n.AUDIO[t[0]]).length&&(this.tech_.trigger({type:"usage",name:"vhs-alternate-audio"}),this.tech_.trigger({type:"usage",name:"hls-alternate-audio"})),this.useCueTags_&&(this.tech_.trigger({type:"usage",name:"vhs-playlist-cue-tags"}),this.tech_.trigger({type:"usage",name:"hls-playlist-cue-tags"}))},e.shouldSwitchToMedia_=function(t){var e=this.masterPlaylistLoader_.media(),i=this.tech_.buffered();return function(t){var e=t.currentPlaylist,i=t.nextPlaylist,n=t.forwardBuffer,r=t.bufferLowWaterLine,a=t.bufferHighWaterLine,s=t.duration,o=t.experimentalBufferBasedABR,l=t.log;if(!i)return br.log.warn("We received no playlist to switch to. Please check your stream."),!1;var u="allowing switch "+(e&&e.id||"null")+" -> "+i.id;if(!e||!e.endList)return l(u+" as current playlist "+(e?"is live":"is not set")),!0;if(i.id===e.id)return!1;t=o?eu.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE:eu.MAX_BUFFER_LOW_WATER_LINE;if(s<t)return l(u+" as duration < max low water line ("+s+" < "+t+")"),!0;t=i.attributes.BANDWIDTH,i=e.attributes.BANDWIDTH;if(t<i&&(!o||n<a)){e=u+" as next bandwidth < current bandwidth ("+t+" < "+i+")";return o&&(e+=" and forwardBuffer < bufferHighWaterLine ("+n+" < "+a+")"),l(e),!0}if((!o||i<t)&&r<=n){r=u+" as forwardBuffer >= bufferLowWaterLine ("+n+" >= "+r+")";return o&&(r+=" and next bandwidth > current bandwidth ("+t+" > "+i+")"),l(r),!0}return l("not "+u+" as no switching criteria met"),!1}({currentPlaylist:e,nextPlaylist:t,forwardBuffer:i.length?i.end(i.length-1)-this.tech_.currentTime():0,bufferLowWaterLine:this.bufferLowWaterLine(),bufferHighWaterLine:this.bufferHighWaterLine(),duration:this.duration(),experimentalBufferBasedABR:this.experimentalBufferBasedABR,log:this.logger_})},e.setupSegmentLoaderListeners_=function(){var e=this;function t(){if(!e.sourceUpdater_.hasCreatedSourceBuffers())return e.tryToCreateSourceBuffers_();var t=e.getCodecsOrExclude_();t&&e.sourceUpdater_.addOrChangeSourceBuffers(t)}this.experimentalBufferBasedABR||(this.mainSegmentLoader_.on("bandwidthupdate",function(){var t=e.selectPlaylist();e.shouldSwitchToMedia_(t)&&e.masterPlaylistLoader_.media(t),e.tech_.trigger("bandwidthupdate")}),this.mainSegmentLoader_.on("progress",function(){e.trigger("progress")})),this.mainSegmentLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.mainSegmentLoader_.error())}),this.mainSegmentLoader_.on("appenderror",function(){e.error=e.mainSegmentLoader_.error_,e.trigger("error")}),this.mainSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.mainSegmentLoader_.on("timestampoffset",function(){e.tech_.trigger({type:"usage",name:"vhs-timestamp-offset"}),e.tech_.trigger({type:"usage",name:"hls-timestamp-offset"})}),this.audioSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()}),this.audioSegmentLoader_.on("appenderror",function(){e.error=e.audioSegmentLoader_.error_,e.trigger("error")}),this.mainSegmentLoader_.on("ended",function(){e.logger_("main segment loader ended"),e.onEndOfStream()}),this.mainSegmentLoader_.on("earlyabort",function(t){e.experimentalBufferBasedABR||(e.delegateLoaders_("all",["abort"]),e.blacklistCurrentPlaylist({message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},120))}),this.mainSegmentLoader_.on("trackinfo",t),this.audioSegmentLoader_.on("trackinfo",t),this.mainSegmentLoader_.on("fmp4",function(){e.triggeredFmp4Usage||(e.tech_.trigger({type:"usage",name:"vhs-fmp4"}),e.tech_.trigger({type:"usage",name:"hls-fmp4"}),e.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("fmp4",function(){e.triggeredFmp4Usage||(e.tech_.trigger({type:"usage",name:"vhs-fmp4"}),e.tech_.trigger({type:"usage",name:"hls-fmp4"}),e.triggeredFmp4Usage=!0)}),this.audioSegmentLoader_.on("ended",function(){e.logger_("audioSegmentLoader ended"),e.onEndOfStream()})},e.mediaSecondsLoaded_=function(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)},e.load=function(){this.mainSegmentLoader_.load(),this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load(),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()},e.smoothQualityChange_=function(t){(t=void 0===t?this.selectPlaylist():t)!==this.masterPlaylistLoader_.media()&&(this.masterPlaylistLoader_.media(t),this.mainSegmentLoader_.resetLoader())},e.fastQualityChange_=function(t){var e=this;(t=void 0===t?this.selectPlaylist():t)!==this.masterPlaylistLoader_.media()?(this.masterPlaylistLoader_.media(t),this.mainSegmentLoader_.resetEverything(function(){br.browser.IE_VERSION||br.browser.IS_EDGE?e.tech_.setCurrentTime(e.tech_.currentTime()+.04):e.tech_.setCurrentTime(e.tech_.currentTime())})):this.logger_("skipping fastQualityChange because new media is same as old")},e.play=function(){if(!this.setupFirstPlay()){this.tech_.ended()&&this.tech_.setCurrentTime(0),this.hasPlayed_&&this.load();var t=this.tech_.seekable();return this.tech_.duration()===1/0&&this.tech_.currentTime()<t.start(0)?this.tech_.setCurrentTime(t.end(t.length-1)):void 0}},e.setupFirstPlay=function(){var t=this,e=this.masterPlaylistLoader_.media();if(!e||this.tech_.paused()||this.hasPlayed_)return!1;if(!e.endList){var i=this.seekable();if(!i.length)return!1;if(br.browser.IE_VERSION&&0===this.tech_.readyState())return this.tech_.one("loadedmetadata",function(){t.trigger("firstplay"),t.tech_.setCurrentTime(i.end(0)),t.hasPlayed_=!0}),!1;this.trigger("firstplay"),this.tech_.setCurrentTime(i.end(0))}return this.hasPlayed_=!0,this.load(),!0},e.handleSourceOpen_=function(){var t;this.tryToCreateSourceBuffers_(),this.tech_.autoplay()&&void 0!==(t=this.tech_.play())&&"function"==typeof t.then&&t.then(null,function(t){}),this.trigger("sourceopen")},e.handleSourceEnded_=function(){var t,e;!this.inbandTextTracks_.metadataTrack_||(t=this.inbandTextTracks_.metadataTrack_.cues)&&t.length&&(e=this.duration(),t[t.length-1].endTime=isNaN(e)||Math.abs(e)===1/0?Number.MAX_VALUE:e)},e.handleDurationChange_=function(){this.tech_.trigger("durationchange")},e.onEndOfStream=function(){var t=this.mainSegmentLoader_.ended_;(t=this.mediaTypes_.AUDIO.activePlaylistLoader?(this.mainSegmentLoader_.currentMediaInfo_&&!this.mainSegmentLoader_.currentMediaInfo_.hasVideo||t)&&this.audioSegmentLoader_.ended_:t)&&(this.stopABRTimer_(),this.sourceUpdater_.endOfStream())},e.stuckAtPlaylistEnd_=function(t){if(!this.seekable().length)return!1;var e=this.syncController_.getExpiredTime(t,this.duration());if(null===e)return!1;var i=ku.Playlist.playlistEnd(t,e),t=this.tech_.currentTime(),e=this.tech_.buffered();if(!e.length)return i-t<=.1;e=e.end(e.length-1);return e-t<=.1&&i-e<=.1},e.blacklistCurrentPlaylist=function(t,e){var i=(t=void 0===t?{}:t).playlist||this.masterPlaylistLoader_.media();if(e=e||t.blacklistDuration||this.blacklistDuration,!i)return this.error=t,void("open"!==this.mediaSource.readyState?this.trigger("error"):this.sourceUpdater_.endOfStream("network"));var n,r=this.masterPlaylistLoader_.master.playlists,a=r.filter(Ho),s=1===a.length&&a[0]===i;if(1===r.length&&e!==1/0)return br.log.warn("Problem encountered with playlist "+i.id+". Trying again since it is the only playlist."),this.tech_.trigger("retryplaylist"),this.masterPlaylistLoader_.load(s);s&&(n=!1,r.forEach(function(t){var e;t===i||void 0!==(e=t.excludeUntil)&&e!==1/0&&(n=!0,delete t.excludeUntil)}),n&&(br.log.warn("Removing other playlists from the exclusion list because the last rendition is about to be excluded."),this.tech_.trigger("retryplaylist"))),i.excludeUntil=Date.now()+1e3*e,t.reason&&(i.lastExcludeReason_=t.reason),this.tech_.trigger("blacklistplaylist"),this.tech_.trigger({type:"usage",name:"vhs-rendition-blacklisted"}),this.tech_.trigger({type:"usage",name:"hls-rendition-blacklisted"});a=this.selectPlaylist();if(!a)return this.error="Playback cannot continue. No available working or supported playlists.",void this.trigger("error");r=t.internal?this.logger_:br.log.warn,e=t.message?" "+t.message:"";r((t.internal?"Internal problem":"Problem")+" encountered with playlist "+i.id+"."+e+" Switching to playlist "+a.id+"."),a.attributes.AUDIO!==i.attributes.AUDIO&&this.delegateLoaders_("audio",["abort","pause"]),a.attributes.SUBTITLES!==i.attributes.SUBTITLES&&this.delegateLoaders_("subtitle",["abort","pause"]),this.delegateLoaders_("main",["abort","pause"]);e=a.targetDuration/2*1e3||5e3,e="number"==typeof a.lastRequest&&Date.now()-a.lastRequest<=e;return this.masterPlaylistLoader_.media(a,s||e)},e.pauseLoading=function(){this.delegateLoaders_("all",["abort","pause"]),this.stopABRTimer_()},e.delegateLoaders_=function(i,t){var n=this,r=[],e="all"===i;!e&&"main"!==i||r.push(this.masterPlaylistLoader_);var a=[];!e&&"audio"!==i||a.push("AUDIO"),!e&&"subtitle"!==i||(a.push("CLOSED-CAPTIONS"),a.push("SUBTITLES")),a.forEach(function(t){t=n.mediaTypes_[t]&&n.mediaTypes_[t].activePlaylistLoader;t&&r.push(t)}),["main","audio","subtitle"].forEach(function(t){var e=n[t+"SegmentLoader_"];!e||i!==t&&"all"!==i||r.push(e)}),r.forEach(function(e){return t.forEach(function(t){"function"==typeof e[t]&&e[t]()})})},e.setCurrentTime=function(t){var e=Oo(this.tech_.buffered(),t);return this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media()&&this.masterPlaylistLoader_.media().segments?e&&e.length?t:(this.mainSegmentLoader_.resetEverything(),this.mainSegmentLoader_.abort(),this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort()),this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort()),void this.load()):0},e.duration=function(){if(!this.masterPlaylistLoader_)return 0;var t=this.masterPlaylistLoader_.media();return t?t.endList?this.mediaSource?this.mediaSource.duration:ku.Playlist.duration(t):1/0:0},e.seekable=function(){return this.seekable_},e.onSyncInfoUpdate_=function(){var t;if(this.masterPlaylistLoader_){var e=this.masterPlaylistLoader_.media();if(e){var i=this.syncController_.getExpiredTime(e,this.duration());if(null!==i){var n,r,a=this.masterPlaylistLoader_.master.suggestedPresentationDelay,s=ku.Playlist.seekable(e,i,a);if(0!==s.length){if(this.mediaTypes_.AUDIO.activePlaylistLoader){if(e=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),null===(i=this.syncController_.getExpiredTime(e,this.duration())))return;if(0===(t=ku.Playlist.seekable(e,i,a)).length)return}this.seekable_&&this.seekable_.length&&(n=this.seekable_.end(0),r=this.seekable_.start(0)),!t||t.start(0)>s.end(0)||s.start(0)>t.end(0)?this.seekable_=s:this.seekable_=br.createTimeRanges([[(t.start(0)>s.start(0)?t:s).start(0),(t.end(0)<s.end(0)?t:s).end(0)]]),this.seekable_&&this.seekable_.length&&this.seekable_.end(0)===n&&this.seekable_.start(0)===r||(this.logger_("seekable updated ["+Mo(this.seekable_)+"]"),this.tech_.trigger("seekablechanged"))}}}}},e.updateDuration=function(t){if(this.updateDuration_&&(this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.updateDuration_=null),"open"!==this.mediaSource.readyState)return this.updateDuration_=this.updateDuration.bind(this,t),void this.mediaSource.addEventListener("sourceopen",this.updateDuration_);var e;t?(e=this.seekable()).length&&(isNaN(this.mediaSource.duration)||this.mediaSource.duration<e.end(e.length-1))&&this.sourceUpdater_.setDuration(e.end(e.length-1)):(t=this.tech_.buffered(),e=ku.Playlist.duration(this.masterPlaylistLoader_.media()),0<t.length&&(e=Math.max(e,t.end(t.length-1))),this.mediaSource.duration!==e&&this.sourceUpdater_.setDuration(e))},e.dispose=function(){var n=this;this.trigger("dispose"),this.decrypter_.terminate(),this.masterPlaylistLoader_.dispose(),this.mainSegmentLoader_.dispose(),this.loadOnPlay_&&this.tech_.off("play",this.loadOnPlay_),["AUDIO","SUBTITLES"].forEach(function(t){var e,i=n.mediaTypes_[t].groups;for(e in i)i[e].forEach(function(t){t.playlistLoader&&t.playlistLoader.dispose()})}),this.audioSegmentLoader_.dispose(),this.subtitleSegmentLoader_.dispose(),this.sourceUpdater_.dispose(),this.timelineChangeController_.dispose(),this.stopABRTimer_(),this.updateDuration_&&this.mediaSource.removeEventListener("sourceopen",this.updateDuration_),this.mediaSource.removeEventListener("durationchange",this.handleDurationChange_),this.mediaSource.removeEventListener("sourceopen",this.handleSourceOpen_),this.mediaSource.removeEventListener("sourceended",this.handleSourceEnded_),this.off()},e.master=function(){return this.masterPlaylistLoader_.master},e.media=function(){return this.masterPlaylistLoader_.media()||this.initialMedia_},e.areMediaTypesKnown_=function(){var t=!!this.mediaTypes_.AUDIO.activePlaylistLoader;return!(!this.mainSegmentLoader_.currentMediaInfo_||t&&!this.audioSegmentLoader_.currentMediaInfo_)},e.getCodecsOrExclude_=function(){var n=this,r={main:this.mainSegmentLoader_.currentMediaInfo_||{},audio:this.audioSegmentLoader_.currentMediaInfo_||{}};r.video=r.main;var t=Tl(this.master(),this.media()),a={},e=!!this.mediaTypes_.AUDIO.activePlaylistLoader;if(r.main.hasVideo&&(a.video=t.video||r.main.videoCodec||"avc1.4d400d"),r.main.isMuxed&&(a.video+=","+(t.audio||r.main.audioCodec||Hl)),(r.main.hasAudio&&!r.main.isMuxed||r.audio.hasAudio||e)&&(a.audio=t.audio||r.main.audioCodec||r.audio.audioCodec||Hl,r.audio.isFmp4=(r.main.hasAudio&&!r.main.isMuxed?r.main:r.audio).isFmp4),a.audio||a.video){var s,i,o={};if(["video","audio"].forEach(function(t){var e,i;a.hasOwnProperty(t)&&(e=r[t].isFmp4,i=a[t],!(e?_o:bo)(i))&&(i=r[t].isFmp4?"browser":"muxer",o[i]=o[i]||[],o[i].push(a[t]),"audio"===t&&(s=i))}),e&&s&&this.media().attributes.AUDIO&&(i=this.media().attributes.AUDIO,this.master().playlists.forEach(function(t){(t.attributes&&t.attributes.AUDIO)===i&&t!==n.media()&&(t.excludeUntil=1/0)}),this.logger_("excluding audio group "+i+" as "+s+' does not support codec(s): "'+a.audio+'"')),!Object.keys(o).length){if(this.sourceUpdater_.hasCreatedSourceBuffers()&&!this.sourceUpdater_.canChangeType()){var l=[];if(["video","audio"].forEach(function(t){var e=(go(n.sourceUpdater_.codecs[t]||"")[0]||{}).type,i=(go(a[t]||"")[0]||{}).type;e&&i&&e.toLowerCase()!==i.toLowerCase()&&l.push('"'+n.sourceUpdater_.codecs[t]+'" -> "'+a[t]+'"')}),l.length)return void this.blacklistCurrentPlaylist({playlist:this.media(),message:"Codec switching not supported: "+l.join(", ")+".",blacklistDuration:1/0,internal:!0})}return a}e=Object.keys(o).reduce(function(t,e){return t&&(t+=", "),t+(e+' does not support codec(s): "'+o[e].join(","))+'"'},"")+".";this.blacklistCurrentPlaylist({playlist:this.media(),internal:!0,message:e,blacklistDuration:1/0})}else this.blacklistCurrentPlaylist({playlist:this.media(),message:"Could not determine codecs for playlist.",blacklistDuration:1/0})},e.tryToCreateSourceBuffers_=function(){var t;"open"!==this.mediaSource.readyState||this.sourceUpdater_.hasCreatedSourceBuffers()||!this.areMediaTypesKnown_()||(t=this.getCodecsOrExclude_())&&(this.sourceUpdater_.createSourceBuffers(t),t=[t.video,t.audio].filter(Boolean).join(","),this.excludeIncompatibleVariants_(t))},e.excludeUnsupportedVariants_=function(){var n=this,r=this.master().playlists,a=[];Object.keys(r).forEach(function(t){var e,i=r[t];-1===a.indexOf(i.id)&&(a.push(i.id),e=[],!(t=Tl(n.master,i)).audio||bo(t.audio)||_o(t.audio)||e.push("audio codec "+t.audio),!t.video||bo(t.video)||_o(t.video)||e.push("video codec "+t.video),t.text&&"stpp.ttml.im1t"===t.text&&e.push("text codec "+t.text),e.length&&(i.excludeUntil=1/0,n.logger_("excluding "+i.id+" for unsupported: "+e.join(", "))))})},e.excludeIncompatibleVariants_=function(t){var r=this,a=[],s=this.master().playlists,t=bl(go(t)),o=wl(t),l=t.video&&go(t.video)[0]||null,u=t.audio&&go(t.audio)[0]||null;Object.keys(s).forEach(function(t){var e,i,n=s[t];-1===a.indexOf(n.id)&&n.excludeUntil!==1/0&&(a.push(n.id),e=[],t=wl(i=Tl(r.masterPlaylistLoader_.master,n)),(i.audio||i.video)&&(t!==o&&e.push('codec count "'+t+'" !== "'+o+'"'),r.sourceUpdater_.canChangeType()||(t=i.video&&go(i.video)[0]||null,i=i.audio&&go(i.audio)[0]||null,t&&l&&t.type.toLowerCase()!==l.type.toLowerCase()&&e.push('video codec "'+t.type+'" !== "'+l.type+'"'),i&&u&&i.type.toLowerCase()!==u.type.toLowerCase()&&e.push('audio codec "'+i.type+'" !== "'+u.type+'"')),e.length&&(n.excludeUntil=1/0,r.logger_("blacklisting "+n.id+": "+e.join(" && ")))))})},e.updateAdCues_=function(t){var u=0,e=this.seekable();e.length&&(u=e.start(0)),function(t,e,i){if(void 0===u&&(i=0),t.segments)for(var n,r=i,a=0;a<t.segments.length;a++){var s,o,l=t.segments[a];if(n=n||function(t,e){for(var i=t.cues,n=0;n<i.length;n++){var r=i[n];if(e>=r.adStartTime&&e<=r.adEndTime)return r}return null}(e,r+l.duration/2)){if("cueIn"in l){n.endTime=r,n.adEndTime=r,r+=l.duration,n=null;continue}if(r<n.endTime){r+=l.duration;continue}n.endTime+=l.duration}else"cueOut"in l&&((n=new kr.VTTCue(r,r+l.duration,l.cueOut)).adStartTime=r,n.adEndTime=r+parseFloat(l.cueOut),e.addCue(n)),"cueOutCont"in l&&(s=(o=l.cueOutCont.split("/").map(parseFloat))[0],o=o[1],(n=new kr.VTTCue(r,r+l.duration,"")).adStartTime=r-s,n.adEndTime=n.adStartTime+o,e.addCue(n));r+=l.duration}}(t,this.cueTagsTrack_,u)},e.goalBufferLength=function(){var t=this.tech_.currentTime(),e=eu.GOAL_BUFFER_LENGTH,i=eu.GOAL_BUFFER_LENGTH_RATE,n=Math.max(e,eu.MAX_GOAL_BUFFER_LENGTH);return Math.min(e+t*i,n)},e.bufferLowWaterLine=function(){var t=this.tech_.currentTime(),e=eu.BUFFER_LOW_WATER_LINE,i=eu.BUFFER_LOW_WATER_LINE_RATE,n=Math.max(e,eu.MAX_BUFFER_LOW_WATER_LINE),r=Math.max(e,eu.EXPERIMENTAL_MAX_BUFFER_LOW_WATER_LINE);return Math.min(e+t*i,this.experimentalBufferBasedABR?r:n)},e.bufferHighWaterLine=function(){return eu.BUFFER_HIGH_WATER_LINE},t}(br.EventTarget),qu=["seeking","seeked","pause","playing","error"],zu=((Xe=Wu.prototype).monitorCurrentTime_=function(){this.checkCurrentTime_(),this.checkCurrentTimeTimeout_&&kr.clearTimeout(this.checkCurrentTimeTimeout_),this.checkCurrentTimeTimeout_=kr.setTimeout(this.monitorCurrentTime_.bind(this),250)},Xe.resetSegmentDownloads_=function(t){var e=this.masterPlaylistController_[t+"SegmentLoader_"];0<this[t+"StalledDownloads_"]&&this.logger_("resetting possible stalled download count for "+t+" loader"),this[t+"StalledDownloads_"]=0,this[t+"Buffered_"]=e.buffered_()},Xe.checkSegmentDownloads_=function(t){var e=this.masterPlaylistController_,i=e[t+"SegmentLoader_"],n=i.buffered_(),r=function(t,e){if(t===e)return!1;if(!t&&e||!e&&t)return!0;if(t.length!==e.length)return!0;for(var i=0;i<t.length;i++)if(t.start(i)!==e.start(i)||t.end(i)!==e.end(i))return!0;return!1}(this[t+"Buffered_"],n);this[t+"Buffered_"]=n,r?this.resetSegmentDownloads_(t):(this[t+"StalledDownloads_"]++,this.logger_("found #"+this[t+"StalledDownloads_"]+" "+t+" appends that did not increase buffer (possible stalled download)",{playlistId:i.playlist_&&i.playlist_.id,buffered:Ro(n)}),this[t+"StalledDownloads_"]<10||(this.logger_(t+" loader stalled download exclusion"),this.resetSegmentDownloads_(t),this.tech_.trigger({type:"usage",name:"vhs-"+t+"-download-exclusion"}),"subtitle"!==t&&e.blacklistCurrentPlaylist({message:"Excessive "+t+" segment downloading detected."},1/0)))},Xe.checkCurrentTime_=function(){if(this.tech_.seeking()&&this.fixesBadSeeks_())return this.consecutiveUpdates=0,void(this.lastRecordedTime=this.tech_.currentTime());if(!this.tech_.paused()&&!this.tech_.seeking()){var t=this.tech_.currentTime(),e=this.tech_.buffered();if(this.lastRecordedTime===t&&(!e.length||t+.1>=e.end(e.length-1)))return this.techWaiting_();5<=this.consecutiveUpdates&&t===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):t===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=t)}},Xe.cancelTimer_=function(){this.consecutiveUpdates=0,this.timer_&&(this.logger_("cancelTimer_"),clearTimeout(this.timer_)),this.timer_=null},Xe.fixesBadSeeks_=function(){if(!this.tech_.seeking())return!1;var t,e=this.seekable(),i=this.tech_.currentTime();if(this.afterSeekableWindow_(e,i,this.media(),this.allowSeeksWithinUnsafeLiveWindow)&&(t=e.end(e.length-1)),void 0!==(t=this.beforeSeekableWindow_(e,i)?(r=e.start(0))+(r===e.end(0)?0:.1):t))return this.logger_("Trying to seek outside of seekable at time "+i+" with seekable range "+Mo(e)+". Seeking to "+t+"."),this.tech_.setCurrentTime(t),!0;var n,r,a=this.tech_.buffered();return n={buffered:a,targetDuration:this.media().targetDuration,currentTime:i},r=n.buffered,e=n.targetDuration,n=n.currentTime,!(!r.length||r.end(0)-r.start(0)<2*e||n>r.start(0)||!(r.start(0)-n<e)||(t=a.start(0)+.1,this.logger_("Buffered region starts ("+a.start(0)+")  just beyond seek point ("+i+"). Seeking to "+t+"."),this.tech_.setCurrentTime(t),0))},Xe.waiting_=function(){if(!this.techWaiting_()){var t=this.tech_.currentTime(),e=Oo(this.tech_.buffered(),t);return e.length&&t+3<=e.end(0)?(this.cancelTimer_(),this.tech_.setCurrentTime(t),this.logger_("Stopped at "+t+" while inside a buffered region ["+e.start(0)+" -> "+e.end(0)+"]. Attempting to resume playback by seeking to the current time."),this.tech_.trigger({type:"usage",name:"vhs-unknown-waiting"}),void this.tech_.trigger({type:"usage",name:"hls-unknown-waiting"})):void 0}},Xe.techWaiting_=function(){var t=this.seekable(),e=this.tech_.currentTime();if(this.tech_.seeking()&&this.fixesBadSeeks_())return!0;if(this.tech_.seeking()||null!==this.timer_)return!0;if(this.beforeSeekableWindow_(t,e)){var i=t.end(t.length-1);return this.logger_("Fell out of live window at time "+e+". Seeking to live point (seekable end) "+i),this.cancelTimer_(),this.tech_.setCurrentTime(i),this.tech_.trigger({type:"usage",name:"vhs-live-resync"}),this.tech_.trigger({type:"usage",name:"hls-live-resync"}),!0}t=this.tech_.vhs.masterPlaylistController_.sourceUpdater_,i=this.tech_.buffered();if(this.videoUnderflow_({audioBuffered:t.audioBuffered(),videoBuffered:t.videoBuffered(),currentTime:e}))return this.cancelTimer_(),this.tech_.setCurrentTime(e),this.tech_.trigger({type:"usage",name:"vhs-video-underflow"}),this.tech_.trigger({type:"usage",name:"hls-video-underflow"}),!0;t=Lo(i,e);if(0<t.length){i=t.start(0)-e;return this.logger_("Stopped at "+e+", setting timer for "+i+", seeking to "+t.start(0)),this.cancelTimer_(),this.timer_=setTimeout(this.skipTheGap_.bind(this),1e3*i,e),!0}return!1},Xe.afterSeekableWindow_=function(t,e,i,n){if(void 0===n&&(n=!1),!t.length)return!1;var r=t.end(t.length-1)+.1;return(r=!i.endList&&n?t.end(t.length-1)+3*i.targetDuration:r)<e},Xe.beforeSeekableWindow_=function(t,e){return!!(t.length&&0<t.start(0)&&e<t.start(0)-this.liveRangeSafeTimeDelta)},Xe.videoUnderflow_=function(t){var e,i,n=t.videoBuffered,r=t.audioBuffered,a=t.currentTime;if(n)return n.length&&r.length?(i=Oo(n,a-3),t=Oo(n,a),(r=Oo(r,a)).length&&!t.length&&i.length&&(e={start:i.end(0),end:r.end(0)})):Lo(n,a).length||(e=this.gapFromVideoUnderflow_(n,a)),!!e&&(this.logger_("Encountered a gap in video from "+e.start+" to "+e.end+". Seeking to current time "+a),!0)},Xe.skipTheGap_=function(t){var e=this.tech_.buffered(),i=this.tech_.currentTime(),e=Lo(e,i);this.cancelTimer_(),0!==e.length&&i===t&&(this.logger_("skipTheGap_:","currentTime:",i,"scheduled currentTime:",t,"nextRange start:",e.start(0)),this.tech_.setCurrentTime(e.start(0)+$l),this.tech_.trigger({type:"usage",name:"vhs-gap-skip"}),this.tech_.trigger({type:"usage",name:"hls-gap-skip"}))},Xe.gapFromVideoUnderflow_=function(t,e){for(var i=function(t){if(t.length<2)return br.createTimeRanges();for(var e=[],i=1;i<t.length;i++){var n=t.end(i-1),r=t.start(i);e.push([n,r])}return br.createTimeRanges(e)}(t),n=0;n<i.length;n++){var r=i.start(n),a=i.end(n);if(e-r<4&&2<e-r)return{start:r,end:a}}return null},Wu),Hu={errorInterval:30,getSource:function(t){return t(this.tech({IWillNotUseThisInPlugins:!0}).currentSource_||this.currentSource())}},Vu={PlaylistLoader:Xl,Playlist:Kl,utils:r,STANDARD_PLAYLIST_SELECTOR:Il,INITIAL_PLAYLIST_SELECTOR:function(){var e=this,t=this.playlists.master.playlists.filter(Kl.isEnabled);return El(t,kl),t.filter(function(t){return!!Tl(e.playlists.master,t).video})[0]||null},lastBandwidthSelector:Il,movingAverageBandwidthSelector:function(e){var i=-1;if(e<0||1<e)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){var t=this.useDevicePixelRatio&&kr.devicePixelRatio||1;return i<0&&(i=this.systemBandwidth),i=e*this.systemBandwidth+(1-e)*i,Cl(this.playlists.master,i,parseInt(Sl(this.tech_.el(),"width"),10)*t,parseInt(Sl(this.tech_.el(),"height"),10)*t,this.limitRenditionByPlayerDimensions)}},comparePlaylistBandwidth:kl,comparePlaylistResolution:function(t,e){var i,n;return(i=(i=t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width?t.attributes.RESOLUTION.width:i)||kr.Number.MAX_VALUE)===(n=(n=e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width?e.attributes.RESOLUTION.width:n)||kr.Number.MAX_VALUE)&&t.attributes.BANDWIDTH&&e.attributes.BANDWIDTH?t.attributes.BANDWIDTH-e.attributes.BANDWIDTH:i-n},xhr:Xo()};function Wu(t){var e=this;function i(){return e.monitorCurrentTime_()}function n(){return e.monitorCurrentTime_()}function r(){return e.techWaiting_()}function a(){return e.cancelTimer_()}function s(){return e.fixesBadSeeks_()}this.masterPlaylistController_=t.masterPlaylistController,this.tech_=t.tech,this.seekable=t.seekable,this.allowSeeksWithinUnsafeLiveWindow=t.allowSeeksWithinUnsafeLiveWindow,this.liveRangeSafeTimeDelta=t.liveRangeSafeTimeDelta,this.media=t.media,this.consecutiveUpdates=0,this.lastRecordedTime=null,this.timer_=null,this.checkCurrentTimeTimeout_=null,this.logger_=To("PlaybackWatcher"),this.logger_("initialize");var o=this.masterPlaylistController_,l=["main","subtitle","audio"],u={};l.forEach(function(t){u[t]={reset:function(){return e.resetSegmentDownloads_(t)},updateend:function(){return e.checkSegmentDownloads_(t)}},o[t+"SegmentLoader_"].on("appendsdone",u[t].updateend),o[t+"SegmentLoader_"].on("playlistupdate",u[t].reset),e.tech_.on(["seeked","seeking"],u[t].reset)}),this.tech_.on("seekablechanged",s),this.tech_.on("waiting",r),this.tech_.on(qu,a),this.tech_.on("canplay",n),this.tech_.one("play",i),this.dispose=function(){e.logger_("dispose"),e.tech_.off("seekablechanged",s),e.tech_.off("waiting",r),e.tech_.off(qu,a),e.tech_.off("canplay",n),e.tech_.off("play",i),l.forEach(function(t){o[t+"SegmentLoader_"].off("appendsdone",u[t].updateend),o[t+"SegmentLoader_"].off("playlistupdate",u[t].reset),e.tech_.off(["seeked","seeking"],u[t].reset)}),e.checkCurrentTimeTimeout_&&kr.clearTimeout(e.checkCurrentTimeTimeout_),e.cancelTimer_()}}function Gu(t,e){for(var i=e.media(),n=-1,r=0;r<t.length;r++)if(t[r].id===i.id){n=r;break}t.selectedIndex_=n,t.trigger({selectedIndex:n,type:"change"})}Object.keys(eu).forEach(function(e){Object.defineProperty(Vu,e,{get:function(){return br.log.warn("using Vhs."+e+" is UNSAFE be sure you know what you are doing"),eu[e]},set:function(t){br.log.warn("using Vhs."+e+" is UNSAFE be sure you know what you are doing"),"number"!=typeof t||t<0?br.log.warn("value of Vhs."+e+" must be greater than or equal to 0"):eu[e]=t}})});var Xu="videojs-vhs";function $u(t,e,i){if(!t)return t;var n={video:e&&e.attributes&&e.attributes.CODECS,audio:i&&i.attributes&&i.attributes.CODECS};!n.audio&&n.video&&1<n.video.split(",").length&&n.video.split(",").forEach(function(t){var e;vo(t=t.trim())?n.audio=t:(e=t,jl.video.test((e=void 0===e?"":e).trim().toLowerCase())&&(n.video=t))});var r,a=n.video?'video/mp4;codecs="'+n.video+'"':null,s=n.audio?'audio/mp4;codecs="'+n.audio+'"':null,o={};for(r in t)o[r]={audioContentType:s,videoContentType:a},e.contentProtection&&e.contentProtection[r]&&e.contentProtection[r].pssh&&(o[r].pssh=e.contentProtection[r].pssh),"string"==typeof t[r]&&(o[r].url=t[r]);return br.mergeOptions(t,o)}function Yu(){if(!kr.localStorage)return null;var t=kr.localStorage.getItem(Xu);if(!t)return null;try{return JSON.parse(t)}catch(t){return null}}Vu.canPlaySource=function(){return br.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")},Vu.supportsNativeHls=function(){if(!Er||!Er.createElement)return!1;var e=Er.createElement("video");return!!br.getTech("Html5").isSupported()&&["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"].some(function(t){return/maybe|probably/i.test(e.canPlayType(t))})}(),Vu.supportsNativeDash=!!(Er&&Er.createElement&&br.getTech("Html5").isSupported())&&/maybe|probably/i.test(Er.createElement("video").canPlayType("application/dash+xml")),Vu.supportsTypeNatively=function(t){return"hls"===t?Vu.supportsNativeHls:"dash"===t&&Vu.supportsNativeDash},Vu.isSupported=function(){return br.log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var Ku=function(r){function t(t,e,i){var n=r.call(this,e,br.mergeOptions(i.hls,i.vhs))||this;if(i.hls&&Object.keys(i.hls).length&&br.log.warn("Using hls options is deprecated. Use vhs instead."),n.logger_=To("VhsHandler"),e.options_&&e.options_.playerId&&((i=br(e.options_.playerId)).hasOwnProperty("hls")||Object.defineProperty(i,"hls",{get:function(){return br.log.warn("player.hls is deprecated. Use player.tech().vhs instead."),e.trigger({type:"usage",name:"hls-player-access"}),wr(n)},configurable:!0}),i.hasOwnProperty("vhs")||Object.defineProperty(i,"vhs",{get:function(){return br.log.warn("player.vhs is deprecated. Use player.tech().vhs instead."),e.trigger({type:"usage",name:"vhs-player-access"}),wr(n)},configurable:!0}),i.hasOwnProperty("dash")||Object.defineProperty(i,"dash",{get:function(){return br.log.warn("player.dash is deprecated. Use player.tech().vhs instead."),wr(n)},configurable:!0}),n.player_=i),n.tech_=e,n.source_=t,n.stats={},n.ignoreNextSeekingEvent_=!1,n.setOptions_(),n.options_.overrideNative&&e.overrideNativeAudioTracks&&e.overrideNativeVideoTracks)e.overrideNativeAudioTracks(!0),e.overrideNativeVideoTracks(!0);else if(n.options_.overrideNative&&(e.featuresNativeVideoTracks||e.featuresNativeAudioTracks))throw new Error("Overriding native HLS requires emulated tracks. See https://git.io/vMpjB");return n.on(Er,["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],function(t){var e=Er.fullscreenElement||Er.webkitFullscreenElement||Er.mozFullScreenElement||Er.msFullscreenElement;e&&e.contains(n.tech_.el())&&n.masterPlaylistController_.smoothQualityChange_()}),n.on(n.tech_,"seeking",function(){this.ignoreNextSeekingEvent_?this.ignoreNextSeekingEvent_=!1:this.setCurrentTime(this.tech_.currentTime())}),n.on(n.tech_,"error",function(){this.tech_.error()&&this.masterPlaylistController_&&this.masterPlaylistController_.pauseLoading()}),n.on(n.tech_,"play",n.play),n}Sr(t,r);var e=t.prototype;return e.setOptions_=function(){var t,e=this;this.options_.withCredentials=this.options_.withCredentials||!1,this.options_.handleManifestRedirects=!1!==this.options_.handleManifestRedirects,this.options_.limitRenditionByPlayerDimensions=!1!==this.options_.limitRenditionByPlayerDimensions,this.options_.useDevicePixelRatio=this.options_.useDevicePixelRatio||!1,this.options_.smoothQualityChange=this.options_.smoothQualityChange||!1,this.options_.useBandwidthFromLocalStorage=void 0!==this.source_.useBandwidthFromLocalStorage?this.source_.useBandwidthFromLocalStorage:this.options_.useBandwidthFromLocalStorage||!1,this.options_.customTagParsers=this.options_.customTagParsers||[],this.options_.customTagMappers=this.options_.customTagMappers||[],this.options_.cacheEncryptionKeys=this.options_.cacheEncryptionKeys||!1,this.options_.handlePartialData=this.options_.handlePartialData||!1,"number"!=typeof this.options_.blacklistDuration&&(this.options_.blacklistDuration=300),"number"!=typeof this.options_.bandwidth&&this.options_.useBandwidthFromLocalStorage&&((t=Yu())&&t.bandwidth&&(this.options_.bandwidth=t.bandwidth,this.tech_.trigger({type:"usage",name:"vhs-bandwidth-from-local-storage"}),this.tech_.trigger({type:"usage",name:"hls-bandwidth-from-local-storage"})),t&&t.throughput&&(this.options_.throughput=t.throughput,this.tech_.trigger({type:"usage",name:"vhs-throughput-from-local-storage"}),this.tech_.trigger({type:"usage",name:"hls-throughput-from-local-storage"}))),"number"!=typeof this.options_.bandwidth&&(this.options_.bandwidth=eu.INITIAL_BANDWIDTH),this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===eu.INITIAL_BANDWIDTH,["withCredentials","useDevicePixelRatio","limitRenditionByPlayerDimensions","bandwidth","smoothQualityChange","customTagParsers","customTagMappers","handleManifestRedirects","cacheEncryptionKeys","handlePartialData","playlistSelector","initialPlaylistSelector","experimentalBufferBasedABR","liveRangeSafeTimeDelta"].forEach(function(t){void 0!==e.source_[t]&&(e.options_[t]=e.source_[t])}),this.limitRenditionByPlayerDimensions=this.options_.limitRenditionByPlayerDimensions,this.useDevicePixelRatio=this.options_.useDevicePixelRatio},e.src=function(t,e){var n=this;t&&(this.setOptions_(),this.options_.src=0===(t=this.source_.src).toLowerCase().indexOf("data:application/vnd.videojs.vhs+json,")?JSON.parse(t.substring(t.indexOf(",")+1)):t,this.options_.tech=this.tech_,this.options_.externVhs=Vu,this.options_.sourceType=Br(e),this.options_.seekTo=function(t){n.tech_.setCurrentTime(t)},this.masterPlaylistController_=new ju(this.options_),e=br.mergeOptions({liveRangeSafeTimeDelta:.1},this.options_,{seekable:function(){return n.seekable()},media:function(){return n.masterPlaylistController_.media()},masterPlaylistController:this.masterPlaylistController_}),this.playbackWatcher_=new zu(e),this.masterPlaylistController_.on("error",function(){var t=br.players[n.tech_.options_.playerId],e=n.masterPlaylistController_.error;"object"!=typeof e||e.code?"string"==typeof e&&(e={message:e,code:3}):e.code=3,t.error(e)}),e=this.options_.experimentalBufferBasedABR?Vu.movingAverageBandwidthSelector(.55):Vu.STANDARD_PLAYLIST_SELECTOR,this.masterPlaylistController_.selectPlaylist=(this.selectPlaylist||e).bind(this),this.masterPlaylistController_.selectInitialPlaylist=Vu.INITIAL_PLAYLIST_SELECTOR.bind(this),this.playlists=this.masterPlaylistController_.masterPlaylistLoader_,this.mediaSource=this.masterPlaylistController_.mediaSource,Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(t){this.masterPlaylistController_.selectPlaylist=t.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(t){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=t,this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.bandwidth},set:function(t){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=t,this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){var t=1/(this.bandwidth||1),e=0<this.throughput?1/this.throughput:0;return Math.floor(1/(t+e))},set:function(){br.log.error('The "systemBandwidth" property is read-only')}}}),this.options_.bandwidth&&(this.bandwidth=this.options_.bandwidth),this.options_.throughput&&(this.throughput=this.options_.throughput),Object.defineProperties(this.stats,{bandwidth:{get:function(){return n.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return n.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return n.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return n.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return n.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return n.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return n.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return n.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0},buffered:{get:function(){return Ro(n.tech_.buffered())},enumerable:!0},currentTime:{get:function(){return n.tech_.currentTime()},enumerable:!0},currentSource:{get:function(){return n.tech_.currentSource_},enumerable:!0},currentTech:{get:function(){return n.tech_.name_},enumerable:!0},duration:{get:function(){return n.tech_.duration()},enumerable:!0},master:{get:function(){return n.playlists.master},enumerable:!0},playerDimensions:{get:function(){return n.tech_.currentDimensions()},enumerable:!0},seekable:{get:function(){return Ro(n.tech_.seekable())},enumerable:!0},timestamp:{get:function(){return Date.now()},enumerable:!0},videoPlaybackQuality:{get:function(){return n.tech_.getVideoPlaybackQuality()},enumerable:!0}}),this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_)),this.tech_.on("bandwidthupdate",function(){n.options_.useBandwidthFromLocalStorage&&function(t){if(kr.localStorage){var e=(e=Yu())?br.mergeOptions(e,t):t;try{kr.localStorage.setItem(Xu,JSON.stringify(e))}catch(t){return}}}({bandwidth:n.bandwidth,throughput:Math.round(n.throughput)})}),this.masterPlaylistController_.on("selectedinitialmedia",function(){var i,t;t=(i=n).playlists,i.representations=function(){return t&&t.master&&t.master.playlists?t.master.playlists.filter(function(t){return!zo(t)}).map(function(t,e){return new wu(i,t,t.id)}):[]}}),this.masterPlaylistController_.sourceUpdater_.on("createdsourcebuffers",function(){n.setupEme_()}),this.on(this.masterPlaylistController_,"progress",function(){this.tech_.trigger("progress")}),this.on(this.masterPlaylistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0}),this.setupQualityLevels_(),this.tech_.el()&&(this.mediaSourceUrl_=kr.URL.createObjectURL(this.masterPlaylistController_.mediaSource),this.tech_.src(this.mediaSourceUrl_)))},e.setupEme_=function(){var t,e=this,i=this.masterPlaylistController_.mediaTypes_.AUDIO.activePlaylistLoader,n=(t={player:this.player_,sourceKeySystems:this.source_.keySystems,media:this.playlists.media(),audioMedia:i&&i.media()},n=t.player,!(!(t=$u(t.sourceKeySystems,t.media,t.audioMedia))||(n.currentSource().keySystems=t)&&!n.eme&&(br.log.warn("DRM encrypted source cannot be decrypted without a DRM plugin"),1)));11!==br.browser.IE_VERSION&&n?(this.logger_("waiting for EME key session creation"),function(t){var n=t.player,e=t.sourceKeySystems,i=t.audioMedia,t=t.mainPlaylists;if(!n.eme.initializeMediaKeys)return Promise.resolve();var r,t=(t=i?t.concat([i]):t,r=Object.keys(e),t.reduce(function(t,n){if(!n.contentProtection)return t;var e=r.reduce(function(t,e){var i=n.contentProtection[e];return i&&i.pssh&&(t[e]={pssh:i.pssh}),t},{});return Object.keys(e).length&&t.push(e),t},[])),a=[],s=[];return t.forEach(function(t){s.push(new Promise(function(t,e){n.tech_.one("keysessioncreated",t)})),a.push(new Promise(function(e,i){n.eme.initializeMediaKeys({keySystems:t},function(t){t?i(t):e()})}))}),Promise.race([Promise.all(a),Promise.race(s)])}({player:this.player_,sourceKeySystems:this.source_.keySystems,audioMedia:i&&i.media(),mainPlaylists:this.playlists.master.playlists}).then(function(){e.logger_("created EME key session"),e.masterPlaylistController_.sourceUpdater_.initializedEme()}).catch(function(t){e.logger_("error while creating EME key session",t),e.player_.error({message:"Failed to initialize media keys for EME",code:3})})):this.masterPlaylistController_.sourceUpdater_.initializedEme()},e.setupQualityLevels_=function(){var i=this,t=br.players[this.tech_.options_.playerId];t&&t.qualityLevels&&!this.qualityLevels_&&(this.qualityLevels_=t.qualityLevels(),this.masterPlaylistController_.on("selectedinitialmedia",function(){var e,t;e=i.qualityLevels_,(t=i).representations().forEach(function(t){e.addQualityLevel(t)}),Gu(e,t.playlists)}),this.playlists.on("mediachange",function(){Gu(i.qualityLevels_,i.playlists)}))},t.version=function(){return{"@videojs/http-streaming":"2.6.4","mux.js":"5.10.0","mpd-parser":"0.15.4","m3u8-parser":"4.5.2","aes-decrypter":"3.1.2"}},e.version=function(){return this.constructor.version()},e.canChangeType=function(){return Iu.canChangeType()},e.play=function(){this.masterPlaylistController_.play()},e.setCurrentTime=function(t){this.masterPlaylistController_.setCurrentTime(t)},e.duration=function(){return this.masterPlaylistController_.duration()},e.seekable=function(){return this.masterPlaylistController_.seekable()},e.dispose=function(){this.playbackWatcher_&&this.playbackWatcher_.dispose(),this.masterPlaylistController_&&this.masterPlaylistController_.dispose(),this.qualityLevels_&&this.qualityLevels_.dispose(),this.player_&&(delete this.player_.vhs,delete this.player_.dash,delete this.player_.hls),this.tech_&&this.tech_.vhs&&delete this.tech_.vhs,this.tech_&&delete this.tech_.hls,this.mediaSourceUrl_&&kr.URL.revokeObjectURL&&(kr.URL.revokeObjectURL(this.mediaSourceUrl_),this.mediaSourceUrl_=null),r.prototype.dispose.call(this)},e.convertToProgramTime=function(t,e){return function(t){var e=t.playlist,i=t.time,n=void 0===i?void 0:i;if(!(i=t.callback))throw new Error("getProgramTime: callback must be provided");return e&&void 0!==n?(t=function(t,e){if(!e||!e.segments||0===e.segments.length)return null;for(var i,n=0,r=0;r<e.segments.length&&!(t<=(n=(i=e.segments[r]).videoTimingInfo?i.videoTimingInfo.transmuxedPresentationEnd:n+i.duration));r++);var a=e.segments[e.segments.length-1];if(a.videoTimingInfo&&a.videoTimingInfo.transmuxedPresentationEnd<t)return null;if(n<t){if(t>n+.25*a.duration)return null;i=a}return{segment:i,estimatedStart:i.videoTimingInfo?i.videoTimingInfo.transmuxedPresentationStart:n-i.duration,type:i.videoTimingInfo?"accurate":"estimate"}}(n,e))?"estimate"===t.type?i({message:"Accurate programTime could not be determined. Please seek to e.seekTime and try again",seekTime:t.estimatedStart}):(e={mediaSeconds:n},(t=function(t){if(!t.dateTimeObject)return null;var e=t.videoTimingInfo.transmuxerPrependedSeconds,e=n-(t.videoTimingInfo.transmuxedPresentationStart+e);return new Date(t.dateTimeObject.getTime()+1e3*e)}(t.segment))&&(e.programDateTime=t.toISOString()),i(null,e)):i({message:"valid programTime was not found"}):i({message:"getProgramTime: playlist and time must be provided"})}({playlist:this.masterPlaylistController_.media(),time:t,callback:e})},e.seekToProgramTime=function(t,e,i,n){return void 0===i&&(i=!0),void 0===n&&(n=2),function t(e){var i=e.programTime,n=e.playlist,r=e.retryCount,a=void 0===r?2:r,s=e.seekTo,o=e.pauseAfterSeek,l=void 0===o||o,u=e.tech,h=e.callback;if(!h)throw new Error("seekToProgramTime: callback must be provided");if(void 0===i||!n||!s)return h({message:"seekToProgramTime: programTime, seekTo and playlist must be provided"});if(!n.endList&&!u.hasStarted_)return h({message:"player must be playing a live stream to start buffering"});if(!function(t){if(t.segments&&0!==t.segments.length){for(var e=0;e<t.segments.length;e++)if(!t.segments[e].dateTimeObject)return;return 1}}(n))return h({message:"programDateTime tags must be provided in the manifest "+n.resolvedUri});r=function(t,e){var i;try{i=new Date(t)}catch(t){return null}if(!e||!e.segments||0===e.segments.length)return null;var n=e.segments[0];if(i<n.dateTimeObject)return null;for(var r=0;r<e.segments.length-1&&(n=e.segments[r],!(i<e.segments[r+1].dateTimeObject));r++);var a=e.segments[e.segments.length-1],s=a.dateTimeObject,o=a.videoTimingInfo?(o=a.videoTimingInfo).transmuxedPresentationEnd-o.transmuxedPresentationStart-o.transmuxerPrependedSeconds:a.duration+.25*a.duration;return new Date(s.getTime()+1e3*o)<i?null:{segment:n=s<i?a:n,estimatedStart:n.videoTimingInfo?n.videoTimingInfo.transmuxedPresentationStart:Kl.duration(e,e.mediaSequence+e.segments.indexOf(n)),type:n.videoTimingInfo?"accurate":"estimate"}}(i,n);if(!r)return h({message:i+" was not found in the stream"});o=r.segment,e=function(t,e){var i;try{n=new Date(t),i=new Date(e)}catch(t){}var n=n.getTime();return(i.getTime()-n)/1e3}(o.dateTimeObject,i);if("estimate"===r.type)return 0===a?h({message:i+" is not buffered yet. Try again"}):(s(r.estimatedStart+e),void u.one("seeked",function(){t({programTime:i,playlist:n,retryCount:a-1,seekTo:s,pauseAfterSeek:l,tech:u,callback:h})}));e=o.start+e;u.one("seeked",function(){return h(null,u.currentTime())}),l&&u.pause(),s(e)}({programTime:t,playlist:this.masterPlaylistController_.media(),retryCount:n,pauseAfterSeek:i,seekTo:this.options_.seekTo,tech:this.options_.tech,callback:e})},t}(br.getComponent("Component")),Qu={name:"videojs-http-streaming",VERSION:"2.6.4",canHandleSource:function(t,e){e=br.mergeOptions(br.options,e=void 0===e?{}:e);return Qu.canPlayType(t.type,e)},handleSource:function(t,e,i){i=br.mergeOptions(br.options,i=void 0===i?{}:i);return e.vhs=new Ku(t,e,i),br.hasOwnProperty("hls")||Object.defineProperty(e,"hls",{get:function(){return br.log.warn("player.tech().hls is deprecated. Use player.tech().vhs instead."),e.vhs},configurable:!0}),e.vhs.xhr=Xo(),e.vhs.src(t.src,t.type),e.vhs},canPlayType:function(t,e){e=br.mergeOptions(br.options,e=void 0===e?{}:e).vhs.overrideNative,e=void 0===e?!br.browser.IS_ANY_SAFARI:e,t=Br(t);return!t||Vu.supportsTypeNatively(t)&&!e?"":"maybe"}};return _o("avc1.4d400d,mp4a.40.2")&&br.getTech("Html5").registerSourceHandler(Qu,0),br.VhsHandler=Ku,Object.defineProperty(br,"HlsHandler",{get:function(){return br.log.warn("videojs.HlsHandler is deprecated. Use videojs.VhsHandler instead."),Ku},configurable:!0}),br.VhsSourceHandler=Qu,Object.defineProperty(br,"HlsSourceHandler",{get:function(){return br.log.warn("videojs.HlsSourceHandler is deprecated. Use videojs.VhsSourceHandler instead."),Qu},configurable:!0}),br.Vhs=Vu,Object.defineProperty(br,"Hls",{get:function(){return br.log.warn("videojs.Hls is deprecated. Use videojs.Vhs instead."),Vu},configurable:!0}),br.use||(br.registerComponent("Hls",Vu),br.registerComponent("Vhs",Vu)),br.options.vhs=br.options.vhs||{},br.options.hls=br.options.hls||{},br.registerPlugin?br.registerPlugin("reloadSourceOnError",Tu):br.plugin("reloadSourceOnError",Tu),br}),videojs.addLanguage("nl",{"Audio Player":"Audiospeler","Video Player":"Videospeler",Play:"Afspelen",Pause:"Pauzeren",Replay:"Opnieuw afspelen","Current Time":"Huidige tijd",Duration:"Tijdsduur","Remaining Time":"Resterende tijd","Stream Type":"Streamtype",LIVE:"LIVE",Loaded:"Geladen",Progress:"Voortgang","Progress Bar":"Voortgangsbalk","progress bar timing: currentTime={1} duration={2}":"{1} van {2}",Fullscreen:"Volledig scherm","Non-Fullscreen":"Geen volledig scherm",Mute:"Dempen",Unmute:"Niet dempen","Playback Rate":"Afspeelsnelheid",Subtitles:"Ondertiteling","subtitles off":"ondertiteling uit",Captions:"Bijschriften","captions off":"bijschriften uit",Chapters:"Hoofdstukken",Descriptions:"Beschrijvingen","descriptions off":"beschrijvingen uit","Audio Track":"Audiospoor","Volume Level":"Geluidsniveau","You aborted the media playback":"U heeft het afspelen van de media afgebroken","A network error caused the media download to fail part-way.":"Een netwerkfout heeft ervoor gezorgd dat het downloaden van de media halverwege is mislukt.","The media could not be loaded, either because the server or network failed or because the format is not supported.":"De media kon niet worden geladen, dit komt doordat of de server of het netwerk mislukt of doordat het formaat niet wordt ondersteund.","The media playback was aborted due to a corruption problem or because the media used features your browser did not support.":"Het afspelen van de media is afgebroken door een probleem met beschadeigde gegevens of doordat de media functies gebruikt die uw browser niet ondersteund.","No compatible source was found for this media.":"Er is geen geschikte bron voor deze media gevonden.","The media is encrypted and we do not have the keys to decrypt it.":"De media is versleuteld en we hebben de sleutels niet om deze te ontsleutelen.","Play Video":"Video afspelen",Close:"Sluiten","Close Modal Dialog":"Extra venster sluiten","Modal Window":"Extra venster","This is a modal window":"Dit is een extra venster","This modal can be closed by pressing the Escape key or activating the close button.":"Dit venster kan worden gesloten door op de Escape-toets te drukken of door de sluiten-knop te activeren.",", opens captions settings dialog":", opent instellingen-venster voor bijschriften",", opens subtitles settings dialog":", opent instellingen-venster voor ondertitelingen",", opens descriptions settings dialog":", opent instellingen-venster voor beschrijvingen",", selected":", geselecteerd","captions settings":"bijschriften-instellingen","subtitles settings":"ondertiteling-instellingen","descriptions settings":"beschrijvingen-instellingen",Text:"Tekst",White:"Wit",Black:"Zwart",Red:"Rood",Green:"Groen",Blue:"Blauw",Yellow:"Geel",Magenta:"Magenta",Cyan:"Cyaan",Background:"Achtergrond",Window:"Venster",Transparent:"Transparant","Semi-Transparent":"Semi-transparant",Opaque:"Ondoorzichtig","Font Size":"Lettergrootte","Text Edge Style":"Stijl tekstrand",None:"Geen",Raised:"Verhoogd",Depressed:"Ingedrukt",Uniform:"Uniform",Dropshadow:"Schaduw","Font Family":"Lettertype","Proportional Sans-Serif":"Proportioneel sans-serif","Monospace Sans-Serif":"Monospace sans-serif","Proportional Serif":"Proportioneel serif","Monospace Serif":"Monospace serif",Casual:"Luchtig",Script:"Script","Small Caps":"Kleine hoofdletters",Reset:"Herstellen","restore all settings to the default values":"alle instellingen naar de standaardwaarden herstellen",Done:"Klaar","Caption Settings Dialog":"Venster voor bijschriften-instellingen","Beginning of dialog window. Escape will cancel and close the window.":"Begin van dialoogvenster. Escape zal annuleren en het venster sluiten.","End of dialog window.":"Einde van dialoogvenster."}),videojs.addLanguage("en",{"Audio Player":"Audio Player","Video Player":"Video Player",Play:"Play",Pause:"Pause",Replay:"Replay","Current Time":"Current Time",Duration:"Duration","Remaining Time":"Remaining Time","Stream Type":"Stream Type",LIVE:"LIVE","Seek to live, currently behind live":"Seek to live, currently behind live","Seek to live, currently playing live":"Seek to live, currently playing live",Loaded:"Loaded",Progress:"Progress","Progress Bar":"Progress Bar","progress bar timing: currentTime={1} duration={2}":"{1} of {2}",Fullscreen:"Fullscreen","Non-Fullscreen":"Non-Fullscreen",Mute:"Mute",Unmute:"Unmute","Playback Rate":"Playback Rate",Subtitles:"Subtitles","subtitles off":"subtitles off",Captions:"Captions","captions off":"captions off",Chapters:"Chapters",Descriptions:"Descriptions","descriptions off":"descriptions off","Audio Track":"Audio Track","Volume Level":"Volume Level","You aborted the media playback":"You aborted the media playback","A network error caused the media download to fail part-way.":"A network error caused the media download to fail part-way.","The media could not be loaded, either because the server or network failed or because the format is not supported.":"The media could not be loaded, either because the server or network failed or because the format is not supported.","The media playback was aborted due to a corruption problem or because the media used features your browser did not support.":"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.","No compatible source was found for this media.":"No compatible source was found for this media.","The media is encrypted and we do not have the keys to decrypt it.":"The media is encrypted and we do not have the keys to decrypt it.","Play Video":"Play Video",Close:"Close","Close Modal Dialog":"Close Modal Dialog","Modal Window":"Modal Window","This is a modal window":"This is a modal window","This modal can be closed by pressing the Escape key or activating the close button.":"This modal can be closed by pressing the Escape key or activating the close button.",", opens captions settings dialog":", opens captions settings dialog",", opens subtitles settings dialog":", opens subtitles settings dialog",", opens descriptions settings dialog":", opens descriptions settings dialog",", selected":", selected","captions settings":"captions settings","subtitles settings":"subtitles settings","descriptions settings":"descriptions settings",Text:"Text",White:"White",Black:"Black",Red:"Red",Green:"Green",Blue:"Blue",Yellow:"Yellow",Magenta:"Magenta",Cyan:"Cyan",Background:"Background",Window:"Window",Transparent:"Transparent","Semi-Transparent":"Semi-Transparent",Opaque:"Opaque","Font Size":"Font Size","Text Edge Style":"Text Edge Style",None:"None",Raised:"Raised",Depressed:"Depressed",Uniform:"Uniform",Dropshadow:"Dropshadow","Font Family":"Font Family","Proportional Sans-Serif":"Proportional Sans-Serif","Monospace Sans-Serif":"Monospace Sans-Serif","Proportional Serif":"Proportional Serif","Monospace Serif":"Monospace Serif",Casual:"Casual",Script:"Script","Small Caps":"Small Caps",Reset:"Reset","restore all settings to the default values":"restore all settings to the default values",Done:"Done","Caption Settings Dialog":"Caption Settings Dialog","Beginning of dialog window. Escape will cancel and close the window.":"Beginning of dialog window. Escape will cancel and close the window.","End of dialog window.":"End of dialog window.","{1} is loading.":"{1} is loading.","Exit Picture-in-Picture":"Exit Picture-in-Picture","Picture-in-Picture":"Picture-in-Picture"}),function(t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=t()}(function(){return function n(r,a,s){function o(i,t){if(!a[i]){if(!r[i]){var e="function"==typeof require&&require;if(!t&&e)return e(i,!0);if(l)return l(i,!0);e=new Error("Cannot find module '"+i+"'");throw e.code="MODULE_NOT_FOUND",e}e=a[i]={exports:{}};r[i][0].call(e.exports,function(t){var e=r[i][1][t];return o(e||t)},e,e.exports,n,r,a,s)}return a[i].exports}for(var l="function"==typeof require&&require,t=0;t<s.length;t++)o(s[t]);return o}({1:[function(t,u,e){!function(e){"use strict";var t,i,n,r,a=e.MutationObserver||e.WebKitMutationObserver,s=a?(t=0,a=new a(l),i=e.document.createTextNode(""),a.observe(i,{characterData:!0}),function(){i.data=t=++t%2}):e.setImmediate||void 0===e.MessageChannel?"document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)}:((n=new e.MessageChannel).port1.onmessage=l,function(){n.port2.postMessage(0)}),o=[];function l(){var t,e;r=!0;for(var i=o.length;i;){for(e=o,o=[],t=-1;++t<i;)e[t]();i=o.length}r=!1}u.exports=function(t){1!==o.push(t)||r||s()}}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,i){"use strict";var r=t(1);function l(){}var u={},a=["REJECTED"],s=["FULFILLED"],n=["PENDING"];function o(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=n,this.queue=[],this.outcome=void 0,t!==l&&p(this,t)}function h(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function c(e,i,n){r(function(){var t;try{t=i(n)}catch(t){return u.reject(e,t)}t===e?u.reject(e,new TypeError("Cannot resolve promise with itself")):u.resolve(e,t)})}function d(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function p(e,t){var i=!1;function n(t){i||(i=!0,u.reject(e,t))}function r(t){i||(i=!0,u.resolve(e,t))}var a=f(function(){t(r,n)});"error"===a.status&&n(a.value)}function f(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}(e.exports=o).prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){if("function"!=typeof t&&this.state===s||"function"!=typeof e&&this.state===a)return this;var i=new this.constructor(l);return this.state!==n?c(i,this.state===s?t:e,this.outcome):this.queue.push(new h(i,t,e)),i},h.prototype.callFulfilled=function(t){u.resolve(this.promise,t)},h.prototype.otherCallFulfilled=function(t){c(this.promise,this.onFulfilled,t)},h.prototype.callRejected=function(t){u.reject(this.promise,t)},h.prototype.otherCallRejected=function(t){c(this.promise,this.onRejected,t)},u.resolve=function(t,e){var i=f(d,e);if("error"===i.status)return u.reject(t,i.value);i=i.value;if(i)p(t,i);else{t.state=s,t.outcome=e;for(var n=-1,r=t.queue.length;++n<r;)t.queue[n].callFulfilled(e)}return t},u.reject=function(t,e){t.state=a,t.outcome=e;for(var i=-1,n=t.queue.length;++i<n;)t.queue[i].callRejected(e);return t},o.resolve=function(t){if(t instanceof this)return t;return u.resolve(new this(l),t)},o.reject=function(t){var e=new this(l);return u.reject(e,t)},o.all=function(t){var i=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);var a=new Array(n),s=0,e=-1,o=new this(l);for(;++e<n;)!function(t,e){i.resolve(t).then(function(t){a[e]=t,++s!==n||r||(r=!0,u.resolve(o,a))},function(t){r||(r=!0,u.reject(o,t))})}(t[e],e);return o},o.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,n=!1;if(!i)return this.resolve([]);var r=-1,a=new this(l);for(;++r<i;)!function(t){e.resolve(t).then(function(t){n||(n=!0,u.resolve(a,t))},function(t){n||(n=!0,u.reject(a,t))})}(t[r]);return a}},{1:1}],3:[function(e,t,i){!function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var o=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}();function a(e,i){e=e||[],i=i||{};try{return new Blob(e,i)}catch(t){if("TypeError"!==t.name)throw t;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(i.type)}}"undefined"==typeof Promise&&t(3);var h=Promise;function c(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}function l(t,e,i){"function"==typeof e&&t.then(e),"function"==typeof i&&t.catch(i)}function d(t){return t="string"!=typeof t?String(t):t}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var s="local-forage-detect-blob-support",r=void 0,p={},f=Object.prototype.toString,m="readonly",g="readwrite";function v(t){return"boolean"==typeof r?h.resolve(r):(n=t,new h(function(i){var t=n.transaction(s,g),e=a([""]);t.objectStore(s).put(e,"key"),t.onabort=function(t){t.preventDefault(),t.stopPropagation(),i(!1)},t.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),e=navigator.userAgent.match(/Edge\//);i(e||!t||43<=parseInt(t[1],10))}}).catch(function(){return!1}).then(function(t){return r=t}));var n}function y(t){var t=p[t.name],i={};i.promise=new h(function(t,e){i.resolve=t,i.reject=e}),t.deferredOperations.push(i),t.dbReady?t.dbReady=t.dbReady.then(function(){return i.promise}):t.dbReady=i.promise}function _(t){t=p[t.name].deferredOperations.pop();return t&&(t.resolve(),t.promise)}function b(t,e){t=p[t.name].deferredOperations.pop();if(t)return t.reject(e),t.promise}function w(r,a){return new h(function(e,i){if(p[r.name]=p[r.name]||A(),r.db){if(!a)return e(r.db);y(r),r.db.close()}var t=[r.name];a&&t.push(r.version);var n=o.open.apply(o,t);a&&(n.onupgradeneeded=function(t){var e=n.result;try{e.createObjectStore(r.storeName),t.oldVersion<=1&&e.createObjectStore(s)}catch(t){if("ConstraintError"!==t.name)throw t}}),n.onerror=function(t){t.preventDefault(),i(n.error)},n.onsuccess=function(){var t=n.result;t.onversionchange=function(t){t.target.close()},e(t),_(r)}})}function T(t){return w(t,!1)}function x(t){return w(t,!0)}function S(t){if(!t.db)return 1;var e=!t.db.objectStoreNames.contains(t.storeName),i=t.version<t.db.version,n=t.version>t.db.version;return i&&(t.version,t.version=t.db.version),(n||e)&&(!e||(e=t.db.version+1)>t.version&&(t.version=e),1)}function E(t){return a([function(t){for(var e=t.length,i=new ArrayBuffer(e),n=new Uint8Array(i),r=0;r<e;r++)n[r]=t.charCodeAt(r);return i}(atob(t.data))],{type:t.type})}function k(t){return t&&t.__local_forage_encoded_blob}function C(t){var e=this,i=e._initReady().then(function(){var t=p[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady});return l(i,t,t),i}function I(e,i,n,r){void 0===r&&(r=1);try{var t=e.db.transaction(e.storeName,i);n(null,t)}catch(t){if(0<r&&(!e.db||"InvalidStateError"===t.name||"NotFoundError"===t.name))return h.resolve().then(function(){if(!e.db||"NotFoundError"===t.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),x(e)}).then(function(){return function(i){y(i);for(var n=p[i.name],r=n.forages,t=0;t<r.length;t++){var e=r[t];e._dbInfo.db&&(e._dbInfo.db.close(),e._dbInfo.db=null)}return i.db=null,T(i).then(function(t){return i.db=t,S(i)?x(i):t}).then(function(t){i.db=n.db=t;for(var e=0;e<r.length;e++)r[e]._dbInfo.db=t}).catch(function(t){throw b(i,t),t})}(e).then(function(){I(e,i,n,r-1)})}).catch(n);n(t)}}function A(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}var P={_driver:"asyncStorage",_initStorage:function(t){var n=this,r={db:null};if(t)for(var e in t)r[e]=t[e];var a=p[r.name];a||(a=A(),p[r.name]=a),a.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=C);var i=[];function s(){return h.resolve()}for(var o=0;o<a.forages.length;o++){var l=a.forages[o];l!==n&&i.push(l._initReady().catch(s))}var u=a.forages.slice(0);return h.all(i).then(function(){return r.db=a.db,T(r)}).then(function(t){return r.db=t,S(r,n._defaultConfig.version)?x(r):t}).then(function(t){r.db=a.db=t,n._dbInfo=r;for(var e=0;e<u.length;e++){var i=u[e];i!==n&&(i._dbInfo.db=r.db,i._dbInfo.version=r.version)}})},_support:function(){try{if(!o||!o.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}}(),iterate:function(s,t){var o=this,e=new h(function(r,a){o.ready().then(function(){I(o._dbInfo,m,function(t,e){if(t)return a(t);try{var i=e.objectStore(o._dbInfo.storeName).openCursor(),n=1;i.onsuccess=function(){var t,e=i.result;e?(k(t=e.value)&&(t=E(t)),void 0!==(t=s(t,e.key,n++))?r(t):e.continue()):r()},i.onerror=function(){a(i.error)}}catch(t){a(t)}})}).catch(a)});return c(e,t),e},getItem:function(a,t){var s=this;a=d(a);var e=new h(function(n,r){s.ready().then(function(){I(s._dbInfo,m,function(t,e){if(t)return r(t);try{var i=e.objectStore(s._dbInfo.storeName).get(a);i.onsuccess=function(){var t=i.result;k(t=void 0===t?null:t)&&(t=E(t)),n(t)},i.onerror=function(){r(i.error)}}catch(t){r(t)}})}).catch(r)});return c(e,t),e},setItem:function(o,e,t){var l=this;o=d(o);var i=new h(function(a,s){var t;l.ready().then(function(){return t=l._dbInfo,"[object Blob]"===f.call(e)?v(t.db).then(function(t){return t?e:(n=e,new h(function(e,t){var i=new FileReader;i.onerror=t,i.onloadend=function(t){t=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:t,type:n.type})},i.readAsBinaryString(n)}));var n}):e}).then(function(r){I(l._dbInfo,g,function(t,e){if(t)return s(t);try{var i=e.objectStore(l._dbInfo.storeName);null===r&&(r=void 0);var n=i.put(r,o);e.oncomplete=function(){a(r=void 0===r?null:r)},e.onabort=e.onerror=function(){var t=n.error||n.transaction.error;s(t)}}catch(t){s(t)}})}).catch(s)});return c(i,t),i},removeItem:function(a,t){var s=this;a=d(a);var e=new h(function(n,r){s.ready().then(function(){I(s._dbInfo,g,function(t,e){if(t)return r(t);try{var i=e.objectStore(s._dbInfo.storeName).delete(a);e.oncomplete=function(){n()},e.onerror=function(){r(i.error)},e.onabort=function(){var t=i.error||i.transaction.error;r(t)}}catch(t){r(t)}})}).catch(r)});return c(e,t),e},clear:function(t){var a=this,e=new h(function(n,r){a.ready().then(function(){I(a._dbInfo,g,function(t,e){if(t)return r(t);try{var i=e.objectStore(a._dbInfo.storeName).clear();e.oncomplete=function(){n()},e.onabort=e.onerror=function(){var t=i.error||i.transaction.error;r(t)}}catch(t){r(t)}})}).catch(r)});return c(e,t),e},length:function(t){var a=this,e=new h(function(n,r){a.ready().then(function(){I(a._dbInfo,m,function(t,e){if(t)return r(t);try{var i=e.objectStore(a._dbInfo.storeName).count();i.onsuccess=function(){n(i.result)},i.onerror=function(){r(i.error)}}catch(t){r(t)}})}).catch(r)});return c(e,t),e},key:function(o,t){var l=this,e=new h(function(a,s){o<0?a(null):l.ready().then(function(){I(l._dbInfo,m,function(t,e){if(t)return s(t);try{var i=e.objectStore(l._dbInfo.storeName),n=!1,r=i.openKeyCursor();r.onsuccess=function(){var t=r.result;t?0===o||n?a(t.key):(n=!0,t.advance(o)):a(null)},r.onerror=function(){s(r.error)}}catch(t){s(t)}})}).catch(s)});return c(e,t),e},keys:function(t){var s=this,e=new h(function(r,a){s.ready().then(function(){I(s._dbInfo,m,function(t,e){if(t)return a(t);try{var i=e.objectStore(s._dbInfo.storeName).openKeyCursor(),n=[];i.onsuccess=function(){var t=i.result;t?(n.push(t.key),t.continue()):r(n)},i.onerror=function(){a(i.error)}}catch(t){a(t)}})}).catch(a)});return c(e,t),e},dropInstance:function(s,t){t=u.apply(this,arguments);var e,i=this.config();return(s="function"!=typeof s&&s||{}).name||(s.name=s.name||i.name,s.storeName=s.storeName||i.storeName),c(e=s.name?(e=s.name===i.name&&this._dbInfo.db?h.resolve(this._dbInfo.db):T(s).then(function(t){var e=p[s.name],i=e.forages;e.db=t;for(var n=0;n<i.length;n++)i[n]._dbInfo.db=t;return t}),s.storeName?e.then(function(t){if(t.objectStoreNames.contains(s.storeName)){var r=t.version+1;y(s);var n=p[s.name],a=n.forages;t.close();for(var e=0;e<a.length;e++){var i=a[e];i._dbInfo.db=null,i._dbInfo.version=r}return new h(function(e,i){var n=o.open(s.name,r);n.onerror=function(t){n.result.close(),i(t)},n.onupgradeneeded=function(){n.result.deleteObjectStore(s.storeName)},n.onsuccess=function(){var t=n.result;t.close(),e(t)}}).then(function(t){n.db=t;for(var e=0;e<a.length;e++){var i=a[e];i._dbInfo.db=t,_(i._dbInfo)}}).catch(function(t){throw(b(s,t)||h.resolve()).catch(function(){}),t})}}):e.then(function(t){y(s);var i=p[s.name],n=i.forages;t.close();for(var e=0;e<n.length;e++)n[e]._dbInfo.db=null;return new h(function(e,i){var n=o.deleteDatabase(s.name);n.onerror=function(){var t=n.result;t&&t.close(),i(n.error)},n.onblocked=function(){},n.onsuccess=function(){var t=n.result;t&&t.close(),e(t)}}).then(function(t){i.db=t;for(var e=0;e<n.length;e++)_(n[e]._dbInfo)}).catch(function(t){throw(b(s,t)||h.resolve()).catch(function(){}),t})})):h.reject("Invalid arguments"),t),e}};var D="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",O=/^~~local_forage_type~([^~]+)~/,L="__lfsc__:",M=L.length,R=M+"arbf".length,N=Object.prototype.toString;function B(t){var e,i,n,r,a=.75*t.length,s=t.length,o=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);for(var a=new ArrayBuffer(a),l=new Uint8Array(a),u=0;u<s;u+=4)e=D.indexOf(t[u]),i=D.indexOf(t[u+1]),n=D.indexOf(t[u+2]),r=D.indexOf(t[u+3]),l[o++]=e<<2|i>>4,l[o++]=(15&i)<<4|n>>2,l[o++]=(3&n)<<6|63&r;return a}function F(t){for(var e=new Uint8Array(t),i="",n=0;n<e.length;n+=3)i+=D[e[n]>>2],i+=D[(3&e[n])<<4|e[n+1]>>4],i+=D[(15&e[n+1])<<2|e[n+2]>>6],i+=D[63&e[n+2]];return e.length%3==2?i=i.substring(0,i.length-1)+"=":e.length%3==1&&(i=i.substring(0,i.length-2)+"=="),i}var U={serialize:function(e,i){var t="";if(e&&(t=N.call(e)),e&&("[object ArrayBuffer]"===t||e.buffer&&"[object ArrayBuffer]"===N.call(e.buffer))){var n,r=L;e instanceof ArrayBuffer?(n=e,r+="arbf"):(n=e.buffer,"[object Int8Array]"===t?r+="si08":"[object Uint8Array]"===t?r+="ui08":"[object Uint8ClampedArray]"===t?r+="uic8":"[object Int16Array]"===t?r+="si16":"[object Uint16Array]"===t?r+="ur16":"[object Int32Array]"===t?r+="si32":"[object Uint32Array]"===t?r+="ui32":"[object Float32Array]"===t?r+="fl32":"[object Float64Array]"===t?r+="fl64":i(new Error("Failed to get type for BinaryArray"))),i(r+F(n))}else if("[object Blob]"===t){t=new FileReader;t.onload=function(){var t="~~local_forage_type~"+e.type+"~"+F(this.result);i(L+"blob"+t)},t.readAsArrayBuffer(e)}else try{i(JSON.stringify(e))}catch(t){i(null,t)}},deserialize:function(t){if(t.substring(0,M)!==L)return JSON.parse(t);var e,i=t.substring(R),n=t.substring(M,R);"blob"===n&&O.test(i)&&(e=(t=i.match(O))[1],i=i.substring(t[0].length));var r=B(i);switch(n){case"arbf":return r;case"blob":return a([r],{type:e});case"si08":return new Int8Array(r);case"ui08":return new Uint8Array(r);case"uic8":return new Uint8ClampedArray(r);case"si16":return new Int16Array(r);case"ur16":return new Uint16Array(r);case"si32":return new Int32Array(r);case"ui32":return new Uint32Array(r);case"fl32":return new Float32Array(r);case"fl64":return new Float64Array(r);default:throw new Error("Unkown type: "+n)}},stringToBuffer:B,bufferToString:F};function j(t,e,i,n){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],i,n)}function q(t,n,r,a,s,o){t.executeSql(r,a,s,function(t,i){i.code===i.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[n.storeName],function(t,e){e.rows.length?o(t,i):j(t,n,function(){t.executeSql(r,a,s,o)},o)},o):o(t,i)},o)}function z(s,t,o,l){var u=this;s=d(s);var e=new h(function(r,a){u.ready().then(function(){var i=t=void 0===t?null:t,n=u._dbInfo;n.serializer.serialize(t,function(e,t){t?a(t):n.db.transaction(function(t){q(t,n,"INSERT OR REPLACE INTO "+n.storeName+" (key, value) VALUES (?, ?)",[s,e],function(){r(i)},function(t,e){a(e)})},function(t){t.code===t.QUOTA_ERR&&(0<l?r(z.apply(u,[s,i,o,l-1])):a(t))})})}).catch(a)});return c(e,o),e}var H={_driver:"webSQLStorage",_initStorage:function(t){var n=this,r={db:null};if(t)for(var e in t)r[e]="string"!=typeof t[e]?t[e].toString():t[e];var i=new h(function(e,i){try{r.db=openDatabase(r.name,String(r.version),r.description,r.size)}catch(t){return i(t)}r.db.transaction(function(t){j(t,r,function(){n._dbInfo=r,e()},function(t,e){i(e)})},i)});return r.serializer=U,i},_support:"function"==typeof openDatabase,iterate:function(u,t){var e=this,i=new h(function(l,i){e.ready().then(function(){var o=e._dbInfo;o.db.transaction(function(t){q(t,o,"SELECT * FROM "+o.storeName,[],function(t,e){for(var i=e.rows,n=i.length,r=0;r<n;r++){var a=i.item(r),s=(s=a.value)&&o.serializer.deserialize(s);if(void 0!==(s=u(s,a.key,r+1)))return void l(s)}l()},function(t,e){i(e)})})}).catch(i)});return c(i,t),i},getItem:function(e,t){var a=this;e=d(e);var i=new h(function(n,r){a.ready().then(function(){var i=a._dbInfo;i.db.transaction(function(t){q(t,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(t,e){e=(e=e.rows.length?e.rows.item(0).value:null)&&i.serializer.deserialize(e);n(e)},function(t,e){r(e)})})}).catch(r)});return c(i,t),i},setItem:function(t,e,i){return z.apply(this,[t,e,i,1])},removeItem:function(r,t){var a=this;r=d(r);var e=new h(function(i,n){a.ready().then(function(){var e=a._dbInfo;e.db.transaction(function(t){q(t,e,"DELETE FROM "+e.storeName+" WHERE key = ?",[r],function(){i()},function(t,e){n(e)})})}).catch(n)});return c(e,t),e},clear:function(t){var r=this,e=new h(function(i,n){r.ready().then(function(){var e=r._dbInfo;e.db.transaction(function(t){q(t,e,"DELETE FROM "+e.storeName,[],function(){i()},function(t,e){n(e)})})}).catch(n)});return c(e,t),e},length:function(t){var r=this,e=new h(function(i,n){r.ready().then(function(){var e=r._dbInfo;e.db.transaction(function(t){q(t,e,"SELECT COUNT(key) as c FROM "+e.storeName,[],function(t,e){e=e.rows.item(0).c;i(e)},function(t,e){n(e)})})}).catch(n)});return c(e,t),e},key:function(r,t){var a=this,e=new h(function(i,n){a.ready().then(function(){var e=a._dbInfo;e.db.transaction(function(t){q(t,e,"SELECT key FROM "+e.storeName+" WHERE id = ? LIMIT 1",[r+1],function(t,e){e=e.rows.length?e.rows.item(0).key:null;i(e)},function(t,e){n(e)})})}).catch(n)});return c(e,t),e},keys:function(t){var n=this,e=new h(function(r,i){n.ready().then(function(){var e=n._dbInfo;e.db.transaction(function(t){q(t,e,"SELECT key FROM "+e.storeName,[],function(t,e){for(var i=[],n=0;n<e.rows.length;n++)i.push(e.rows.item(n).key);r(i)},function(t,e){i(e)})})}).catch(i)});return c(e,t),e},dropInstance:function(i,t){t=u.apply(this,arguments);var n=this.config();(i="function"!=typeof i&&i||{}).name||(i.name=i.name||n.name,i.storeName=i.storeName||n.storeName);var r=this,e=i.name?new h(function(t){var a,e=i.name===n.name?r._dbInfo.db:openDatabase(i.name,"","",0);i.storeName?t({db:e,storeNames:[i.storeName]}):t((a=e,new h(function(r,i){a.transaction(function(t){t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(t,e){for(var i=[],n=0;n<e.rows.length;n++)i.push(e.rows.item(n).name);r({db:a,storeNames:i})},function(t,e){i(e)})},function(t){i(t)})})))}).then(function(s){return new h(function(r,a){s.db.transaction(function(n){for(var t=[],e=0,i=s.storeNames.length;e<i;e++)t.push(function(e){return new h(function(t,i){n.executeSql("DROP TABLE IF EXISTS "+e,[],function(){t()},function(t,e){i(e)})})}(s.storeNames[e]));h.all(t).then(function(){r()}).catch(function(t){a(t)})},function(t){a(t)})})}):h.reject("Invalid arguments");return c(e,t),e}};function V(t,e){var i=t.name+"/";return t.storeName!==e.storeName&&(i+=t.storeName+"/"),i}function W(){return!function(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),void localStorage.removeItem(t)}catch(t){return 1}}()||0<localStorage.length}function G(t,e){for(var i,n,r=t.length,a=0;a<r;){if((i=t[a])===(n=e)||"number"==typeof i&&"number"==typeof n&&isNaN(i)&&isNaN(n))return 1;a++}}var t={_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var i in t)e[i]=t[i];return e.keyPrefix=V(t,this._defaultConfig),W()?((this._dbInfo=e).serializer=U,h.resolve()):h.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(t){return!1}}(),iterate:function(l,t){var u=this,e=u.ready().then(function(){for(var t=u._dbInfo,e=t.keyPrefix,i=e.length,n=localStorage.length,r=1,a=0;a<n;a++){var s=localStorage.key(a);if(0===s.indexOf(e)){var o=(o=localStorage.getItem(s))&&t.serializer.deserialize(o);if(void 0!==(o=l(o,s.substring(i),r++)))return o}}});return c(e,t),e},getItem:function(i,t){var n=this;i=d(i);var e=n.ready().then(function(){var t=n._dbInfo,e=localStorage.getItem(t.keyPrefix+i);return e=e&&t.serializer.deserialize(e)});return c(e,t),e},setItem:function(s,t,e){var o=this;s=d(s);var i=o.ready().then(function(){var a=t=void 0===t?null:t;return new h(function(i,n){var r=o._dbInfo;r.serializer.serialize(t,function(t,e){if(e)n(e);else try{localStorage.setItem(r.keyPrefix+s,t),i(a)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||n(t),n(t)}})})});return c(i,e),i},removeItem:function(e,t){var i=this;e=d(e);var n=i.ready().then(function(){var t=i._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return c(n,t),n},clear:function(t){var n=this,e=n.ready().then(function(){for(var t=n._dbInfo.keyPrefix,e=localStorage.length-1;0<=e;e--){var i=localStorage.key(e);0===i.indexOf(t)&&localStorage.removeItem(i)}});return c(e,t),e},length:function(t){var e=this.keys().then(function(t){return t.length});return c(e,t),e},key:function(i,t){var n=this,e=n.ready().then(function(){var e,t=n._dbInfo;try{e=localStorage.key(i)}catch(t){e=null}return e=e&&e.substring(t.keyPrefix.length)});return c(e,t),e},keys:function(t){var a=this,e=a.ready().then(function(){for(var t=a._dbInfo,e=localStorage.length,i=[],n=0;n<e;n++){var r=localStorage.key(n);0===r.indexOf(t.keyPrefix)&&i.push(r.substring(t.keyPrefix.length))}return i});return c(e,t),e},dropInstance:function(e,t){t=u.apply(this,arguments),(e="function"!=typeof e&&e||{}).name||(n=this.config(),e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var i=this,n=e.name?new h(function(t){e.storeName?t(V(e,i._defaultConfig)):t(e.name+"/")}).then(function(t){for(var e=localStorage.length-1;0<=e;e--){var i=localStorage.key(e);0===i.indexOf(t)&&localStorage.removeItem(i)}}):h.reject("Invalid arguments");return c(n,t),n}},X=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},$={},Y={},K={INDEXEDDB:P,WEBSQL:H,LOCALSTORAGE:t},t=[K.INDEXEDDB._driver,K.WEBSQL._driver,K.LOCALSTORAGE._driver],Q=["dropInstance"],J=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Q),Z={description:"",driver:t.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function tt(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];if(i)for(var n in i)i.hasOwnProperty(n)&&(X(i[n])?t[n]=i[n].slice():t[n]=i[n])}return t}function et(t){for(var e in!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,et),K){var i,n;K.hasOwnProperty(e)&&(n=(i=K[e])._driver,this[e]=n,$[n]||this.defineDriver(i))}this._defaultConfig=tt({},Z),this._config=tt({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}t=new(et.prototype.config=function(t){if("object"!==(void 0===t?"undefined":n(t)))return"string"==typeof t?this._config[t]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t&&t.driver)||this.setDriver(this._config.driver)},et.prototype.defineDriver=function(u,t,e){var i=new h(function(e,i){try{var n=u._driver,t=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!u._driver)return void i(t);for(var r=J.concat("_initStorage"),a=0,s=r.length;a<s;a++){var o=r[a];if((!G(Q,o)||u[o])&&"function"!=typeof u[o])return void i(t)}!function(){for(var t=0,e=Q.length;t<e;t++){var i=Q[t];u[i]||(u[i]=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),t=h.reject(t);return c(t,arguments[arguments.length-1]),t}}(i))}}();var l=function(t){$[n],$[n]=u,Y[n]=t,e()};"_support"in u?u._support&&"function"==typeof u._support?u._support().then(l,i):l(!!u._support):l(!0)}catch(t){i(t)}});return l(i,t,e),i},et.prototype.driver=function(){return this._driver||null},et.prototype.getDriver=function(t,e,i){t=$[t]?h.resolve($[t]):h.reject(new Error("Driver not found."));return l(t,e,i),t},et.prototype.getSerializer=function(t){var e=h.resolve(U);return l(e,t),e},et.prototype.ready=function(t){var e=this,i=e._driverSet.then(function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready});return l(i,t,t),i},et.prototype.setDriver=function(t,e,i){var a=this;X(t)||(t=[t]);var n=this._getSupportedDrivers(t);function s(){a._config.driver=a.driver()}function o(t){return a._extend(t),s(),a._ready=a._initStorage(a._config),a._ready}function r(r){return function(){var n=0;return function t(){for(;n<r.length;){var e=r[n];return n++,a._dbInfo=null,a._ready=null,a.getDriver(e).then(o).catch(t)}s();var i=new Error("No available storage method found.");return a._driverSet=h.reject(i),a._driverSet}()}}t=null!==this._driverSet?this._driverSet.catch(function(){return h.resolve()}):h.resolve();return this._driverSet=t.then(function(){var t=n[0];return a._dbInfo=null,a._ready=null,a.getDriver(t).then(function(t){a._driver=t._driver,s(),a._wrapLibraryMethodsWithReady(),a._initDriver=r(n)})}).catch(function(){s();var t=new Error("No available storage method found.");return a._driverSet=h.reject(t),a._driverSet}),l(this._driverSet,e,i),this._driverSet},et.prototype.supports=function(t){return!!Y[t]},et.prototype._extend=function(t){tt(this,t)},et.prototype._getSupportedDrivers=function(t){for(var e=[],i=0,n=t.length;i<n;i++){var r=t[i];this.supports(r)&&e.push(r)}return e},et.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=J.length;t<e;t++)!function(e,i){e[i]=function(){var t=arguments;return e.ready().then(function(){return e[i].apply(e,t)})}}(this,J[t])},et.prototype.createInstance=function(t){return new et(t)},et);e.exports=t},{3:3}]},{},[4])(4)}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Sortable=e()}(this,function(){"use strict";function e(e,t){var i,n=Object.keys(e);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(e),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)),n}function P(n){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?e(Object(r),!0).forEach(function(t){var e,i;e=n,t=r[i=t],i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):e(Object(r)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))})}return n}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(){return(s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i,n=arguments[e];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function r(t,e){if(null==t)return{};var i,n=function(t,e){if(null==t)return{};for(var i,n={},r=Object.keys(t),a=0;a<r.length;a++)i=r[a],0<=e.indexOf(i)||(n[i]=t[i]);return n}(t,e);if(Object.getOwnPropertySymbols)for(var r=Object.getOwnPropertySymbols(t),a=0;a<r.length;a++)i=r[a],0<=e.indexOf(i)||Object.prototype.propertyIsEnumerable.call(t,i)&&(n[i]=t[i]);return n}function a(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(i="Object"===i&&t.constructor?t.constructor.name:i)||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?o(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function t(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}var _=t(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),b=t(/Edge/i),l=t(/firefox/i),h=t(/safari/i)&&!t(/chrome/i)&&!t(/android/i),i=t(/iP(ad|od|hone)/i),u=t(/chrome/i)&&t(/android/i),c={capture:!1,passive:!1};function d(t,e,i){t.addEventListener(e,i,!_&&c)}function p(t,e,i){t.removeEventListener(e,i,!_&&c)}function f(t,e){if(e&&(">"===e[0]&&(e=e.substring(1)),t))try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch(t){return}}function D(t,e,i,n){if(t){i=i||document;do{if(null!=e&&(">"!==e[0]||t.parentNode===i)&&f(t,e)||n&&t===i)return t}while(t!==i&&(t=(r=t).host&&r!==document&&r.host.nodeType?r.host:r.parentNode))}var r;return null}var m,g=/\s+/g;function O(t,e,i){var n;t&&e&&(t.classList?t.classList[i?"add":"remove"](e):(n=(" "+t.className+" ").replace(g," ").replace(" "+e+" "," "),t.className=(n+(i?" "+e:"")).replace(g," ")))}function L(t,e,i){var n=t&&t.style;if(n){if(void 0===i)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(i=t.currentStyle),void 0===e?i:i[e];n[e=!(e in n||-1!==e.indexOf("webkit"))?"-webkit-"+e:e]=i+("string"==typeof i?"":"px")}}function v(t,e){var i="";if("string"==typeof t)i=t;else do{var n=L(t,"transform")}while(n&&"none"!==n&&(i=n+" "+i),!e&&(t=t.parentNode));var r=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return r&&new r(i)}function y(t,e,i){if(t){var n=t.getElementsByTagName(e),r=0,a=n.length;if(i)for(;r<a;r++)i(n[r],r);return n}return[]}function I(){var t=document.scrollingElement;return t||document.documentElement}function M(t,e,i,n,r){if(t.getBoundingClientRect||t===window){var a,s,o,l,u,h,c=t!==window&&t.parentNode&&t!==I()?(s=(a=t.getBoundingClientRect()).top,o=a.left,l=a.bottom,u=a.right,h=a.height,a.width):(o=s=0,l=window.innerHeight,u=window.innerWidth,h=window.innerHeight,window.innerWidth);if((e||i)&&t!==window&&(r=r||t.parentNode,!_))do{if(r&&r.getBoundingClientRect&&("none"!==L(r,"transform")||i&&"static"!==L(r,"position"))){var d=r.getBoundingClientRect();s-=d.top+parseInt(L(r,"border-top-width")),o-=d.left+parseInt(L(r,"border-left-width")),l=s+a.height,u=o+a.width;break}}while(r=r.parentNode);return n&&t!==window&&(n=(e=v(r||t))&&e.a,t=e&&e.d,e&&(l=(s/=t)+(h/=t),u=(o/=n)+(c/=n))),{top:s,left:o,bottom:l,right:u,width:c,height:h}}}function R(t,e,i){for(var n=A(t,!0),r=M(t)[e];n;){var a=M(n)[i];if(!("top"===i||"left"===i?a<=r:r<=a))return n;if(n===I())break;n=A(n,!1)}return!1}function N(t,e,i,n){for(var r=0,a=0,s=t.children;a<s.length;){if("none"!==s[a].style.display&&s[a]!==Ft.ghost&&(n||s[a]!==Ft.dragged)&&D(s[a],i.draggable,t,!1)){if(r===e)return s[a];r++}a++}return null}function B(t,e){for(var i=t.lastElementChild;i&&(i===Ft.ghost||"none"===L(i,"display")||e&&!f(i,e));)i=i.previousElementSibling;return i||null}function F(t,e){var i=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)"TEMPLATE"===t.nodeName.toUpperCase()||t===Ft.clone||e&&!f(t,e)||i++;return i}function w(t){var e=0,i=0,n=I();if(t)do{var r=v(t),a=r.a,r=r.d}while(e+=t.scrollLeft*a,i+=t.scrollTop*r,t!==n&&(t=t.parentNode));return[e,i]}function A(t,e){if(!t||!t.getBoundingClientRect)return I();var i=t,n=!1;do{if(i.clientWidth<i.scrollWidth||i.clientHeight<i.scrollHeight){var r=L(i);if(i.clientWidth<i.scrollWidth&&("auto"==r.overflowX||"scroll"==r.overflowX)||i.clientHeight<i.scrollHeight&&("auto"==r.overflowY||"scroll"==r.overflowY)){if(!i.getBoundingClientRect||i===document.body)return I();if(n||e)return i;n=!0}}}while(i=i.parentNode);return I()}function T(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}function x(e,i){return function(){var t;m||(1===(t=arguments).length?e.call(this,t[0]):e.apply(this,t),m=setTimeout(function(){m=void 0},i))}}function U(t,e,i){t.scrollLeft+=e,t.scrollTop+=i}function S(t){var e=window.Polymer,i=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):i?i(t).clone(!0)[0]:t.cloneNode(!0)}function E(t,e){L(t,"position","absolute"),L(t,"top",e.top),L(t,"left",e.left),L(t,"width",e.width),L(t,"height",e.height)}function k(t){L(t,"position",""),L(t,"top",""),L(t,"left",""),L(t,"width",""),L(t,"height","")}var j="Sortable"+(new Date).getTime();function C(){var e,n=[];return{captureAnimationState:function(){n=[],this.options.animation&&[].slice.call(this.el.children).forEach(function(t){var e,i;"none"!==L(t,"display")&&t!==Ft.ghost&&(n.push({target:t,rect:M(t)}),e=P({},n[n.length-1].rect),!t.thisAnimationDuration||(i=v(t,!0))&&(e.top-=i.f,e.left-=i.e),t.fromRect=e)})},addAnimationState:function(t){n.push(t)},removeAnimationState:function(t){n.splice(function(t,e){for(var i in t)if(t.hasOwnProperty(i))for(var n in e)if(e.hasOwnProperty(n)&&e[n]===t[i][n])return Number(i);return-1}(n,{target:t}),1)},animateAll:function(t){var u=this;if(!this.options.animation)return clearTimeout(e),void("function"==typeof t&&t());var h=!1,c=0;n.forEach(function(t){var e=0,i=t.target,n=i.fromRect,r=M(i),a=i.prevFromRect,s=i.prevToRect,o=t.rect,l=v(i,!0);l&&(r.top-=l.f,r.left-=l.e),i.toRect=r,i.thisAnimationDuration&&T(a,r)&&!T(n,r)&&(o.top-r.top)/(o.left-r.left)==(n.top-r.top)/(n.left-r.left)&&(t=o,l=a,a=s,s=u.options,e=Math.sqrt(Math.pow(l.top-t.top,2)+Math.pow(l.left-t.left,2))/Math.sqrt(Math.pow(l.top-a.top,2)+Math.pow(l.left-a.left,2))*s.animation),T(r,n)||(i.prevFromRect=n,i.prevToRect=r,e=e||u.options.animation,u.animate(i,o,r,e)),e&&(h=!0,c=Math.max(c,e),clearTimeout(i.animationResetTimer),i.animationResetTimer=setTimeout(function(){i.animationTime=0,i.prevFromRect=null,i.fromRect=null,i.prevToRect=null,i.thisAnimationDuration=null},e),i.thisAnimationDuration=e)}),clearTimeout(e),h?e=setTimeout(function(){"function"==typeof t&&t()},c):"function"==typeof t&&t(),n=[]},animate:function(t,e,i,n){var r,a;n&&(L(t,"transition",""),L(t,"transform",""),r=(a=v(this.el))&&a.a,a=a&&a.d,r=(e.left-i.left)/(r||1),a=(e.top-i.top)/(a||1),t.animatingX=!!r,t.animatingY=!!a,L(t,"transform","translate3d("+r+"px,"+a+"px,0)"),this.forRepaintDummy=t.offsetWidth,L(t,"transition","transform "+n+"ms"+(this.options.easing?" "+this.options.easing:"")),L(t,"transform","translate3d(0,0,0)"),"number"==typeof t.animated&&clearTimeout(t.animated),t.animated=setTimeout(function(){L(t,"transition",""),L(t,"transform",""),t.animated=!1,t.animatingX=!1,t.animatingY=!1},n))}}}var q=[],z={initializeByDefault:!0},H={mount:function(e){for(var t in z)!z.hasOwnProperty(t)||t in e||(e[t]=z[t]);q.forEach(function(t){if(t.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),q.push(e)},pluginEvent:function(e,i,n){var t=this;this.eventCanceled=!1,n.cancel=function(){t.eventCanceled=!0};var r=e+"Global";q.forEach(function(t){i[t.pluginName]&&(i[t.pluginName][r]&&i[t.pluginName][r](P({sortable:i},n)),i.options[t.pluginName]&&i[t.pluginName][e]&&i[t.pluginName][e](P({sortable:i},n)))})},initializePlugins:function(i,n,r,t){for(var e in q.forEach(function(t){var e=t.pluginName;(i.options[e]||t.initializeByDefault)&&((t=new t(i,n,i.options)).sortable=i,t.options=i.options,i[e]=t,s(r,t.defaults))}),i.options){var a;i.options.hasOwnProperty(e)&&(void 0!==(a=this.modifyOption(i,e,i.options[e]))&&(i.options[e]=a))}},getEventProperties:function(e,i){var n={};return q.forEach(function(t){"function"==typeof t.eventProperties&&s(n,t.eventProperties.call(i[t.pluginName],e))}),n},modifyOption:function(e,i,n){var r;return q.forEach(function(t){e[t.pluginName]&&t.optionListeners&&"function"==typeof t.optionListeners[i]&&(r=t.optionListeners[i].call(e[t.pluginName],n))}),r}};function V(t){var e=t.sortable,i=t.rootEl,n=t.name,r=t.targetEl,a=t.cloneEl,s=t.toEl,o=t.fromEl,l=t.oldIndex,u=t.newIndex,h=t.oldDraggableIndex,c=t.newDraggableIndex,d=t.originalEvent,p=t.putSortable,f=t.extraEventProperties;if(e=e||i&&i[j]){var m,g=e.options,t="on"+n.charAt(0).toUpperCase()+n.substr(1);!window.CustomEvent||_||b?(m=document.createEvent("Event")).initEvent(n,!0,!0):m=new CustomEvent(n,{bubbles:!0,cancelable:!0}),m.to=s||i,m.from=o||i,m.item=r||i,m.clone=a,m.oldIndex=l,m.newIndex=u,m.oldDraggableIndex=h,m.newDraggableIndex=c,m.originalEvent=d,m.pullMode=p?p.lastPutMode:void 0;var v,y=P(P({},f),H.getEventProperties(n,e));for(v in y)m[v]=y[v];i&&i.dispatchEvent(m),g[t]&&g[t].call(e,m)}}function W(t,e){var i=(n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).evt,n=r(n,G);H.pluginEvent.bind(Ft)(t,e,P({dragEl:J,parentEl:Z,ghostEl:tt,rootEl:et,nextEl:it,lastDownEl:nt,cloneEl:rt,cloneHidden:at,dragStarted:yt,putSortable:ct,activeSortable:Ft.active,originalEvent:i,oldIndex:st,oldDraggableIndex:lt,newIndex:ot,newDraggableIndex:ut,hideGhostForTarget:K,unhideGhostForTarget:Q,cloneNowHidden:function(){at=!0},cloneNowShown:function(){at=!1},dispatchSortableEvent:function(t){X({sortable:e,name:t,originalEvent:i})}},n))}var G=["evt"];function X(t){V(P({putSortable:ct,cloneEl:rt,targetEl:J,rootEl:et,oldIndex:st,oldDraggableIndex:lt,newIndex:ot,newDraggableIndex:ut},t))}function $(t,e){var i=L(t),n=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),r=N(t,0,e),a=N(t,1,e),s=r&&L(r),o=a&&L(a),l=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+M(r).width,t=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+M(a).width;if("flex"===i.display)return"column"===i.flexDirection||"column-reverse"===i.flexDirection?"vertical":"horizontal";if("grid"===i.display)return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(r&&s.float&&"none"!==s.float){e="left"===s.float?"left":"right";return!a||"both"!==o.clear&&o.clear!==e?"horizontal":"vertical"}return r&&("block"===s.display||"flex"===s.display||"table"===s.display||"grid"===s.display||n<=l&&"none"===i[Lt]||a&&"none"===i[Lt]&&n<l+t)?"vertical":"horizontal"}function Y(t){function o(a,s){return function(t,e,i,n){var r=t.options.group.name&&e.options.group.name&&t.options.group.name===e.options.group.name;if(null==a&&(s||r))return!0;if(null==a||!1===a)return!1;if(s&&"clone"===a)return a;if("function"==typeof a)return o(a(t,e,i,n),s)(t,e,i,n);e=(s?t:e).options.group.name;return!0===a||"string"==typeof a&&a===e||a.join&&-1<a.indexOf(e)}}var e={},i=t.group;i&&"object"==n(i)||(i={name:i}),e.name=i.name,e.checkPull=o(i.pull,!0),e.checkPut=o(i.put),e.revertClone=i.revertClone,t.group=e}function K(){!Rt&&tt&&L(tt,"display","none")}function Q(){!Rt&&tt&&L(tt,"display","")}var J,Z,tt,et,it,nt,rt,at,st,ot,lt,ut,ht,ct,dt,pt,ft,mt,gt,vt,yt,_t,bt,wt,Tt,xt=!1,St=!1,Et=[],kt=!1,Ct=!1,It=[],At=!1,Pt=[],Dt="undefined"!=typeof document,Ot=i,Lt=b||_?"cssFloat":"float",Mt=Dt&&!u&&!i&&"draggable"in document.createElement("div"),Rt=function(){if(Dt){if(_)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto","auto"===t.style.pointerEvents}}();Dt&&!u&&document.addEventListener("click",function(t){if(St)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),St=!1},!0);function Nt(t){if(J){t=t.touches?t.touches[0]:t;var e=(r=t.clientX,a=t.clientY,Et.some(function(t){var e=t[j].options.emptyInsertThreshold;if(e&&!B(t)){var i=M(t),n=r>=i.left-e&&r<=i.right+e,e=a>=i.top-e&&a<=i.bottom+e;return n&&e?s=t:void 0}}),s);if(e){var i,n={};for(i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.target=n.rootEl=e,n.preventDefault=void 0,n.stopPropagation=void 0,e[j]._onDragOver(n)}}var r,a,s}function Bt(t){J&&J.parentNode[j]._isOutsideThisEl(t.target)}function Ft(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=s({},e),t[j]=this;var i,n,r={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return $(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(t,e){t.setData("Text",e.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==Ft.supportPointer&&"PointerEvent"in window&&!h,emptyInsertThreshold:5};for(i in H.initializePlugins(this,t,r),r)i in e||(e[i]=r[i]);for(n in Y(e),this)"_"===n.charAt(0)&&"function"==typeof this[n]&&(this[n]=this[n].bind(this));this.nativeDraggable=!e.forceFallback&&Mt,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?d(t,"pointerdown",this._onTapStart):(d(t,"mousedown",this._onTapStart),d(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(d(t,"dragover",this),d(t,"dragenter",this)),Et.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),s(this,C())}function Ut(t,e,i,n,r,a,s,o){var l,u,h=t[j],c=h.options.onMove;return!window.CustomEvent||_||b?(l=document.createEvent("Event")).initEvent("move",!0,!0):l=new CustomEvent("move",{bubbles:!0,cancelable:!0}),l.to=e,l.from=t,l.dragged=i,l.draggedRect=n,l.related=r||e,l.relatedRect=a||M(e),l.willInsertAfter=o,l.originalEvent=s,t.dispatchEvent(l),u=c?c.call(h,l,s):u}function jt(t){t.draggable=!1}function qt(){At=!1}function zt(t){return setTimeout(t,0)}function Ht(t){return clearTimeout(t)}Ft.prototype={constructor:Ft,_isOutsideThisEl:function(t){this.el.contains(t)||t===this.el||(_t=null)},_getDirection:function(t,e){return"function"==typeof this.options.direction?this.options.direction.call(this,t,e,J):this.options.direction},_onTapStart:function(e){if(e.cancelable){var i=this,n=this.el,t=this.options,r=t.preventOnFilter,a=e.type,s=e.touches&&e.touches[0]||e.pointerType&&"touch"===e.pointerType&&e,o=(s||e).target,l=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||o,u=t.filter;if(!function(t){Pt.length=0;var e=t.getElementsByTagName("input"),i=e.length;for(;i--;){var n=e[i];n.checked&&Pt.push(n)}}(n),!J&&!(/mousedown|pointerdown/.test(a)&&0!==e.button||t.disabled)&&!l.isContentEditable&&(this.nativeDraggable||!h||!o||"SELECT"!==o.tagName.toUpperCase())&&!((o=D(o,t.draggable,n,!1))&&o.animated||nt===o)){if(st=F(o),lt=F(o,t.draggable),"function"==typeof u){if(u.call(this,e,o,this))return X({sortable:i,rootEl:l,name:"filter",targetEl:o,toEl:n,fromEl:n}),W("filter",i,{evt:e}),void(r&&e.cancelable&&e.preventDefault())}else if(u=u&&u.split(",").some(function(t){if(t=D(l,t.trim(),n,!1))return X({sortable:i,rootEl:t,name:"filter",targetEl:o,fromEl:n,toEl:n}),W("filter",i,{evt:e}),!0}))return void(r&&e.cancelable&&e.preventDefault());t.handle&&!D(l,t.handle,n,!1)||this._prepareDragStart(e,s,o)}}},_prepareDragStart:function(t,e,i){var n,r=this,a=r.el,s=r.options,o=a.ownerDocument;i&&!J&&i.parentNode===a&&(n=M(i),et=a,Z=(J=i).parentNode,it=J.nextSibling,nt=i,ht=s.group,dt={target:Ft.dragged=J,clientX:(e||t).clientX,clientY:(e||t).clientY},gt=dt.clientX-n.left,vt=dt.clientY-n.top,this._lastX=(e||t).clientX,this._lastY=(e||t).clientY,J.style["will-change"]="all",n=function(){W("delayEnded",r,{evt:t}),Ft.eventCanceled?r._onDrop():(r._disableDelayedDragEvents(),!l&&r.nativeDraggable&&(J.draggable=!0),r._triggerDragStart(t,e),X({sortable:r,name:"choose",originalEvent:t}),O(J,s.chosenClass,!0))},s.ignore.split(",").forEach(function(t){y(J,t.trim(),jt)}),d(o,"dragover",Nt),d(o,"mousemove",Nt),d(o,"touchmove",Nt),d(o,"mouseup",r._onDrop),d(o,"touchend",r._onDrop),d(o,"touchcancel",r._onDrop),l&&this.nativeDraggable&&(this.options.touchStartThreshold=4,J.draggable=!0),W("delayStart",this,{evt:t}),!s.delay||s.delayOnTouchOnly&&!e||this.nativeDraggable&&(b||_)?n():Ft.eventCanceled?this._onDrop():(d(o,"mouseup",r._disableDelayedDrag),d(o,"touchend",r._disableDelayedDrag),d(o,"touchcancel",r._disableDelayedDrag),d(o,"mousemove",r._delayedDragTouchMoveHandler),d(o,"touchmove",r._delayedDragTouchMoveHandler),s.supportPointer&&d(o,"pointermove",r._delayedDragTouchMoveHandler),r._dragStartTimer=setTimeout(n,s.delay)))},_delayedDragTouchMoveHandler:function(t){t=t.touches?t.touches[0]:t;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){J&&jt(J),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;p(t,"mouseup",this._disableDelayedDrag),p(t,"touchend",this._disableDelayedDrag),p(t,"touchcancel",this._disableDelayedDrag),p(t,"mousemove",this._delayedDragTouchMoveHandler),p(t,"touchmove",this._delayedDragTouchMoveHandler),p(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,e){e=e||"touch"==t.pointerType&&t,!this.nativeDraggable||e?this.options.supportPointer?d(document,"pointermove",this._onTouchMove):d(document,e?"touchmove":"mousemove",this._onTouchMove):(d(J,"dragend",this),d(et,"dragstart",this._onDragStart));try{document.selection?zt(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(t){}},_dragStarted:function(t,e){var i;xt=!1,et&&J?(W("dragStarted",this,{evt:e}),this.nativeDraggable&&d(document,"dragover",Bt),i=this.options,t||O(J,i.dragClass,!1),O(J,i.ghostClass,!0),Ft.active=this,t&&this._appendGhost(),X({sortable:this,name:"start",originalEvent:e})):this._nulling()},_emulateDragOver:function(){if(pt){this._lastX=pt.clientX,this._lastY=pt.clientY,K();for(var t=document.elementFromPoint(pt.clientX,pt.clientY),e=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(pt.clientX,pt.clientY))!==e;)e=t;if(J.parentNode[j]._isOutsideThisEl(t),e)do{if(e[j])if(e[j]._onDragOver({clientX:pt.clientX,clientY:pt.clientY,target:t,rootEl:e})&&!this.options.dragoverBubble)break}while(e=(t=e).parentNode);Q()}},_onTouchMove:function(t){if(dt){var e=this.options,i=e.fallbackTolerance,n=e.fallbackOffset,r=t.touches?t.touches[0]:t,a=tt&&v(tt,!0),s=tt&&a&&a.a,o=tt&&a&&a.d,e=Ot&&Tt&&w(Tt),s=(r.clientX-dt.clientX+n.x)/(s||1)+(e?e[0]-It[0]:0)/(s||1),o=(r.clientY-dt.clientY+n.y)/(o||1)+(e?e[1]-It[1]:0)/(o||1);if(!Ft.active&&!xt){if(i&&Math.max(Math.abs(r.clientX-this._lastX),Math.abs(r.clientY-this._lastY))<i)return;this._onDragStart(t,!0)}tt&&(a?(a.e+=s-(ft||0),a.f+=o-(mt||0)):a={a:1,b:0,c:0,d:1,e:s,f:o},a="matrix(".concat(a.a,",").concat(a.b,",").concat(a.c,",").concat(a.d,",").concat(a.e,",").concat(a.f,")"),L(tt,"webkitTransform",a),L(tt,"mozTransform",a),L(tt,"msTransform",a),L(tt,"transform",a),ft=s,mt=o,pt=r),t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!tt){var t=this.options.fallbackOnBody?document.body:et,e=M(J,!0,Ot,!0,t),i=this.options;if(Ot){for(Tt=t;"static"===L(Tt,"position")&&"none"===L(Tt,"transform")&&Tt!==document;)Tt=Tt.parentNode;Tt!==document.body&&Tt!==document.documentElement?(Tt===document&&(Tt=I()),e.top+=Tt.scrollTop,e.left+=Tt.scrollLeft):Tt=I(),It=w(Tt)}O(tt=J.cloneNode(!0),i.ghostClass,!1),O(tt,i.fallbackClass,!0),O(tt,i.dragClass,!0),L(tt,"transition",""),L(tt,"transform",""),L(tt,"box-sizing","border-box"),L(tt,"margin",0),L(tt,"top",e.top),L(tt,"left",e.left),L(tt,"width",e.width),L(tt,"height",e.height),L(tt,"opacity","0.8"),L(tt,"position",Ot?"absolute":"fixed"),L(tt,"zIndex","100000"),L(tt,"pointerEvents","none"),Ft.ghost=tt,t.appendChild(tt),L(tt,"transform-origin",gt/parseInt(tt.style.width)*100+"% "+vt/parseInt(tt.style.height)*100+"%")}},_onDragStart:function(t,e){var i=this,n=t.dataTransfer,r=i.options;W("dragStart",this,{evt:t}),Ft.eventCanceled?this._onDrop():(W("setupClone",this),Ft.eventCanceled||((rt=S(J)).removeAttribute("id"),rt.draggable=!1,rt.style["will-change"]="",this._hideClone(),O(rt,this.options.chosenClass,!1),Ft.clone=rt),i.cloneId=zt(function(){W("clone",i),Ft.eventCanceled||(i.options.removeCloneOnHide||et.insertBefore(rt,J),i._hideClone(),X({sortable:i,name:"clone"}))}),e||O(J,r.dragClass,!0),e?(St=!0,i._loopId=setInterval(i._emulateDragOver,50)):(p(document,"mouseup",i._onDrop),p(document,"touchend",i._onDrop),p(document,"touchcancel",i._onDrop),n&&(n.effectAllowed="move",r.setData&&r.setData.call(i,n,J)),d(document,"drop",i),L(J,"transform","translateZ(0)")),xt=!0,i._dragStartId=zt(i._dragStarted.bind(i,e,t)),d(document,"selectstart",i),yt=!0,h&&L(document.body,"user-select","none"))},_onDragOver:function(i){var n,r,a,t,s=this.el,o=i.target,e=this.options,l=e.group,u=Ft.active,h=ht===l,c=e.sort,d=ct||u,p=this,f=!1;if(!At){if(void 0!==i.preventDefault&&i.cancelable&&i.preventDefault(),o=D(o,e.draggable,s,!0),k("dragOver"),Ft.eventCanceled)return f;if(J.contains(i.target)||o.animated&&o.animatingX&&o.animatingY||p._ignoreWhileAnimating===o)return I(!1);if(St=!1,u&&!e.disabled&&(h?c||(r=Z!==et):ct===this||(this.lastPutMode=ht.checkPull(this,u,J,i))&&l.checkPut(this,u,J,i))){if(a="vertical"===this._getDirection(i,o),n=M(J),k("dragOverValid"),Ft.eventCanceled)return f;if(r)return Z=et,C(),this._hideClone(),k("revert"),Ft.eventCanceled||(it?et.insertBefore(J,it):et.appendChild(J)),I(!0);var m=B(s,e.draggable);if(!m||function(t,e,i){i=M(B(i.el,i.options.draggable));return e?t.clientX>i.right+10||t.clientX<=i.right&&t.clientY>i.bottom&&t.clientX>=i.left:t.clientX>i.right&&t.clientY>i.top||t.clientX<=i.right&&t.clientY>i.bottom+10}(i,a,this)&&!m.animated){if(m===J)return I(!1);if((o=m&&s===i.target?m:o)&&(b=M(o)),!1!==Ut(et,s,J,n,o,b,i,!!o))return C(),m&&m.nextSibling?s.insertBefore(J,m.nextSibling):s.appendChild(J),Z=s,A(),I(!0)}else if(m&&function(t,e,i){i=M(N(i.el,0,i.options,!0));return e?t.clientX<i.left-10||t.clientY<i.top&&t.clientX<i.right:t.clientY<i.top-10||t.clientY<i.bottom&&t.clientX<i.left}(i,a,this)){var g=N(s,0,e,!0);if(g===J)return I(!1);if(b=M(o=g),!1!==Ut(et,s,J,n,o,b,i,!1))return C(),s.insertBefore(J,g),Z=s,A(),I(!0)}else if(o.parentNode===s){var v,y,_,b=M(o),w=J.parentNode!==s,T=(T=J.animated&&J.toRect||n,E=o.animated&&o.toRect||b,x=(t=a)?T.left:T.top,l=t?T.right:T.bottom,m=t?T.width:T.height,g=t?E.left:E.top,T=t?E.right:E.bottom,E=t?E.width:E.height,!(x===g||l===T||x+m/2===g+E/2)),x=a?"top":"left",m=R(o,"top","top")||R(J,"top","top"),g=m?m.scrollTop:void 0;if(_t!==o&&(y=b[x],kt=!1,Ct=!T&&e.invertSwap||w),0!==(v=function(t,e,i,n,r,a,s,o){var l=n?t.clientY:t.clientX,u=n?i.height:i.width,t=n?i.top:i.left,n=n?i.bottom:i.right,i=!1;if(!s)if(o&&wt<u*r){if(kt=!kt&&(1===bt?t+u*a/2<l:l<n-u*a/2)?!0:kt)i=!0;else if(1===bt?l<t+wt:n-wt<l)return-bt}else if(t+u*(1-r)/2<l&&l<n-u*(1-r)/2)return function(t){return F(J)<F(t)?1:-1}(e);if((i=i||s)&&(l<t+u*a/2||n-u*a/2<l))return t+u/2<l?1:-1;return 0}(i,o,b,a,T?1:e.swapThreshold,null==e.invertedSwapThreshold?e.swapThreshold:e.invertedSwapThreshold,Ct,_t===o)))for(var S=F(J);(_=Z.children[S-=v])&&("none"===L(_,"display")||_===tt););if(0===v||_===o)return I(!1);bt=v;var E=(_t=o).nextElementSibling,w=!1,T=Ut(et,s,J,n,o,b,i,w=1===v);if(!1!==T)return 1!==T&&-1!==T||(w=1===T),At=!0,setTimeout(qt,30),C(),w&&!E?s.appendChild(J):o.parentNode.insertBefore(J,w?E:o),m&&U(m,0,g-m.scrollTop),Z=J.parentNode,void 0===y||Ct||(wt=Math.abs(y-M(o)[x])),A(),I(!0)}if(s.contains(J))return I(!1)}return!1}function k(t,e){W(t,p,P({evt:i,isOwner:h,axis:a?"vertical":"horizontal",revert:r,dragRect:n,targetRect:b,canSort:c,fromSortable:d,target:o,completed:I,onMove:function(t,e){return Ut(et,s,J,n,t,M(t),i,e)},changed:A},e))}function C(){k("dragOverAnimationCapture"),p.captureAnimationState(),p!==d&&d.captureAnimationState()}function I(t){return k("dragOverCompleted",{insertion:t}),t&&(h?u._hideClone():u._showClone(p),p!==d&&(O(J,(ct||u).options.ghostClass,!1),O(J,e.ghostClass,!0)),ct!==p&&p!==Ft.active?ct=p:p===Ft.active&&ct&&(ct=null),d===p&&(p._ignoreWhileAnimating=o),p.animateAll(function(){k("dragOverAnimationComplete"),p._ignoreWhileAnimating=null}),p!==d&&(d.animateAll(),d._ignoreWhileAnimating=null)),(o===J&&!J.animated||o===s&&!o.animated)&&(_t=null),e.dragoverBubble||i.rootEl||o===document||(J.parentNode[j]._isOutsideThisEl(i.target),t||Nt(i)),!e.dragoverBubble&&i.stopPropagation&&i.stopPropagation(),f=!0}function A(){ot=F(J),ut=F(J,e.draggable),X({sortable:p,name:"change",toEl:s,newIndex:ot,newDraggableIndex:ut,originalEvent:i})}},_ignoreWhileAnimating:null,_offMoveEvents:function(){p(document,"mousemove",this._onTouchMove),p(document,"touchmove",this._onTouchMove),p(document,"pointermove",this._onTouchMove),p(document,"dragover",Nt),p(document,"mousemove",Nt),p(document,"touchmove",Nt)},_offUpEvents:function(){var t=this.el.ownerDocument;p(t,"mouseup",this._onDrop),p(t,"touchend",this._onDrop),p(t,"pointerup",this._onDrop),p(t,"touchcancel",this._onDrop),p(document,"selectstart",this)},_onDrop:function(t){var e=this.el,i=this.options;ot=F(J),ut=F(J,i.draggable),W("drop",this,{evt:t}),Z=J&&J.parentNode,ot=F(J),ut=F(J,i.draggable),Ft.eventCanceled||(kt=Ct=xt=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Ht(this.cloneId),Ht(this._dragStartId),this.nativeDraggable&&(p(document,"drop",this),p(e,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),h&&L(document.body,"user-select",""),L(J,"transform",""),t&&(yt&&(t.cancelable&&t.preventDefault(),i.dropBubble||t.stopPropagation()),tt&&tt.parentNode&&tt.parentNode.removeChild(tt),(et===Z||ct&&"clone"!==ct.lastPutMode)&&rt&&rt.parentNode&&rt.parentNode.removeChild(rt),J&&(this.nativeDraggable&&p(J,"dragend",this),jt(J),J.style["will-change"]="",yt&&!xt&&O(J,(ct||this).options.ghostClass,!1),O(J,this.options.chosenClass,!1),X({sortable:this,name:"unchoose",toEl:Z,newIndex:null,newDraggableIndex:null,originalEvent:t}),et!==Z?(0<=ot&&(X({rootEl:Z,name:"add",toEl:Z,fromEl:et,originalEvent:t}),X({sortable:this,name:"remove",toEl:Z,originalEvent:t}),X({rootEl:Z,name:"sort",toEl:Z,fromEl:et,originalEvent:t}),X({sortable:this,name:"sort",toEl:Z,originalEvent:t})),ct&&ct.save()):ot!==st&&0<=ot&&(X({sortable:this,name:"update",toEl:Z,originalEvent:t}),X({sortable:this,name:"sort",toEl:Z,originalEvent:t})),Ft.active&&(null!=ot&&-1!==ot||(ot=st,ut=lt),X({sortable:this,name:"end",toEl:Z,originalEvent:t}),this.save())))),this._nulling()},_nulling:function(){W("nulling",this),et=J=Z=tt=it=rt=nt=at=dt=pt=yt=ot=ut=st=lt=_t=bt=ct=ht=Ft.dragged=Ft.ghost=Ft.clone=Ft.active=null,Pt.forEach(function(t){t.checked=!0}),Pt.length=ft=mt=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":J&&(this._onDragOver(t),function(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move");t.cancelable&&t.preventDefault()}(t));break;case"selectstart":t.preventDefault()}},toArray:function(){for(var t,e=[],i=this.el.children,n=0,r=i.length,a=this.options;n<r;n++)D(t=i[n],a.draggable,this.el,!1)&&e.push(t.getAttribute(a.dataIdAttr)||function(t){var e=t.tagName+t.className+t.src+t.href+t.textContent,i=e.length,n=0;for(;i--;)n+=e.charCodeAt(i);return n.toString(36)}(t));return e},sort:function(t,e){var i={},n=this.el;this.toArray().forEach(function(t,e){e=n.children[e];D(e,this.options.draggable,n,!1)&&(i[t]=e)},this),e&&this.captureAnimationState(),t.forEach(function(t){i[t]&&(n.removeChild(i[t]),n.appendChild(i[t]))}),e&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,e){return D(t,e||this.options.draggable,this.el,!1)},option:function(t,e){var i=this.options;if(void 0===e)return i[t];var n=H.modifyOption(this,t,e);i[t]=void 0!==n?n:e,"group"===t&&Y(i)},destroy:function(){W("destroy",this);var t=this.el;t[j]=null,p(t,"mousedown",this._onTapStart),p(t,"touchstart",this._onTapStart),p(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(p(t,"dragover",this),p(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Et.splice(Et.indexOf(this.el),1),this.el=t=null},_hideClone:function(){at||(W("hideClone",this),Ft.eventCanceled||(L(rt,"display","none"),this.options.removeCloneOnHide&&rt.parentNode&&rt.parentNode.removeChild(rt),at=!0))},_showClone:function(t){"clone"===t.lastPutMode?at&&(W("showClone",this),Ft.eventCanceled||(J.parentNode!=et||this.options.group.revertClone?it?et.insertBefore(rt,it):et.appendChild(rt):et.insertBefore(rt,J),this.options.group.revertClone&&this.animate(J,rt),L(rt,"display",""),at=!1)):this._hideClone()}},Dt&&d(document,"touchmove",function(t){(Ft.active||xt)&&t.cancelable&&t.preventDefault()}),Ft.utils={on:d,off:p,css:L,find:y,is:function(t,e){return!!D(t,e,t,!1)},extend:function(t,e){if(t&&e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},throttle:x,closest:D,toggleClass:O,clone:S,index:F,nextTick:zt,cancelNextTick:Ht,detectDirection:$,getChild:N},Ft.get=function(t){return t[j]},Ft.mount=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];(e=e[0].constructor===Array?e[0]:e).forEach(function(t){if(!t.prototype||!t.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(t));t.utils&&(Ft.utils=P(P({},Ft.utils),t.utils)),H.mount(t)})},Ft.create=function(t,e){return new Ft(t,e)};var Vt,Wt,Gt,Xt,$t,Yt,Kt=[],Qt=!(Ft.version="1.15.0");function Jt(){Kt.forEach(function(t){clearInterval(t.pid)}),Kt=[]}function Zt(){clearInterval(Yt)}function te(t){var e=t.originalEvent,i=t.putSortable,n=t.dragEl,r=t.activeSortable,a=t.dispatchSortableEvent,s=t.hideGhostForTarget,t=t.unhideGhostForTarget;e&&(r=i||r,s(),e=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:e,e=document.elementFromPoint(e.clientX,e.clientY),t(),r&&!r.el.contains(e)&&(a("spill"),this.onSpill({dragEl:n,putSortable:i})))}var ee,ie=x(function(i,t,e,n){if(t.scroll){var r,a=(i.touches?i.touches[0]:i).clientX,s=(i.touches?i.touches[0]:i).clientY,o=t.scrollSensitivity,l=t.scrollSpeed,u=I(),h=!1;Wt!==e&&(Wt=e,Jt(),Vt=t.scroll,r=t.scrollFn,!0===Vt&&(Vt=A(e,!0)));var c=0,d=Vt;do{var p=d,f=M(p),m=f.top,g=f.bottom,v=f.left,y=f.right,_=f.width,b=f.height,w=void 0,T=void 0,x=p.scrollWidth,S=p.scrollHeight,E=L(p),k=p.scrollLeft,f=p.scrollTop,T=p===u?(w=_<x&&("auto"===E.overflowX||"scroll"===E.overflowX||"visible"===E.overflowX),b<S&&("auto"===E.overflowY||"scroll"===E.overflowY||"visible"===E.overflowY)):(w=_<x&&("auto"===E.overflowX||"scroll"===E.overflowX),b<S&&("auto"===E.overflowY||"scroll"===E.overflowY)),k=w&&(Math.abs(y-a)<=o&&k+_<x)-(Math.abs(v-a)<=o&&!!k),f=T&&(Math.abs(g-s)<=o&&f+b<S)-(Math.abs(m-s)<=o&&!!f);if(!Kt[c])for(var C=0;C<=c;C++)Kt[C]||(Kt[C]={});Kt[c].vx==k&&Kt[c].vy==f&&Kt[c].el===p||(Kt[c].el=p,Kt[c].vx=k,Kt[c].vy=f,clearInterval(Kt[c].pid),0==k&&0==f||(h=!0,Kt[c].pid=setInterval(function(){n&&0===this.layer&&Ft.active._onTouchMove($t);var t=Kt[this.layer].vy?Kt[this.layer].vy*l:0,e=Kt[this.layer].vx?Kt[this.layer].vx*l:0;"function"==typeof r&&"continue"!==r.call(Ft.dragged.parentNode[j],e,t,i,$t,Kt[this.layer].el)||U(Kt[this.layer].el,e,t)}.bind({layer:c}),24))),c++}while(t.bubbleScroll&&d!==u&&(d=A(d,!1)));Qt=h}},30);function ne(){}function re(){}ne.prototype={startIndex:null,dragStart:function(t){t=t.oldDraggableIndex;this.startIndex=t},onSpill:function(t){var e=t.dragEl,i=t.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();t=N(this.sortable.el,this.startIndex,this.options);t?this.sortable.el.insertBefore(e,t):this.sortable.el.appendChild(e),this.sortable.animateAll(),i&&i.animateAll()},drop:te},s(ne,{pluginName:"revertOnSpill"}),re.prototype={onSpill:function(t){var e=t.dragEl,t=t.putSortable||this.sortable;t.captureAnimationState(),e.parentNode&&e.parentNode.removeChild(e),t.animateAll()},drop:te},s(re,{pluginName:"removeOnSpill"});var ae,se,oe,le,ue,he=[],ce=[],de=!1,pe=!1,fe=!1;function me(i,n){ce.forEach(function(t,e){e=n.children[t.sortableIndex+(i?Number(e):0)];e?n.insertBefore(t,e):n.appendChild(t)})}function ge(){he.forEach(function(t){t!==oe&&t.parentNode&&t.parentNode.removeChild(t)})}return Ft.mount(new function(){function t(){for(var t in this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0},this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this))}return t.prototype={dragStarted:function(t){t=t.originalEvent;this.sortable.nativeDraggable?d(document,"dragover",this._handleAutoScroll):this.options.supportPointer?d(document,"pointermove",this._handleFallbackAutoScroll):t.touches?d(document,"touchmove",this._handleFallbackAutoScroll):d(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(t){t=t.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?p(document,"dragover",this._handleAutoScroll):(p(document,"pointermove",this._handleFallbackAutoScroll),p(document,"touchmove",this._handleFallbackAutoScroll),p(document,"mousemove",this._handleFallbackAutoScroll)),Zt(),Jt(),clearTimeout(m),m=void 0},nulling:function(){$t=Wt=Vt=Qt=Yt=Gt=Xt=null,Kt.length=0},_handleFallbackAutoScroll:function(t){this._handleAutoScroll(t,!0)},_handleAutoScroll:function(e,i){var n,r=this,a=(e.touches?e.touches[0]:e).clientX,s=(e.touches?e.touches[0]:e).clientY,t=document.elementFromPoint(a,s);$t=e,i||this.options.forceAutoScrollFallback||b||_||h?(ie(e,this.options,t,i),n=A(t,!0),!Qt||Yt&&a===Gt&&s===Xt||(Yt&&Zt(),Yt=setInterval(function(){var t=A(document.elementFromPoint(a,s),!0);t!==n&&(n=t,Jt()),ie(e,r.options,t,i)},10),Gt=a,Xt=s)):this.options.bubbleScroll&&A(t,!0)!==I()?ie(e,this.options,A(t,!1),!1):Jt()}},s(t,{pluginName:"scroll",initializeByDefault:!0})}),Ft.mount(re,ne),Ft.mount(new function(){function t(){this.defaults={swapClass:"sortable-swap-highlight"}}return t.prototype={dragStart:function(t){t=t.dragEl;ee=t},dragOverValid:function(t){var e=t.completed,i=t.target,n=t.onMove,r=t.activeSortable,a=t.changed,s=t.cancel;r.options.swap&&(t=this.sortable.el,r=this.options,i&&i!==t&&(t=ee,ee=!1!==n(i)?(O(i,r.swapClass,!0),i):null,t&&t!==ee&&O(t,r.swapClass,!1)),a(),e(!0),s())},drop:function(t){var e,i,n=t.activeSortable,r=t.putSortable,a=t.dragEl,s=r||this.sortable,o=this.options;ee&&O(ee,o.swapClass,!1),ee&&(o.swap||r&&r.options.swap)&&a!==ee&&(s.captureAnimationState(),s!==n&&n.captureAnimationState(),i=ee,t=(e=a).parentNode,o=i.parentNode,t&&o&&!t.isEqualNode(i)&&!o.isEqualNode(e)&&(r=F(e),a=F(i),t.isEqualNode(o)&&r<a&&a++,t.insertBefore(i,t.children[r]),o.insertBefore(e,o.children[a])),s.animateAll(),s!==n&&n.animateAll())},nulling:function(){ee=null}},s(t,{pluginName:"swap",eventProperties:function(){return{swapItem:ee}}})}),Ft.mount(new function(){function t(n){for(var t in this)"_"===t.charAt(0)&&"function"==typeof this[t]&&(this[t]=this[t].bind(this));n.options.avoidImplicitDeselect||(n.options.supportPointer?d(document,"pointerup",this._deselectMultiDrag):(d(document,"mouseup",this._deselectMultiDrag),d(document,"touchend",this._deselectMultiDrag))),d(document,"keydown",this._checkKeyDown),d(document,"keyup",this._checkKeyUp),this.defaults={selectedClass:"sortable-selected",multiDragKey:null,avoidImplicitDeselect:!1,setData:function(t,e){var i="";he.length&&se===n?he.forEach(function(t,e){i+=(e?", ":"")+t.textContent}):i=e.textContent,t.setData("Text",i)}}}return t.prototype={multiDragKeyDown:!1,isMultiDrag:!1,delayStartGlobal:function(t){t=t.dragEl;oe=t},delayEnded:function(){this.isMultiDrag=~he.indexOf(oe)},setupClone:function(t){var e=t.sortable,t=t.cancel;if(this.isMultiDrag){for(var i=0;i<he.length;i++)ce.push(S(he[i])),ce[i].sortableIndex=he[i].sortableIndex,ce[i].draggable=!1,ce[i].style["will-change"]="",O(ce[i],this.options.selectedClass,!1),he[i]===oe&&O(ce[i],this.options.chosenClass,!1);e._hideClone(),t()}},clone:function(t){var e=t.sortable,i=t.rootEl,n=t.dispatchSortableEvent,t=t.cancel;this.isMultiDrag&&(this.options.removeCloneOnHide||he.length&&se===e&&(me(!0,i),n("clone"),t()))},showClone:function(t){var e=t.cloneNowShown,i=t.rootEl,t=t.cancel;this.isMultiDrag&&(me(!1,i),ce.forEach(function(t){L(t,"display","")}),e(),ue=!1,t())},hideClone:function(t){var e=this,i=(t.sortable,t.cloneNowHidden),t=t.cancel;this.isMultiDrag&&(ce.forEach(function(t){L(t,"display","none"),e.options.removeCloneOnHide&&t.parentNode&&t.parentNode.removeChild(t)}),i(),ue=!0,t())},dragStartGlobal:function(t){t.sortable;!this.isMultiDrag&&se&&se.multiDrag._deselectMultiDrag(),he.forEach(function(t){t.sortableIndex=F(t)}),he=he.sort(function(t,e){return t.sortableIndex-e.sortableIndex}),fe=!0},dragStarted:function(t){var e,i=this,t=t.sortable;this.isMultiDrag&&(this.options.sort&&(t.captureAnimationState(),this.options.animation&&(he.forEach(function(t){t!==oe&&L(t,"position","absolute")}),e=M(oe,!1,!0,!0),he.forEach(function(t){t!==oe&&E(t,e)}),de=pe=!0)),t.animateAll(function(){de=pe=!1,i.options.animation&&he.forEach(function(t){k(t)}),i.options.sort&&ge()}))},dragOver:function(t){var e=t.target,i=t.completed,t=t.cancel;pe&&~he.indexOf(e)&&(i(!1),t())},revert:function(t){var i,n,e=t.fromSortable,r=t.rootEl,a=t.sortable,s=t.dragRect;1<he.length&&(he.forEach(function(t){a.addAnimationState({target:t,rect:pe?M(t):s}),k(t),t.fromRect=s,e.removeAnimationState(t)}),pe=!1,i=!this.options.removeCloneOnHide,n=r,he.forEach(function(t,e){e=n.children[t.sortableIndex+(i?Number(e):0)];e?n.insertBefore(t,e):n.appendChild(t)}))},dragOverCompleted:function(t){var e,i=t.sortable,n=t.isOwner,r=t.insertion,a=t.activeSortable,s=t.parentEl,o=t.putSortable,t=this.options;r&&(n&&a._hideClone(),de=!1,t.animation&&1<he.length&&(pe||!n&&!a.options.sort&&!o)&&(e=M(oe,!1,!0,!0),he.forEach(function(t){t!==oe&&(E(t,e),s.appendChild(t))}),pe=!0),n||(pe||ge(),1<he.length?(n=ue,a._showClone(i),a.options.animation&&!ue&&n&&ce.forEach(function(t){a.addAnimationState({target:t,rect:le}),t.fromRect=le,t.thisAnimationDuration=null})):a._showClone(i)))},dragOverAnimationCapture:function(t){var e=t.dragRect,i=t.isOwner,t=t.activeSortable;he.forEach(function(t){t.thisAnimationDuration=null}),t.options.animation&&!i&&t.multiDrag.isMultiDrag&&(le=s({},e),e=v(oe,!0),le.top-=e.f,le.left-=e.e)},dragOverAnimationComplete:function(){pe&&(pe=!1,ge())},drop:function(t){var e=t.originalEvent,i=t.rootEl,n=t.parentEl,r=t.sortable,a=t.dispatchSortableEvent,s=t.oldIndex,o=t.putSortable,l=o||this.sortable;if(e){var u,h,c,d=this.options,p=n.children;if(!fe)if(d.multiDragKey&&!this.multiDragKeyDown&&this._deselectMultiDrag(),O(oe,d.selectedClass,!~he.indexOf(oe)),~he.indexOf(oe))he.splice(he.indexOf(oe),1),ae=null,V({sortable:r,rootEl:i,name:"deselect",targetEl:oe,originalEvent:e});else{if(he.push(oe),V({sortable:r,rootEl:i,name:"select",targetEl:oe,originalEvent:e}),e.shiftKey&&ae&&r.el.contains(ae)){var f=F(ae),t=F(oe);if(~f&&~t&&f!==t)for(var m,g=f<t?(m=f,t):(m=t,f+1);m<g;m++)~he.indexOf(p[m])||(O(p[m],d.selectedClass,!0),he.push(p[m]),V({sortable:r,rootEl:i,name:"select",targetEl:p[m],originalEvent:e}))}else ae=oe;se=l}fe&&this.isMultiDrag&&(pe=!1,(n[j].options.sort||n!==i)&&1<he.length&&(u=M(oe),h=F(oe,":not(."+this.options.selectedClass+")"),!de&&d.animation&&(oe.thisAnimationDuration=null),l.captureAnimationState(),de||(d.animation&&(oe.fromRect=u,he.forEach(function(t){var e;t.thisAnimationDuration=null,t!==oe&&(e=pe?M(t):u,t.fromRect=e,l.addAnimationState({target:t,rect:e}))})),ge(),he.forEach(function(t){p[h]?n.insertBefore(t,p[h]):n.appendChild(t),h++}),s===F(oe)&&(c=!1,he.forEach(function(t){t.sortableIndex!==F(t)&&(c=!0)}),c&&a("update"))),he.forEach(function(t){k(t)}),l.animateAll()),se=l),(i===n||o&&"clone"!==o.lastPutMode)&&ce.forEach(function(t){t.parentNode&&t.parentNode.removeChild(t)})}},nullingGlobal:function(){this.isMultiDrag=fe=!1,ce.length=0},destroyGlobal:function(){this._deselectMultiDrag(),p(document,"pointerup",this._deselectMultiDrag),p(document,"mouseup",this._deselectMultiDrag),p(document,"touchend",this._deselectMultiDrag),p(document,"keydown",this._checkKeyDown),p(document,"keyup",this._checkKeyUp)},_deselectMultiDrag:function(t){if(!(void 0!==fe&&fe||se!==this.sortable||t&&D(t.target,this.options.draggable,this.sortable.el,!1)||t&&0!==t.button))for(;he.length;){var e=he[0];O(e,this.options.selectedClass,!1),he.shift(),V({sortable:this.sortable,rootEl:this.sortable.el,name:"deselect",targetEl:e,originalEvent:t})}},_checkKeyDown:function(t){t.key===this.options.multiDragKey&&(this.multiDragKeyDown=!0)},_checkKeyUp:function(t){t.key===this.options.multiDragKey&&(this.multiDragKeyDown=!1)}},s(t,{pluginName:"multiDrag",utils:{select:function(t){var e=t.parentNode[j];e&&e.options.multiDrag&&!~he.indexOf(t)&&(se&&se!==e&&(se.multiDrag._deselectMultiDrag(),se=e),O(t,e.options.selectedClass,!0),he.push(t))},deselect:function(t){var e=t.parentNode[j],i=he.indexOf(t);e&&e.options.multiDrag&&~i&&(O(t,e.options.selectedClass,!1),he.splice(i,1))}},eventProperties:function(){var i=this,n=[],r=[];return he.forEach(function(t){var e;n.push({multiDragElement:t,index:t.sortableIndex}),e=pe&&t!==oe?-1:pe?F(t,":not(."+i.options.selectedClass+")"):F(t),r.push({multiDragElement:t,index:e})}),{items:a(he),clones:[].concat(ce),oldIndicies:n,newIndicies:r}},optionListeners:{multiDragKey:function(t){return"ctrl"===(t=t.toLowerCase())?t="Control":1<t.length&&(t=t.charAt(0).toUpperCase()+t.substr(1)),t}}})}),Ft}),function(){var e=null;this.Milkbox=new Class({Implements:[Options,Events],options:{overlayOpacity:.7,marginTop:50,initialWidth:250,initialHeight:250,fileboxBorderWidth:"0px",fileboxBorderColor:"#000000",fileboxPadding:"0px",resizeDuration:.5,resizeTransition:"sine:in:out",autoPlay:!1,autoPlayDelay:7,removeTitle:!0,autoSize:!0,autoSizeMaxHeight:0,autoSizeMaxWidth:0,autoSizeMinHeight:0,autoSizeMinWidth:0,centered:!0,imageOfText:"of",onXmlGalleries:function(){},onClosed:function(){},onFileReady:function(){}},initialize:function(t){if(e)return e;(e=this).setOptions(t),this.autoPlayBkup={autoPlayDelay:this.options.autoPlayDelay,autoPlay:this.options.autoPlay},this.fullOptionsBkup={},this.galleries=[],this.formElements=[],this.activated=!1,this.busy=!1,this.paused=!1,this.closed=!0,this.intId=null,this.loadCheckerId=null,this.externalGalleries=[],this.singlePageLinkId=0,this.currentIndex=0,this.currentGallery=null,this.fileReady=!1,this.loadedImages=[],this.currentFile=null,this.display=null,this.getPageGalleries(),0!==this.galleries.length&&this.prepare(!0)},prepare:function(t){t&&this.checkFormElements(),this.prepareHTML(),this.prepareEventListeners(),this.activated=!0},open:function(t,e){var i;this.activated||this.prepare(!0);t=instanceOf(t,MilkboxGallery)?t:this.getGallery(t);if(!t)return!1;"number"!==typeOf(e)&&-1!==(i=t.get_index_of(e))&&(e=i),i=parseInt(e,10),isNaN(i)&&(i=0),this.closed=!1;e=t.get_item(i);return!!e&&(this.currentGallery=t,this.currentIndex=i,this.hideFormElements(),this.display.set_mode(this.currentGallery.type),this.display.appear(),(this.options.autoPlay||t.options.autoplay)&&this.startAutoPlay(!0),this.loadFile(e,this.getPreloads()),!0)},close:function(t){t&&this.display.disappear(),this.showFormElements(),this.pauseAutoPlay(),this.stopLoadingCheck(),this.currentGallery=null,this.currentIndex=0,this.currentFile=null,this.busy=!1,this.paused=!1,this.fileReady=!1,this.closed=!0,this.fireEvent("close")},startAutoPlay:function(t){var e,i=this.currentGallery.options.autoplay_delay||this.options.autoPlayDelay;i<2*this.options.resizeDuration&&(i=2*this.options.resizeDuration),e=function(){this.removeEvent("fileReady",e),this.intId=this.navAux.periodical(1e3*i,this,[null,"next"])},t?this.addEvent("fileReady",e):this.intId=this.navAux.periodical(1e3*i,this,[null,"next"]),this.paused=!1},pauseAutoPlay:function(){this.intId&&(clearInterval(this.intId),this.intId=null),this.paused=!0},setAutoPlay:function(t){("array"!==typeOf(t)?[t]:t).each(function(t){var e,i=this.getGallery(t.gallery);i&&(e=1==t.autoplay&&t.autoplay,t=t.delay&&e?t.delay:this.options.autoPlayDelay,i.setOptions({autoplay:e,autoplay_delay:t}).refresh())},this)},openWithFile:function(t){t=new MilkboxGallery([t]);t.items&&0<t.items.length&&this.open(t,0)},getPreloads:function(){var t=this.currentGallery.items,e=this.currentIndex;if(1===t.length)return null;var i=e!=t.length-1?t[e+1]:t[0],t=0!=e?t[e-1]:t[t.length-1];return t==i?[t]:[t,i]},loadFile:function(t,e){this.fileReady=!1,this.display.clear_content(),this.display.hide_bottom(),this.checkFileType(t,"swf")?this.loadSwf(t):this.checkFileType(t,"html")?this.loadHtml(t):this.loadImage(t),this.checkFileType(t,"swf")||this.startLoadingCheck(),e&&this.preloadFiles(e)},startLoadingCheck:function(){var t=0;this.loadCheckerId||(this.loadCheckerId=function(){5<(t+=1)&&(this.loadCheckerId&&this.display.show_loader(),this.stopLoadingCheck())}.periodical(100,this))},stopLoadingCheck:function(){clearInterval(this.loadCheckerId),this.loadCheckerId=null},preloadFiles:function(t){t.each(function(t,e){this.checkFileType(t,"swf")||this.checkFileType(t,"html")||this.preloadImage(t.href)},this)},preloadImage:function(t){this.loadedImages.contains(t)||new Asset.image(t,{onLoad:function(){this.loadedImages.push(t)}.bind(this)})},loadImage:function(e){var i=e.href;new Asset.image(i,{onLoad:function(t){this.loadedImages.contains(i)||this.loadedImages.push(i),this.loadComplete(t,e.caption)}.bind(this)})},loadSwf:function(t){var e=new Swiff(t.href,{width:t.size.width,height:t.size.height,vars:t.vars,params:{wMode:"opaque",swLiveConnect:"false"}});this.loadComplete($(e),t.caption)},loadHtml:function(t){var e=t.vars?"?"+Object.toQueryString(t.vars):"",e=new Element("iframe",{src:t.href+e,styles:{"border-style":"solid","border-width":"0px"}});t.size&&e.set({width:t.size.width,height:t.size.height}),this.loadComplete(e,t.caption)},loadComplete:function(t,e){var i;this.closed||(this.fileReady=!0,this.stopLoadingCheck(),this.currentFile=t,i=function(){this.display.ready&&(null!=this.currentGallery.items&&this.display.show_file(t,e,this.currentIndex+1,this.currentGallery.items.length),clearInterval(i))}.periodical(100,this),this.fireEvent("fileReady"))},checkFileType:function(t,e){t="string"!==typeOf(t)?t.href:t,e=new RegExp("\\.("+e+")$","i");return t.split("?")[0].test(e)},getPageGalleries:function(){var i=[];$$("a[data-milkbox]").each(function(t){var e=t.get("data-milkbox");"single"===e?(t=new MilkboxGallery(t,{name:"single"+this.singlePageLinkId++})).items&&0<t.items.length&&this.galleries.push(t):i.contains(e)||i.push(e)},this),i.each(function(t){t=new MilkboxGallery($$("a[data-milkbox="+t+"]"),{name:t});t.items&&0<t.items.length&&this.galleries.push(t)},this),this.options.autoPlay&&this.galleries.each(function(t){t.setOptions({autoplay:this.options.autoPlay,autoplay_delay:this.options.autoPlayDelay})})},reloadPageGalleries:function(){this.removePageGalleryEvents(),this.galleries=this.galleries.filter(function(t){return t.external||t.clear(),t.external}),this.getPageGalleries(),this.addPageGalleriesEvents(),this.activated||this.prepare(!0)},resetExternalGalleries:function(t){this.galleries=this.galleries.filter(function(t){return t.external&&t.clear(),!t.external}),t&&("array"===typeOf(t)?t:[t]).each(function(t){this.addGalleries(t)},this)},addGalleries:function(t){this.activated||this.prepare(!0),"string"===typeOf(t)&&t.split("?")[0].test(/\.(xml)$/i)?this.loadXml(t):this.setObjectGalleries(t),this.activated||this.prepare(!0)},loadXml:function(t){new $Request({method:"get",autoCancel:!0,url:t,onRequest:function(){}.bind(this),onSuccess:function(t,e){t=t.replace(/(<a.+)\/>/gi,"$1></a>");this.setXmlGalleries(new Element("div",{html:t}))}.bind(this),onFailure:function(t){alert("Milkbox :: loadXml: XML file path error or local Ajax test: please test xml galleries on-line")}}).send()},setXmlGalleries:function(t){t.getElements(".gallery").each(function(t,e){var i={name:t.getProperty("name"),autoplay:Boolean(t.getProperty("autoplay")),autoplay_delay:Number(t.getProperty("autoplay_delay"))},t=t.getChildren("a").map(function(t){return{href:t.href,size:t.get("data-milkbox-size"),title:t.get("title")}},this),i=new MilkboxGallery(t,i);i.items&&0<i.items.length&&this.galleries.push(i)},this),this.fireEvent("xmlGalleries")},setObjectGalleries:function(t){("array"===typeOf(t)?t:[t]).each(function(t){var e={name:t.name,autoplay:t.autoplay,autoplay_delay:t.autoplay_delay},e=new MilkboxGallery(t.files,e);e.items&&0<e.items.length&&this.galleries.push(e)},this)},getGallery:function(e){return this.galleries.filter(function(t){return t.name==e},this)[0]||null},prepareHTML:function(){this.display=new MilkboxDisplay({init_width:this.options.initialWidth,init_height:this.options.initialHeight,overlay_opacity:this.options.overlayOpacity,margin_top:this.options.marginTop,filebox_border_color:this.options.fileboxBorderColor,filebox_padding:this.options.fileboxPadding,resize_duration:this.options.resizeDuration,resize_transition:this.options.resizeTransition,centered:this.options.centered,auto_size:this.options.autoSize,autosize_max_height:this.options.autoSizeMaxHeight,autosize_max_width:this.options.autoSizeMaxWidth,autosize_min_height:this.options.autoSizeMinHeight,autosize_min_width:this.options.autoSizeMinWidth,image_of_text:this.options.imageOfText})},checkFormElements:function(){this.formElements=$$("select, textarea"),0!==this.formElements.length&&(this.formElements=this.formElements.map(function(t){return t.store("visibility",t.getStyle("visibility")),t.store("display",t.getStyle("display")),t}))},hideFormElements:function(){0!==this.formElements.length&&this.formElements.each(function(t){t.setStyle("display","none")})},showFormElements:function(){0!==this.formElements.length&&this.formElements.each(function(t){t.setStyle("visibility",t.retrieve("visibility")),t.setStyle("display",t.retrieve("display"))})},addPageGalleriesEvents:function(){this.galleries.filter(function(t){return!t.external}).each(function(i){i.items.each(function(e){e.element.addEvent("click",function(t){t.preventDefault(),this.open(i.name,i.get_index_of(e))}.bind(this))},this)},this)},removePageGalleryEvents:function(){this.galleries.filter(function(t){return!t.external}).each(function(t){t.items.each(function(t){t.element.removeEvents("click")})})},prepareEventListeners:function(){this.addPageGalleriesEvents(),this.display.addEvent("nextClick",function(){this.navAux(!0,"next")}.bind(this)),this.display.addEvent("prevClick",function(){this.navAux(!0,"prev")}.bind(this)),this.display.addEvent("reloadClick",function(){this.navAux(!0,"reload")}.bind(this)),this.display.addEvent("playPauseClick",function(){this.paused?this.startAutoPlay():this.pauseAutoPlay(),this.display.set_paused(this.paused)}.bind(this)),this.display.addEvent("disappear",function(){this.close(!1)}.bind(this)),this.display.addEvent("resizeComplete",function(){this.busy=!1}.bind(this)),window.addEvent("resize",function(){this.display.ready&&(this.loadFile(this.currentGallery.get_item(0)),this.display.resetOverlaySize())}.bind(this)),window.document.addEvent("keydown",function(t){if(1!=this.busy&&!this.closed)switch(t.key){case"right":case"space":t.preventDefault(),this.navAux(t,"next");break;case"left":t.preventDefault(),this.navAux(t,"prev");break;case"esc":t.stop(),this.close(!0)}}.bind(this))},navAux:function(t,e){if(t)this.pauseAutoPlay();else if(this.busy||!this.fileReady)return;var i;this.busy=!0,e="next"===e?(i=this.currentIndex!=this.currentGallery.items.length-1?this.currentIndex+1:0,this.currentIndex=i,this.currentIndex!=this.currentGallery.items.length-1?this.currentIndex+1:0):"prev"===e?(i=0!=this.currentIndex?this.currentIndex-1:this.currentGallery.items.length-1,this.currentIndex=i,0!=this.currentIndex?this.currentIndex-1:this.currentGallery.items.length-1):(i=this.currentIndex,this.currentIndex),this.loadFile(this.currentGallery.get_item(i),[this.currentGallery.get_item(e)])}})}();var MilkboxDisplay=new Class({Implements:[Options,Events],options:{init_width:100,init_height:100,overlay_opacity:1,margin_top:0,filebox_border_color:"#000000",filebox_padding:"0px",resize_duration:.5,resize_transition:"sine:in:out",centered:!1,auto_size:!1,autosize_max_height:0,autosize_max_width:0,autosize_min_height:0,autosize_min_width:0,fixup_dimension:!0,image_of_text:"of",zIndex:41e4,onNextClick:function(){},onPrevClick:function(){},onPlayPause:function(){},onDisappear:function(){},onResizeComplete:function(){}},initialize:function(t){this.setOptions(t),this.overlay=null,this.mainbox=null,this.filebox=null,this.bottom=null,this.controls=null,this.caption=null,this.close=null,this.next=null,this.prev=null,this.playpause=null,this.paused=!1,this.count=null,this.mode="standard",this.ready=!1,this.overlay_show_fx=null,this.overlay_hide_fx=null,this.mainbox_show_fx=null,this.mainbox_hide_fx=null,this.mainbox_resize_fx=null,this.current_file=null,this.zoomed=!1,this.zoomable=!1,this.mousepos={x:0,y:0},this.build_html(),this.prepare_effects(),this.prepare_events()},build_html:function(){this.overlay=new Element("div",{id:"mbox-overlay",styles:{visibility:"visible",position:"fixed",display:"none","z-index":this.options.zIndex,left:0,width:"100%",opacity:0,height:0,overflow:"hidden",margin:0,padding:0}}).inject($(document.body)),this.mainbox=new Element("div",{id:"mbox-mainbox",styles:{position:this.options.centered?"fixed":"absolute",overflow:"hidden",display:"none","z-index":this.options.zIndex+1,width:this.options.init_width,height:this.options.init_height,opacity:0,margin:0,left:"50%",marginLeft:-this.options.init_width/2,marginTop:this.options.centered?-this.options.init_height/2:"",top:this.options.centered?"50%":""}}).inject($(document.body)),this.filebox=new Element("div#mbox-filebox").inject(this.mainbox),this.bottom=new Element("div#mbox-bottom").setStyle("visibility","hidden").inject(this.mainbox),this.controls=new Element("div#mbox-controls"),this.caption=new Element("div#mbox-caption",{html:"test"}).setStyle("display","none"),this.bottom.adopt(new Element("div.mbox-reset"),this.controls,this.caption,new Element("div.mbox-reset")),this.close=new Element("div#mbox-close"),this.next=new Element("div#mbox-next"),this.prev=new Element("div#mbox-prev"),this.playpause=new Element("div#mbox-playpause"),this.count=new Element("div#mbox-count"),$$(this.next,this.prev,this.close,this.playpause).setStyles({outline:"none",cursor:"pointer"}),this.controls.adopt(new Element("div.mbox-reset"),this.close,this.next,this.prev,this.playpause,new Element("div.mbox-reset"),this.count)},prepare_effects:function(){this.overlay_show_fx=new Fx.Tween(this.overlay,{duration:"short",link:"cancel",property:"opacity",onStart:function(){this.element.setStyles({top:-window.getScroll().y,height:window.getScrollSize().y+window.getScroll().y,display:"block"})},onComplete:function(){this.mainbox_show_fx.start(1)}.bind(this)}),this.overlay_hide_fx=new Fx.Tween(this.overlay,{duration:"short",link:"cancel",property:"opacity",onStart:function(){},onComplete:function(){this.overlay.setStyle("display","none")}.bind(this)}),this.mainbox_show_fx=new Fx.Tween(this.mainbox,{duration:"short",link:"cancel",property:"opacity",onStart:function(){this.mainbox.setStyle("display","block")}.bind(this),onComplete:function(){this.ready=!0}.bind(this)}),this.mainbox_hide_fx=new Fx.Tween(this.mainbox,{duration:"short",link:"cancel",property:"opacity",onStart:function(){this.ready=!1}.bind(this),onComplete:function(){this.overlay.setStyle("display","none")}.bind(this)}),this.mainbox_resize_fx=new Fx.Morph(this.mainbox,{duration:1e3*this.options.resize_duration,transition:this.options.resize_transition,link:"cancel",onStart:function(){},onComplete:function(){var t=this.current_file.width,e=this.current_file.height;t<this.options.autosize_min_width&&(t=this.options.autosize_min_width),e<this.options.autosize_min_height&&(e=this.options.autosize_min_height),this.show_bottom(),this.filebox.setStyle("width",t+"px"),this.filebox.setStyle("height",e+"px"),this.filebox.setStyle("opacity",0).grab(this.current_file).tween("opacity",1),this.fireEvent("resizeComplete")}.bind(this)}),this.filebox.set("tween",{duration:"short",link:"chain"})},prepare_events:function(){$$(this.overlay,this.close).addEvent("click",function(){this.disappear()}.bind(this)),this.prev.addEvent("click",function(){this.fireEvent("prevClick"),this.zoomed=!1}.bind(this)),this.next.addEvent("click",function(){this.fireEvent("nextClick"),this.zoomed=!1}.bind(this)),this.playpause.addEvent("click",function(){this.fireEvent("playPauseClick"),this.zoomed=!1}.bind(this)),this.filebox.addEvent("click",function(t){this.zoomed=!this.zoomed,this.zoomable&&this.fireEvent("reloadClick"),this.mousepos.x=t.client.x,this.mousepos.y=t.client.y}.bind(this)),this.filebox.addEvent("mousemove",function(t){this.position_file(t.client.x,t.client.y,this.current_file.offsetHeight)}.bind(this))},position_file:function(t,e,i){var n,r;this.zoomable&&this.zoomed&&0<i&&(n=this.filebox.getPosition(),r=window.getScroll(),t=t-n.x+r.x,r=e-n.y+r.y,i=this.filebox.offsetHeight/(i-(this.filebox.offsetHeight-10)),this.current_file.setStyles({left:5-Math.floor(t/i),top:5-Math.floor(r/i)}))},show_file:function(t,e,i,n){var r;this.hide_loader(),this.zoomable=!1,t.match&&t.match("img")&&(this.options.auto_size||this.options.centered)&&((r=t.height.toInt())>(t=this.get_resized_image(t)).height.toInt()&&(this.zoomable=!0));var a,s,o={w:t.width.toInt(),h:t.height.toInt()};if(!o.w||!o.h){if(!this.options.fixup_dimension)return void alert("Milkbox error: you must pass size values if the file is swf or html or a free file (openWithFile)");var l=Window.getSize();t.width=l.x,t.height=l.y,o={w:.85*l.x,h:.85*l.y},t.set({width:o.w.toInt(),height:o.h.toInt()})}this.options.autosize_min_height>o.h&&(a=Math.round((this.options.autosize_min_height-o.h)/2),s=this.options.autosize_min_height-o.h-a,t.setStyles({"margin-top":a,"margin-bottom":s}),o.h=this.options.autosize_min_height),this.options.autosize_min_width>o.w&&(a=Math.round((this.options.autosize_min_width-o.w)/2),s=this.options.autosize_min_width-o.w-a,t.setStyles({"margin-left":a,"margin-right":s}),o.w=this.options.autosize_min_width),o=Object.map(o,function(t){return t.toInt()}),this.caption.innerHTML=e||"",this.update_count(i,n);e=2*this.filebox.getStyle("border-width").toInt()+2*this.filebox.getStyle("padding").toInt(),i=o.w+e,n=this.caption.getStyles("paddingRight","marginRight");this.caption.setStyle("width",i-n.paddingRight.toInt()-n.marginRight.toInt()),$$(this.bottom,this.controls).setStyle("height",Math.max(this.caption.getDimensions().height,this.controls.getComputedSize().totalHeight));n=this.mainbox.getComputedSize(),e=o.h+e+this.bottom.getComputedSize().totalHeight,n={w:i,h:e,total_w:i+n.totalWidth-n.width,total_h:e+n.totalHeight-n.height};this.zoomable&&this.zoomed?(t.setStyles({width:"auto",height:"auto",position:"absolute"}),t.addClass("zoomoutcursor")):(t.setStyles({position:"absolute",left:0,top:0}),this.zoomable?t.addClass("zoomincursor"):(t.removeClass("zoomincursor"),t.removeClass("zoomoutcursor"))),this.current_file=t,this.zoomable&&this.zoomed&&this.mousepos&&this.position_file(this.mousepos.x,this.mousepos.y,r),this.resize_to(n)},get_resized_image:function(t){var e={w:t.get("width").toInt(),h:t.get("height").toInt()},i=window.getSize(),n={w:i.x-60,h:i.y-68-2*this.options.margin_top},i=Math.max(n.h,n.w),i=i==n.w?(r=i/e.w,"h"):(r=i/e.h,"w"),r=r<=1?r:1,e=Object.map(e,function(t){return t*r});return r=n[i]/e[i]<=1?n[i]/e[i]:1,e=Object.map(e,function(t){return t*r}),0<this.options.autosize_max_height&&(r=this.options.autosize_max_height/e.h<1?this.options.autosize_max_height/e.h:1,e=Object.map(e,function(t){return t*r})),0<this.options.autosize_max_width&&(r=this.options.autosize_max_width/e.w<1?this.options.autosize_max_width/e.w:1,e=Object.map(e,function(t){return t*r})),t.set({width:Math.round(e.w),height:Math.round(e.h)}),t},resize_to:function(t){this.mainbox_resize_fx.start({width:t.w,height:t.h,marginLeft:-(t.total_w/2).round(),marginTop:this.options.centered?-(t.total_h/2).round():""})},show_loader:function(){this.mainbox.addClass("mbox-loading")},hide_loader:function(){this.mainbox.removeClass("mbox-loading")},clear_content:function(){this.filebox.empty(),this.caption.empty(),this.count.empty(),$$(this.bottom,this.controls).setStyle("height","")},hide_bottom:function(){this.caption.setStyle("display","none"),this.bottom.setStyle("visibility","hidden")},show_bottom:function(){this.caption.setStyle("display","block"),this.bottom.setStyle("visibility","visible")},appear:function(){this.options.centered||this.mainbox.setStyle("top",window.getScroll().y+this.options.margin_top),this.overlay_show_fx.start(this.options.overlay_opacity)},disappear:function(){this.cancel_effects(),this.current_file=null,this.ready=!1,this.mode="standard",$$(this.prev,this.next,this.playpause,this.count).setStyle("display","none"),this.playpause.setStyle("backgroundPosition","0 0"),this.count.empty(),this.caption.setStyle("display","none").empty(),this.bottom.setStyle("visibility","hidden"),this.filebox.setStyle("height","").empty(),this.mainbox.setStyles({opacity:0,display:"none",width:this.options.init_width,height:this.options.init_height,marginLeft:-this.options.init_width/2,marginTop:this.options.centered?-this.options.init_height/2:"",top:this.options.centered?"50%":""}),this.overlay_hide_fx.start(0),this.fireEvent("disappear")},cancel_effects:function(){[this.mainbox_resize_fx,this.mainbox_hide_fx,this.mainbox_show_fx,this.overlay_hide_fx,this.overlay_show_fx].each(function(t){t.cancel()})},set_mode:function(t){this.zoomed=!1,this.mode=t;var e=this.close.getComputedSize().width,i=this.prev.getComputedSize().width,n=this.next.getComputedSize().width,r=this.playpause.getComputedSize().width,a=this.mainbox.getStyle("border-right-width").toInt();switch(t){case"autoplay":$$(this.playpause,this.close,this.next,this.prev,this.count).setStyle("display","block"),this.controls.setStyle("width",e+i+n+r+a);break;case"single":$$(this.playpause,this.next,this.prev,this.count).setStyle("display","none"),this.controls.setStyle("width",e+a);break;case"standard":$$(this.close,this.next,this.prev,this.count).setStyle("display","block"),this.playpause.setStyle("display","none"),this.controls.setStyle("width",e+i+n+a);break;default:return}this.caption.setStyle("margin-right",this.controls.getComputedSize().totalWidth)},set_paused:function(t){this.paused=t;t=this.paused?"0 -66px":"";this.playpause.setStyle("background-position",t)},update_count:function(t,e){this.count.set("text",t+" "+this.options.image_of_text+" "+e)},resetOverlaySize:function(){var t;0!=this.overlay.getStyle("opacity")&&(t=window.getSize().y,this.overlay.setStyles({height:t}))}}),MilkboxGallery=new Class({Implements:[Options,Events],options:{name:null,autoplay:null,autoplay_delay:null},initialize:function(t,e){this.setOptions(e),this.source=t,this.external=!1,this.items=null,this.name=this.options.name,this.type=null,this.prepare_gallery(),this.prepare_elements()},prepare_gallery:function(){switch(typeOf(this.source)){case"element":this.check_extension(this.source.href)&&(this.items=[this.source]);break;case"elements":this.items=this.source.filter(function(t){return this.check_extension(t.href)},this);break;case"array":this.items=this.source.filter(function(t){return this.check_extension(t.href)},this),this.external=!0;break;default:return}},prepare_elements:function(){this.items&&0!==this.items.length&&(this.items=this.items.map(function(t){var e=t.href.split("?"),i={};i.element="element"===typeOf(t)?t:null,i.href=e[0],i.vars=e[1]?e[1].parseQueryString():null,i.size=null,i.caption=i.element?i.element.get("title"):t.title;t=i.element?i.element.get("data-milkbox-size"):t.size;return t&&(i.size=Object.map(this.get_item_props(t),function(t,e){return t.toInt()})),i},this),0!==this.items.length&&(this.type=1===this.items.length?"single":this.options.autoplay?"autoplay":"standard"))},check_extension:function(t){return t.split("?")[0].test(/\.(gif|jpg|jpeg|png|bmp|tif|tiff|swf|html)$/i)},get_index_of:function(e){return"string"===typeOf(e)?this.items.indexOf(this.items.filter(function(t){return t.href===e})[0]):this.items.indexOf(e)},get_item:function(t){return this.items[t]},get_item_props:function(t){var i={};return t.split(",").each(function(t,e){t=t.trim().split(":");i[t[0].trim()]=t[1].trim()},this),i},refresh:function(){this.type=1===this.items.length?"single":this.options.autoplay?"autoplay":"standard"},clear:function(){this.source=null,this.items=null}}),PEShape=new Class({Implements:[Options,Events],editor:null,options:{handler:{size:8,hover_size:9,opacity:.6,drag_opacity:.2,active_opacity:1,color:"inherit",stroke:"#000"},path:{active_opacity:.7,inactive_opacity:.4},active_color:"#f9f4e2",editable:!1},path:null,handlers:null,label:!1,connections:[],paper:null,shape:!1,finished:!1,active_handler:!1,identifier:null,initialize:function(t,e,i,n){this.editor=e,this.paper=e.paper,this.identifier=t,this.setOptions(i),void 0!==this.options.color&&null!==this.options.color||(this.options.color=this.editor.options.colors[Object.getLength(this.editor.shapes)%this.editor.options.colors.length]),(this.editor.shapes[t]=this).handlers=this.paper.set(),this.create_shape(n),this.path.data("shape",this),this.options.editable&&(this.path.click(this.on_click.bind(this)),this.path.dblclick(this.on_dblclick.bind(this)),this.path.drag(this.on_drag_move.bind(this),this.on_drag_start.bind(this),this.on_drag_end.bind(this)),this.editor.activate_shape(this))},set_identifier:function(t){var e=this.label&&this.label[1].attr("text")===this.identifier;delete this.editor.shapes[this.identifier],this.identifier=t,this.editor.shapes[t]=this,e&&this.draw_label(t)},finish:function(t){return this.finished=!0,this.editor.delete_shape_link&&this.editor.delete_shape_link.removeClass("disabled"),this.editor.fireEvent("create",[this,t]),!0},register_connection:function(t){this.connections.contains(t)||this.connections.push(t)},unregister_connection:function(t){this.connections.contains(t)&&this.connections.erase(t)},update_connections:function(){this.connections.each(function(t){t.update()})},get_connected_shapes:function(){var e=[];return this.connections.each(function(t){e.push(t.shape_1===this?t.shape_2:t.shape_1)}),e},destroy:function(){var e=[];this.connections.each(function(t){e.push([t.shape_1.identifier,t.shape_2.identifier])}),e.each(function(t){this.editor.disconnect(t[0],t[1])},this),this.path.undrag(),this.handlers.remove(),this.label&&this.label.remove(),this.path.remove(),this.path.unclick(),this.path.undblclick()},on_activate:function(){this.path.animate({"fill-opacity":this.options.path.active_opacity},500),this.handlers.show()},on_deactivate:function(){this.active_handler&&this.deactivate_handler_menu(),this.handlers.hide(),this.path.animate({"fill-opacity":this.options.path.inactive_opacity},500)},on_drag_move:function(t,e,i,n,r){t=Math.round(t*(this.editor.viewBox.W/this.editor.paper.width)),e=Math.round(e*(this.editor.viewBox.H/this.editor.paper.height));var a=t-this.prev_dx,s=e-this.prev_dy;this.prev_dx=t,this.prev_dy=e,this.path.translate(a,s),void 0!==this.handlers&&this.handlers.forEach(function(t){t.attr({cx:t.attrs.cx+a,cy:t.attrs.cy+s})}),!1!==this.label&&this.label.translate(a,s),0<this.connections.length&&this.update_connections()},on_drag_start:function(t){this!==this.editor.active_shape&&this.editor.activate_shape(this),this.prev_dx=0,this.prev_dy=0},on_drag_end:function(t){this.normalize(),this.send_update()},to_json:function(){return!1},get_coordinates:function(){return!1},set_color:function(t){this.path.attr({fill:t,stroke:t})},get_handler:function(e){var i=!1;return this.handlers.forEach(function(t){if(t.attrs.cx===e[1]&&t.attrs.cy===e[2])return i=t,!1}),i},draw_handler:function(t,e,i){"inherit"===(i=i||this.options.handler.color)&&(i=this.options.color);i=this.paper.circle(t,e,this.options.handler.size/2).attr({fill:i,"fill-opacity":this.options.handler.opacity,cursor:"pointer",stroke:this.options.handler.stroke,"stroke-opacity":1,"stroke-width":1});return this.handlers.push(i),i.drag(this.on_drag_handler_move.bind(this),this.on_drag_handler_start.bind(this),this.on_drag_handler_end.bind(this)),this!==this.editor.active_shape&&i.hide(),i.click(this.on_handler_click.bind(this)),i.dblclick(this.on_handler_dblclick.bind(this)),i},on_drag_handler_start:function(t,e,i){i=this.paper.getById(i.target.raphaelid);this.activate_handler_menu(i),i.disabled||(!1!==this.label&&this.label.hide(),i.ox="rect"===i.type?i.attr("x"):i.attr("cx"),i.oy="rect"===i.type?i.attr("y"):i.attr("cy"))},on_drag_handler_move:function(t,e,i,n,r){if((r=new DOMEvent(r)).stop(),!this.active_handler.disabled){t=this.editor.viewBox.W*(t/this.paper.width),e=this.editor.viewBox.H*(e/this.paper.height);i=this.active_handler.ox+t,n=this.active_handler.oy+e,n=this.editor.limit_point_to_bounds({x:i,y:n});return this.active_handler.attr({cx:n.x,cy:n.y}),!1}},on_drag_handler_end:function(t){return this.active_handler.ox=this.active_handler.oy=null,this.reposition_label(),!1!==this.label&&this.label.show(),0<this.connections.length&&this.update_connections(),this.send_update(),!1},activate_handler_menu:function(t){return!1!==this.active_handler&&this.active_handler!==t&&this.deactivate_handler_menu(),this.active_handler=t,this.active_handler.attr({fill:this.options.active_color}),this.active_handler.animate({"fill-opacity":this.options.handler.active_opacity},500),3<this.handlers.length?this.editor.delete_point_link.removeClass("disabled"):this.editor.delete_point_link.addClass("disabled"),!1},deactivate_handler_menu:function(){this.active_handler.attr({fill:this.options.color}),this.active_handler.animate({"fill-opacity":this.options.handler.opacity},500),this.editor.delete_point_link.addClass("disabled"),this.active_handler=!1},on_click:function(t){return(t=new DOMEvent(t)).stop(),this.editor.active_shape!==this&&this.editor.activate_shape(this),!1},on_dblclick:function(t){return!1},on_handler_click:function(t){(t=new DOMEvent(t)).stop();t=this.paper.getById(t.target.raphaelid);return this.activate_handler_menu(t),!1},on_handler_dblclick:function(t){return!1},on_canvas_click:function(t){return!1},on_canvas_dblclick:function(t){return!1},get_center:function(){return!1},show_label:function(){!1!==this.label&&this.label.show()},hide_label:function(){!1!==this.label&&this.label.hide()},get_label_text:function(){return!1!==this.label?this.label[1].attr("text"):""},draw_label:function(t){var e,i=this.get_label_text(),n=!1;if(this.label&&(e=this.label[0].attr("path")[0],r=this.get_center(),n=e[1]!==r.x||e[2]!==r.y),n||t!==i){if(!1!==this.label&&(this.label.unclick(),this.label.undrag(),this.label.remove(),this.label=!1),""!==t){var r=r||this.get_center();t=t||this.identifier,this.label=this.paper.tag(r.x,r.y,t).attr({"fill-opacity":.8,"stroke-opacity":.8,cursor:"pointer"}),this.options.editable&&(this.label.drag(this.on_drag_move.bind(this),this.on_drag_start.bind(this),this.on_drag_end.bind(this)),this.label.click(this.on_click.bind(this)),this.handlers.hover(this.label_fadeout.bind(this),this.label_fadein.bind(this)),this.editor.enable_menu_option("labels"),!1===this.editor.label_checkbox.get("checked")&&this.label.hide(),this.editor.options.editable_labels&&(this.editor.label_field.set("value",t),this.editor.enable_menu_option("edit_label"))),this.label.data("shape",this),this.label[0].data("center",r),this.path.hover(this.label_fadeout.bind(this),this.label_fadein.bind(this))}else{var a,s=!1;for(a in this.editor.shapes)if(!1!==this.editor.shapes[a].label){s=!0;break}s||this.editor.disable_menu_option("labels")}(i&&t!==i||!i&&t!==this.identifier)&&this.send_update()}},reposition_label:function(){var t;!1!==this.label&&(t=this.label[1].attr("text"),this.draw_label(t))},label_fadeout:function(){this.label.animate({"fill-opacity":.25,"stroke-opacity":0},300)},label_fadein:function(){this.label.animate({"fill-opacity":.8,"stroke-opacity":.8},300)},send_update:function(){this.editor.fireEvent("update",{label:this.get_label_text(),coords:this.get_coordinates(),identifier:this.identifier})}}),PEPolygon=new Class({Extends:PEShape,Implements:[Options,Events],Binds:["deactivate_new_points"],shape:"poly",options:{color:null},points:[],create_shape:function(i){if(this.path&&this.path.remove(),this.path=this.paper.path().attr({fill:this.options.color,"fill-opacity":this.options.path.inactive_opacity||.4,"stroke-linecap":"round","stroke-linejoin":"miter",stroke:this.options.color,"stroke-width":2,"stroke-opacity":1}),i)if("object"==typeof i[0])i.each(function(t,e){2<e&&e===i.length-1?(i[0].x===t.x&&i[0].y===t.y||this.add_point(t.x,t.y),this.finish(!0)):this.add_point(t.x,t.y)},this);else for(var t,e,n=0,r=i.length;n<r;n+=2)t=i[n],e=i[n+1],4<n&&n===i.length-2?(i[0]===t&&i[1]===e||this.add_point(t,e),this.finish(!0)):this.add_point(t,e)},normalize:function(){var e=[];this.handlers.forEach(function(t){t=this.editor.limit_point_to_bounds({x:t.attr("cx"),y:t.attr("cy")});e.push([0===e.length?"M":"L",t.x,t.y])},this),e.push("Z"),this.path.attr({path:e,transform:""})},to_json:function(){var e=Raphael.parsePathString(this.path.attr("path")),i={shape:this.shape,coordinates:[]};return e.each(function(t){"L"===t[0]||"M"===t[0]?i.coordinates.push({x:Math.round(t[1]),y:t[2]}):"Z"===t[0]&&i.coordinates.push({x:e[0][1],y:e[0][2]})}),JSON.encode(i)},get_coordinates:function(){var e=[],t=Raphael.parsePathString(this.path.attr("path"));return!t||t.length<=0||t.each(function(t){"L"===t[0]||"M"===t[0]?(e.push(Math.round(t[1])),e.push(Math.round(t[2]))):"Z"===t[0]&&(e.push(e[0]),e.push(e[1]))}),e},on_dblclick:function(t){this.finished&&(t=new DOMEvent(t),t=this.editor.convert_position(t.page.x,t.page.y),this.merge_point(t.x,t.y))},on_canvas_click:function(t){this.finished||this.add_point(t.x,t.y)},on_canvas_dblclick:function(t,e){!this.finished&&2<this.handlers.length&&this.editor.finish_shape(!1)},on_activate:function(){this.parent(),this.editor.enable_menu_option("add_point"),this.finished&&this.editor.add_point_link.removeClass("disabled"),this.editor.enable_menu_option("delete_point")},on_deactivate:function(){this.editor.disable_menu_option("add_point"),this.editor.disable_menu_option("delete_point"),this.parent()},finish:function(t){var e=Raphael.parsePathString(this.path.attr("path"));return!(null===e||e.length<3)&&(e.push(["Z"]),this.path.attr("path",e),this.options.editable&&this.editor.connect_points_link.hide(),this.parent(t))},add_point:function(t,e){if(!0===this.finished)return!1;var i=this.editor.limit_point_to_bounds(i={x:t,y:e}),t=this.draw_handler(i.x,i.y,this.options.color);1<this.handlers.length?(t.first=!1,e=Raphael.parsePathString(this.path.attr("path")),this.path.attr("path",e.toString()+"L"+i.x+" "+i.y)):(t.first=!0,this.path.attr("path","M"+i.x+" "+i.y)),this.options.editable&&!this.finished&&2<this.handlers.length&&this.editor.connect_points_link.removeClass("disabled")},merge_point:function(i,n){for(var t=Raphael.parsePathString(this.path.attr("path")),e=[],r=1;r<t.length;r++){var a,s,o=t[r-1],l=o[1],u=o[2];s=(a=(c="Z"===t[r][0]?t[0]:t[r])[1],c[2]);var h=((i-l)*(a-l)+(n-u)*(s-u))/(Math.pow(a-l,2)+Math.pow(s-u,2)),u=["M",l+h*(a-l),u+h*(s-u)],c=h<0?o:1<h?c:u,u=Math.sqrt(Math.pow(i-c[1],2)+Math.pow(n-c[2],2));e.push({distance:u,index:r-1,point:c,p1:o})}var d,p=!1;e.each(function(t){(0==p||t.distance<p.distance)&&t.distance<10&&(p=t)},this),!1!==p&&(d=[],t.each(function(t,e){d.push(t),p.index==e&&d.push(["L",i,n])}),this.path.attr("path",d),this.draw_handler(i,n,this.options.color))},delete_point:function(){var t=this.active_handler;this.deactivate_handler_menu(t);for(var e=Raphael.parsePathString(this.path.attr("path")),i=[],n=0;n<e.length;n++){var r=e[n];if(r[1]===t.attrs.cx&&r[2]===t.attrs.cy){if(0===n){var a=e[1];this.get_handler(a).first=!0;r=e[e.length-1];r[1]=a[1],r[2]=a[2],a[0]="M",i.push(a);for(var s=2;s<e.length-1;s++)i.push(e[s]);i.push(r);break}a=n===e.length-1?e[0]:e[n+1];e[n-1];for(s=0;s<e.length;s++)s!==n&&i.push(e[s]);break}}this.handlers.exclude(t),t.remove(),this.path.attr("path",i)},start_add_point:function(){if(this.finished){this.handlers.animate({"fill-opacity":.1,"stroke-opacity":.5},500),this.handlers.forEach(function(t){t.disabled=!0}),this.editor.add_point_link.addClass("disabled"),!1!==this.active_handler&&this.deactivate_handler_menu();var t=Raphael.parsePathString(this.path.attr("path"));"Z"===t[t.length-1][0]&&(t[t.length-1]=t[0]);var e=this,i=t.length,n=t[0];this.new_points=this.paper.set(),this.editor.element.addEvent("click",this.deactivate_new_points);for(var r=1;r<i;r++){var a=t[r],s=(n[1]+a[1])/2,o=(n[2]+a[2])/2,o=this.paper.circle(s,o,this.options.handler.size/2).attr({fill:this.options.active_color,"fill-opacity":.7,cursor:"pointer",stroke:"#000","stroke-opacity":1,"stroke-width":1});this.new_points.push(o),o.click(function(){return e.merge_point(this.attrs.cx,this.attrs.cy),e.deactivate_new_points(),!1}),n=a}}},deactivate_new_points:function(t){t=void 0!==t&&this.paper.getElementByPoint(t.page.x,t.page.y);this.new_points&&!this.new_points.items.contains(t)&&(this.new_points.remove(),this.new_points=!1,this.handlers.forEach(function(t){t.disabled=!1},this),this.handlers.animate({"fill-opacity":this.options.handler.opacity,"stroke-opacity":1},500),this.editor.add_point_link.removeClass("disabled")),this.editor.element.removeEvent("click",this.deactivate_new_points)},on_drag_handler_start:function(t,e,i){this.parent(t,e,i),this.deactivate_new_points();for(var n=Raphael.parsePathString(this.path.attr("path")),r=0;r<n.length;r++){var a=n[r],s=this.active_handler.attr(["cx","cy"]);if(s.cx==a[1]&&s.cy==a[2]){this.active_handler.index=r;break}}},on_drag_handler_move:function(t,e,i,n,r){this.parent(t,e,i,n,r);var r=Raphael.parsePathString(this.path.attr("path")),a=[];t=Math.round(t*(this.editor.viewBox.W/this.paper.width)),e=Math.round(e*(this.editor.viewBox.H/this.paper.height));var s=this.editor.limit_point_to_bounds({x:this.active_handler.ox+t,y:this.active_handler.oy+e});r.each(function(t,e){e==this.active_handler.index&&(t[1]=s.x,t[2]=s.y),a.push(t)},this),this.path.attr("path",a)},get_center:function(){for(var t,e,i,n,r,a=this.handlers,s=n=r=0,o=0,l=a.length,u=l-1;o<l;u=o++)t=a[o].attr(["cx","cy"]),e=a[u].attr(["cx","cy"]),i=t.cy*e.cx-e.cy*t.cx,n+=(t.cx+e.cx)*i,r+=(t.cy+e.cy)*i,s+=3*i;var h,c={x:n/s,y:r/s};return this.path.isPointInside(c.x,c.y)||(h=this.path.getBBox(),c.x=h.x+(h.x2-h.x)/2,c.y=h.y+(h.y2-h.y)/2),c}}),PECircle=new Class({Extends:PEShape,Implements:[Options,Events],shape:"circle",options:{cx:-10,cy:-10,r:10,active_color:"#000000",handler:{stroke:"#000",color:"#000"}},to_json:function(){return JSON.encode({shape:this.shape,coordinates:[this.path.attrs.cx,this.path.attrs.cy,this.path.attrs.r]})},get_coordinates:function(){var t=[],e=this.path.attr(["cx","cy","r"]);return e.cx<0&&this.finished&&(e.cx=0),e.cx>this.paper.width&&this.finished&&(e.cx=Math.round(this.paper.width-e.r)),this.path.attr({cx:e.cx}),e.cy<0&&this.finished&&(e.cy=0),e.cy>this.paper.height&&this.finished&&(e.cy=Math.round(this.paper.height-e.r)),this.path.attr({cy:e.cy}),this.handlers.attr({cx:e.cx+e.r,cy:e.cy}),t.push(e.cx),t.push(e.cy),t.push(e.r),t},create_shape:function(t){this.path&&this.path.remove(),t=t||[];var e=parseInt(t[0]||this.options.cx),i=parseInt(t[1]||this.options.cy),t=parseInt(t[2]||this.options.r);this.path=this.paper.circle(e,i,t).attr({fill:this.options.color,"fill-opacity":this.options.path.inactive_opacity,"stroke-linecap":"round","stroke-linejoin":"miter",stroke:this.options.color,"stroke-width":2,"stroke-opacity":1}),this.options.editable&&this.draw_handler(e+t,i),0<this.path.attr("cx")&&0<this.path.attr("cy")&&this.finish(!0)},normalize:function(){var t=this.path.attr("cx"),e=this.path.attr("cy");this.path.attr({cx:this.path.matrix.x(t,e),cy:this.path.matrix.y(t,e),transform:""})},on_canvas_click:function(t){this.finished||(this.path.attrs.cx<0||this.path.attrs.cy<0)&&(this.path.attr({cx:t.x,cy:t.y}).transform(""),this.handlers.attr({cx:t.x-this.path.attr("r"),cy:t.y}).transform(""),this.editor.finish_shape())},on_activate:function(){this.parent(),this.editor.enable_menu_option("size_control");var t=this.path.attr("r");this.activate_handler_menu(this.handlers.items[0]),this.set_size(t)},on_deactivate:function(){this.parent(),this.editor.disable_menu_option("size_control")},on_drag_handler_move:function(t,e,i,n,r){this.parent(t,e,i,n,r);var a=this.path.attr("cx"),i=this.path.attr("cy"),n=this.editor.viewBox.W/this.paper.width,r=this.editor.viewBox.H/this.paper.height;t=Math.round(t*n),e=Math.round(e*r);t=this.active_handler.ox+t,e=this.active_handler.oy+e,i=Math.round(Math.sqrt(Math.pow(t-a,2)+Math.pow(e-i,2)));this.set_size(i)},set_size:function(t,e){this.path.attr({r:t}),e&&this.handlers.attr({cx:this.path.attr("cx")+t,cy:this.path.attr("cy")}),this.editor.size_field.get("value").toInt()===t&&!e||(this.editor.size_field.set("value",t+"px"),this.send_update())},get_center:function(){var t=this.path.attr(["cx","cy"]);return{x:this.path.matrix.x(t.cx,t.cy),y:this.path.matrix.y(t.cx,t.cy)}}}),PEConnector=new Class({Implements:[Options,Events],Binds:["load_start","on_drag_move","load_end"],shape_1:null,shape_2:null,overlay:null,connector:!1,editor:null,paper:null,drag:{ox:!1,oy:!1},options:{from:!1,to:!1,color:"#000",dash:"",width:2,end_size:1},initialize:function(t,e){this.editor=t,this.paper=t.paper,this.setOptions(e),!1!==this.options.from&&!1!==this.options.to&&this.options.from>this.options.to&&(e=this.options.from,this.options.from=this.options.to,this.options.to=e),this.draw()},draw:function(){!1!==this.options.from&&!1!==this.options.to&&(this.load_start(),this.load_end())},destroy:function(){this.fireEvent("destroy"),this.editor.unregister_connection(this),this.shape_1&&(this.shape_1.unregister_connection(this),delete this.shape_1),this.shape_2&&(this.shape_2.unregister_connection(this),delete this.shape_2),delete this.editor,this.connector&&(this.connector.remove(),delete this.connector),this.overlay&&(this.overlay.undrag(),this.overlay.unclick(),this.overlay.remove(),delete this.overlay),this.removeEvents("destroy")},start:function(){var t;this.overlay=this.paper.rect(0,0,this.paper.width,this.paper.height).attr({fill:"#fff",stroke:"#fff","fill-opacity":0,"stroke-opacity":0}).toFront(),!1!==this.options.from?(t=this.editor.shapes[this.options.from].get_center(),this.load_start(t.x,t.y),this.overlay.mousemove(function(t){var e=new DOMEvent(t),t=this.editor.convert_position(e.page.x,e.page.y),e=t.x-this.drag.ox,t=t.y-this.drag.oy;this.on_drag_move(e,t)}.bind(this)),this.connector[2].click(this.load_end)):this.overlay.drag(this.on_drag_move,this.load_start,this.load_end)},on_drag_move:function(t,e){var i;this.connector&&(i=this.connector[0].attr(["cx","cy"]),t=this.drag.ox+t,e=this.drag.oy+e,this.connector[1].attr({path:[["M",i.cx,i.cy],["L",t,e]]}).transform(""),this.connector[2].attr({cx:t,cy:e,transform:""}))},load_start:function(t,e,i){var n;!1!==this.options.from?(this.shape_1=this.editor.shapes[this.options.from],n=this.shape_1.get_center()):(n=this.editor.convert_position(t,e),Object.each(this.editor.shapes,function(t){if(t.path.isPointInside(n.x,n.y))return this.shape_1=t,!1},this)),this.shape_1?(e=this.shape_1.get_center(),this.connector=this.paper.set(),this.connector.push(this.paper.circle(e.x,e.y,this.options.end_size).attr({fill:this.options.color})),this.connector.push(this.paper.path([["M",e.x,e.y],["L",n.x,n.y]]).attr({stroke:this.options.color,"stroke-width":this.options.width,"stroke-dasharray":this.options.dash||null})),this.connector.push(this.paper.circle(n.x,n.y,this.options.end_size).attr({fill:this.options.color})),this.connector.toFront(),i?(this.drag.ox=n.x,this.drag.oy=n.y):(this.drag.ox=!1,this.drag.oy=!1)):this.destroy()},set_style:function(t){this.connector.attr({fill:t.color||this.options.color}),this.connector[0].attr({r:t.end_size||this.options.end_size}),this.connector[1].attr({stroke:t.color||this.options.color,"stroke-width":t.width||this.options.width,"stroke-dasharray":t.dash||null}),this.connector[2].attr({r:t.end_size||this.options.end_size})},load_end:function(){var t,e,i,n;this.shape_1&&this.connector&&(t=this.connector[0].attr(["cx","cy"]),e=this.connector[2].attr(["cx","cy"]),i=!1,Math.round(this.drag.ox)===Math.round(e.cx)&&Math.round(this.drag.oy)===Math.round(e.cy)?i=!0:(this.options.to?this.shape_2=this.editor.shapes[this.options.to]:Object.each(this.editor.shapes,function(t){if(t!==this.shape_1&&t.path.isPointInside(e.cx,e.cy))return this.shape_2=t,!1},this),this.shape_2&&(n=this.shape_2.get_center(),this.connector[1].attr({path:[["M",t.cx,t.cy],["L",n.x,n.y]]}),this.connector[2].attr({cx:n.x,cy:n.y}),this.editor.register_connection(this),this.shape_1.register_connection(this),this.shape_2.register_connection(this),this.fireEvent("connect",[this])))),i?this.overlay&&(this.overlay.undrag(),this.overlay.mousemove(function(t){t=this.editor.convert_position(t.pageX,t.pageY);this.on_drag_move(t.x-this.drag.ox,t.y-this.drag.oy)}.bind(this)),this.connector[2].click(function(t){this.connector[2].unclick(),this.load_end()}.bind(this)),this.editor.paper.canvas.addEvent("mouseleave",function(t){this.load_end()}.bind(this))):this.shape_1&&this.shape_2||!this.connector?this.overlay&&(this.overlay.undrag(),this.overlay.unclick(),this.overlay.remove(),this.overlay=!1):this.destroy()},update:function(){var t,e,i,n;this.connector&&(t=Raphael.parsePathString(this.connector[1].attr("path")),e=!1,this.shape_1&&(n=this.shape_1.get_center(),(i=this.connector[0].attr(["cx","cy"])).cx===n.x&&i.cy===n.y||(this.connector[0].attr({cx:n.x,cy:n.y}),t[0]=["M",n.x,n.y],e=!0)),this.shape_2&&(i=this.shape_2.get_center(),(n=this.connector[2].attr(["cx","cy"])).cx===i.x&&n.cy===i.y||(this.connector[2].attr({cx:i.x,cy:i.y}),t[1]=["L",i.x,i.y],e=!0)),e&&this.connector[1].attr({path:t}))}}),PolygonViewer=new Class({Implements:[Options,Events],Binds:["preventScroll","deactivate_new_points"],container:!1,element:!1,shapes:{},connections:[],options:{image:{src:"",width:0,height:0},path:{active_opacity:.7,inactive_opacity:.4},paths:[],active_color:"#f9f4e2",textattr:{"font-weight":"normal",fill:"#fff","font-size":"10px"},polygon_options:{},circle_options:{},shape_options:{},colors:["#5d21d9","#21c5d9","#21d92e","#d9d721","#d98421","#d92121","#89d921","#213fd9","#d921c5"],zoom_by_scroll:!0},cur_zoom_level:100,is_dragging:!1,delete_point_link:!1,viewBox:{},initialize:function(t,e){this.setOptions(e),this.container=t,this.container.addClass("polygon-editor-container"),this.container.addClass("rs_skip"),this.element=new Element("div",{class:"polygon-editor-element",style:"display: inline-block; position: relative"}),this.container.grab(this.element),this.element.store("polygon_editor",this),this.load_menu();e=0,e=0!=this.element.offsetWidth?Math.min("string"==typeof this.options.image.width?parseInt(this.options.image.width):this.options.image.width,this.element.offsetWidth):"string"==typeof this.options.image.width?parseInt(this.options.image.width):this.options.image.width,t=("string"==typeof this.options.image.height?parseInt(this.options.image.height):this.options.image.height)||this.element.offsetHeight;this.paper=Raphael(this.element,e,t),this.paper.desc.set("text",""),!1!==this.options.image&&this.paper.image(this.options.image.src,0,0,this.options.image.width,this.options.image.height),this.viewBox={X:0,Y:0,W:e,H:t},this.paper.setViewBox(this.viewBox.X,this.viewBox.Y,this.viewBox.W,this.viewBox.H,!1),this.load_panning(),0<this.options.paths.length&&this.add_paths(this.options.paths),this.element.addEvents({click:this.on_click.bind(this),dblclick:this.on_dblclick.bind(this)})},load_menu:function(){},add_paths:function(t){if("array"!==typeOf(t)||0===t.length)return!1;t.each(function(t,e){var i,e=void 0===t.identifier?"path"+e:t.identifier;this.shapes[e]&&this.delete_path(e,!0),"polygon"===t.shape||"poly"===t.shape?i=new PEPolygon(e,this,Object.merge(this.options.shape_options,this.options.polygon_options,t.options||{}),t.coords||t.coordinates):"circle"===t.shape&&(i=new PECircle(e,this,Object.merge(this.options.shape_options,this.options.circle_options,t.options||{}),t.coords||t.coordinates)),t.label&&i.draw_label(t.label)}.bind(this)),this.active_shape&&this.deactivate_shape()},on_click:function(t){var e=this.paper.getElementByPoint(t.page.x,t.page.y),i=this.convert_position(t.page.x,t.page.y);this.fireEvent("click",[t,e,i])},on_dblclick:function(t){var e=this.paper.getElementByPoint(t.page.x,t.page.y),i=this.convert_position(t.page.x,t.page.y);this.fireEvent("dblclick",[t,e,i])},enable_menu_option:function(){return!0},disable_menu_option:function(){return!0},register_connection:function(t){this.connections.contains(t)||(this.connections.push(t),this.fireEvent("connect",[{identifier:t.shape_1.identifier,label:t.shape_1.get_label_text()},{identifier:t.shape_2.identifier,label:t.shape_2.get_label_text()}]))},unregister_connection:function(t){this.connections.contains(t)&&(this.connections.erase(t),this.fireEvent("disconnect",[t.shape_1.identifier,t.shape_2.identifier]))},get_connection:function(t,e){for(var i=0,n=this.connections.length;i<n;i++){var r=this.connections[i];if(r.shape_1.identifier===t&&r.shape_2.identifier===e||r.shape_1.identifier===e&&r.shape_2.identifier===t)return r}return!1},connect:function(t,e,i){this.shapes[t]&&this.shapes[e]&&new PEConnector(this,Object.merge({from:t,to:e},i||{}))},disconnect:function(t,e){e=this.get_connection(t,e);!1!==e&&e.destroy()},set_width:function(t){this.paper.setSize(t,this.paper.height),100===this.cur_zoom_level&&(this.viewBox.W=t,this.paper.setViewBox(this.viewBox.X,this.viewBox.Y,this.viewBox.W,this.viewBox.H,!1))},to_json:function(t){if(t)return this.shapes[t].to_json();var i="{",n=0;return Object.each(this.shapes,function(t,e){0<n&&(i+=","),i+=JSON.encode(e)+":"+t.to_json(),n++}),i+="}"},get_path_coordinates:function(t){return!(!this.shapes[t]||void 0===this.shapes[t])&&this.shapes[t].get_coordinates()},delete_path:function(t,e){var i=this.shapes[t];i===this.active_shape&&this.deactivate_shape(),this.shapes[t].destroy(),delete this.shapes[t];try{i.destroy()}catch(t){}var n,r=0;for(n in this.shapes){var a=this.options.colors[r%this.options.colors.length];this.shapes[n].set_color(a),r++}e||this.fireEvent("delete",[t])},limit_point_to_bounds:function(t){return t.x=Math.round(Math.max(Math.min(t.x,this.options.image.width),0)),t.y=Math.round(Math.max(Math.min(t.y,this.options.image.height),0)),t},convert_position:function(t,e){var i=this.element.getPosition(),n=this.element.getComputedSize(),t=t-i.x-n.computedLeft,n=e-i.y-n.computedTop;return{x:t=this.viewBox.W*(t/this.paper.width),y:n=this.viewBox.H*(n/this.paper.height)}},update_order:function(t,e){if((e=!!e)&&Object.keys(this.shapes)!==t){for(var i={},n=0,r=t.length;n<r;n++)i[t[n]]=this.shapes[t[n]];this.shapes=i}for(n=t.length-1;0<=n;n--)this.shapes[t[n]].path.toFront(),this.shapes[t[n]].handlers.toFront();for(var a=this.connections.length-1;0<=a;a--)this.connections[a].connector.toFront();for(n=t.length-1;0<=n;n--)!1!==this.shapes[t[n]].label&&this.shapes[t[n]].label.toFront()},destroy:function(){for(var t in this.element.eliminate("polygon_editor"),this.paths)this.paths[t].points.each(function(t){t.handler.remove()}),this.paths[t].remove(),delete this.paths[t];this.paper.remove(),this.container.empty(),this.options.zoom_by_scroll&&window.removeEventListener("MozMousePixelScroll",this.preventScroll)},create_identifier:function(){for(var t=Object.keys(this.shapes).map(String.toLowerCase),e=1,i=t.length+1;e<=i;e++){var n=this.int2char(e);if(!t.contains(n))return n.toUpperCase()}return String.uniqueID().toUpperCase()},int2char:function(t){--t;var e=Math.floor(t/26);return 0<e?this.int2chr(e)+this.chr(97+t%26):this.chr(97+t%26)},chr:function(t){return 65535<t?(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t))):String.fromCharCode(t)},load_panning:function(){var i,n,r,a,s,o,l=!1;this.element.addEvent("mousedown",function(t){var e=this.paper.getElementByPoint(t.page.x,t.page.y);null!=e&&"image"!==e.type||(l=!0,i=t.page.x,n=t.page.y,o=a=s=r=0,t.stop())}.bind(this)),window.addEvent("mousemove",function(t){var e;0!=l&&(r=i-t.page.x,a=n-t.page.y,r=Math.round(r*(this.viewBox.W/this.paper.width)),a=Math.round(a*(this.viewBox.H/this.paper.height)),s=this.viewBox.X+r,o=this.viewBox.Y+a,s=Math.max(s,0),o=Math.max(o,0),e=this.viewBox.W<this.options.image.width?this.options.image.width-this.viewBox.W:0,t=this.viewBox.H<this.options.image.height?this.options.image.height-this.viewBox.H:0,s=Math.min(s,e),o=Math.min(o,t),this.paper.setViewBox(s,o,this.viewBox.W,this.viewBox.H))}.bind(this)),window.addEvent("mouseup",function(t){0!=l&&(this.viewBox.X=s,this.viewBox.Y=o,l=!1)}.bind(this)),this.options.zoom_by_scroll&&(this.element.addEvent("mousewheel",function(t){return t.stop(),0<t.wheel?this.zoom(-5,t):this.zoom(5,t),!1}.bind(this)),Browser.firefox&&window.addEventListener("MozMousePixelScroll",this.preventScroll))},preventScroll:function(t){if(t.target===this.element||this.element.contains(t.target)){t=new DOMEvent(t);return t.preventDefault(),t.stop(),!1}},zoom_in:function(){this.zoom(5)},zoom_out:function(){this.zoom(-5)},zoom:function(t,e){var i=this.cur_zoom_level,n=Math.min(500,Math.max(5,i+t)),r=this.paper.width,a=this.paper.height,s=this.viewBox.H,i=this.viewBox.W;this.viewBox.W=r/(n/100),this.viewBox.H=a/(n/100),this.viewBox.W=Math.max(this.viewBox.W,this.paper.width/5),this.viewBox.H=Math.max(this.viewBox.H,this.paper.height/5),this.viewBox.W=Math.min(this.viewBox.W,10*this.paper.width),this.viewBox.H=Math.min(this.viewBox.H,10*this.paper.height),void 0!==e&&0!==this.viewBox.X?(t=this.element.getPosition(),r=this.element.getSize(),a=(e.page.x-t.x)/r.x,r=(e.page.y-t.y)/r.y,this.viewBox.X-=(this.viewBox.W-i)*a,this.viewBox.Y-=(this.viewBox.H-s)*r):0!==this.viewBox.X&&(this.viewBox.X-=(this.viewBox.W-i)/2,this.viewBox.Y-=(this.viewBox.H-s)/2),this.viewBox.X=Math.round(this.viewBox.X),this.viewBox.Y=Math.round(this.viewBox.Y),this.viewBox.W=Math.round(this.viewBox.W),this.viewBox.H=Math.round(this.viewBox.H),this.viewBox.X=Math.max(this.viewBox.X,0),this.viewBox.y=Math.max(this.viewBox.y,0);i=this.viewBox.W<this.options.image.width?this.options.image.width-this.viewBox.W:0,s=this.viewBox.H<this.options.image.height?this.options.image.height-this.viewBox.H:0;return this.viewBox.X=Math.min(this.viewBox.X,i),this.viewBox.y=Math.min(this.viewBox.y,s),this.cur_zoom_level=n,this.paper.setViewBox(this.viewBox.X,this.viewBox.Y,this.viewBox.W,this.viewBox.H),n}});window.FileAPI={debug:!1,cors:!1,media:!1,staticPath:"/base/resources/js/fileapi/"},void 0!==window.getCSRFToken&&(window.FileAPI.headers={"X-Request":"REST"},window.FileAPI.headers[window.getCSRFHeaderName()]=window.getCSRFToken()),function(t){"use strict";var n=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,s=t.Blob&&function(){try{return Boolean(new Blob)}catch(t){return!1}}(),o=s&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(t){return!1}}(),l=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,r=(s||l)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(t){for(var e,i=(0<=t.split(",")[0].indexOf("base64")?atob:decodeURIComponent)(t.split(",")[1]),n=new ArrayBuffer(i.length),r=new Uint8Array(n),a=0;a<i.length;a+=1)r[a]=i.charCodeAt(a);return e=t.split(",")[0].split(":")[1].split(";")[0],s?new Blob([o?r:n],{type:e}):((t=new l).append(n),t.getBlob(e))};t.HTMLCanvasElement&&!n.toBlob&&(n.mozGetAsFile?n.toBlob=function(t,e,i){i&&n.toDataURL&&r?t(r(this.toDataURL(e,i))):t(this.mozGetAsFile("blob",e))}:n.toDataURL&&r&&(n.toBlob=function(t,e,i){t(r(this.toDataURL(e,i)))})),t.dataURLtoBlob=r}(window),function(r,s){"use strict";function m(){}function t(t){return(t=new r.Number(O.pow(1024,t))).from=function(t){return O.round(t*this)},t}function o(e,t,i){var n,r;e&&(n=z.uid(e),L[n]||(L[n]={}),r=_&&e&&e instanceof _,j(t.split(/\s+/),function(t){T&&!r?T.event.add(e,t,i):(L[n][t]||(L[n][t]=[]),L[n][t].push(i),e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i)}))}function l(n,t,r){var e,a,s;n&&(e=z.uid(n),a=L[e]||{},s=_&&n&&n instanceof _,j(t.split(/\s+/),function(t){if(T&&!s)T.event.remove(n,t,r);else{for(var e=a[t]||[],i=e.length;i--;)if(e[i]===r){e.splice(i,1);break}n.addEventListener?n.removeEventListener(t,r,!1):n.detachEvent?n.detachEvent("on"+t,r):n["on"+t]=null}}))}function d(i,n,r){o(i,n,function t(e){l(i,n,t),r(e)})}function a(t){return t.target||(t.target=r.event&&r.event.srcElement||n),3===t.target.nodeType&&(t.target=t.target.parentNode),t}function e(t){var e=n.createElement("input");return e.setAttribute("type","file"),t in e}var i=1,n=r.document,u=n.doctype||{},h=r.navigator.userAgent,p=/safari\//i.test(h)&&!/chrome\//i.test(h),c=/iemobile\//i.test(h),f=!p&&/chrome\//i.test(h)&&"http:"===r.location.protocol,g=r.createObjectURL&&r||r.URL&&URL.revokeObjectURL&&URL||r.webkitURL&&webkitURL,v=r.Blob,y=r.File,_=r.FileReader,b=r.FormData,w=r.XMLHttpRequest,T=r.jQuery,x=!(!(y&&_&&(r.Uint8Array||b||w.prototype.sendAsBinary))||p&&/windows/i.test(h)&&!c),c=x&&"withCredentials"in new w,v=x&&!!v&&!!(v.prototype.webkitSlice||v.prototype.mozSlice||v.prototype.slice),S=0<(""+"".normalize).indexOf("[native code]"),E=r.dataURLtoBlob,k=/img/i,C=/canvas/i,I=/img|canvas/i,A=/input/i,P=/^data:[^,]+,/,D={}.toString,O=r.Math,L={},M=[],R="abort progress error load loadend",N="status statusText readyState response responseXML responseText responseBody".split(" "),B="currentTarget",F="preventDefault",U=function(t){return t&&"length"in t},j=function(t,e,i){if(t)if(U(t))for(var n=0,r=t.length;n<r;n++)n in t&&e.call(i,t[n],n,t);else for(var a in t)t.hasOwnProperty(a)&&e.call(i,t[a],a,t)},q=function(i){for(var t=arguments,e=1,n=function(t,e){i[e]=t};e<t.length;e++)j(t[e],n);return i},z={version:"2.1.1",cors:!1,html5:!0,media:!1,formData:!0,multiPassResize:!0,insecureChrome:f,debug:!1,pingUrl:!1,multiFlash:!1,flashAbortTimeout:0,withCredentials:!0,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,postNameConcat:function(t,e){return t+(null!=e?"["+e+"]":"")},ext2mime:{jpg:"image/jpeg",tif:"image/tiff",txt:"text/plain"},accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},uploadRetry:0,networkDownRetryTimeout:5e3,chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2e3,KB:t(1),MB:t(2),GB:t(3),TB:t(4),EMPTY_PNG:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",expando:"fileapi"+(new Date).getTime(),uid:function(t){return t?t[z.expando]=t[z.expando]||z.uid():(++i,z.expando+i)},log:function(){z.debug},newImage:function(t,e){var i=n.createElement("img");return e&&z.event.one(i,"error load",function(t){e("error"==t.type,i),i=null}),i.src=t,i},getXHR:function(){var e;if(w)e=new w;else if(r.ActiveXObject)try{e=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(t){e=new ActiveXObject("Microsoft.XMLHTTP")}return e},isArray:U,support:{dnd:c&&"ondrop"in n.createElement("div"),cors:c,html5:x,chunked:v,dataURI:!0,accept:e("accept"),multiple:e("multiple")},event:{on:o,off:l,one:d,fix:a},throttle:function(t,e){var i,n;return function(){n=arguments,i||(t.apply(r,n),i=setTimeout(function(){i=0,t.apply(r,n)},e))}},F:function(){},parseJSON:function(t){t=r.JSON&&JSON.parse?JSON.parse(t):new Function("return ("+t.replace(/([\r\n])/g,"\\$1")+");")();return t},trim:function(t){return(t=String(t)).trim?t.trim():t.replace(/^\s+|\s+$/g,"")},defer:function(){var i,n,r=[],a={resolve:function(t,e){for(a.resolve=m,n=t||!1,i=e;e=r.shift();)e(n,i)},then:function(t){n!==s?t(n,i):r.push(t)}};return a},queue:function(t){var e=0,i=0,n=!1,r=!1,a={inc:function(){i++},next:function(){e++,setTimeout(a.check,0)},check:function(){i<=e&&!n&&a.end()},isFail:function(){return n},fail:function(){n||t(n=!0)},end:function(){r||(r=!0,t())}};return a},each:j,afor:function(e,i){var n=0,r=e.length;U(e)&&r--?function t(){i(r!=n&&t,e[n],n++)}():i(!1)},extend:q,isFile:function(t){return"[object File]"===D.call(t)},isBlob:function(t){return this.isFile(t)||"[object Blob]"===D.call(t)},isCanvas:function(t){return t&&C.test(t.nodeName)},getFilesFilter:function(t){return(t="string"==typeof t?t:t.getAttribute&&t.getAttribute("accept")||"")?new RegExp("("+t.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(t,e){z.isCanvas(t)?H(t,e,"load",z.toDataURL(t)):W(t,e,"DataURL")},readAsBinaryString:function(t,i){V("BinaryString")?W(t,i,"BinaryString"):W(t,function(e){if("load"==e.type)try{e.result=z.toBinaryString(e.result)}catch(t){e.type="error",e.message=t.toString()}i(e)},"DataURL")},readAsArrayBuffer:function(t,e){W(t,e,"ArrayBuffer")},readAsText:function(t,e,i){i||(i=e,e="utf-8"),W(t,i,"Text",e)},toDataURL:function(t,e){return"string"==typeof t?t:t.toDataURL?t.toDataURL(e||"image/png"):void 0},toBinaryString:function(t){return r.atob(z.toDataURL(t).replace(P,""))},readAsImage:function(i,n,e){var r,t;z.isBlob(i)?g?(t=g.createObjectURL(i))===s?H(i,n,"error"):z.readAsImage(t,n,e):z.readAsDataURL(i,function(t){"load"==t.type?z.readAsImage(t.result,n,e):!e&&"error"!=t.type||H(i,n,t,null,{loaded:t.loaded,total:t.total})}):z.isCanvas(i)?H(i,n,"load",i):k.test(i.nodeName)?i.complete?H(i,n,"load",i):d(i,r="error abort load",function t(e){"load"==e.type&&g&&g.revokeObjectURL(i.src),l(i,r,t),H(i,n,e,i)}):i.iframe?H(i,n,{type:"error"}):(t=z.newImage(i.dataURL||i),z.readAsImage(t,n,e))},checkFileObj:function(t){var i={},e=z.accept;return"object"==typeof t?i=t:i.name=(t+"").split(/\\|\//g).pop(),null==i.type&&(i.type=i.name.split(".").pop()),j(e,function(t,e){((t=new RegExp(t.replace(/\s/g,"|"),"i")).test(i.type)||z.ext2mime[i.type])&&(i.type=z.ext2mime[i.type]||e.split("/")[0]+"/"+i.type)}),i},getDropFiles:function(t,e){var n=[],r=[],t=Y(t),i=t.files,a=t.items,s=U(a)&&a[0]&&X(a[0]),o=z.queue(function(){e(n,r)});if(s)if(S&&i)for(var l,u,h=i.length,c=new Array(h);h--;){l=i[h];try{u=X(a[h])}catch(t){z.log("[err] getDropFiles: ",t),u=null}G(u)&&(u.isDirectory||u.isFile&&l.name==l.name.normalize("NFC"))?c[h]=u:c[h]=l}else c=a;else c=i;j(c||[],function(i){o.inc();try{s&&G(i)?function e(i,n){{var a,s,o,l,u,t;i?i.isFile?i.file(function(t){t.fullPath=i.fullPath,n(!1,[t],[t])},function(t){i.error=t,n("FileError.code: "+t.code,[],[i])}):i.isDirectory?(a=i.createReader(),s=!0,o=[],l=[i],u=function(t){i.error=t,n("DirectoryError.code: "+t.code,o,l)},t=function r(t){s&&(s=!1,t.length||(i.error=new Error("directory is empty"))),t.length?z.afor(t,function(n,t){e(t,function(t,e,i){t||(o=o.concat(e)),l=l.concat(i),n?n():a.readEntries(r,u)})}):n(!1,o,l)},a.readEntries(t,u)):e(X(i),n):(t=new Error("invalid entry"),(i=new Object(i)).error=t,n(t.message,[],[i]))}}(i,function(t,e,i){t?z.log("[err] getDropFiles:",t):n.push.apply(n,e),r.push.apply(r,i),o.next()}):function(t,e){if(!t.type&&(p||t.size%4096==0&&t.size<=102400))if(_)try{var i=new _;d(i,R,function(t){t="error"!=t.type;t?(null!=i.readyState&&i.readyState!==i.LOADING||i.abort(),e(t)):e(!1,i.error)}),i.readAsDataURL(t)}catch(t){e(!1,t)}else e(null,new Error("FileReader is not supported"));else e(!0)}(i,function(t,e){t?n.push(i):i.error=e,r.push(i),o.next()})}catch(t){o.next(),z.log("[err] getDropFiles: ",t)}}),o.check()},getFiles:function(t,e,i){var n=[];return i?(z.filterFiles(z.getFiles(t),e,i),null):(t.jquery&&(t.each(function(){n=n.concat(z.getFiles(this))}),t=n,n=[]),"string"==typeof e&&(e=z.getFilesFilter(e)),t.originalEvent?t=a(t.originalEvent):t.srcElement&&(t=a(t)),t.dataTransfer?t=t.dataTransfer:t.target&&(t=t.target),t.files?(n=t.files,x||(n[0].blob=t,n[0].iframe=!0)):!x&&$(t)?z.trim(t.value)&&((n=[z.checkFileObj(t.value)])[0].blob=t,n[0].iframe=!0):U(t)&&(n=t),z.filter(n,function(t){return!e||e.test(t.name)}))},getTotalSize:function(t){for(var e=0,i=t&&t.length;i--;)e+=t[i].size;return e},getInfo:function(e,n){var r={},a=M.concat();z.isBlob(e)?function i(){var t=a.shift();t?t.test(e.type)?t(e,function(t,e){t?n(t):(q(r,e),i())}):i():n(!1,r)}():n("not_support_info",r)},addInfoReader:function(e,t){t.test=function(t){return e.test(t)},M.push(t)},filter:function(t,e){for(var i,n=[],r=0,a=t.length;r<a;r++)r in t&&(i=t[r],e.call(i,i,r,t)&&n.push(i));return n},filterFiles:function(t,n,e){var r,a,s,o;t.length?(r=t.concat(),s=[],o=[],function i(){r.length?(a=r.shift(),z.getInfo(a,function(t,e){(n(a,!t&&e)?s:o).push(a),i()})):e(s,o)}()):e([],t)},upload:function(o){(o=q({jsonp:"callback",prepare:z.F,beforeupload:z.F,upload:z.F,fileupload:z.F,fileprogress:z.F,filecomplete:z.F,progress:z.F,complete:z.F,pause:z.F,imageOriginal:!0,chunkSize:z.chunkSize,chunkUploadRetry:z.chunkUploadRetry,uploadRetry:z.uploadRetry},o)).imageAutoOrientation&&!o.imageTransform&&(o.imageTransform={rotate:"auto"});var l,u=new z.XHR(o),h=this._getFilesDataArray(o.files),c=this,d=0,p=0,f=!1;return j(h,function(t){d+=t.size}),u.files=[],j(h,function(t){u.files.push(t.file)}),u.total=d,u.loaded=0,u.filesLeft=h.length,o.beforeupload(u,o),l=function(){var i,t,n=h.shift(),r=n&&n.file,a=!1,s=(i={},j(o,function(t,e){t&&"object"==typeof t&&void 0===t.nodeType&&(t=q({},t)),i[e]=t}),i);u.filesLeft=h.length,r&&r.name===z.expando&&(r=null,z.log("[warn] FileAPI.upload() — called without files")),("abort"!=u.statusText||u.current)&&n?(f=!1,(u.currentFile=r)&&!1===o.prepare(r,s)?l.call(c):(s.file=r,c._getFormData(s,n,function(t){p||o.upload(u,o);var e=new z.XHR(q({},s,{upload:r?function(){o.fileupload(r,e,s)}:m,progress:r?function(t){a||(a=t.loaded===t.total,o.fileprogress({type:"progress",total:n.total=t.total,loaded:n.loaded=t.loaded},r,e,s),o.progress({type:"progress",total:d,loaded:u.loaded=p+n.size*(t.loaded/t.total)||0},r,e,s))}:m,complete:function(t){j(N,function(t){u[t]=e[t]}),r&&(n.total=n.total||n.size,n.loaded=n.total,t||(this.progress(n),a=!0,p+=n.size,u.loaded=p),o.filecomplete(t,e,r,s)),setTimeout(function(){l.call(c)},0)}}));u.abort=function(t){t||(h.length=0),this.current=t,e.abort()},e.send(t)}))):(t=200==u.status||201==u.status||204==u.status,o.complete(!t&&(u.statusText||"error"),u,o),f=!0)},setTimeout(l,0),u.append=function(t,e){t=z._getFilesDataArray([].concat(t)),j(t,function(t){d+=t.size,u.files.push(t.file),e?h.unshift(t):h.push(t)}),u.statusText="",f&&l.call(c)},u.remove=function(t){for(var e,i=h.length;i--;)h[i].file==t&&(e=h.splice(i,1),d-=e.size);return e},u},_getFilesDataArray:function(t){var e,n=[],i={};return $(t)?(e=z.getFiles(t),i[t.name||"file"]=null!==t.getAttribute("multiple")?e:e[0]):U(t)&&$(t[0])?j(t,function(t){i[t.name||"file"]=z.getFiles(t)}):i=t,j(i,function e(t,i){U(t)?j(t,function(t){e(t,i)}):t&&(t.name||t.image)&&n.push({name:i,file:t,size:t.size,total:t.size,loaded:0})}),n.length||n.push({file:{name:z.expando}}),n},_getFormData:function(r,t,e){var i=t.file,a=t.name,s=i.name,o=i.type,l=z.support.transform&&r.imageTransform,u=new z.Form,h=z.queue(function(){e(u)}),c=l&&function(t){for(var e in t)if(t.hasOwnProperty(e)&&!(t[e]instanceof Object||"overlay"===e||"filter"===e))return!0;return!1}(l),d=z.postNameConcat;j(r.data,function i(t,n){"object"==typeof t?j(t,function(t,e){i(t,d(n,e))}):u.append(n,t)}),function i(n){n.image?(h.inc(),n.toData(function(t,e){n.file&&(e.type=n.file.type,e.quality=n.matrix.quality,s=n.file&&n.file.name),s=s||(new Date).getTime()+".png",i(e),h.next()})):z.Image&&l&&(/^image/.test(n.type)||I.test(n.nodeName))?(h.inc(),c&&(l=[l]),z.Image.transform(n,l,r.imageAutoOrientation,function(t,e){var i;c&&!t?(E||z.flashEngine||(u.multipart=!0),u.append(a,e[0],s,l[0].type||o)):(i=0,t||j(e,function(t,e){E||z.flashEngine||(u.multipart=!0),l[e].postName||(i=1),u.append(l[e].postName||d(a,e),t,s,l[e].type||o)}),(t||r.imageOriginal)&&u.append(d(a,i?"original":null),n,s,o)),h.next()})):s!==z.expando&&u.append(a,n,s)}(i),h.check()},reset:function(i,t){var e,n;return T?(n=T(i).clone(!0).insertBefore(i).val("")[0],t||T(i).remove()):(e=i.parentNode,(n=e.insertBefore(i.cloneNode(!0),i)).value="",t||e.removeChild(i),j(L[z.uid(i)],function(t,e){j(t,function(t){l(i,e,t),o(n,e,t)})})),n},load:function(e,i){var n=z.getXHR();return n?(n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined"),o(n,"progress",function(t){t.lengthComputable&&i({type:t.type,loaded:t.loaded,total:t.total},n)}),n.onreadystatechange=function(){var t;4==n.readyState&&(n.onreadystatechange=null,200==n.status?((t={name:(e=e.split("/"))[e.length-1],size:n.getResponseHeader("Content-Length"),type:n.getResponseHeader("Content-Type")}).dataURL="data:"+t.type+";base64,"+z.encode64(n.responseBody||n.responseText),i({type:"load",result:t},n)):i({type:"error"},n))},n.send(null)):i({type:"error"}),n},encode64:function(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="",n=0;for("string"!=typeof t&&(t=String(t));n<t.length;){var r,a,s=255&t.charCodeAt(n++),o=255&t.charCodeAt(n++),l=255&t.charCodeAt(n++),u=s>>2,s=(3&s)<<4|o>>4;isNaN(o)?r=a=64:(r=(15&o)<<2|l>>6,a=isNaN(l)?64:63&l),i+=e.charAt(u)+e.charAt(s)+e.charAt(r)+e.charAt(a)}return i}};function H(t,e,i,n,r){n={type:i.type||i,target:t,result:n};q(n,r),e(n)}function V(t){return _&&_.prototype["readAs"+t]}function W(n,r,t,e){if(z.isBlob(n)&&V(t)){var a=new _;o(a,R,function t(e){var i=e.type;"progress"==i?H(n,r,e,e.target.result,{loaded:e.loaded,total:e.total}):"loadend"==i?(l(a,R,t),a=null):H(n,r,e,e.target.result)});try{e?a["readAs"+t](n,e):a["readAs"+t](n)}catch(t){H(n,r,"error",s,{error:t.toString()})}}else H(n,r,"error",s,{error:"filreader_not_support_"+t})}function G(t){return t&&(t.isFile||t.isDirectory)}function X(t){var e;return t.getAsEntry?e=t.getAsEntry():t.webkitGetAsEntry&&(e=t.webkitGetAsEntry()),e}function $(t){return A.test(t&&t.tagName)}function Y(t){return(t.originalEvent||t||"").dataTransfer||{}}z.addInfoReader(/^image/,function(t,e){var i;t.__dimensions||(i=t.__dimensions=z.defer(),z.readAsImage(t,function(t){var e=t.target;i.resolve("load"!=t.type&&"error",{width:e.width,height:e.height}),e.src=z.EMPTY_PNG})),t.__dimensions.then(e)}),z.event.dnd=function(t,r,n){var a,s;n||(n=r,r=z.F),_?(o(t,"dragenter dragleave dragover",r.ff=r.ff||function(t){for(var e=Y(t).types,i=e&&e.length,n=!1;i--;)if(~e[i].indexOf("File")){t[F](),s!==t.type&&("dragleave"!=(s=t.type)&&r.call(t[B],!0,t),n=!0);break}n&&(clearTimeout(a),a=setTimeout(function(){r.call(t[B],"dragleave"!=s,t)},50))}),o(t,"drop",n.ff=n.ff||function(i){i[F](),s=0,z.getDropFiles(i,function(t,e){n.call(i[B],t,e,i)}),r.call(i[B],!1,i)})):z.log("Drag'n'Drop -- not supported")},z.event.dnd.off=function(t,e,i){l(t,"dragenter dragleave dragover",e.ff),l(t,"drop",i.ff)},T&&!T.fn.dnd&&(T.fn.dnd=function(t,e){return this.each(function(){z.event.dnd(this,t,e)})},T.fn.offdnd=function(t,e){return this.each(function(){z.event.dnd.off(this,t,e)})}),r.FileAPI=q(z,r.FileAPI),z.log("FileAPI: "+z.version),z.log("protocol: "+r.location.protocol),z.log("doctype: ["+u.name+"] "+u.publicId+" "+u.systemId),j(n.getElementsByTagName("meta"),function(t){/x-ua-compatible/i.test(t.getAttribute("http-equiv"))&&z.log("meta.http-equiv: "+t.getAttribute("content"))});try{console.log,console.log.apply}catch(t){}z.flashUrl||(z.flashUrl=z.staticPath+"FileAPI.flash.swf"),z.flashImageUrl||(z.flashImageUrl=z.staticPath+"FileAPI.flash.image.swf"),z.flashWebcamUrl||(z.flashWebcamUrl=z.staticPath+"FileAPI.flash.camera.swf")}(window,void 0),function(g,i){"use strict";function v(){return i.createElement("canvas")}var y=Math.min,h=Math.round,t=!1,a={8:270,3:180,6:90,7:270,4:180,5:90};try{t=-1<v().toDataURL("image/png").indexOf("data:image/png")}catch(t){}function _(t){if(t instanceof _){var e=new _(t.file);return g.extend(e.matrix,t.matrix),e}if(!(this instanceof _))return new _(t);this.file=t,this.size=t.size||100,this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1,filter:0}}_.prototype={image:!0,constructor:_,set:function(t){return g.extend(this.matrix,t),this},crop:function(t,e,i,n){return void 0===i&&(i=t,n=e,t=e=0),this.set({sx:t,sy:e,sw:i,sh:n||i})},resize:function(t,e,i){return/min|max|height|width/.test(e)&&(i=e,e=t),this.set({dw:t,dh:e||t,resize:i})},preview:function(t,e){return this.resize(t,e||t,"preview")},rotate:function(t){return this.set({deg:t})},filter:function(t){return this.set({filter:t})},overlay:function(t){return this.set({overlay:t})},clone:function(){return new _(this)},_load:function(t,e){var i=this;/img|video/i.test(t.nodeName)?e.call(i,null,t):g.readAsImage(t,function(t){e.call(i,"load"!=t.type,t.result)})},_apply:function(t,e){var i,n=v(),r=this.getMatrix(t),l=n.getContext("2d"),a=t.videoWidth||t.width,s=t.videoHeight||t.height,o=r.deg,u=r.dw,h=r.dh,c=a,d=s,a=r.filter,p=t,s=r.overlay,f=g.queue(function(){t.src=g.EMPTY_PNG,e(!1,n)}),m=g.renderImageToCanvas;for(o-=360*Math.floor(o/360),t._type=this.file.type;r.multipass&&2<y(c/u,d/h);)c=c/2+.5|0,d=d/2+.5|0,(i=v()).width=c,i.height=d,p!==t?(m(i,p,0,0,p.width,p.height,0,0,c,d),p=i):(m(p=i,t,r.sx,r.sy,r.sw,r.sh,0,0,c,d),r.sx=r.sy=r.sw=r.sh=0);n.width=o%180?h:u,n.height=o%180?u:h,n.type=r.type,n.quality=r.quality,l.rotate(o*Math.PI/180),m(l.canvas,p,r.sx,r.sy,r.sw||p.width,r.sh||p.height,180==o||270==o?-u:0,90==o||180==o?-h:0,u,h),l.setTransform(1,0,0,1,0,0),u=n.width,h=n.height,s&&g.each([].concat(s),function(a){f.inc();function s(){var t=0|a.x,e=0|a.y,i=a.w||o.width,n=a.h||o.height,r=a.rel,t=1==r||4==r||7==r?(u-i+t)/2:2==r||5==r||8==r?u-(i+t):t,e=3==r||4==r||5==r?(h-n+e)/2:6<=r?h-(n+e):e;g.event.off(o,"error load abort",s);try{l.globalAlpha=a.opacity||1,l.drawImage(o,t,e,i,n)}catch(t){}f.next()}var o=new window.Image;g.event.on(o,"error load abort",s),o.src=a.src,o.complete&&s()}),a&&(f.inc(),_.applyFilter(n,a,f.next)),f.check()},getMatrix:function(t){var e,i,n=g.extend({},this.matrix),r=n.sw=n.sw||t.videoWidth||t.naturalWidth||t.width,a=n.sh=n.sh||t.videoHeight||t.naturalHeight||t.height,s=n.dw=n.dw||r,o=n.dh=n.dh||a,l=r/a,u=s/o,t=n.resize;return"preview"==t?s==r&&o==a||(l<=u?i=(e=r)/u:e=(i=a)*u,e==r&&i==a||(n.sx=~~((r-e)/2),n.sy=~~((a-i)/2),r=e,a=i)):"height"==t?s=o*l:"width"==t?o=s/l:t&&(o=s<r||o<a?"min"==t?(s=h(l<u?y(r,s):o*l),h(l<u?s/l:y(a,o))):(s=h(u<=l?y(r,s):o*l),h(u<=l?s/l:y(a,o))):(s=r,a)),n.sw=r,n.sh=a,n.dw=s,n.dh=o,n.multipass=g.multiPassResize,n},_trans:function(i){this._load(this.file,function(t,e){if(t)i(t);else try{this._apply(e,i)}catch(t){g.log("[err] FileAPI.Image.fn._apply:",t),i(t)}})},get:function(i){var n,r;return g.support.transform?"auto"==(r=(n=this).matrix).deg?g.getInfo(n.file,function(t,e){r.deg=a[e&&e.exif&&e.exif.Orientation]||0,n._trans(i)}):n._trans(i):i("not_support_transform"),this},toData:function(t){return this.get(t)}},_.exifOrientation=a,_.transform=function(l,e,u,i){function t(t,a){var s={},o=g.queue(function(t){i(t,s)});t?o.fail():g.each(e,function(t,i){var e,n,r;o.isFail()||(e=new _(a.nodeType?a:l),(n="function"==typeof t)?t(a,e):t.width?e[t.preview?"preview":"resize"](t.width,t.height,t.strategy):t.maxWidth&&(a.width>t.maxWidth||a.height>t.maxHeight)&&e.resize(t.maxWidth,t.maxHeight,"max"),t.crop&&(r=t.crop,e.crop(0|r.x,0|r.y,r.w||r.width,r.h||r.height)),void 0===t.rotate&&u&&(t.rotate="auto"),e.set({type:e.matrix.type||t.type||l.type||"image/png"}),n||e.set({deg:t.rotate,overlay:t.overlay,filter:t.filter,quality:t.quality||1}),o.inc(),e.toData(function(t,e){t?o.fail():(s[i]=e,o.next())}))})}l.width?t(!1,l):g.getInfo(l,t)},g.each(["TOP","CENTER","BOTTOM"],function(i,n){g.each(["LEFT","CENTER","RIGHT"],function(t,e){_[i+"_"+t]=3*n+e,_[t+"_"+i]=3*n+e})}),_.toCanvas=function(t){var e=i.createElement("canvas");return e.width=t.videoWidth||t.width,e.height=t.videoHeight||t.height,e.getContext("2d").drawImage(t,0,0),e},_.fromDataURL=function(t,e,i){t=g.newImage(t);g.extend(t,e),i(t)},_.applyFilter=function(t,e,i){"function"==typeof e?e(t,i):window.Caman&&window.Caman("IMG"==t.tagName?_.toCanvas(t):t,function(){"string"==typeof e?this[e]():g.each(e,function(t,e){this[e](t)},this),this.render(i)})},g.renderImageToCanvas=function(t,e,i,n,r,a,s,o,l,u){try{return t.getContext("2d").drawImage(e,i,n,r,a,s,o,l,u)}catch(t){throw g.log("renderImageToCanvas failed"),t}},g.support.canvas=g.support.transform=t,g.Image=_}(FileAPI,document),function(){"use strict";!function(y){"use strict";var _;window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)&&(_=y.renderImageToCanvas,y.detectSubsampling=function(t){var e;return 1048576<t.width*t.height&&((e=document.createElement("canvas")).width=e.height=1,(e=e.getContext("2d")).drawImage(t,1-t.width,0),0===e.getImageData(0,0,1,1).data[3])},y.detectVerticalSquash=function(t,e){var i,n,r,a,s=t.naturalHeight||t.height,o=document.createElement("canvas"),l=o.getContext("2d");for(e&&(s/=2),o.width=1,o.height=s,l.drawImage(t,0,0),i=l.getImageData(0,0,1,s).data,n=0,a=r=s;n<a;)0===i[4*(a-1)+3]?r=a:n=a,a=r+n>>1;return a/s||1},y.renderImageToCanvas=function(t,e,i,n,r,a,s,o,l,u){if("image/jpeg"===e._type){var h,c,d,p,f=t.getContext("2d"),m=document.createElement("canvas"),g=1024,v=m.getContext("2d");if(m.width=g,m.height=g,f.save(),(h=y.detectSubsampling(e))&&(i/=2,n/=2,r/=2,a/=2),c=y.detectVerticalSquash(e,h),h||1!==c){for(n*=c,l=Math.ceil(g*l/r),u=Math.ceil(g*u/a/c),p=o=0;p<a;){for(d=s=0;d<r;)v.clearRect(0,0,g,g),v.drawImage(e,i,n,r,a,-d,-p,r,a),f.drawImage(m,0,0,g,g,s,o,l,u),d+=g,s+=l;p+=g,o+=u}return f.restore(),t}}return _(t,e,i,n,r,a,s,o,l,u)})}(FileAPI)}(),function(l,t){"use strict";function e(){this.items=[]}var r=t.document,i=t.FormData,a=t.encodeURIComponent;function s(e,i,t){var n,r,a,s=e.blob,o=e.file;o?s.toDataURL?(r=(a={"image/jpeg":".jpe?g","image/png":".png"})[n=a[e.type]?e.type:"image/png"]||".png",a=s.quality||1,o.match(new RegExp(r+"$","i"))||(o+=r.replace("?","")),e.file=o,e.type=n,!t&&s.toBlob?s.toBlob(function(t){i(e,t)},n,a):i(e,l.toBinaryString(s.toDataURL(n,a)))):l.readAsBinaryString(s,function(t){"load"==t.type&&i(e,t.result)}):i(e,s)}e.prototype={append:function(t,e,i,n){this.items.push({name:t,blob:e&&e.blob||(null==e?"":e),file:e&&(i||e.name),type:e&&(n||e.type)})},each:function(t){for(var e=0,i=this.items.length;e<i;e++)t.call(this,this.items[e])},toData:function(t,e){e._chunked=l.support.chunked&&0<e.chunkSize&&1==l.filter(this.items,function(t){return t.file}).length,l.support.html5?l.formData&&!this.multipart&&i?e._chunked?(l.log("FileAPI.Form.toPlainData"),this.toPlainData(t)):(l.log("FileAPI.Form.toFormData"),this.toFormData(t)):(l.log("FileAPI.Form.toMultipartData"),this.toMultipartData(t)):(l.log("FileAPI.Form.toHtmlData"),this.toHtmlData(t))},_to:function(e,i,n,r){var a=l.queue(function(){i(e)});this.each(function(t){try{n(t,e,a,r)}catch(t){l.log("FileAPI.Form._to: "+t.message),i(t)}}),a.check()},toHtmlData:function(t){this._to(r.createDocumentFragment(),t,function(t,e){var i,n=t.blob;t.file?(l.reset(n,!0),n.name=t.name,n.disabled=!1,e.appendChild(n)):((i=r.createElement("input")).name=t.name,i.type="hidden",i.value=n,e.appendChild(i))})},toPlainData:function(t){this._to({},t,function(t,i,n){t.file&&(i.type=t.file),t.blob.toBlob?(n.inc(),s(t,function(t,e){i.name=t.name,i.file=e,i.size=e.length,i.type=t.type,n.next()})):t.file?(i.name=t.blob.name,i.file=t.blob,i.size=t.blob.size,i.type=t.type):(i.params||(i.params=[]),i.params.push(a(t.name)+"="+a(t.blob))),i.start=-1,i.end=i.file&&i.file.FileAPIReadPosition||-1,i.retry=0})},toFormData:function(t){this._to(new i,t,function(t,i,n){t.blob&&t.blob.toBlob?(n.inc(),s(t,function(t,e){i.append(t.name,e,t.file),n.next()})):t.file?i.append(t.name,t.blob,t.file):i.append(t.name,t.blob),t.file&&i.append("_"+t.name,t.file)})},toMultipartData:function(t){this._to([],t,function(t,i,n,r){n.inc(),s(t,function(t,e){i.push("--_"+r+'\r\nContent-Disposition: form-data; name="'+t.name+'"'+(t.file?'; filename="'+a(t.file)+'"':"")+(t.file?"\r\nContent-Type: "+(t.type||"application/octet-stream"):"")+"\r\n\r\n"+(t.file?e:a(e))+"\r\n"),n.next()},!0)},l.expando)}},l.Form=e}(FileAPI,window),function(d,p){"use strict";function r(){}function t(t){this.uid=p.uid(),this.xhr={abort:r,getResponseHeader:r,getAllResponseHeaders:r},this.options=t}var f=d.document,m={"":1,XML:1,Text:1,Body:1};t.prototype={status:0,statusText:"",constructor:t,getResponseHeader:function(t){return this.xhr.getResponseHeader(t)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(t,e){var i=this,n=i.options;i.end=i.abort=r,i.status=t,e&&(i.statusText=e),p.log("xhr.end:",t,e),n.complete(200!=t&&201!=t&&(i.statusText||"unknown"),i),i.xhr&&i.xhr.node&&setTimeout(function(){var t=i.xhr.node;try{t.parentNode.removeChild(t)}catch(t){}try{delete d[i.uid]}catch(t){}d[i.uid]=i.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(t){var e=this,i=this.options;t.toData(function(t){t instanceof Error?e.end(0,t.message):(i.upload(i,e),e._send.call(e,i,t))},i)},_send:function(n,r){var t,a,s=this,o=s.uid,l=s.uid+"Load",i=n.url;if(p.log("XHR._send:",r),n.cache||(i+=(~i.indexOf("?")?"&":"?")+p.uid()),r.nodeName){var e=n.jsonp,i=i.replace(/([a-z]+)=(\?)/i,"$1="+o);n.upload(n,s);var u=function(t){if(~i.indexOf(t.origin))try{var e=p.parseJSON(t.data);e.id==o&&h(e.status,e.statusText,e.response)}catch(t){h(0,t.message)}},h=d[o]=function(t,e,i){s.readyState=4,s.responseText=i,s.end(t,e),p.event.off(d,"message",u),d[o]=a=c=d[l]=null};s.xhr.abort=function(){try{c.stop?c.stop():c.contentWindow.stop?c.contentWindow.stop():c.contentWindow.document.execCommand("Stop")}catch(t){}h(0,"abort")},p.event.on(d,"message",u),d[l]=function(){try{var t=c.contentWindow,e=t.document,i=t.result||p.parseJSON(e.body.innerHTML);h(i.status,i.statusText,i.response)}catch(t){p.log("[transport.onload]",t)}},(a=f.createElement("div")).innerHTML='<form target="'+o+'" action="'+i+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+o+'" src="javascript:false;" onload="window.'+l+" && "+l+'();"></iframe>'+(e&&n.url.indexOf("=?")<0?'<input value="'+o+'" name="'+e+'" type="hidden"/>':"")+"</form>";var e=a.getElementsByTagName("form")[0],c=a.getElementsByTagName("iframe")[0];e.appendChild(r),p.log(e.parentNode.innerHTML),f.body.appendChild(a),s.xhr.node=a,s.readyState=2;try{e.submit()}catch(t){p.log("iframe.error: "+t)}}else i=i.replace(/([a-z]+)=(\?)&?/i,""),this.xhr&&this.xhr.aborted?p.log("Error: already aborted"):(a=s.xhr=p.getXHR(),r.params&&(i+=(i.indexOf("?")<0?"?":"&")+r.params.join("&")),a.open(n.uploadMethod||"POST",i,!0),"boolean"==typeof n.uploadCredentials?a.withCredentials=n.uploadCredentials?"true":null:p.withCredentials&&(a.withCredentials="true"),n.headers&&n.headers["X-Requested-With"]||a.setRequestHeader("X-Requested-With","XMLHttpRequest"),p.each(n.headers,function(t,e){a.setRequestHeader(e,t)}),n._chunked?(a.upload&&a.upload.addEventListener("progress",p.throttle(function(t){r.retry||n.progress({type:t.type,total:r.size,loaded:r.start+t.loaded,totalSize:r.size},s,n)},100),!1),a.onreadystatechange=function(){var t,e=parseInt(a.getResponseHeader("X-Last-Known-Byte"),10);if(s.status=a.status,s.statusText=a.statusText,s.readyState=a.readyState,4==a.readyState){for(var i in m)s["response"+i]=a["response"+i];a.onreadystatechange=null,!a.status||0<a.status-201?(p.log("Error: "+a.status),(!a.status&&!a.aborted||500==a.status||416==a.status)&&++r.retry<=n.chunkUploadRetry?(t=a.status?0:p.chunkNetworkDownRetryTimeout,n.pause(r.file,n),p.log("X-Last-Known-Byte: "+e),e?r.end=e:(r.end=r.start-1,416==a.status&&(r.end=r.end-n.chunkSize)),setTimeout(function(){s._send(n,r)},t)):s.end(a.status)):(r.retry=0,r.end==r.size-1?s.end(a.status):(p.log("X-Last-Known-Byte: "+e),e&&(r.end=e),r.file.FileAPIReadPosition=r.end,setTimeout(function(){s._send(n,r)},0))),a=null}},r.start=r.end+1,r.end=Math.max(Math.min(r.start+n.chunkSize,r.size)-1,r.start),t=((t=r.file).slice||t.mozSlice||t.webkitSlice).call(t,r.start,r.end+1),r.size&&!t.size?setTimeout(function(){s.end(-1)}):(a.setRequestHeader("Content-Range","bytes "+r.start+"-"+r.end+"/"+r.size),a.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(r.name)),a.setRequestHeader("Content-Type",r.type||"application/octet-stream"),a.send(t))):(a.upload&&a.upload.addEventListener("progress",p.throttle(function(t){n.progress(t,s,n)},100),!1),a.onreadystatechange=function(){if(s.status=a.status,s.statusText=a.statusText,s.readyState=a.readyState,4==a.readyState){for(var t in m)s["response"+t]=a["response"+t];var e;a.onreadystatechange=null,!a.status||201<a.status?(p.log("Error: "+a.status),(!a.status&&!a.aborted||500==a.status)&&(n.retry||0)<n.uploadRetry?(n.retry=(n.retry||0)+1,e=p.networkDownRetryTimeout,n.pause(n.file,n),setTimeout(function(){s._send(n,r)},e)):s.end(a.status)):s.end(a.status),a=null}},p.isArray(r)?(a.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+p.expando),t=r.join("")+"--_"+p.expando+"--",a.sendAsBinary?a.sendAsBinary(t):(t=Array.prototype.map.call(t,function(t){return 255&t.charCodeAt(0)}),a.send(new Uint8Array(t).buffer))):a.send(r)))}},p.XHR=t}(window,FileAPI),function(a,s){"use strict";var o=a.URL||a.webkitURL,l=a.document,u=a.navigator,h=u.getUserMedia||u.webkitGetUserMedia||u.mozGetUserMedia||u.msGetUserMedia,c=!!h;s.support.media=c;function d(t){this.video=t}var e,t,i,n;d.prototype={isActive:function(){return!!this._active},start:function(e){function t(t){r._active=!t,clearTimeout(n),clearTimeout(i),e&&e(t,r)}var i,n,r=this,a=r.video;h.call(u,{video:!0},function(e){r.stream=e;try{a.src=o.createObjectURL(e)}catch(t){a.srcObject=e}i=setInterval(function(){!function(t){var e,i=l.createElement("canvas"),n=!1;try{(e=i.getContext("2d")).drawImage(t,0,0,1,1),n=255!=e.getImageData(0,0,1,1).data[4]}catch(t){s.log("[FileAPI.Camera] detectVideoSignal:",t)}return n}(a)||t(null)},1e3),n=setTimeout(function(){t("timeout")},5e3),a.play()},t)},stop:function(){try{this._active=!1,this.video.pause();try{this.stream.stop()}catch(t){s.each(this.stream.getTracks(),function(t){t.stop()})}this.stream=null}catch(t){s.log("[FileAPI.Camera] stop:",t)}},shot:function(){return new r(this.video)}},d.get=function(t){return new d(t.firstChild)},d.publish=function(e,i,n){"function"==typeof i&&(n=i,i={}),i=s.extend({},{width:"100%",height:"100%",start:!0},i);function t(t){t?n(t):(t=d.get(e),i.start?t.start(n):n(null,t))}var r;(e=e.jquery?e[0]:e).style.width=p(i.width),e.style.height=p(i.height),s.html5&&c&&!s.insecureChrome?((r=l.createElement("video")).style.width=p(i.width),r.style.height=p(i.height),a.jQuery?jQuery(e).empty():e.innerHTML="",e.appendChild(r),t()):d.fallback(e,i,t)},d.fallback=function(t,e,i){i("not_support_camera")},d.checkAlreadyCaptured=(e=u.mediaDevices,t=a.MediaStreamTrack,i=u.enumerateDevices,n=e&&e.enumerateDevices?function(t){e.enumerateDevices().then(t)}:t&&t.getSources?t.getSources.bind(t):i?i.bind(u):function(t){t([])},function(e){n(function(t){t=t.some(function(t){return("videoinput"===t.kind||"video"===t.kind)&&t.label});e(t)})});var r=function(t){var e=t.nodeName?s.Image.toCanvas(t):t,t=s.Image(e);return t.type="image/png",t.width=e.width,t.height=e.height,t.size=e.width*e.height*4,t};function p(t){return 0<=t?t+"px":t}d.Shot=r,s.Camera=d}(window,FileAPI),function(r,a,l){"use strict";var u,i,s,n,h,o=r.document,c=r.location,d=r.navigator,p=l.each;function f(i){return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(i.width||"100%")+'" height="'+(i.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(i.width||"100%")+'" height="'+(i.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/gi,function(t,e){return i[e]})}function m(t,e){var i,n;if(t&&t.style)for(i in e){"number"==typeof(n=e[i])&&(n+="px");try{t.style[i]=n}catch(t){}}}function t(n,t){p(t,function(t,e){var i=n[e];n[e]=function(){return this.parent=i,t.apply(this,arguments)}})}function g(t){return t&&!t.flashId}function v(t){var e=t.wid=l.uid();return h._fn[e]=t,"FileAPI.Flash._fn."+e}function y(t){try{h._fn[t.wid]=null,delete h._fn[t.wid]}catch(t){}}function _(t,e){var i;return n.test(t)||("//"!=(t=/^\.\//.test(t)||"/"!=t.charAt(0)?((i=(i=c.pathname).substr(0,i.lastIndexOf("/")))+"/"+t).replace("/./","/"):t).substr(0,2)&&(t="//"+c.host+t),n.test(t)||(t=c.protocol+t)),e&&(t+=(/\?/.test(t)?"&":"?")+e),t}function b(t,e,i){var n,r=l.uid(),a=o.createElement("div"),s=10;for(n in t)a.setAttribute(n,t[n]),a[n]=t[n];m(a,t),t.width="100%",t.height="100%",a.innerHTML=f(l.extend({id:r,src:_(l.flashImageUrl,"r="+l.uid()),wmode:"opaque",flashvars:"scale="+t.scale+"&callback="+v(function t(){return y(t),0<--s&&function(){try{h.get(r).setImage(e)}catch(t){l.log('[err] FlashAPI.Preview.setImage -- can not set "base64":',t)}}(),!0})},t)),i(!1,a)}l.support.flash=function(){var t=d.mimeTypes,e=!1;if(d.plugins&&"object"==typeof d.plugins["Shockwave Flash"])e=d.plugins["Shockwave Flash"].description&&!(t&&t["application/x-shockwave-flash"]&&!t["application/x-shockwave-flash"].enabledPlugin);else try{e=!(!r.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(t){l.log("Flash -- does not supported.")}return e&&/^file:/i.test(c)&&l.log("[warn] Flash does not work on `file:` protocol."),e}(),l.support.flash&&(!l.html5||!l.support.html5||l.cors&&!l.support.cors||l.media&&!l.support.media||l.insecureChrome)&&(u=l.uid(),i=0,s={},n=/^https?:/i,h={_fn:{},init:function(){var t=o.body&&o.body.firstChild;if(t)do{if(1==t.nodeType){l.log("FlashAPI.state: awaiting");var e=o.createElement("div");return e.id="_"+u,m(e,{top:1,right:1,width:5,height:5,position:"absolute",zIndex:"2147483647"}),t.parentNode.insertBefore(e,t),void h.publish(e,u)}}while(t=t.nextSibling);i<10&&setTimeout(h.init,50*++i)},publish:function(t,e,i){i=i||{},t.innerHTML=f({id:e,src:_(l.flashUrl,"r="+l.version),wmode:i.camera?"":"transparent",flashvars:"callback="+(i.onEvent||"FileAPI.Flash.onEvent")+"&flashId="+e+"&storeKey="+d.userAgent.match(/\d/gi).join("")+"_"+l.version+(h.isReady||(l.pingUrl?"&ping="+l.pingUrl:""))+"&timeout="+l.flashAbortTimeout+(i.camera?"&useCamera="+_(l.flashWebcamUrl):"")+"&debug="+(l.debug?"1":"")})},ready:function(){l.log("FlashAPI.state: ready"),h.ready=l.F,h.isReady=!0,h.patch(),h.patchCamera&&h.patchCamera(),l.event.on(o,"mouseover",h.mouseover),l.event.on(o,"click",function(t){h.mouseover(t)&&(t.preventDefault?t.preventDefault():t.returnValue=!0)})},getEl:function(){return o.getElementById("_"+u)},getWrapper:function(t){do{if(/js-fileapi-wrapper/.test(t.className))return t}while((t=t.parentNode)&&t!==o.body)},mouseover:function(t){var e=l.event.fix(t).target;if(/input/i.test(e.nodeName)&&"file"==e.type&&!e.disabled){var i=e.getAttribute(u),t=h.getWrapper(e);if(l.multiFlash){if("i"==i||"r"==i)return!1;if("p"!=i){e.setAttribute(u,"i");var n=o.createElement("div");if(!t)return void l.log("[err] FlashAPI.mouseover: js-fileapi-wrapper not found");m(n,{top:0,left:0,width:e.offsetWidth,height:e.offsetHeight,zIndex:"2147483647",position:"absolute"}),t.appendChild(n),h.publish(n,l.uid()),e.setAttribute(u,"p")}return!0}t&&(n=(i=t).getBoundingClientRect(),t=o.body,i=(i&&i.ownerDocument).documentElement,n={top:n.top+(r.pageYOffset||i.scrollTop)-(i.clientTop||t.clientTop||0),left:n.left+(r.pageXOffset||i.scrollLeft)-(i.clientLeft||t.clientLeft||0),width:n.right-n.left,height:n.bottom-n.top},m(h.getEl(),n),h.curInp=e)}else/object|embed/i.test(e.nodeName)||m(h.getEl(),{top:1,left:1,width:5,height:5})},onEvent:function(t){var e=t.type;if("ready"==e){try{h.getInput(t.flashId).setAttribute(u,"r")}catch(t){}return h.ready(),setTimeout(function(){h.mouseenter(t)},50),!0}"ping"===e?l.log("(flash -> js).ping:",[t.status,t.savedStatus],t.error):"log"===e?l.log("(flash -> js).log:",t.target):e in h&&setTimeout(function(){l.log("FlashAPI.event."+t.type+":",t),h[e](t)},1)},mouseenter:function(t){var i,e,n=h.getInput(t.flashId);n&&(h.cmd(t,"multiple",null!=n.getAttribute("multiple")),i=[],e={},p((n.getAttribute("accept")||"").split(/,\s*/),function(t){l.accept[t]&&p(l.accept[t].split(" "),function(t){e[t]=1})}),p(e,function(t,e){i.push(e)}),h.cmd(t,"accept",i.length?i.join(",")+","+i.join(",").toUpperCase():"*"))},get:function(t){return o[t]||r[t]||o.embeds[t]},getInput:function(e){if(!l.multiFlash)return h.curInp;try{var t=h.getWrapper(h.get(e));if(t)return t.getElementsByTagName("input")[0]}catch(t){l.log('[err] Can not find "input" by flashId:',e,t)}},select:function(t){var e,i=h.getInput(t.flashId),n=l.uid(i),t=t.target.files;p(t,function(t){l.checkFileObj(t)}),s[n]=t,o.createEvent?((e=o.createEvent("Event")).files=t,e.initEvent("change",!0,!0),i.dispatchEvent(e)):a?a(i).trigger({type:"change",files:t}):((e=o.createEventObject()).files=t,i.fireEvent("onchange",e))},cmd:function(e,i,n,r){try{return l.log("(js -> flash)."+i+":",n),h.get(e.flashId||e).cmd(i,n)}catch(t){l.log("(js -> flash).onError:",t.toString()),r||setTimeout(function(){h.cmd(e,i,n,!0)},50)}},patch:function(){l.flashEngine=!0,t(l,{getFiles:function(t,e,i){if(i)return l.filterFiles(l.getFiles(t),e,i),null;t=l.isArray(t)?t:s[l.uid(t.target||t.srcElement||t)];return t?(e&&(e=l.getFilesFilter(e),t=l.filter(t,function(t){return e.test(t.name)})),t):this.parent.apply(this,arguments)},getInfo:function(n,t){var r;g(n)?this.parent.apply(this,arguments):n.isShot?t(null,n.info={width:n.width,height:n.height}):(n.__info||(r=n.__info=l.defer(),h.cmd(n,"getFileInfo",{id:n.id,callback:v(function t(e,i){y(t),r.resolve(e,n.info=i)})})),n.__info.then(t))}}),l.support.transform=!0,l.Image&&t(l.Image.prototype,{get:function(t,e){return this.set({scaleMode:e||"noScale"}),this.parent(t)},_load:function(e,i){var n;l.log("FlashAPI.Image._load:",e),g(e)?this.parent.apply(this,arguments):(n=this,l.getInfo(e,function(t){i.call(n,t,e)}))},_apply:function(n,r){var a,s;l.log("FlashAPI.Image._apply:",n),g(n)?this.parent.apply(this,arguments):(a=this.getMatrix(n.info),s=r,h.cmd(n,"imageTransform",{id:n.id,matrix:a,callback:v(function t(e,i){l.log("FlashAPI.Image._apply.callback:",e),y(t),e?s(e):l.support.html5||l.support.dataURI&&!(3e4<i.length)?(a.filter&&(s=function(t,e){t?r(t):l.Image.applyFilter(e,a.filter,function(){r(t,this.canvas)})}),l.newImage("data:"+n.type+";base64,"+i,s)):b({width:a.deg%180?a.dh:a.dw,height:a.deg%180?a.dw:a.dh,scale:a.scaleMode},i,s)})}))},toData:function(t){var e=this.file,i=e.info,n=this.getMatrix(i);l.log("FlashAPI.Image.toData"),g(e)?this.parent.apply(this,arguments):("auto"==n.deg&&(n.deg=l.Image.exifOrientation[i&&i.exif&&i.exif.Orientation]||0),t.call(this,!e.info,{id:e.id,flashId:e.flashId,name:e.name,type:e.type,matrix:n}))}}),l.Image&&t(l.Image,{fromDataURL:function(t,e,i){!l.support.dataURI||3e4<t.length?b(l.extend({scale:"exactFit"},e),t.replace(/^data:[^,]+,/,""),function(t,e){i(e)}):this.parent(t,e,i)}}),t(l.Form.prototype,{toData:function(t){for(var e=this.items,i=e.length;i--;)if(e[i].file&&g(e[i].blob))return this.parent.apply(this,arguments);l.log("FlashAPI.Form.toData"),t(e)}}),t(l.XHR.prototype,{_send:function(r,t){if(t.nodeName||t.append&&l.support.html5||l.isArray(t)&&"string"==typeof t[0])return this.parent.apply(this,arguments);var i,n,a={},s={},o=this;if(p(t,function(t){var e;t.file?(s[t.name]=t={id:(e=t.blob).id,name:e.name,matrix:e.matrix,flashId:e.flashId},n=t.id,i=t.flashId):a[t.name]=t.blob}),!(i=!n?u:i))return l.log("[err] FlashAPI._send: flashId -- undefined"),this.parent.apply(this,arguments);l.log("FlashAPI.XHR._send: "+i+" -> "+n),o.xhr={headers:{},abort:function(){h.cmd(i,"abort",{id:n})},getResponseHeader:function(t){return this.headers[t]},getAllResponseHeaders:function(){return this.headers}};var e=l.queue(function(){h.cmd(i,"upload",{url:_(r.url.replace(/([a-z]+)=(\?)&?/i,"")),data:a,files:n?s:null,headers:r.headers||{},callback:v(function t(e){var i=e.type,n=e.result;l.log("FlashAPI.upload."+i),"progress"==i?(e.loaded=Math.min(e.loaded,e.total),e.lengthComputable=!0,r.progress(e)):"complete"==i?(y(t),"string"==typeof n&&(o.responseText=n.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),o.end(e.status||200)):"abort"!=i&&"error"!=i||(o.end(e.status||0,e.message),y(t))})})});p(s,function(t){e.inc(),l.getInfo(t,e.next)}),e.check()}})}},l.Flash=h,l.newImage("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",function(t,e){l.support.dataURI=!(1!=e.width||1!=e.height),h.init()}))}(window,window.jQuery,FileAPI),function(r){"use strict";var a,t=r.each,e=[];function s(t){var e=t.wid=r.uid();return r.Flash._fn[e]=t,"FileAPI.Flash._fn."+e}function o(t){try{r.Flash._fn[t.wid]=null,delete r.Flash._fn[t.wid]}catch(t){}}!r.support.flash||!r.media||r.support.media&&r.html5&&!r.insecureChrome||(a=r.Flash,r.extend(r.Flash,{patchCamera:function(){r.Camera.fallback=function(t,e,i){var n=r.uid();r.log("FlashAPI.Camera.publish: "+n),a.publish(t,n,r.extend(e,{camera:!0,onEvent:s(function t(e){"camera"===e.type&&(o(t),e.error?(r.log("FlashAPI.Camera.publish.error: "+e.error),i(e.error)):(r.log("FlashAPI.Camera.publish.success: "+n),i(null)))})}))},t(e,function(t){r.Camera.fallback.apply(r.Camera,t)}),e=[],r.extend(r.Camera.prototype,{_id:function(){return this.video.id},start:function(i){var n=this;a.cmd(this._id(),"camera.on",{callback:s(function t(e){o(t),e.error?(r.log("FlashAPI.camera.on.error: "+e.error),i(e.error,n)):(r.log("FlashAPI.camera.on.success: "+n._id()),n._active=!0,i(null,n))})})},stop:function(){this._active=!1,a.cmd(this._id(),"camera.off")},shot:function(){r.log("FlashAPI.Camera.shot:",this._id());var t=r.Flash.cmd(this._id(),"shot",{});return t.type="image/png",t.flashId=this._id(),t.isShot=!0,new r.Camera.Shot(t)}})}}),r.Camera.fallback=function(){e.push(arguments)})}((window,window.jQuery,FileAPI)),"function"==typeof define&&define.amd&&define("FileAPI",[],function(){return FileAPI}),function(t){function e(t){var e=function(){for(var t,e=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],i=0,n=e.length,r={};i<n;i++){var a=e[i];if(a&&a[1]in document)for(i=0,t=a.length;i<t;i++)r[e[0][i]]=document[a[i]]}return r}();return!(void 0===e.fullscreenElement||!e.fullscreenElement||e.fullscreenElement===t)}var i;void 0!==t.videojs&&(i=videojs.getComponent("FullscreenToggle"),t.FullwindowToggle=videojs.extend(i,{constructor:function(){i.apply(this,arguments)},handleClick:function(){var t;e(this.player_.el_)||window.self!==window.top?(t=this.player_.el_,void 0!==this.player_.isFullWindow&&this.player_.isFullWindow?(t.classList.remove("vjs-fullscreen"),this.player_.exitFullWindow()):(t.classList.add("vjs-fullscreen"),this.player_.enterFullWindow())):this.player_.isFullscreen()?this.player_.exitFullscreen():this.player_.requestFullscreen()}}),videojs.registerComponent("FullwindowToggle",FullwindowToggle))}(window);var interaction=new Class({element:!1,options:{},id:null,initialize:function(t){this.element=$(t),this.element&&this.element.createTooltips&&this.element.createTooltips(),this.input=t,this.warningElement=!1,this.element.addEventListener("focusout",this.validateInput.bind(this)),this.element.addEventListener("focusin",this.removeWarning.bind(this))},setFormData:function(t){this._setFormData(t)&&this.onUpdateResponse(t)},_setFormData:function(t,e){var i,n=!1;if(e=e||"",_.isObject(t)&&void 0!==t[0]&&(t=_.toArray(t)),Array.isArray(t)&&""!==e)for(var r=0,a=t.length;r<a;r++)n=this._setFormData(t[r],e);else if("object"==typeof t)for(var s in t)!t.hasOwnProperty(s)||0<(o=this.element.querySelectorAll('*[name^="'+(i=""===e?s:e+"["+s+"]")+'"]')).length&&(n=this._setFormData(t[s],i));else if(""!==e)for(var o,r=0,a=(o=this.element.querySelectorAll('*[name^="'+e+'"]')).length;r<a;r++){var l=o[r];if("INPUT"===l.tagName){var u=l.getAttribute("type");switch(u){case"radio":case"checkbox":l.getAttribute("value")===""+t?l.setAttribute("checked","true"):"checkbox"===u&&l.removeAttribute("checked"),n=!0;break;default:l.setAttribute("value",t),n=!0}}else"TEXTAREA"===l.tagName&&(l.value=t,void 0!==l.fireEvent&&l.fireEvent("update"),n=!0)}return n},setResponse:function(t){var e,i=this.element.getAttribute("data-assessmentitem-identifier"),n=this.element.getAttribute("data-response-identifier");i&&n&&((e={})[i]={},e[i][n]=t,this.setFormData(e))},onUpdateResponse:function(){},getAnswerStatus:function(){var t=SerializeForm(this.element);return _.size(t)?"answered":"unanswered"},validate:function(t=0){return!0},warningText:function(){return this.input.get("data-warning")},validateInput:function(){var t=this.validate(!1);return"object"==typeof t&&"function"==typeof t.then?Promise.all(t).then(function(t){return t.every(t=>t)?this.removeWarning():this.showWarning()}):t?this.removeWarning():this.showWarning()},showWarning:function(){!this.warningElement&&this.warningText()&&(this.warningElement=new Element("span.warningmessage",{text:this.warningText()}).inject(this.input,"after"))},removeWarning:function(){if(null!==this.input&&(this.input.removeClass("warning"),this.warningElement))try{this.warningElement.destroy(),this.warningElement=!1}catch(t){}}}),$QTI={loadQTI:function(t,s){if(s=s||{},void 0!==(t=void 0===t?this:t).$qti)return t.$qti;var n={interactions:{},positionObjectStages:[],cases:[],media:[],setFormData:function(t,e){if(e=e||!1)this.interactions[e]&&this.interactions[e].setFormData(t,e);else for(e in this.interactions)this.interactions.hasOwnProperty(e)&&this.interactions[e].setFormData(t,e)},setResponse:function(t,e){if(e=e||!1)this.interactions[e]&&this.interactions[e].setResponse(t,e);else for(e in this.interactions)this.interactions.hasOwnProperty(e)&&void 0!==t[e]&&this.interactions[e].setResponse(t[e],e)},getAnswerStatus:function(){var t,e=void 0===s.empty_interaction_count?0:s.empty_interaction_count,i=0,n=0,r=0;for(t in this.interactions){var a=this.interactions[t].getAnswerStatus();"exclude"!==a&&("partly"===a?n++:"answered"===a?r++:"unanswered"===a&&i++)}return 0<n||0<r&&e<i?"partly":e<i||0==r?"unanswered":"answered"}};return t.getElements(".qti-selectPointInteraction").each(function(t){var e;t.getParent(".qti-display-screen")&&(e=t.getAttribute("data-response-identifier")||"RESPONSE",n.interactions[e]=new selectPointInteraction(t,s[e]||{}))}),t.getElements(".qti-choiceInteraction").each(function(t){var e=t.getAttribute("data-response-identifier")||"RESPONSE";n.interactions[e]=new(0===t.getElements(".qti-dropdown-select-multiselect").length?choiceInteraction:dropdownChoiceInteraction)(t,s[e]||{})}),t.getElements(".qti-inlineChoiceInteraction").each(function(t){var e=t.getAttribute("data-response-identifier")||"RESPONSE";n.interactions[e]=new inlineChoiceInteraction(t,s[e]||{})}),t.getElements(".qti-matchInteraction").each(function(t){var e=t.getAttribute("data-response-identifier")||"RESPONSE";n.interactions[e]=new matchInteraction(t,s[e]||{})}),t.getElements(".qti-orderInteraction").each(function(t){var e=t.getAttribute("data-response-identifier")||"RESPONSE";n.interactions[e]=new orderInteraction(t,s[e]||{})}),t.getElements(".qti-graphicAssociateInteraction").each(function(t){var e=t.getAttribute("data-response-identifier")||"RESPONSE";n.interactions[e]=new graphicAssociateInteraction(t,s[e]||{})}),t.getElements(".qti-drawingInteraction").each(function(t){var e=t.getAttribute("data-response-identifier")||"RESPONSE";n.interactions[e]=new drawingInteraction(t,s[e]||{})}),t.getElements(".qti-image-container").each(function(t){n.media.push(new media(t))}),t.getElements(".qti-mediaInteraction").each(function(t){var e=t.getAttribute("data-response-identifier")||"RESPONSE";n.interactions[e]=new mediaInteraction(t,s[e]||{})}),t.getElements(".qti-positionObjectStage").each(function(t){var i=new positionObjectStage(t);n.positionObjectStages.push(i),Object.each(i.interactions,function(t,e){n.interactions[e]=i},this)}),t.getElements(".qti-uploadInteraction").each(function(t){var e=t.getAttribute("data-response-identifier")||"RESPONSE";n.interactions[e]=new uploadInteraction(t,s[e]||{})}),t.getElements(".qti-textEntryInteraction").each(function(t){var e=t.getAttribute("data-response-identifier")||"RESPONSE";n.interactions[e]=new textEntryInteraction(t)}),t.getElements(".qti-extendedTextInteraction").each(function(t){var e=t.getAttribute("data-response-identifier")||"RESPONSE";n.interactions[e]=new extendedTextInteraction(t)}),t.getElements(".qti-worksheetInteraction").each(function(t){var e=t.getAttribute("data-response-identifier")||"RESPONSE";n.interactions[e]=new worksheetInteraction(t)}),t.getElements(".qti-algebrakitInteraction").each(function(t){var e=t.getAttribute("data-response-identifier")||"RESPONSE";n.interactions[e]=new algebrakitInteraction(t)}),t.getElements(".qti-endAttemptInteraction").each(function(t){var e=t.getAttribute("data-response-identifier")||"RESPONSE";n.interactions[e]=new endAttemptInteraction(t)}),t.getElements(".qti-display-screen textarea, .qti-display-screen input").each(function(t){t.set("spellcheck",!1),t.set("autocomplete","off")}),t.getElements(".qti-code[data-lang]").each(function(t){var e=t.get("data-lang");!CodeMirror||(e=CodeMirror.findModeByMIME(e))&&(CodeMirror.modeURL=t.get("data-codemirror-url")+"/mode/%N/%N.js",CodeMirror.requireMode(e.mode,function(){CodeMirror.colorize([t])}))}),t.getElements("img.qti-image").each(function(t){var e,i=t.getParent();i&&!i.hasClass("qti-interaction")&&(e=t.getParent(".qtistyle-casus-text"),t.setStyle("max-width","100%"),t.setStyle("height","auto"),e&&(t.set("width",null),t.set("height",null)),i.hasClass("qti-image-container")&&(i.setStyle("max-width","100%"),i.setStyle("height","auto")))}),t.getElements("audio, video").each(function(t){if("undefined"!=typeof videojs)try{var e=videojs.getPlayer(t.getAttribute("id"));(e||videojs(t.getAttribute("id"))).ready(function(){this.isAudio()||(this.getChild("controlBar").removeChild("fullscreenToggle"),this.getChild("controlBar").addChild("fullwindowToggle",{}))})}catch(t){}}),t.getElements("a.newwindow").each(function(t){null!==t.get("href").match(/^mailto:/i)||t.hasClass("qtistyle-filedownload")&&".pdf"===t.get("href").substr(-4)||t.addEvent("click",function(t){window.open(this.href,"_blank","noopener"),t.preventDefault()})}),t.$qti=n},fireChangeEvent:function(t){var e;try{e=new Event("change",{bubbles:!0,cancelable:!0})}catch(t){(e=document.createEvent("HTMLEvents")).initEvent("change",!0,!0)}t.dispatchEvent(e)}};!function(){function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),i}"function"!=typeof window.CustomEvent&&(t.prototype=window.Event.prototype,window.CustomEvent=t)}(),Element.implement({loadQTI:$QTI.loadQTI}),$(window).addEvent("domready",function(){$QTI.loadQTI($$("body").pick())});var choiceInteraction=new Class({Extends:interaction,initialize:function(t,e){var i,n,r,a;this.parent(t),e.displayorder&&(i=this.element.getElement(".qti-simpleChoice-list"),n=i.getElements(".qti-simpleChoice-block"),r=[],a=[],e.displayorder.each(function(t,e){r[t]=n[e];t=n[e].getElement("input");a[e]=!!t&&t.getAttribute("title")}),r.each(function(t,e){i.appendChild(t),!1!==a[e]&&t.getElement("input").setAttribute("title",a[e])})),this.element.getElements(".qti-simpleChoice-list input").each(function(t){this.storeID(t),t.addEvent("click",function(t){var e=this.getParent(".qti-choiceInteraction"),i=e.get("data-maxchoices");if(1<i&&e.getElements("input:checked").length>i)return t.stopPropagation(),t.stop(),void t.preventDefault();this.get("checked")&&"radio"===this.get("type").toLowerCase()&&(e.retrieve("sel")===this.get("id")?(this.set("checked",null),$QTI.fireChangeEvent(this),e.eliminate("sel")):e.store("sel",this.get("id")))}),t.addEvent("change",this.onSelectInput)},this)},storeID:function(t){"radio"==t.get("type").toLowerCase()&&t.get("checked")&&t.getParent(".qti-choiceInteraction").store("sel",t.get("id"))},onSelectInput:function(t){var e=this.getParent(".qti-choiceInteraction"),i=e.get("data-maxchoices");if(1<i&&e.getElements("input:checked").length>i)return t.stopPropagation(),t.stop(),void t.preventDefault();e.getElements(".qti-simpleChoice-block").each(function(t){t.getElement("input").get("checked")?t.addClass("qti-candidateResponse"):t.removeClass("qti-candidateResponse")})},_setFormData:function(t,e){if(e=e||"",_.isObject(t)&&void 0!==t[0]&&(t=_.toArray(t)),!Array.isArray(t))return this.parent(t,e);for(var i=!1,n=this.element.getElementsByTagName("input"),r=0,a=n.length;r<a;r++)n[r].get("checked")&&(i=!0),n[r].removeAttribute("checked");for(r=0,a=t.length;r<a;r++)for(var s=0,o=n.length;s<o;s++)n[s].value===""+t[r]&&(n[s].setAttribute("checked",!0),i=!0,"radio"===n[s].get("type").toLowerCase()&&this.element.store("sel",n[s].get("id")));return i},onUpdateResponse:function(){this.updateStyles()},updateStyles:function(){this.element.getElements(".qti-simpleChoice-block").each(function(t){t.getElement("input").get("checked")?t.addClass("qti-candidateResponse"):t.removeClass("qti-candidateResponse")})},int2char:function(t){--t;var e=Math.floor(t/26);return 0<e?this.int2chr(e)+this.chr(97+t%26):this.chr(97+t%26)},chr:function(t){return 65535<t?(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t))):String.fromCharCode(t)}}),dropdownChoiceInteraction=new Class({Extends:choiceInteraction,initialize:function(t,e){this.parent(t,e),this.arrowElement=t.getElement(".qti-dropdown-select-arrow"),this.wrapperElement=t.getElement(".qti-dropdown-wrapper"),this.tagsElement=t.getElement(".qti-dropdown-tags-wrap"),this.inputElements=t.getElements(".qti-simpleChoice-list input"),this.placeholderElement=t.getElement(".qti-dropdown-select-placeholder"),this.inputElements.each(function(t){t.addEvent("change",this.updateTags.bind(this))}.bind(this)),this.arrowElement.addEvent("click",this.toggleWrapperElement.bind(this)),this.placeholderElement.addEvent("click",this.toggleWrapperElement.bind(this))},updateTags:function(){for(;this.tagsElement.firstChild;)this.tagsElement.removeChild(this.tagsElement.firstChild);var e=!0;this.inputElements.each(function(t){t.checked&&(e=!1,this.createTag(t.getAttribute("id"),t.parentNode.getElement(".qti-display-fix").innerHTML.replace("qti-readspeaker-hover","")))}.bind(this)),e?(this.placeholderElement.style.display="block",this.placeholderElement.classList.remove("rs_skip")):(this.placeholderElement.style.display="none",this.placeholderElement.classList.add("rs_skip")),this.toggleSelectedClass()},createTag:function(t,e){var i=document.createElement("div");i.classList.add("qti-dropdown-tag"),i.setAttribute("id",t),i.innerHTML="<span>"+e+'</span><i aria-hidden="true" tabindex="1" class="qti-dropdown-tag-icon"></i>',i.getElement(".qti-dropdown-tag-icon").addEvent("click",this.removeTag.bind(this)),this.disableReadspeaker(i),this.tagsElement.appendChild(i),this.toggleSelectedClass()},removeTag:function(t){var e=t.target.parentNode.getAttribute("id");this.wrapperElement.childNodes[0].getElements(".qti-simpleChoice-block").each(function(t){t=t.getElement("input");t.getAttribute("id")===e&&t.checked&&t.click()}.bind(this)),this.updateTags(),this.updateStyles()},toggleSelectedClass:function(){0===this.tagsElement.childNodes.length?this.element.classList.remove("qti-dropdown-select-has-response"):this.element.classList.add("qti-dropdown-select-has-response")},toggleWrapperElement:function(){this.element.classList.contains("qti-dropdown-select-active")?(this.element.classList.remove("qti-dropdown-select-active"),this.wrapperElement.classList.add("rs_skip")):(this.element.classList.add("qti-dropdown-select-active"),this.wrapperElement.classList.remove("rs_skip"))},_setFormData:function(t,e){e=this.parent(t,e);return this.updateTags(),e},disableReadspeaker:function(t){if(t.nodeType!==Node.TEXT_NODE&&t.classList)if(t.classList.contains("qti-readspeakerlink"))t.parentNode.removeChild(t);else{t.classList.add("rs_disable");for(var e=t.firstChild;null!==e;e=e.nextSibling)this.disableReadspeaker(e)}}}),inlineChoiceInteraction=new Class({Extends:interaction,initialize:function(t,e){var i,n,r,a;this.parent(t),e.displayorder&&(i=this.element.getElement("select"),n=i.getElements("option"),r=[],a=this.element.getElement('option[value=""]'),r.push(a),e.displayorder.each(function(t,e){r[t+1]=n[e+1]}),r.each(function(t){i.appendChild(t)})),t.getElement("select").addEvent("change",this.onSelectInput.bind(this))},onSelectInput:function(t){this.updateStyles()},_setFormData:function(t,e){if(e=e||"",_.isObject(t)&&void 0!==t[0])t=_.toArray(t);else if(_.isObject(t))return this.parent(t,e);for(var i=!1,n=this.element.getElementsByTagName("option"),r=0,a=n.length;r<a;r++)n[r].get("selected")&&(i=!0),n[r].removeAttribute("selected");for(var s=0,o=n.length;s<o;s++)n[s].value===""+t&&(n[s].selected="selected",i=!0);return i},onUpdateResponse:function(){this.updateStyles()},updateStyles:function(){var t=this.element.getElement("select");""!==t.get("value")?t.addClass("qti-candidateResponse"):t.removeClass("qti-candidateResponse")}});document.createElement("canvas").getContext||function(){var x=Math,S=x.round,u=x.sin,h=x.cos,n=x.abs,r=x.sqrt,E=10,c=E/2;function i(){return this.context_||(this.context_=new g(this))}var a=Array.prototype.slice;var t={init:function(t){/MSIE/.test(navigator.userAgent)&&!window.opera&&((t=t||document).createElement("canvas"),t.attachEvent("onreadystatechange",function(t,e,i){var n=a.call(arguments,2);return function(){return t.apply(e,n.concat(a.call(arguments)))}}(this.init_,this,t)))},init_:function(t){var e;t.namespaces.g_vml_||t.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML"),t.namespaces.g_o_||t.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML"),t.styleSheets.ex_canvas_||((e=t.createStyleSheet()).owningElement.id="ex_canvas_",e.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}");for(var i=t.getElementsByTagName("canvas"),n=0;n<i.length;n++)this.initElement(i[n])},initElement:function(t){var e;return t.getContext||(t.getContext=i,t.innerHTML="",t.attachEvent("onpropertychange",s),t.attachEvent("onresize",o),(e=t.attributes).width&&e.width.specified?t.style.width=e.width.nodeValue+"px":t.width=t.clientWidth,e.height&&e.height.specified?t.style.height=e.height.nodeValue+"px":t.height=t.clientHeight),t}};function s(t){var e=t.srcElement;switch(t.propertyName){case"width":e.style.width=e.attributes.width.nodeValue+"px",e.getContext().clearRect();break;case"height":e.style.height=e.attributes.height.nodeValue+"px",e.getContext().clearRect()}}function o(t){t=t.srcElement;t.firstChild&&(t.firstChild.style.width=t.clientWidth+"px",t.firstChild.style.height=t.clientHeight+"px")}t.init();for(var l=[],e=0;e<16;e++)for(var d=0;d<16;d++)l[16*e+d]=e.toString(16)+d.toString(16);function p(){return[[1,0,0],[0,1,0],[0,0,1]]}function f(t,e){for(var i=p(),n=0;n<3;n++)for(var r=0;r<3;r++){for(var a=0,s=0;s<3;s++)a+=t[n][s]*e[s][r];i[n][r]=a}return i}function m(t,e){e.fillStyle=t.fillStyle,e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.shadowBlur=t.shadowBlur,e.shadowColor=t.shadowColor,e.shadowOffsetX=t.shadowOffsetX,e.shadowOffsetY=t.shadowOffsetY,e.strokeStyle=t.strokeStyle,e.globalAlpha=t.globalAlpha,e.arcScaleX_=t.arcScaleX_,e.arcScaleY_=t.arcScaleY_,e.lineScale_=t.lineScale_}function k(t){var e=1;if("rgb"==(t=String(t)).substring(0,3)){for(var i=t.indexOf("(",3),n=t.indexOf(")",i+1),r=t.substring(i+1,n).split(","),a="#",s=0;s<3;s++)a+=l[Number(r[s])];4==r.length&&"a"==t.substr(3,1)&&(e=r[3])}else a=t;return{color:a,alpha:e}}function g(t){this.m_=p(),this.mStack_=[],this.aStack_=[],this.currentPath_=[],this.strokeStyle="#000",this.fillStyle="#000",this.lineWidth=1,this.lineJoin="miter",this.lineCap="butt",this.miterLimit=+E,this.globalAlpha=1;var e=(this.canvas=t).ownerDocument.createElement("div");e.style.width=t.clientWidth+"px",e.style.height=t.clientHeight+"px",e.style.overflow="hidden",e.style.position="absolute",t.appendChild(e),this.element_=e,this.arcScaleX_=1,this.arcScaleY_=1,this.lineScale_=1}var v=g.prototype;function y(t,e,i,n){t.currentPath_.push({type:"bezierCurveTo",cp1x:e.x,cp1y:e.y,cp2x:i.x,cp2y:i.y,x:n.x,y:n.y}),t.currentX_=n.x,t.currentY_=n.y}function _(t,e,i){!function(t){for(var e=0;e<3;e++)for(var i=0;i<2;i++)if(!isFinite(t[e][i])||isNaN(t[e][i]))return;return 1}(e)||(t.m_=e,i&&(e=e[0][0]*e[1][1]-e[0][1]*e[1][0],t.lineScale_=r(n(e))))}function b(t){this.type_=t,this.x0_=0,this.y0_=0,this.r0_=0,this.x1_=0,this.y1_=0,this.r1_=0,this.colors_=[]}function w(){}v.clearRect=function(){this.element_.innerHTML=""},v.beginPath=function(){this.currentPath_=[]},v.moveTo=function(t,e){e=this.getCoords_(t,e);this.currentPath_.push({type:"moveTo",x:e.x,y:e.y}),this.currentX_=e.x,this.currentY_=e.y},v.lineTo=function(t,e){e=this.getCoords_(t,e);this.currentPath_.push({type:"lineTo",x:e.x,y:e.y}),this.currentX_=e.x,this.currentY_=e.y},v.bezierCurveTo=function(t,e,i,n,r,a){a=this.getCoords_(r,a),e=this.getCoords_(t,e),n=this.getCoords_(i,n);y(this,e,n,a)},v.quadraticCurveTo=function(t,e,i,n){e=this.getCoords_(t,e),n=this.getCoords_(i,n),e={x:this.currentX_+2/3*(e.x-this.currentX_),y:this.currentY_+2/3*(e.y-this.currentY_)};y(this,e,{x:e.x+(n.x-this.currentX_)/3,y:e.y+(n.y-this.currentY_)/3},n)},v.arc=function(t,e,i,n,r,a){i*=E;var s=a?"at":"wa",o=t+h(n)*i-c,l=e+u(n)*i-c,n=t+h(r)*i-c,r=e+u(r)*i-c;o!=n||a||(o+=.125);e=this.getCoords_(t,e),l=this.getCoords_(o,l),r=this.getCoords_(n,r);this.currentPath_.push({type:s,x:e.x,y:e.y,radius:i,xStart:l.x,yStart:l.y,xEnd:r.x,yEnd:r.y})},v.rect=function(t,e,i,n){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+n),this.lineTo(t,e+n),this.closePath()},v.strokeRect=function(t,e,i,n){var r=this.currentPath_;this.beginPath(),this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+n),this.lineTo(t,e+n),this.closePath(),this.stroke(),this.currentPath_=r},v.fillRect=function(t,e,i,n){var r=this.currentPath_;this.beginPath(),this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+n),this.lineTo(t,e+n),this.closePath(),this.fill(),this.currentPath_=r},v.createLinearGradient=function(t,e,i,n){var r=new b("gradient");return r.x0_=t,r.y0_=e,r.x1_=i,r.y1_=n,r},v.createRadialGradient=function(t,e,i,n,r,a){var s=new b("gradientradial");return s.x0_=t,s.y0_=e,s.r0_=i,s.x1_=n,s.y1_=r,s.r1_=a,s},v.drawImage=function(t,e){var i,n,r,a,s,o,l,u=t.runtimeStyle.width,h=t.runtimeStyle.height;t.runtimeStyle.width="auto",t.runtimeStyle.height="auto";var c=t.width,d=t.height;if(t.runtimeStyle.width=u,t.runtimeStyle.height=h,3==arguments.length)i=e,m=arguments[2],a=s=0,o=n=c,l=r=d;else if(5==arguments.length)i=e,m=arguments[2],n=arguments[3],r=arguments[4],a=s=0,o=c,l=d;else{if(9!=arguments.length)throw Error("Invalid number of arguments");a=e,s=arguments[2],o=arguments[3],l=arguments[4],i=arguments[5],m=arguments[6],n=arguments[7],r=arguments[8]}var p,f,m,g=this.getCoords_(i,m),v=[];v.push(" <g_vml_:group",' coordsize="',10*E,",",10*E,'"',' coordorigin="0,0"',' style="width:',10,"px;height:",10,"px;position:absolute;"),1!=this.m_[0][0]||this.m_[0][1]?((p=[]).push("M11=",this.m_[0][0],",","M12=",this.m_[1][0],",","M21=",this.m_[0][1],",","M22=",this.m_[1][1],",","Dx=",S(g.x/E),",","Dy=",S(g.y/E),""),f=g,u=this.getCoords_(i+n,m),h=this.getCoords_(i,m+r),m=this.getCoords_(i+n,m+r),f.x=x.max(f.x,u.x,h.x,m.x),f.y=x.max(f.y,u.y,h.y,m.y),v.push("padding:0 ",S(f.x/E),"px ",S(f.y/E),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",p.join(""),", sizingmethod='clip');")):v.push("top:",S(g.y/E),"px;left:",S(g.x/E),"px;"),v.push(' ">','<g_vml_:image src="',t.src,'"',' style="width:',E*n,"px;"," height:",E*r,'px;"',' cropleft="',a/c,'"',' croptop="',s/d,'"',' cropright="',(c-a-o)/c,'"',' cropbottom="',(d-s-l)/d,'"'," />","</g_vml_:group>"),this.element_.insertAdjacentHTML("BeforeEnd",v.join(""))},v.stroke=function(t){var e=[],i=k(t?this.fillStyle:this.strokeStyle),n=i.color,r=i.alpha*this.globalAlpha;e.push("<g_vml_:shape",' filled="',!!t,'"',' style="position:absolute;width:',10,"px;height:",10,'px;"',' coordorigin="0 0" coordsize="',10*E," ",10*E,'"',' stroked="',!t,'"',' path="');for(var a={x:null,y:null},s={x:null,y:null},o=0;o<this.currentPath_.length;o++){var l=this.currentPath_[o];switch(l.type){case"moveTo":e.push(" m ",S(l.x),",",S(l.y));break;case"lineTo":e.push(" l ",S(l.x),",",S(l.y));break;case"close":e.push(" x "),l=null;break;case"bezierCurveTo":e.push(" c ",S(l.cp1x),",",S(l.cp1y),",",S(l.cp2x),",",S(l.cp2y),",",S(l.x),",",S(l.y));break;case"at":case"wa":e.push(" ",l.type," ",S(l.x-this.arcScaleX_*l.radius),",",S(l.y-this.arcScaleY_*l.radius)," ",S(l.x+this.arcScaleX_*l.radius),",",S(l.y+this.arcScaleY_*l.radius)," ",S(l.xStart),",",S(l.yStart)," ",S(l.xEnd),",",S(l.yEnd))}l&&((null==a.x||l.x<a.x)&&(a.x=l.x),(null==s.x||l.x>s.x)&&(s.x=l.x),(null==a.y||l.y<a.y)&&(a.y=l.y),(null==s.y||l.y>s.y)&&(s.y=l.y))}if(e.push(' ">'),t)if("object"==typeof this.fillStyle){var u,h=this.fillStyle,c=0,d={x:0,y:0},p=0,f=1;"gradient"==h.type_?(u=h.x0_/this.arcScaleX_,v=h.y0_/this.arcScaleY_,i=h.x1_/this.arcScaleX_,t=h.y1_/this.arcScaleY_,v=this.getCoords_(u,v),t=(i=this.getCoords_(i,t)).x-v.x,i=i.y-v.y,(c=180*Math.atan2(t,i)/Math.PI)<0&&(c+=360),c<1e-6&&(c=0)):(v=this.getCoords_(h.x0_,h.y0_),y=s.x-a.x,_=s.y-a.y,d={x:(v.x-a.x)/y,y:(v.y-a.y)/_},y/=this.arcScaleX_*E,_/=this.arcScaleY_*E,b=x.max(y,_),p=2*h.r0_/b,f=2*h.r1_/b-p);var m=h.colors_;m.sort(function(t,e){return t.offset-e.offset});for(var g=m.length,v=m[0].color,y=m[g-1].color,_=m[0].alpha*this.globalAlpha,b=m[g-1].alpha*this.globalAlpha,w=[],o=0;o<g;o++){var T=m[o];w.push(T.offset*f+p+" "+T.color)}e.push('<g_vml_:fill type="',h.type_,'"',' method="none" focus="100%"',' color="',v,'"',' color2="',y,'"',' colors="',w.join(","),'"',' opacity="',b,'"',' g_o_:opacity2="',_,'"',' angle="',c,'"',' focusposition="',d.x,",",d.y,'" />')}else e.push('<g_vml_:fill color="',n,'" opacity="',r,'" />');else{d=this.lineScale_*this.lineWidth;d<1&&(r*=d),e.push("<g_vml_:stroke",' opacity="',r,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',function(t){switch(t){case"butt":return"flat";case"round":return"round";default:return"square"}}(this.lineCap),'"',' weight="',d,'px"',' color="',n,'" />')}e.push("</g_vml_:shape>"),this.element_.insertAdjacentHTML("beforeEnd",e.join(""))},v.fill=function(){this.stroke(!0)},v.closePath=function(){this.currentPath_.push({type:"close"})},v.getCoords_=function(t,e){var i=this.m_;return{x:E*(t*i[0][0]+e*i[1][0]+i[2][0])-c,y:E*(t*i[0][1]+e*i[1][1]+i[2][1])-c}},v.save=function(){var t={};m(this,t),this.aStack_.push(t),this.mStack_.push(this.m_),this.m_=f(p(),this.m_)},v.restore=function(){m(this.aStack_.pop(),this),this.m_=this.mStack_.pop()},v.translate=function(t,e){_(this,f([[1,0,0],[0,1,0],[t,e,1]],this.m_),!1)},v.rotate=function(t){var e=h(t),t=u(t);_(this,f([[e,t,0],[-t,e,0],[0,0,1]],this.m_),!1)},v.scale=function(t,e){this.arcScaleX_*=t,this.arcScaleY_*=e,_(this,f([[t,0,0],[0,e,0],[0,0,1]],this.m_),!0)},v.transform=function(t,e,i,n,r,a){_(this,f([[t,e,0],[i,n,0],[r,a,1]],this.m_),!0)},v.setTransform=function(t,e,i,n,r,a){_(this,[[t,e,0],[i,n,0],[r,a,1]],!0)},v.clip=function(){},v.arcTo=function(){},v.createPattern=function(){return new w},b.prototype.addColorStop=function(t,e){e=k(e),this.colors_.push({offset:t,color:e.color,alpha:e.alpha})},G_vmlCanvasManager=t,CanvasRenderingContext2D=g,CanvasGradient=b,CanvasPattern=w}();var graphicInteraction=new Class({Extends:interaction,Implements:Options,options:{pointerClass:"qti-pointer",pointerOffset:{x:10,y:10},dragClass:"drag",gutterClass:"gutter",shape_opacity:.4,limit_to_container:!1,colors:["#5d21d9","#21c5d9","#21d92e","#d9d721","#d98421","#d92121","#89d921","#213fd9","#d921c5"]},graphics:!1,container:!1,gutter:!1,pointerElement:!1,usedPointers:[],hotspots:{},showReview:!1,showSolution:!1,polygonViewer:!1,initialize:function(t,e){this.setOptions(e),this.parent(t),this.showReview=!!this.element.getParent(".qti-display-review")||t.hasClass("qti-display-review"),this.showSolution=!!this.element.getParent(".qti-display-solution")||t.hasClass("qti-display-solution");var i={};this.element.getElements("img").each(function(t){t.closest("div.qti-prompt")||(i[t.src]=t)});var n=Object.values(i);0!==n.length&&(this.graphics=Asset.images(Object.keys(i),{onComplete:function(){var a={};this.graphics.each(function(t){a[t.src]=t},this);var s=[];n.each(function(t){var e,i=a[t.src].clone(),n=t.get("width"),r=t.get("height");n&&r||(e=t.getSize(),n=n||e.x,r=r||e.y),i.replaces(t),i.set("width",n),i.set("height",r),s.push(i)},this),this.graphics=s,this.createContainer(this.graphics.shift()),this.pointerElement=new Element("div",{class:this.options.pointerClass}),this.image_loaded()}.bind(this)}))},image_loaded:function(){},createContainer:function(t){var e;this.container=new Element("div",{class:"qti-graphicInteraction"}),this.container.replaces(t),t.get("width")&&this.container.setStyle("width",t.get("width")+"px"),this.polygonViewer=new PolygonViewer(this.container,{image:{src:t.src,width:t.get("width")||0,height:t.get("height")||0},path:{inactive_opacity:this.options.shape_opacity},paths:[],colors:["#000000"],zoom_by_scroll:!1}),this.showReview?(e=t.getProperty("width"))&&this.container.setStyle("width",Math.max(100,e)+"px"):(this.gutter=new Element("div",{class:this.options.gutterClass}),(e=t.getProperty("width"))&&this.container.setStyle("width",Math.max(100,e)+"px"),this.polygonViewer.element.grab(this.gutter))},limitToCanvas:function(t,e){var i=(e=void 0===e)?4:0;t.x=Math.max(-i,t.x);e=parseInt(this.polygonViewer.paper.width);0<e&&(t.x=Math.min(t.x,e+i)),t.y=Math.max(-i,t.y);e=parseInt(this.polygonViewer.paper.height);return 0<e&&(t.y=Math.min(t.y,e+i)),t},newPointerElement:function(){return this.pointerElement.clone()},onPointerDrop:function(t,e,i){var n;this.container.removeClass("qti-warning"),e&&e!==this.gutter?e===this.polygonViewer.paper.canvas&&(this.usedPointers.erase(t),this.usedPointers.push(t),n=this.limitToCanvas(this.polygonViewer.convert_position(i.page.x,i.page.y),!1),t.set("data-x",Math.round(n.x)),t.set("data-y",Math.round(n.y))):((n=t.retrieve("placeHolder"))&&n.destroy(),this.usedPointers.erase(t),this.returnToGutter(t),t.set("data-x",null),t.set("data-y",null))},onPointerLeave:function(t,e){e==this.gutter?(t=t.retrieve("placeHolder"))&&t.destroy():e==this.polygonViewer.paper.canvas&&this.container.addClass("qti-warning")},onPointerEnter:function(t,e){e==this.polygonViewer.paper.canvas&&this.container.removeClass("qti-warning")},onPointerBeforeDragStart:function(t){this.usedPointers.contains(t)||(placeHolder=t.clone().setStyle("visibility","hidden").inject(t,"after"),t.store("placeHolder",placeHolder)),this.setDrag(t)},onPointerDragCancel:function(t){var e;this.element.removeClass("qti-warning"),this.usedPointers.contains(t)||((e=t.retrieve("placeHolder"))&&(t.eliminate(e),e.destroy()),this.returnToGutter(t))},setDrag:function(t,e){e=e||t.getPosition(this.polygonViewer.element),t.setStyles({left:e.x,top:e.y}),t.addClass(this.options.dragClass)},makeDraggable:function(t){new Drag.Move(t,{onDrop:this.onPointerDrop.bind(this),onBeforeStart:this.onPointerBeforeDragStart.bind(this),onLeave:this.onPointerLeave.bind(this),onEnter:this.onPointerEnter.bind(this),onCancel:this.onPointerDragCancel.bind(this),container:this.options.limit_to_container?this.container:null,droppables:[this.gutter,this.polygonViewer.paper.canvas],precalculate:!1});t.setStyles({position:"",left:"",top:""})},returnToGutter:function(t){t.removeClass("drag"),t.removeProperty(this.options.dragClass)},loadHotspots:function(t){var t=this.element.getElements("."+t),s=[];t.each(function(t){var e=t.get("data-shape"),i=JSON.decode(t.get("data-coords")),n=t.get("data-identifier"),r=t.get("data-match-max"),a=t.get("data-match-min"),a={shape:e,coords:i,identifier:n,match_max:r.toInt(),match_min:a.toInt(),options:{path:{inactive_opacity:this.options.shape_opacity}}};s.push(a),this.hotspots[n]=a,$(t).destroy()},this),this.polygonViewer.add_paths(s)},hex2rgb:function(t){"#"===t.charAt(0)&&(t=t.substr(1));t=parseInt(t,16);return{r:t>>16&255,g:t>>8&255,b:255&t}}}),extendedTextInteraction=new Class({Extends:interaction,editor:!1,initialize:function(t,e){this.parent(t);var i=t.getElement("textarea");i&&i.get("data-codemirror")||t.createWordCounts(),i&&"true"===i.get("data-tinymce")?this.loadTinyMCE(i):i&&i.get("data-codemirror")?this.loadCodemirror(i):(document.$sl||(document.$sl=new SymbolList),document.$sl.load(t.getElements("textarea"))),"undefined"!=typeof Offline&&(window.addEventListener("online",function(){$$("a.mce_charmap").each(function(t){t.setStyle("display","block")}),$$("a.mce_table").each(function(t){t.setStyle("display","block")}),$$("span.mce_remindomath").each(function(t){t.setStyle("display","block")})},this),window.addEventListener("offline",function(){$$("a.mce_charmap").each(function(t){t.setStyle("display","none")}),$$("a.mce_table").each(function(t){t.setStyle("display","none")}),$$("span.mce_remindomath").each(function(t){t.setStyle("display","none")})},this))},loadTinyMCE:function(r){var t=r.get("data-height"),e=JSON.parse(r.get("data-config"));r.get("data-language");this.editor&&this.destroy(),r.set("id",r.get("id")+"_"+String.uniqueID());e={mode:"exact",elements:r.get("id"),language_url:e.language_url,width:"100%",height:t,autoresize_min_height:t,toolbar_items_size:"small",toolbar1:e.toolbar1,toolbar2:e.toolbar2,toolbar3:e.toolbar3,content_css:e.content_css,editor_css:e.editor_css,statusbar:!1,plugins:"autolink lists link charmap hr anchor searchreplace paste code table contextmenu directionality "+e.plugins,relative_urls:!1,object_resizing:!0,table_resize_bars:!0,menubar:!1,invalid_elements:"form,input,fieldset,legend,select,button,textarea,embed,param,label,option,iframe,object,script",paste_data_images:!1,paste_preprocess:function(t,e){e.content=e.content.replace("/<script[^]*?<\/script>/ig","").replace("/<iframe[^]*?</iframe>/ig","").replace(/<img[^]*?src=['"]([^]*?)['"][^]*?>/gi,function(t,e){return"/math"===e.substr(0,5)?t:""})},block_formats:[$I18N.t("Text")+"=p",$I18N.t("Header 1")+"=h1",$I18N.t("Header 2")+"=h2",$I18N.t("Header 3")+"=h3",$I18N.t("Code")+"=pre"].join("; "),formats:{alignleft:{selector:"p,h1,h2,h3,h4,h5,h6,td,th,ul,ol,li,table,img",classes:"qtistyle-alignleft"},aligncenter:{selector:"p,h1,h2,h3,h4,h5,h6,td,th,ul,ol,li,table,img",classes:"qtistyle-aligncenter"},alignright:{selector:"p,h1,h2,h3,h4,h5,h6,td,th,ul,ol,li,table,img",classes:"qtistyle-alignright"},underline:{inline:"span",classes:"qtistyle-underline",exact:!0},strikethrough:{inline:"span",classes:"qtistyle-linetrough",exact:!0}},style_formats:[],branding:!1,valid_elements:e.valid_elements,valid_classes:e.valid_classes,valid_styles:e.valid_styles,browser_spellcheck:!1,plugin_preview_width:750,code_dialog_width:750,table_advtab:!1,table_cell_advtab:!1,table_row_advtab:!1,pagebreak_split_block:!0,indentation:"10px",target_list:!1,table_appearance_options:!1,table_default_attributes:{class:"qtistyle-table qtistyle-border-thin",width:"300px",cellspacing:0,cellpadding:0},table_class_list:[{title:$I18N.t("None"),value:"qtistyle-table"},{title:$I18N.t("Thick border"),value:"qtistyle-table qtistyle-border-thick"},{title:$I18N.t("Thin border"),value:"qtistyle-table qtistyle-border-thin"},{title:$I18N.t("Thick border outside, thin border inside"),value:"qtistyle-border-thick-outside-thin-inside"}],table_cell_class_list:[{title:$I18N.t("None"),value:""},{title:$I18N.t("Top border"),value:"qtistyle-border-top"},{title:$I18N.t("Right border"),value:"qtistyle-border-right"},{title:$I18N.t("Bottom border"),value:"qtistyle-border-bottom"},{title:$I18N.t("Left border"),value:"qtistyle-border-left"}],charmap_append:[["502","Latin Capital Letter Hwair"],["405","Latin small letter HV"]],setup:function(e){e.on("init",function(t){r&&r.fireEvent("tinyMCEloaded"),tinyMCE.i18n.data.nl&&(tinyMCE.i18n.data.nl.Class="Opmaak"),tinyMCE.i18n.data.en&&(tinyMCE.i18n.data.en.Class="Styling"),e.editorContainer&&e.editorContainer.classList.add("rs_skip")}),e.on("Change",function(t){var e=tinyMCE.get(r.id).getBody(),i=tinyMCE.trim(e.innerText||e.textContent),n=document.createComment(i),e=document.createElement("span");e.classList.add("RS_MESSAGE","fr_skip");i=r.parentNode.getElementsByClassName("RS_MESSAGE");0<i.length&&i[0].remove(),e.appendChild(n),r.parentNode.insertBefore(e,r)})}};this.editor=tinyMCE.init(e)},loadCodemirror:function(t){var i,e,n,r=JSON.parse(t.get("data-codemirror"));r&&(i=t,r.viewportMargin=1/0,e=Math.max(5,i.get("rows")),i.measure(function(){return this.getSize()}),CodeMirror.modeURL=t.get("data-codemirror-url")+"/mode/%N/%N.js","ie"===Browser.name?r.inputStyle="textarea":r.inputStyle="contenteditable",(n=CodeMirror.fromTextArea(i,r)).getWrapperElement().setStyle("min-height",e+1+"em"),r.mode&&CodeMirror.requireMode(r.mode,function(){n.setOption("mode",r.mime||r.mode)}),i.store("codemirror",n),n.on("change",function(t,e){n.save(),"setValue"!==e.origin&&$QTI.fireChangeEvent(i)}),n.setSize("100%",1.5*e+"em"))},destroy:function(){var t,e,i=this.element.getElement("textarea");"true"===i.get("data-tinymce")?(t=i.get("id"),(e=tinyMCE.get(t))&&(tinyMCE.execCommand("mceRemoveEditor",!1,t),tinyMCE.remove(e),e.destroy())):!i.get("data-codemirror")||(i=i.retrieve("codemirror"))&&i.toTextArea()},_setFormData:function(e,i){var n=(d=this.element.getElement("textarea")).get("id");if("true"===d.get("data-tinymce")){if(i=i||"",_.isObject(e)&&void 0!==e[0]?e=_.toArray(e):"string"==typeof e&&(e=[e]),!Array.isArray(e))return this.parent(e,i);if("undefined"==typeof tinymce||void 0!==tinymce.getInstanceById&&!tinymce.getInstanceById(n)||void 0!==tinymce.get&&!tinymce.get(n)){var r=this;return tinymce.on("AddEditor",function(t){t.editor.id===n&&r._setFormData(e,i)}),!0}for(var t=void 0!==tinymce.getInstanceById?tinymce.getInstanceById(n):tinymce.get(n),a=!1,s=this.element.getElementsByTagName("textarea"),o=0,l=e.length;o<l;o++)for(var u=0,h=s.length;u<h;u++){var c=e[o];t.initialized?(t.setContent(c),t.save()):(s[u].value=c,t.on("init",function(){t.setContent(c)})),a=!0}}else{if(!d.get("data-codemirror"))return this.parent(e,i);if(i=i||"",_.isObject(e)&&void 0!==e[0]?e=_.toArray(e):"string"==typeof e&&(e=[e]),!Array.isArray(e))return this.parent(e,i);for(s=this.element.getElementsByTagName("textarea"),o=0,l=e.length;o<l;o++)for(u=0,h=s.length;u<h;u++){var d,c=e[o],p=(d=s[u]).retrieve("codemirror");p?p.doc.setValue(c):d.value=c,a=!0}}return a}}),textEntryInteraction=new Class({Extends:interaction,initialize:function(t){this.parent(t),this.input=this.element.getElement("input.qti-numberinput"),this.input||(document.$sl||(document.$sl=new SymbolList),document.$sl.load(t.getElements("input[type=text]")))},validate:function(t=0){if(!this.input)return!0;if(this.input.value.length<1)return!0;var e=","===this.input.get("data-decimalsymbol")?",":".",i=","==e?".":",",e=-1!==this.input.value.indexOf(i)?new RegExp("^-?[1-9]\\d{0,2}([{\\"+i+"]\\d{3})*(\\"+e+"\\d+)?(e-?\\d+)?$","gi"):new RegExp("^-?\\d+(\\"+e+"\\d+)?(e-?\\d+)?$","gi");return null!==this.input.value.match(e)},setFormData:function(t){this.parent(t)},setResponse:function(t,e){"number"==typeof t&&(t=this.format(t)),this.parent(t,e)},format:function(t){var e=this.input.get("data-decimalsymbol");return(","===e?t.toLocaleString(["nl-NL"],{maximumFractionDigits:20,notation:(t+"").match(/e/)?"scientific":"standard"}):t.toLocaleString(["en-US"],{maximumFractionDigits:20,notation:(t+"").match(/e/)?"scientific":"standard"})).toLowerCase()}}),media=new Class({element:!1,Binds:["hoverImage","unhoverImage"],original_link:!1,imgobj:!1,mbobj:null,initialize:function(t){this.element=$(t),this.imgobj=this.element.getElement("img"),this.original_link=this.element.getElement(".qti-original-media-link"),this.element.hasClass("scan-result")||this.element.hasClass("scan-url")||(this.original_link.addClass("qti-hidden"),this.element.addEvent("mouseenter",this.hoverImage),this.element.addEvent("mouseleave",this.unhoverImage)),this.original_link.addEvent("click",this.lightboxImage)},hoverImage:function(t){this.original_link.removeClass("qti-hidden"),this.imgobj.addClass("qti-shadow")},unhoverImage:function(t){this.original_link.addClass("qti-hidden"),this.imgobj.removeClass("qti-shadow")},lightboxImage:function(t){t.stop();t=!1;window.testplayersettings&&window.testplayersettings.parentModalWindow&&(t=window.testplayersettings.parentModalWindow),"parentIFrame"in window&&t?window.parentIFrame.sendMessage(JSON.stringify({open_modal:this.href})):"function"==typeof Milkbox?(this.mbobj=new Milkbox,this.mbobj.openWithFile({href:this.href,title:""})):window.open(this.href)}}),mediaInteraction=new Class({Extends:interaction,element:!1,Binds:["onPlay","onVideoEnd","onTimeChange","onUpdate"],localSeek:!1,initialize:function(t){this.element=$(t),this.form=this.element.getParent("form"),this.body=this.element.getParent(".qti-itemBody"),this.source="",this.form?this.source+=this.form.getAttribute("action"):this.source+=document.location.toString(),this.source+="|"+this.element.getAttribute("data-assessment-identifier")+this.element.getAttribute("data-response-identifier"),this.input=this.element.querySelector("input[type=hidden]"),this.status=this.element.querySelector(".qti-status"),this.videojsElement=this.element.querySelector(".video-js"),this.store=localforage.createInstance({name:this.source}),this.inAssessment=this.body.classList.contains("qti-display-assessment"),this.currentCount=parseInt(this.input.getAttribute("value")),this.currentTime=0,this.isPlaying=!1,this.inAssessment?(this.limit=parseInt(this.element.getAttribute("data-maxplays")),isNaN(this.limit)&&(this.limit=0)):this.limit=0,isNaN(this.currentCount)&&(this.currentCount=0),this.videojsElement&&(this.videojs=window.videojs(this.videojsElement.getAttribute("id")),lastvideo=this.videojs,this.store.getItem("time").then(function(t){null!==t&&(this.currentTime=t)}.bind(this)),0<this.limit&&this.currentCount>=this.limit?this.disable():this.videojs.ready(function(){this.videojs.load(),this.videojs.on("ended",this.onVideoEnd),this.videojs.on("timeupdate",this.onTimeChange),this.videojs.on("play",this.onUpdate),this.videojs.on("pause",this.onUpdate),this.videojs.on("seeking",this.onUpdate),this.videojs.on("seeked",this.onUpdate),this.videojs.on("play",this.onPlay);var t=this.element.querySelector("video, audio");t.addEventListener?t.addEventListener("contextmenu",function(t){t.preventDefault()},!1):t.attachEvent("oncontextmenu",function(){window.event.returnValue=!1}),this.updateStatus()}.bind(this))),this.updateStatus()},getAnswerStatus:function(){return!1},onPlay:function(t){!1!==this.inAssessment&&(0<this.limit&&this.currentCount>=this.limit&&this.disable(),this.isPlaying=!0,this.updateStatus())},onVideoEnd:function(t){this.inAssessment&&(this.isPlaying=!1,this.currentCount++,this.input.setAttribute("value",this.currentCount),this.currentTime=0,this.store.removeItem("time"),$QTI.fireChangeEvent(this.input),this.status&&0<this.limit&&this.updateStatus(),0<this.limit&&this.currentCount>=this.limit&&this.disable())},onTimeChange:function(t){if(!this.localSeek){var e=this.videojs.currentTime(),i=e-this.currentTime;try{0!==this.limit&&.5<Math.abs(i)?this.seek(this.currentTime):0!==this.limit&&this.currentPlays>=this.limit?this.disable():e>this.currentTime?(this.currentTime=e,this.store.setItem("time",this.currentTime)):0!==this.limit&&e<this.currentTime&&this.seek(this.currentTime)}catch(t){}}},onUpdate:function(t){this.localSeek||(0!==this.limit&&["seeking","seeked"].contains(t.type)&&(this.seek(this.currentTime),t.preventDefault()),0!==this.limit&&this.currentCount>=this.limit&&this.disable())},seek:function(t){this.localSeek||(this.localSeek=!0,this.videojs.paused()?this.videojs.currentTime(t):(this.videojs.pause(),this.videojs.currentTime(t),this.videojs.play().then(function(){this.localSeek=!1}.bind(this)).catch(function(t){})))},disable:function(){this.videojs.pause(),this.seek(0),this.videojs.controls(!1),this.videojs.load(),this.element.addClass("media-disabled"),this.updateStatus()},updateStatus:function(){!1!==this.inAssessment&&null!==this.status&&(0!==this.limit?this.currentCount>=this.limit?this.status.innerText=$I18N.t("{type, select, video{This video fragment} audio{This audio fragment} other{This media file}} cannot be played, it has been played the maximum allowed number of times.",{type:this.element.getAttribute("data-type")}):!1!==this.isPlaying?this.currentCount+1>=this.limit?this.status.innerText=$I18N.t("When {type, select, video{this video fragment} audio{this audio fragment} other{this media file}} ends, it cannot be replayed.",{type:this.element.getAttribute("data-type")}):this.status.innerText=$I18N.t("When {type, select, video{this video fragment} audio{this audio fragment} other{this media file}} ends, it can be played {limit,plural, =1 {1 more time} other {# more times}}.",{type:this.element.getAttribute("data-type"),limit:this.limit-this.currentCount-1}):this.status.innerText=$I18N.t("{type, select, video{This video fragment} audio{This audio fragment} other{This media file}} can be played {limit,plural, =1 {1 time} other {# times}}.",{type:this.element.getAttribute("data-type"),limit:this.limit-this.currentCount}):this.status.innerText=$I18N.t("{type, select, video{This video fragment} audio{This audio fragment} other{This media file}} can be played without limitations.",{type:this.element.getAttribute("data-type")}))},onUpdateResponse:function(){this.currentCount=parseInt(this.input.getAttribute("value")),isNaN(this.currentCount)&&(this.currentCount=0),0<this.limit&&this.currentCount>=this.limit?this.disable():0<this.currentCount&&this.status&&this.updateStatus()}});!function(t){var r={},a={};t.casus=new Class({Implements:[Events],element:!1,Binds:["load","onSuccess"],loaded:!1,initialize:function(t,e){t?(this.element=$(t),this.load()):0<e.length&&this.preload(e)},preload:function(n){"#"!==n.substring(0,1)?(a[n]=a[n]||0,0===a[n]&&(a[n]=1,new $Request.JSON({url:n,method:"GET",onSuccess:function(t){r[n]=t;var t=document.createRange().createContextualFragment(t.html),e=!1,i=[];[].slice.call(t.querySelectorAll("img.qti-image, a.qti-original-media-link")).forEach(function(t){i.push("A"===t.nodeName?t.href:t.src),e=e||"A"===t.nodeName}),e&&(i=i.concat(["/base/resources/images/milkbox/close.png","/base/resources/images/milkbox/prev.png","/base/resources/images/milkbox/next.png","/base/resources/images/milkbox/play-pause.png","/base/resources/images/milkbox/loading.gif"])),[].forEach.call(i,function(t){(new Image).src=t}),a[n]=2},onFailure:function(t){a[n]=3}.bind(this),onError:function(t,e){a[n]=3}.bind(this),onTimeout:function(t){a[n]=3}.bind(this),timeout:3e3}).send())):a[n]=2},load:function(){var t=this.element.get("data-url");a[t]=a[t]||0,1===a[t]?setTimeout(function(){this.load()}.bind(this),100):2===a[t]&&r[t]?this.onSuccess(r[t]):t&&(this.element.innerHTML="...",new $Request.JSON({url:t,method:"GET",onSuccess:this.onSuccess,onFailure:function(t){this.element.parentNode&&(this.element.innerHTML=$I18N.t("Unable to load case text, retrying in a couple of seconds..."),this.load.delay(3e3))}.bind(this),onError:function(t,e){this.element.parentNode&&(this.element.innerHTML=$I18N.t("Unable to load case text, retrying in a couple of seconds..."),this.load.delay(3e3))}.bind(this),onTimeout:function(t){this.element.parentNode&&(this.element.innerHTML=$I18N.t("Unable to load case text, retrying in a couple of seconds..."),this.load.delay(3e3))}.bind(this),timeout:15e3}).send())},onSuccess:function(t){var e=this.element.get("data-url");void 0!==t.html&&(this.element.innerHTML=t.html,""===t.html&&this.element.parentNode.setStyle("visibility","hidden"),this.element.loadQTI(),a[e],r[e]=t,this.loaded=!0,this.fireEvent("onLoad",[t.html,this.element]))}})}(window);var orderInteraction=new Class({Extends:interaction,Binds:["updateBoxes"],from:!1,to:!1,initialize:function(t,e){var i,n,r;this.parent(t),e.displayorder&&((i=this.element.getElement(".qti-simpleOrder-list > ul")).parentNode.classList.contains("qti-correctResponse")||(n=i.getElements(".qti-simpleOrder-block"),r=[],e.displayorder.each(function(t,e){r[t]=n[e]}),r.each(function(t){void 0!==t&&i.appendChild(t)}))),void 0===window.iosFix&&(window.addEventListener("touchmove",function(){}),window.iosFix=!0),null!=this.element.getParent(".qti-display-assessment")&&(t=this.element.getElements("div.qti-simpleOrder-lists > .qti-simpleOrder-list > ul"),e=String.uniqueID(),this.from=Sortable.create(t[0],{group:{name:e,pull:!0,put:!1},pull:!0,put:!1,sort:!1,onEnd:this.onUpdate.bind(this),onStart:this.onStart.bind(this)}),this.to=Sortable.create(t[1],{group:{name:e},onEnd:this.onUpdate.bind(this)})),this.updateBoxes(),window.addEventListener("resize",this.updateBoxes)},destroy:function(){window.removeEventListener("resize",this.updateBoxes)},onStart:function(t){t.target.getParent(".qti-simpleOrder-lists").getElement(".qti-simpleOrder-answerList > ul").addClass("qti-active")},onUpdate:function(t){var e=t.target.getParent(".qti-simpleOrder-lists").getElement(".qti-simpleOrder-answerList > ul");e.removeClass("qti-active");var i="";e.getChildren().each(function(t){i=(0==i.length?"":i+"|")+t.getElement(".qti-simpleOrder-value").get("html")}),t.target.getParent(".qti-simpleOrder-lists").getElement(".qti-simpleOrder-answer").value=i,$QTI.fireChangeEvent(t.target.getParent(".qti-simpleOrder-lists").getElement(".qti-simpleOrder-answer"))},onUpdateResponse:function(){var t=this.element.getElements(".qti-simpleOrder-list > ul"),e=[];this.element.getElements(".qti-simpleOrder-list ul .qti-simpleOrder-block").each(function(t){e[t.getElement(".qti-simpleOrder-value").innerHTML]=t});for(var i=this.element.getElement(".qti-simpleOrder-answer").get("value").split("|"),n=[],r=0;r<i.length;++r)void 0!==e[i[r]]&&(n[r]=e[i[r]]);for(r=0;r<n.length;++r)t[1].appendChild(n[r])},getAnswerStatus:function(){var t=this.element.getElements(".qti-simpleOrder-list > ul"),e=t[0].getElements("li").length;return 0==t[1].getElements("li").length?"unanswered":0<e?"partly":"answered"},updateBoxes:function(){var i=0,n={};this.element.getElements("li").each(function(t){var e;n[t.id]||(i+=t.offsetHeight,e=window.getComputedStyle(t),i+=parseFloat(e["margin-bottom"]),parseFloat(e["margin-bottom"]),n[t.id]=!0)}),this.element.getElements(".qti-simpleOrder-list > ul").setStyle("height",i+"px")}}),matchInteraction=new Class({Extends:interaction,initialize:function(t,e){var r,a,i,s,n,o,l,u;this.parent(t),e.displayorder&&(r=(u=this.element.getElement(".qti-match-table tbody")).children,a=r.length-1,i=e.displayorder.slice(0,a),s=e.displayorder.slice(a),n=r[0].children,o=[],s.each(function(t,e){o[t-a]=n[e+1]}),o.each(function(t){r[0].appendChild(t)}),l=[],i.each(function(t,e){var i=r[e+1].children,n=[];s.each(function(t,e){n[t-a]=i[e+1]}),n.each(function(t){r[e+1].appendChild(t)}),l[t]=r[e+1]}),l.each(function(t){u.appendChild(t)})),(u=this.element.getParent(".qti-itemBody"))&&u.hasClass("qti-display-assessment")&&this.element.getElements(".qti-simpleAssociableChoice-choice input").each(function(t){this.storeID(t),t.addEvent("click",this.onSelectInput)},this);var h=this;t.measure(function(){h.resize()})},storeID:function(t){"radio"==t.get("type").toLowerCase()&&t.get("checked")&&t.getParent(".qti-matchInteraction").store("sel",t.get("id"))},_setFormData:function(t,e){e=e||"";var i=this.element.getElements("input.qti-choice-checkbox").length;if(0<i&&_.size(t)==i&&(t=_.filter(_.flatten(_.values(t)))),!Array.isArray(t))return this.parent(t,e);for(var n=!1,r=this.element.getElementsByTagName("input"),a=0,s=r.length;a<s;a++)r[a].removeAttribute("checked");for(a=0,s=t.length;a<s;a++)for(var o=0,l=r.length;o<l;o++)r[o].value===t[a]&&(r[o].setAttribute("checked",!0),n=!0);return n},onSelectInput:function(t){var e=this.getParent(".qti-matchInteraction");this.get("checked")&&"radio"==this.get("type").toLowerCase()&&(e.retrieve("sel")==this.get("id")?(this.set("checked",!1),$QTI.fireChangeEvent(this),e.eliminate("sel")):e.store("sel",this.get("id"))),e.getElements(".qti-simpleChoice-block").each(function(t){t.getElement("input").get("checked")?t.addClass("qti-candidateResponse"):t.removeClass("qti-candidateResponse")})},resize:function(t){var e,i=this.element.getElement("table.qti-match-table");0<this.element.getElements(".qti-simpleAssociableCoice.source img").length&&(e=Math.max(e,img.getSize().x),i.getElement("tr:first-child td:first-child").setStyle("min-width",e+"px")),i.getElements("tr").each(function(t){var e=t.getElement("td, th"),e=Math.ceil(e.getComputedSize({mode:"vertical"}).height);t.getElements("label").setStyles({height:e+"px","line-height":e+"px"})})}}),uploadInteraction=new Class({Extends:interaction,Binds:["on_change","on_upload_start","on_upload_complete","on_upload_progress","check_upload_status"],options:{upload_options:{url:"/upload",data:{upload:"true"},activeClassName:"qti-upload-active"}},id:null,online:!0,messages:!1,timer:null,fileStatus:!1,fileIds:[],initialize:function(t){this.parent(t),this.id||(this.element.get("id")?this.id=this.element.get("id"):(this.id="uploadInteraction_"+String.uniqueID(),this.element.set("id",this.id))),this.input=this.element.getElement("input[type=file]"),this.input&&(this.input.addEvent("change",this.on_change),this.messages||(this.messages=new Element("div.qti-messages",{styles:{display:"none"}}),this.wrapper=this.element.getElement(".qti-file-wrapper"),this.wrapper.grab(this.messages,"after")),this.fileStatus||(this.fileStatus=new Element("p.qti-file-status",{styles:{display:"none"}}),this.element.getElement(".qti-value-container").grab(this.fileStatus,"after")),this.result=this.element.getElement("input[type=hidden]"),this.form=this.element.getParent("form"),(t=this.element.get("data-session"))&&(this.options.upload_options.data.__esid=t),window.addEventListener("online",this.onOnline,this),window.addEventListener("offline",this.onOffline,this),this.online=navigator.onLine)},_setFormData:function(t,e){e=e||"",e=this.parent(t,e);if(e&&"string"==typeof t)try{this.setFile(t,!0)}catch(t){}return e},setFile:function(t,e){e=!!e;var i=this.getFileData(t);if(i){var n=i.basename.split(".").pop(),r='            <div class="qti-upload-value">\n                <h1>'+("unknown"===i.status?$I18N.t("Last uploaded file:"):$I18N.t("Saved file:"))+'</h1>\n                <p><span class="filetypebig"></span></p>\n                <p><span class="basename"></span></p>\n            </div>',t=this.element.getElement(".qti-value-container");switch(t.set("html",r),t.getElements(".basename").set("text",i.basename),t.getElements(".filetypebig").addClass("filetypebig-"+n),t.fireEvent("change"),this.fileStatus.setStyle("display","block"),i.status){case"processing":var a="";null!==i.progress&&0<i.progress&&i.progress<=100?a+=$I18N.t("The file is saved and is currently being processed ({progress}%).",{progress:i.progress}):a+=$I18N.t("The file is saved and is currently being processed."),a+=" "+$I18N.t("It's safe to continue with your test."),this.fileStatus.set("text",a);break;case"failed":this.fileStatus.set("text",$I18N.t("The file is saved but could not be processed. This may mean something is wrong with the file. Please make sure you uploaded a working and complete file."));break;case"unknown":case null:this.fileStatus.set("text",$I18N.t("Your file is being saved"));break;default:this.fileStatus.set("text",""),this.fileStatus.setStyle("display","none")}t=!1;this.fileIds.contains(i.id)||(this.fileIds.push(i.id),t=!0),null!==this.timer&&clearTimeout(this.timer),"available"===i.status&&!t||(this.timer=setTimeout(this.check_upload_status,e?0:1500))}},getFileData:function(t){t=t.replace("qtifile://","").split("/")[0].replace("-","+").replace("_","/").replace(",","="),t=window.atob(t);return"string"==typeof t&&0<t.length?JSON.parse(t):null},on_change:function(t){t=FileAPI.getFiles(t)[0];t&&("undefined"!=typeof ReadSpeaker&&this.id&&this.initialize($(this.id)),this.uploadFile(t))},uploadFile:function(t){var e=this.parseURL(this.form.get("action")),i=this.input.getAttribute("data-filesize-limit");if(i&&t.size&&i<t.size)return this.messages.setStyle("display","inline-block"),this.messages.set("text",$I18N.t("File too big.")),void this.messages.insertAdjacentElement("afterbegin",new Element("span.fas.fa-exclamation-triangle.red-icon"));e=e.path+"?"+Object.toQueryString(Object.merge(e.params,{upload_name:this.input.get("name"),id:String.uniqueID()})),e=FileAPI.extend(this.options.upload_options,{url:e,files:{},upload:this.on_upload_start,complete:this.on_upload_complete,progress:this.on_upload_progress,name:this.input.get("name")});void 0!==window.getCSRFToken&&(void 0===e.headers&&(e.headers={}),e.headers["X-Request"]="REST",e.headers[window.getCSRFHeaderName()]=window.getCSRFToken()),e.files[e.name]=t,FileAPI.upload(e)},check_upload_status:function(){var t=this.parseURL(this.form.get("action")),t=t.path+"?"+Object.toQueryString(Object.merge(t.params,{upload_name:this.input.get("name"),id:String.uniqueID(),status:"true",data:this.result.get("value")})),e=function(){null!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.check_upload_status,2500)}.bind(this);new $Request.JSON({url:t,method:"POST",timeout:2e3,onFailure:e,onError:e,onTimeout:e,onSuccess:function(t){!1===this.setUploadData(t,!1)&&e()}.bind(this)}).send()},on_upload_start:function(){this.messages.setStyle("display","none"),this.form.addClass(this.options.upload_options.activeClassName);var t=this.form.retrieve("uploads",0);1==++t&&this.form.getElements("input[type=submit]").each(function(t){t.store("pre_upload_disabled",t.hasClass("disabled")),t.addClass("disabled"),t.disabled=1}),this.form.store("uploads",t)},on_upload_complete:function(e,t){try{var i=JSON.decode(t.response,!0);this.setUploadData(i,!0)}catch(t){alert($I18N.t("Error during uploading:")+" "+e),Raven&&Raven.captureException&&Raven.captureException(t)}this.upload_ended()},setUploadData:function(t,e){if(t.file){var i=this.getFileData(t.file);if(!i||i.id!==this.fileIds[this.fileIds.length-1]&&this.fileIds.contains(i.id))return!1;this.setFile(t.file,!1),e&&i&&(this.fileId=i.id,this.result.set("value",t.file),$QTI.fireChangeEvent(this.result))}t.message&&e&&(this.messages.setStyle("display","inline-block"),this.messages.set("text",t.message)),t.value&&((e=this.element.getElement(".qti-value-container")).set("html",t.value),delete e.$qti,$QTI.loadQTI(e),e.fireEvent("change"))},upload_ended:function(){var t=this.form.retrieve("uploads",1);1===t&&(this.form.removeClass(this.options.upload_options.activeClassName),this.form.getElements("input[type=submit]").each(function(t){t.store("pre_upload_disabled",t.hasClass("disabled")),t.retrieve("pre_upload_disabled",!1)&&(t.removeClass("disabled"),t.disabled=0),t.eliminate("pre_upload_disabled")})),this.form.store("uploads",t-1)},parseURL:function(t){var e=document.createElement("a");return{source:e.href=t,protocol:e.protocol.replace(":",""),host:e.hostname,port:e.port,path:("/"+e.pathname).replace("//","/"),query:e.search,params:""===e.search||"?"===e.search?{}:e.search.substring(1).parseQueryString(!1,!1)}},on_upload_progress:function(t){t=Math.round(t.loaded/t.total*100)+"%";this.messages.setStyle("display","inline-block"),this.messages.set("text",t)},onOnline:function(){this.online=!0,this.wrapper.removeClass("disabled")},onOffline:function(){this.online=!1,this.wrapper.addClass("disabled")},getAnswerStatus:function(){return this.result&&""!==this.result.value?"answered":"unanswered"}}),selectPointInteraction=new Class({Extends:graphicInteraction,opacity:.4,maxChoices:1,minChoices:0,inputName:"",outputField:!1,candidateResponse:[],options:{enableUserInteraction:!0},image_loaded:function(){this.maxChoices=this.element.getProperty("data-maxchoices"),this.minChoices=this.element.getProperty("data-minchoices"),this.inputName=this.element.getProperty("data-inputname"),this.outputField=this.element.getElement('input[name="'+this.inputName+'"]');var t=null;if((t=this.outputField?this.outputField.get("value"):t)&&(this.candidateResponse=JSON.decode(t)),this.showSolution&&this.displaySolution(),!this.showReview){1==this.maxChoices?this.gutter.setStyle("padding",0):this.gutter.setStyle("height","auto");for(var e=0;e<this.maxChoices;e++){var i=this.newPointerElement();this.gutter.grab(i),this.options.enableUserInteraction&&this.makeDraggable(i)}var n=this.gutter.getChildren("."+this.options.pointerClass)}this.candidateResponse.each(function(t){var e=this.showReview?this.newPointerElement():n.shift();e&&(t=this.limitToCanvas(t),this.showReview&&this.polygonViewer.element.grab(e),this.setDrag(e),e.setStyles({left:t.x-this.options.pointerOffset.x,top:t.y-this.options.pointerOffset.y}),e.set("data-x",Math.round(t.x)),e.set("data-y",Math.round(t.y)),this.usedPointers.push(e))},this),this.showReview||(this.options.enableUserInteraction&&this.polygonViewer.addEvent("click",this.elementClicked.bind(this)),this.setOutputVariables(!0))},elementClicked:function(t,e,i){if(this.dropped)this.dropped=!1;else{for(var n=this.gutter.getChildren("."+this.options.pointerClass),r=this.usedPointers.length-1;0<=r&&!(n.length<=1);r--)n.erase(this.usedPointers[r]);var a=n.shift();this.setDrag(a),i=this.limitToCanvas(i,!1),a.setStyles({left:i.x-this.options.pointerOffset.x,top:i.y-this.options.pointerOffset.y}),a.set("data-x",Math.round(i.x)),a.set("data-y",Math.round(i.y)),this.usedPointers.erase(a),this.usedPointers.push(a),this.setOutputVariables()}},onPointerDrop:function(t,e,i){var n=t.getSize(),r=Math.round(n.x/2),n=Math.round(n.y/2);i.page=t.getPosition(),i.page&&(i.page.x+=r,i.page.y+=n),this.dropped=!0,this.parent(t,e,i),this.setOutputVariables()},setOutputVariables:function(t){var i,e;this.outputField&&(i=[],this.usedPointers.each(function(t){var e=t.get("data-x"),t=t.get("data-y");null!==e&&null!==t&&i.push({x:e.toInt(),y:t.toInt()})},this),e=this.outputField.getProperty("value"),0===i.length?this.outputField.setProperty("value",""):this.outputField.setProperty("value",JSON.encode(i)),!t||(t="form"===this.container.get("tag")?this.container:this.container.getParent("form"))&&t.fireEvent("update"),e!==this.outputField.getProperty("value")&&$QTI.fireChangeEvent(this.outputField))},displaySolution:function(){var t=(t=this.element.getProperty("data-solution"))?JSON.decode(t):[],e=this.element.getParent("div.qti-itemBody"),i=!0;e&&!e.hasClass("qti-view-author")&&(i=!1),t.each(function(t,e){t.options={},!i&&0===this.candidateResponse.length||t.containsCandidateResponse?t.options.color="#b3fbad":i?0===this.candidateResponse.length?t.options.color=this.options.colors[e%this.options.colors.length]:t.options.color="#ffde64":t.options.color="#fbadad"},this),this.polygonViewer.add_paths(t)}}),graphicAssociateInteraction=new Class({Extends:graphicInteraction,opacity:.4,maxAssociations:1,minAssociations:0,inputName:"",outputField:!1,candidateResponse:[],options:{shape_opacity:.3,enableUserInteraction:!0},initialize:function(t,e){this.parent(t,e),this.maxAssociations=this.element.getProperty("data-maxassociations").toInt(),this.minAssociations=this.element.getProperty("data-minassociations").toInt(),this.inputName=this.element.getProperty("data-inputname"),this.outputField=this.element.getElement('input[name="'+this.inputName+'"]')},image_loaded:function(){var t;!this.outputField||(t=JSON.decode(this.outputField.get("value")))&&(this.candidateResponse=t),this.loadHotspots("qti-associableHotspot"),this.load_gutter(),this.showSolution&&this.displaySolution(),this.showCandidateResponse(),this.showReview||(this.options.enableUserInteraction&&this.start(),this.setOutputVariables())},load_gutter:function(){this.showReview||(this.undo_button=new Element("button.qti-button.disabled.has-icon",{html:"<span class='fas fa-undo'></span>"+$I18N.t("Undo"),type:"button",name:"undo",title:$I18N.t("Remove the last connection you created."),disabled:!0,events:{click:this.undo.bind(this)}}),this.gutter.grab(this.undo_button),this.gutter.setStyles({"text-align":"center"}))},start:function(){var t;this.candidateResponse.length<this.maxAssociations||0==this.maxAssociations?(this.interacting=!0,this.container.setStyle("cursor","crosshair"),(t=new PEConnector(this.polygonViewer,{is_user_interaction:!0})).start(),t.addEvent("destroy",function(){this.start()}.bind(this)),t.addEvent("connect",function(t){this.on_connect(t),this.setOutputVariables(),this.start()}.bind(this))):(this.container.setStyle("cursor","default"),this.interacting=!1)},on_connect:function(i){var e={},n=!1;this.polygonViewer.connections.each(function(t){t!==i&&(i.shape_1.identifier===t.shape_1.identifier&&i.shape_2.identifier===t.shape_2.identifier||i.shape_1.identifier===t.shape_2.identifier&&i.shape_2.identifier===t.shape_1.identifier)&&t.options.is_user_interaction===i.options.is_user_interaction?(i.destroy(),n=!0):t.options.is_user_interaction&&(e[t.shape_1.identifier]||(e[t.shape_1.identifier]=0),e[t.shape_1.identifier]++,e[t.shape_2.identifier]||(e[t.shape_2.identifier]=0),e[t.shape_2.identifier]++)}),0<this.maxAssociations&&this.polygonViewer.connections.filter(function(t){return t.options.is_user_interaction}).length>this.maxAssociations&&(i.destroy(),n=!0),n||Object.each(e,function(t,e){0!==this.hotspots[e].match_max&&t>this.hotspots[e].match_max&&(i.shape_1.identifier===e||i.shape_2.identifier===e)&&i.destroy()},this)},showCandidateResponse:function(){0<this.candidateResponse.length&&(this.candidateResponse.each(function(t){this.polygonViewer.connect(t[0],t[1],{is_user_interaction:!0})},this),this.setOutputVariables())},elementClicked:function(t){},setOutputVariables:function(){var t;this.candidateResponse=[],this.polygonViewer.connections.each(function(t){var e;t.options.is_user_interaction&&(0==this.maxAssociations||this.candidateResponse.length<this.maxAssociations)&&((e=[]).push(t.shape_1.identifier),e.push(t.shape_2.identifier),e.sort(),this.candidateResponse.push(e))},this),this.undo_button&&(0===this.candidateResponse.length?(this.undo_button.set("disabled",!0),this.undo_button.addClass("disabled")):(this.undo_button.set("disabled",!1),this.undo_button.removeClass("disabled"))),this.outputField&&(t=0<this.candidateResponse.length?JSON.encode(this.candidateResponse):"",this.outputField.getProperty("value")!==t&&(this.outputField.setProperty("value",t),$QTI.fireChangeEvent(this.outputField)))},displaySolution:function(){var t=(t=this.element.getProperty("data-solution"))?JSON.decode(t):[];Object.each(t,function(t,e){e=e.split(" ");this.polygonViewer.connect(e[0],e[1],{color:t.correct?"#35c12f":"#dfdfdf",dash:t.correct?"":".",width:2,end_size:3,is_user_interaction:!1})},this)},reset:function(){for(var t=this.polygonViewer.connections.length-1;0<=t;t--)this.polygonViewer.connections[t].options.is_user_interaction&&this.polygonViewer.connections[t].destroy();this.setOutputVariables()},undo:function(){for(var t=this.polygonViewer.connections.length-1;0<=t;t--)if(this.polygonViewer.connections[t].options.is_user_interaction){this.polygonViewer.connections[t].destroy();break}this.setOutputVariables(),this.interacting||this.start()},getAnswerStatus:function(){if(this.outputField&&""!==this.outputField.value){var t=JSON.parse(this.outputField.value);return _.size(t)<this.minAssociations?"partly":"answered"}return"unanswered"}}),drawingInteraction=new Class({Extends:interaction,assessmentItemIdentifier:"",inputElement:null,drawingComponent:null,form:null,dataName:"",uploadName:"",offlineEvent:void 0,uploading:!1,uploadingEvent:void 0,initData:void 0,initialize:function(t,e){this.parent(t),this.assessmentItemIdentifier=this.element.getAttribute("data-assessmentitem-identifier"),this.responseIdentifier=this.element.getAttribute("data-response-identifier"),this.id=this.assessmentItemIdentifier+"["+this.responseIdentifier+"]",this.dataName="formdata["+this.assessmentItemIdentifier+"]["+this.responseIdentifier+"]",this.uploadName=this.assessmentItemIdentifier+"["+this.responseIdentifier+"-DRAWING]",this.form=this.element.getParent("form"),this.inputElement=this.element.getElement("input[name="+this.id+"]"),this.element.addEventListener("drawing-loaded",this.onDrawingLoaded.bind(this)),this.element.addEventListener("drawing-updated",this.onDrawingUpdated.bind(this)),window.addEventListener("online",this.onNetworkIsOnline.bind(this))},onDrawingLoaded:function(t){this.drawingComponent=t.target,this.initData&&(this.drawingComponent.$setResponse(this.initData),this.initData=void 0)},onDrawingUpdated:function(t){var e;window.navigator.onLine?this.uploading?this.uploadingEvent=t:(e={url:this.makeUploadUrl(),headers:{Accept:"application/json","X-Request":"REST",[window.getCSRFHeaderName()]:window.getCSRFToken()},files:{[this.uploadName]:t.detail.file},data:{[this.dataName]:JSON.stringify({historyState:t.detail.historyState})},upload:function(){this.isUploading=!0}.bind(this),complete:function(){this.isUploading=!1,this.uploadingEvent?(this.onDrawingUpdated(this.offlineEvent),this.uploadingEvent=void 0):$QTI.fireChangeEvent(this.inputElement)}.bind(this)},FileAPI.upload(e)):this.offlineEvent=t},onNetworkIsOnline:function(){window.navigator.onLine&&this.offlineEvent&&(this.onDrawingUpdated(this.offlineEvent),this.offlineEvent=void 0)},makeUploadUrl(){var t=new URI(this.form.get("action")),e=new URLSearchParams(t.parsed.query);return e.set("timestamp",Date.now()),e.set("upload_name",this.uploadName),e.set("id",String.uniqueID()),t.parsed.query=e.toString(),t.toString()},_setFormData:function(t,e){if(null!=t){var i;if(t&&t[this.assessmentItemIdentifier]&&t[this.assessmentItemIdentifier][this.responseIdentifier])i=t[this.assessmentItemIdentifier][this.responseIdentifier];else{if(!t||!t[this.id])return;i=t[this.id]}i=i.startsWith("qtifile://")?this.decodeQtiFile(i):this.decodeResponse(i),this.inputElement.set("value",JSON.stringify(i)),this.drawingComponent?this.drawingComponent.$setResponse(i):this.initData=i}else this.drawingComponent&&this.drawingComponent.$setResponse(null)},decodeQtiFile:function(e){e=(e=(e=e.replace("qtifile://","")).split("/"))[0].replace("-","+").replace("_","/").replace(",","="),e=window.atob(e);try{e=JSON.parse(e)}catch(t){e={}}return e.metadata||{historyState:[]}},decodeResponse:function(t){try{return JSON.parse(t)}catch(t){return{historyState:[]}}},validate:function(t=0){return!(this.initData||this.uploading||this.offlineEvent||this.uploadingEvent)},getAnswerStatus:function(){try{if(!this.inputElement)throw new Error;var t=this.inputElement.get("value");if(!t)throw new Error;if(t=JSON.parse(t),!Array.isArray(t.historyState)||t.historyState.length<2)throw new Error}catch(t){return"unanswered"}return"answered"}}),positionObjectStage=new Class({Extends:graphicInteraction,opacity:.4,maxChoices:1,minChoices:0,inputName:"",outputField:!1,candidateResponse:[],interactions:{},options:{enableUserInteraction:!0},initialize:function(n,t){n.getElements("div.qti-positionObjectInteraction").each(function(t){var e=t.get("data-response-identifier");this.interactions[e]={},this.interactions[e].maxChoices=t.getProperty("data-maxchoices").toInt(),this.interactions[e].minChoices=t.getProperty("data-minchoices").toInt(),this.interactions[e].choices=0,this.interactions[e].inputName=t.getProperty("data-inputname"),this.interactions[e].solution=t.getProperty("data-solution"),this.interactions[e].elements=[],this.interactions[e].elements.push(t),this.interactions[e].solution&&(this.interactions[e].solution=JSON.decode(this.interactions[e].solution));var i=t.getProperty("data-candidate-response");this.interactions[e].candidateResponse=!!i&&JSON.decode(i),!!n.getParent(".qti-display-review")||n.hasClass("qti-display-review")?(t.addEvent("mouseenter",function(t){this.showCorrectAnswers(e)}.bind(this)),t.addEvent("mouseleave",function(t){this.hideCorrectAnswers(e)}.bind(this))):(this.interactions[e].outputField=new Element("input",{type:"hidden",name:this.interactions[e].inputName}),n.grab(this.interactions[e].outputField))},this),this.parent(n,t)},setResponse:function(t,e){var i,n=this.interactions[e].elements.pick().getAttribute("data-assessmentitem-identifier");n&&e&&((i={})[n]={},i[n][e]=JSON.decode(t),this.setFormData(i))},loadResponse:function(t,e){var r=this.interactions[e].elements.pick(),a=r;t.each(function(t){var e=this.onPointerBeforeDragStart(a);this.usedPointers.push(a),this.showReview&&this.polygonViewer.element.grab(a);var i,n=r.get("data-centerPoint");n=n?(i=n.split(" "),{x:parseInt(i[0]),y:parseInt(i[1])}):(i=r.getSize(),{x:Math.round(i.x/2),y:Math.round(i.y/2)}),t=this.limitToCanvas(t),a.setStyles({left:t.x-n.x,top:t.y-n.y,position:"absolute"}),a.set("data-x",t.x),a.set("data-y",t.y),a=e},this)},showCorrectAnswers:function(i){Object.each(this.interactions,function(t,e){e!==i&&null!=t.solution&&t.solution.each(function(t){this.polygonViewer.shapes[t.identifier].path.hide()}.bind(this))}.bind(this))},hideCorrectAnswers:function(i){Object.each(this.interactions,function(t,e){e!==i&&null!=t.solution&&t.solution.each(function(t){this.polygonViewer.shapes[t.identifier].path.show()}.bind(this))}.bind(this))},_setFormData:function(t,e){return e=e||"",Array.isArray(t)&&(t=JSON.stringify(t)),this.parent(t,e)},image_loaded:function(){Object.each(this.interactions,function(t,e){var i=t.elements.pick();this.showReview||(this.gutter.setStyle("height","auto"),0===i.getElements(this.gutter).length&&this.gutter.grab(i),this.options.enableUserInteraction&&this.makeDraggable(i)),t.candidateResponse?this.loadResponse(t.candidateResponse,e):t.outputField&&""!==t.outputField.value&&this.loadResponse(JSON.parse(t.outputField.value),e)},this),this.showReview&&this.checkResponseOverflow(),this.showReview||this.setOutputVariables(!0),this.showSolution&&this.displaySolution()},onPointerDrop:function(t,e,i){var n,r=t.get("data-centerPoint");r||(n=t.getSize(),r={x:Math.round(n.x/2),y:Math.round(n.y/2)}),i.page=t.getPosition(),i.page&&(i.page.x+=r.x,i.page.y+=r.y),this.parent(t,e,i),this.setOutputVariables()},onPointerBeforeDragStart:function(t){var e=t.get("data-response-identifier");t.get("data-candidate-response")||t.store("gutter-styles",t.getStyles("padding","margin"));var i,n=t.getPosition(this.polygonViewer.element);return t.setStyles({padding:0,margin:0}),this.usedPointers.contains(t)||(this.interactions[e].choices++,(this.interactions[e].choices<this.interactions[e].maxChoices||0==this.interactions[e].maxChoices)&&(i=t.clone().setStyle("visibility","visible").inject(t,"after"),e=t.retrieve("gutter-styles",{}),i.setStyles(e),this.showReview||this.makeDraggable(i))),this.setDrag(t,n),i||t},returnToGutter:function(t){var e,i=t.get("data-response-identifier");this.interactions[i].choices===this.interactions[i].maxChoices?(t.removeClass("drag"),t.removeProperty(this.options.dragClass),!1!==(e=t.retrieve("gutter-styles",!1))?(t.set("style",""),t.setStyles(e)):t.set("style","")):(this.interactions[i].elements.erase(t),t.destroy()),this.interactions[i].choices--},setOutputVariables:function(t){var n,i;this.showReview||(n={},Object.each(this.interactions,function(t,e){void 0===n[e]&&(n[e]=[])},this),this.usedPointers.each(function(t){var e=t.get("data-response-identifier");n[e]||(n[e]=[]);var i=t.get("data-x"),t=t.get("data-y");null!==i&&null!==t&&n[e].push({x:i.toInt(),y:t.toInt()})},this),i=[],Object.each(n,function(t,e){e=this.interactions[e].outputField;!e||(t=0===t.length?"":JSON.encode(t))!==e.getProperty("value")&&(i.push(e),e.setProperty("value",t))},this),!t||(t="form"===this.container.get("tag")?this.container:this.container.getParent("form"))&&t.fireEvent("update"),i.each(function(t){$QTI.fireChangeEvent(t)}))},displaySolution:function(){var t=this.element.getParent("div.qti-itemBody"),o=!0;t&&!t.hasClass("qti-view-author")&&(o=!1);var l=[],u=0;Object.each(this.interactions,function(a,s){a.solution&&a.solution.each(function(t,e){if(t.options={},t.identifier=s+"-"+e,!o&&0===a.candidateResponse.length||t.containsCandidateResponse)t.options.color="#b3fbad";else if(o)!1===a.candidateResponse||0===a.candidateResponse.length?(t.options.color=this.options.colors[u%this.options.colors.length],a.color=t.options.color):t.options.color="#ffde64";else{for(var i=!1,n=0,r=a.solution.length;n<r;n++)n!==e&&a.solution[n].containsCandidateResponse&&(i=!0);t.options.color=i?"#cccccc":"#fbadad"}l.push(t)},this),u++},this),this.polygonViewer.add_paths(l)},getAnswerStatus:function(){var t,e=null;for(t in this.interactions){var i=0;this.interactions[t].outputField&&0<this.interactions[t].outputField.value.length&&(n=JSON.parse(this.interactions[t].outputField.value),i=_.size(n));var n="unanswered";if(0<i&&i<this.interactions[t].minChoices?n="partly":0<i&&(n="answered"),"partly"===n){e=n;break}if("answered"===n){if("unanswered"===e){e="partly";break}e=n}else if("unanswered"===n){if("answered"===e){e="partly";break}e=n}}return e=null===e?"unanswered":e},checkResponseOverflow:function(){const t=window.getComputedStyle(this.container),i=parseInt(t.getPropertyValue("height")),n=parseInt(t.getPropertyValue("width"));var e=this.usedPointers.reduce((t,e)=>({top:Math.min(t.top,e.offsetTop),left:Math.min(t.left,e.offsetLeft),bottom:Math.max(t.bottom,e.offsetTop+e.offsetHeight-i),right:Math.max(t.right,e.offsetLeft+e.offsetWidth-n)}),{top:0,left:0,bottom:0,right:0});0==e.top&&0==e.left&&0==e.bottom&&0==e.right||(this.container.setStyle("height",i+"px"),this.polygonViewer.element.setStyle("margin",`${-e.top}px ${e.right}px ${e.bottom}px ${-e.left}px`),this.container.scrollTop=-e.top,this.container.scrollLeft=-e.left)}}),worksheetInteraction=new Class({Extends:interaction,Binds:["onWorksheetLoaded"],worksheetComponent:!1,initData:null,initialize:function(t,e){this.parent(t,e),(e=t.querySelector("div[data-qti-worksheet]"))?t.addEventListener("worksheet-loaded",this.onWorksheetLoaded):(e=t.querySelector(".qti-worksheet"))&&this.onWorksheetLoaded({target:e})},onWorksheetLoaded:function(t){this.worksheetComponent=t.target,null!==this.initData&&this.worksheetComponent&&(this.worksheetComponent.$setResponse(this.initData),this.initData=null)},_setFormData:function(t,e){var i,n=this.element.getAttribute("data-response-identifier"),r=this.element.getAttribute("data-assessmentitem-identifier");null===t&&this.worksheetComponent?this.worksheetComponent.$setResponse(null):(i={},"string"==typeof(i=t[r][n]?t[r][n]:i)&&(i=JSON.parse(i)),this.worksheetComponent?this.worksheetComponent.$setResponse(i):this.initData=i)}}),algebrakitInteraction=new Class({Extends:interaction,sessionId:null,initialize:function(t){this.parent(t),this.element.addEventListener("session-id-updated",this.onSessionIdUpdated.bind(this))},validate:function(t=!1){var e=this.element.querySelector('akit-exercise[session-id="'+this.sessionId+'"]');if(!e||!e.submit||!e.finishPendingEvents)return!0;let i=[];return t&&i.push(e.submit().then(function(){return!0}).catch(function(){return!0})),i.push(e.finishPendingEvents().then(function(){return!0}).catch(function(){return!1})),i},onSessionIdUpdated:function(t){t.detail.sessionId&&(this.sessionId=t.detail.sessionId)},destroy:function(){this.element.removeEventListener("session-id-updated",this.onSessionIdUpdated)}}),endAttemptInteraction=new Class({Extends:interaction,initialize:function(t,e){this.parent(t)},getAnswerStatus:function(){return"exclude"}});
//# sourceMappingURL=qti-player.js.map